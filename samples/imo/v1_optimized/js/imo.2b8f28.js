if(typeof YUI!="undefined"){YUI._YUI=YUI;
}var YUI=function(){var c=0,f=this,b=arguments,a=b.length,e=function(h,g){return(h&&h.hasOwnProperty&&(h instanceof g));
},d=(typeof YUI_config!=="undefined")&&YUI_config;
if(!(e(f,YUI))){f=new YUI();
}else{f._init();
if(YUI.GlobalConfig){f.applyConfig(YUI.GlobalConfig);
}if(d){f.applyConfig(d);
}if(!a){f._setup();
}}if(a){for(;
c<a;
c++){f.applyConfig(b[c]);
}f._setup();
}f.instanceOf=e;
return f;
};
(function(){var p,b,q="3.4.1",h=".",n="http://yui.yahooapis.com/",t="yui3-js-enabled",l=function(){},g=Array.prototype.slice,r={"io.xdrReady":1,"io.xdrResponse":1,"SWF.eventHandler":1},f=(typeof window!="undefined"),e=(f)?window:null,v=(f)?e.document:null,d=v&&v.documentElement,a=d&&d.className,c={},i=new Date().getTime(),m=function(z,y,x,w){if(z&&z.addEventListener){z.addEventListener(y,x,w);
}else{if(z&&z.attachEvent){z.attachEvent("on"+y,x);
}}},u=function(A,z,y,w){if(A&&A.removeEventListener){try{A.removeEventListener(z,y,w);
}catch(x){}}else{if(A&&A.detachEvent){A.detachEvent("on"+z,y);
}}},s=function(){YUI.Env.windowLoaded=true;
YUI.Env.DOMReady=true;
if(f){u(window,"load",s);
}},j=function(y,x){var w=y.Env._loader;
if(w){w.ignoreRegistered=false;
w.onEnd=null;
w.data=null;
w.required=[];
w.loadType=null;
}else{w=new y.Loader(y.config);
y.Env._loader=w;
}YUI.Env.core=y.Array.dedupe([].concat(YUI.Env.core,["loader-base","loader-rollup","loader-yui3"]));
return w;
},o=function(y,x){for(var w in x){if(x.hasOwnProperty(w)){y[w]=x[w];
}}},k={success:true};
if(d&&a.indexOf(t)==-1){if(a){a+=" ";
}a+=t;
d.className=a;
}if(q.indexOf("@")>-1){q="3.3.0";
}p={applyConfig:function(D){D=D||l;
var y,A,z=this.config,B=z.modules,x=z.groups,C=z.rls,w=this.Env._loader;
for(A in D){if(D.hasOwnProperty(A)){y=D[A];
if(B&&A=="modules"){o(B,y);
}else{if(x&&A=="groups"){o(x,y);
}else{if(C&&A=="rls"){o(C,y);
}else{if(A=="win"){z[A]=y.contentWindow||y;
z.doc=z[A].document;
}else{if(A=="_yuid"){}else{z[A]=y;
}}}}}}}if(w){w._config(D);
}},_config:function(w){this.applyConfig(w);
},_init:function(){var y,z=this,w=YUI.Env,x=z.Env,A;
z.version=q;
if(!x){z.Env={core:["get","features","intl-base","yui-log","yui-later","loader-base","loader-rollup","loader-yui3"],mods:{},versions:{},base:n,cdn:n+q+"/build/",_idx:0,_used:{},_attached:{},_missed:[],_yidx:0,_uidx:0,_guidp:"y",_loaded:{},_BASE_RE:/(?:\?(?:[^&]*&)*([^&]*))?\b(simpleyui|yui(?:-\w+)?)\/\2(?:-(min|debug))?\.js/,parseBasePath:function(F,D){var B=F.match(D),E,C;
if(B){E=RegExp.leftContext||F.slice(0,F.indexOf(B[0]));
C=B[3];
if(B[1]){E+="?"+B[1];
}E={filter:C,path:E};
}return E;
},getBase:w&&w.getBase||function(F){var D=(v&&v.getElementsByTagName("script"))||[],G=x.cdn,C,E,B,H;
for(E=0,B=D.length;
E<B;
++E){H=D[E].src;
if(H){C=z.Env.parseBasePath(H,F);
if(C){y=C.filter;
G=C.path;
break;
}}}return G;
}};
x=z.Env;
x._loaded[q]={};
if(w&&z!==YUI){x._yidx=++w._yidx;
x._guidp=("yui_"+q+"_"+x._yidx+"_"+i).replace(/\./g,"_");
}else{if(YUI._YUI){w=YUI._YUI.Env;
x._yidx+=w._yidx;
x._uidx+=w._uidx;
for(A in w){if(!(A in x)){x[A]=w[A];
}}delete YUI._YUI;
}}z.id=z.stamp(z);
c[z.id]=z;
}z.constructor=YUI;
z.config=z.config||{win:e,doc:v,debug:true,useBrowserConsole:true,throwFail:true,bootstrap:true,cacheUse:true,fetchCSS:true,use_rls:false,rls_timeout:2000};
if(YUI.Env.rls_disabled){z.config.use_rls=false;
}z.config.lang=z.config.lang||"en-US";
z.config.base=YUI.config.base||z.Env.getBase(z.Env._BASE_RE);
if(!y||(!("mindebug").indexOf(y))){y="min";
}y=(y)?"-"+y:y;
z.config.loaderPath=YUI.config.loaderPath||"loader/loader"+y+".js";
},_setup:function(B){var x,A=this,w=[],z=YUI.Env.mods,y=A.config.core||[].concat(YUI.Env.core);
for(x=0;
x<y.length;
x++){if(z[y[x]]){w.push(y[x]);
}}A._attach(["yui-base"]);
A._attach(w);
if(A.Loader){j(A);
}},applyTo:function(C,B,y){if(!(B in r)){this.log(B+": applyTo not allowed","warn","yui");
return null;
}var x=c[C],A,w,z;
if(x){A=B.split(".");
w=x;
for(z=0;
z<A.length;
z=z+1){w=w[A[z]];
if(!w){this.log("applyTo not found: "+B,"warn","yui");
}}return w.apply(x,y);
}return null;
},add:function(x,C,B,w){w=w||{};
var A=YUI.Env,D={name:x,fn:C,version:B,details:w},E,z,y=A.versions;
A.mods[x]=D;
y[B]=y[B]||{};
y[B][x]=D;
for(z in c){if(c.hasOwnProperty(z)){E=c[z].Env._loader;
if(E){if(!E.moduleInfo[x]){E.addModule(w,x);
}}}}return this;
},_attach:function(B,M){var F,N,L,I,w,D,y,z=YUI.Env.mods,G=YUI.Env.aliases,x=this,E,A=x.Env._loader,C=x.Env._attached,H=B.length,A,K=[];
for(F=0;
F<H;
F++){N=B[F];
L=z[N];
K.push(N);
if(A&&A.conditions[N]){x.Object.each(A.conditions[N],function(P){var O=P&&((P.ua&&x.UA[P.ua])||(P.test&&P.test(x)));
if(O){K.push(P.name);
}});
}}B=K;
H=B.length;
for(F=0;
F<H;
F++){if(!C[B[F]]){N=B[F];
L=z[N];
if(G&&G[N]){x._attach(G[N]);
continue;
}if(!L){if(A&&A.moduleInfo[N]){L=A.moduleInfo[N];
M=true;
}if(!M){if((N.indexOf("skin-")===-1)&&(N.indexOf("css")===-1)){x.Env._missed.push(N);
x.Env._missed=x.Array.dedupe(x.Env._missed);
x.message("NOT loaded: "+N,"warn","yui");
}}}else{C[N]=true;
for(E=0;
E<x.Env._missed.length;
E++){if(x.Env._missed[E]===N){x.message("Found: "+N+" (was reported as missing earlier)","warn","yui");
x.Env._missed.splice(E,1);
}}I=L.details;
w=I.requires;
D=I.use;
y=I.after;
if(w){for(E=0;
E<w.length;
E++){if(!C[w[E]]){if(!x._attach(w)){return false;
}break;
}}}if(y){for(E=0;
E<y.length;
E++){if(!C[y[E]]){if(!x._attach(y,true)){return false;
}break;
}}}if(L.fn){try{L.fn(x,N);
}catch(J){x.error("Attach error: "+N,J,N);
return false;
}}if(D){for(E=0;
E<D.length;
E++){if(!C[D[E]]){if(!x._attach(D)){return false;
}break;
}}}}}}return true;
},use:function(){var y=g.call(arguments,0),C=y[y.length-1],B=this,A=0,x,w=B.Env,z=true;
if(B.Lang.isFunction(C)){y.pop();
}else{C=null;
}if(B.Lang.isArray(y[0])){y=y[0];
}if(B.config.cacheUse){while((x=y[A++])){if(!w._attached[x]){z=false;
break;
}}if(z){if(y.length){}B._notify(C,k,y);
return B;
}}if(B._loading){B._useQueue=B._useQueue||new B.Queue();
B._useQueue.add([y,C]);
}else{B._use(y,function(E,D){E._notify(C,D,y);
});
}return B;
},_notify:function(z,w,x){if(!w.success&&this.config.loadErrorFn){this.config.loadErrorFn.call(this,this,z,w,x);
}else{if(z){try{z(this,w);
}catch(y){this.error("use callback error",y,x);
}}}},_use:function(y,A){if(!this.Array){this._attach(["yui-base"]);
}var M,F,N,K,x=this,O=YUI.Env,z=O.mods,w=x.Env,C=w._used,J=O._loaderQueue,R=y[0],E=x.Array,P=x.config,D=P.bootstrap,L=[],H=[],Q=true,B=P.fetchCSS,I=function(T,S){if(!T.length){return;
}E.each(T,function(W){if(!S){H.push(W);
}if(C[W]){return;
}var U=z[W],X,V;
if(U){C[W]=true;
X=U.details.requires;
V=U.details.use;
}else{if(!O._loaded[q][W]){L.push(W);
}else{C[W]=true;
}}if(X&&X.length){I(X);
}if(V&&V.length){I(V,1);
}});
},G=function(W){var U=W||{success:true,msg:"not dynamic"},T,S,V=true,X=U.data;
x._loading=false;
if(X){S=L;
L=[];
H=[];
I(X);
T=L.length;
if(T){if(L.sort().join()==S.sort().join()){T=false;
}}}if(T&&X){x._loading=false;
x._use(y,function(){if(x._attach(X)){x._notify(A,U,X);
}});
}else{if(X){V=x._attach(X);
}if(V){x._notify(A,U,y);
}}if(x._useQueue&&x._useQueue.size()&&!x._loading){x._use.apply(x,x._useQueue.next());
}};
if(R==="*"){Q=x._attach(x.Object.keys(z));
if(Q){G();
}return x;
}if(D&&x.Loader&&y.length){F=j(x);
F.require(y);
F.ignoreRegistered=true;
F.calculate(null,(B)?null:"js");
y=F.sorted;
}I(y);
M=L.length;
if(M){L=x.Object.keys(E.hash(L));
M=L.length;
}if(D&&M&&x.Loader){x._loading=true;
F=j(x);
F.onEnd=G;
F.context=x;
F.data=y;
F.ignoreRegistered=false;
F.require(y);
F.insert(null,(B)?null:"js");
}else{if(M&&x.config.use_rls&&!YUI.Env.rls_enabled){O._rls_queue=O._rls_queue||new x.Queue();
K=function(S,U){var T=function(W){G(W);
S.rls_advance();
},V=S._rls(U);
if(V){S.rls_oncomplete(function(W){T(W);
});
S.Get.script(V,{data:U,timeout:S.config.rls_timeout,onFailure:S.rls_handleFailure,onTimeout:S.rls_handleTimeout});
}else{T({success:true,data:U});
}};
O._rls_queue.add(function(){O._rls_in_progress=true;
x.rls_callback=A;
x.rls_locals(x,y,K);
});
if(!O._rls_in_progress&&O._rls_queue.size()){O._rls_queue.next()();
}}else{if(D&&M&&x.Get&&!w.bootstrapped){x._loading=true;
N=function(){x._loading=false;
J.running=false;
w.bootstrapped=true;
O._bootstrapping=false;
if(x._attach(["loader"])){x._use(y,A);
}};
if(O._bootstrapping){J.add(N);
}else{O._bootstrapping=true;
x.Get.script(P.base+P.loaderPath,{onEnd:N});
}}else{Q=x._attach(y);
if(Q){G();
}}}}return x;
},namespace:function(){var x=arguments,B=this,z=0,y,A,w;
for(;
z<x.length;
z++){w=x[z];
if(w.indexOf(h)){A=w.split(h);
for(y=(A[0]=="YAHOO")?1:0;
y<A.length;
y++){B[A[y]]=B[A[y]]||{};
B=B[A[y]];
}}else{B[w]=B[w]||{};
}}return B;
},log:l,message:l,dump:function(w){return""+w;
},error:function(A,y,x){var z=this,w;
if(z.config.errorFn){w=z.config.errorFn.apply(z,arguments);
}if(z.config.throwFail&&!w){throw (y||new Error(A));
}else{z.message(A,"error");
}return z;
},guid:function(w){var x=this.Env._guidp+"_"+(++this.Env._uidx);
return(w)?(w+x):x;
},stamp:function(y,z){var w;
if(!y){return y;
}if(y.uniqueID&&y.nodeType&&y.nodeType!==9){w=y.uniqueID;
}else{w=(typeof y==="string")?y:y._yuid;
}if(!w){w=this.guid();
if(!z){try{y._yuid=w;
}catch(x){w=null;
}}}return w;
},destroy:function(){var w=this;
if(w.Event){w.Event._unload();
}delete c[w.id];
delete w.Env;
delete w.config;
}};
YUI.prototype=p;
for(b in p){if(p.hasOwnProperty(b)){YUI[b]=p[b];
}}YUI._init();
if(f){m(window,"load",s);
}else{s();
}YUI.Env.add=m;
YUI.Env.remove=u;
if(typeof exports=="object"){exports.YUI=YUI;
}}());
YUI.add("yui-base",function(b){var i=b.Lang||(b.Lang={}),n=String.prototype,k=Object.prototype.toString,a={"undefined":"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"},c=/\{\s*([^|}]+?)\s*(?:\|([^}]*))?\s*\}/g,s=/^\s+|\s+$/g,e=b.config.win,o=e&&!!(e.MooTools||e.Prototype);
i.isArray=(!o&&Array.isArray)||function(w){return i.type(w)==="array";
};
i.isBoolean=function(w){return typeof w==="boolean";
};
i.isFunction=function(w){return i.type(w)==="function";
};
i.isDate=function(w){return i.type(w)==="date"&&w.toString()!=="Invalid Date"&&!isNaN(w);
};
i.isNull=function(w){return w===null;
};
i.isNumber=function(w){return typeof w==="number"&&isFinite(w);
};
i.isObject=function(y,x){var w=typeof y;
return(y&&(w==="object"||(!x&&(w==="function"||i.isFunction(y)))))||false;
};
i.isString=function(w){return typeof w==="string";
};
i.isUndefined=function(w){return typeof w==="undefined";
};
i.trim=n.trim?function(w){return w&&w.trim?w.trim():w;
}:function(w){try{return w.replace(s,"");
}catch(x){return w;
}};
i.trimLeft=n.trimLeft?function(w){return w.trimLeft();
}:function(w){return w.replace(/^\s+/,"");
};
i.trimRight=n.trimRight?function(w){return w.trimRight();
}:function(w){return w.replace(/\s+$/,"");
};
i.isValue=function(x){var w=i.type(x);
switch(w){case"number":return isFinite(x);
case"null":case"undefined":return false;
default:return !!w;
}};
i.type=function(w){return a[typeof w]||a[k.call(w)]||(w?"object":"null");
};
i.sub=function(w,x){return w.replace?w.replace(c,function(y,z){return i.isUndefined(x[z])?y:x[z];
}):w;
};
i.now=Date.now||function(){return new Date().getTime();
};
var f=b.Lang,r=Array.prototype,p=Object.prototype.hasOwnProperty;
function j(y,B,A){var x,w;
B||(B=0);
if(A||j.test(y)){try{return r.slice.call(y,B);
}catch(z){w=[];
for(x=y.length;
B<x;
++B){w.push(y[B]);
}return w;
}}return[y];
}b.Array=j;
j.dedupe=function(B){var A={},y=[],x,z,w;
for(x=0,w=B.length;
x<w;
++x){z=B[x];
if(!p.call(A,z)){A[z]=1;
y.push(z);
}}return y;
};
j.each=j.forEach=r.forEach?function(y,w,x){r.forEach.call(y||[],w,x||b);
return b;
}:function(A,y,z){for(var x=0,w=(A&&A.length)||0;
x<w;
++x){if(x in A){y.call(z||b,A[x],x,A);
}}return b;
};
j.hash=function(z,x){var A={},B=(x&&x.length)||0,y,w;
for(y=0,w=z.length;
y<w;
++y){if(y in z){A[z[y]]=B>y&&y in x?x[y]:true;
}}return A;
};
j.indexOf=r.indexOf?function(x,w){return r.indexOf.call(x,w);
}:function(z,y){for(var x=0,w=z.length;
x<w;
++x){if(x in z&&z[x]===y){return x;
}}return -1;
};
j.numericSort=function(x,w){return x-w;
};
j.some=r.some?function(y,w,x){return r.some.call(y,w,x);
}:function(A,y,z){for(var x=0,w=A.length;
x<w;
++x){if(x in A&&y.call(z,A[x],x,A)){return true;
}}return false;
};
j.test=function(y){var w=0;
if(f.isArray(y)){w=1;
}else{if(f.isObject(y)){try{if("length" in y&&!y.tagName&&!y.alert&&!y.apply){w=2;
}}catch(x){}}}return w;
};
function u(){this._init();
this.add.apply(this,arguments);
}u.prototype={_init:function(){this._q=[];
},next:function(){return this._q.shift();
},last:function(){return this._q.pop();
},add:function(){this._q.push.apply(this._q,arguments);
return this;
},size:function(){return this._q.length;
}};
b.Queue=u;
YUI.Env._loaderQueue=YUI.Env._loaderQueue||new u();
var m="__",p=Object.prototype.hasOwnProperty,l=b.Lang.isObject;
b.cached=function(y,w,x){w||(w={});
return function(z){var A=arguments.length>1?Array.prototype.join.call(arguments,m):String(z);
if(!(A in w)||(x&&w[A]==x)){w[A]=y.apply(y,arguments);
}return w[A];
};
};
b.merge=function(){var y=arguments,z=0,x=y.length,w={};
for(;
z<x;
++z){b.mix(w,y[z],true);
}return w;
};
b.mix=function(w,x,D,y,A,E){var B,H,G,z,I,C,F;
if(!w||!x){return w||b;
}if(A){if(A===2){b.mix(w.prototype,x.prototype,D,y,0,E);
}G=A===1||A===3?x.prototype:x;
F=A===1||A===4?w.prototype:w;
if(!G||!F){return w;
}}else{G=x;
F=w;
}B=D&&!E;
if(y){for(z=0,C=y.length;
z<C;
++z){I=y[z];
if(!p.call(G,I)){continue;
}H=B?false:I in F;
if(E&&H&&l(F[I],true)&&l(G[I],true)){b.mix(F[I],G[I],D,null,0,E);
}else{if(D||!H){F[I]=G[I];
}}}}else{for(I in G){if(!p.call(G,I)){continue;
}H=B?false:I in F;
if(E&&H&&l(F[I],true)&&l(G[I],true)){b.mix(F[I],G[I],D,null,0,E);
}else{if(D||!H){F[I]=G[I];
}}}if(b.Object._hasEnumBug){b.mix(F,G,D,b.Object._forceEnum,A,E);
}}return w;
};
var p=Object.prototype.hasOwnProperty,e=b.config.win,o=e&&!!(e.MooTools||e.Prototype),v,g=b.Object=(!o&&Object.create)?function(w){return Object.create(w);
}:(function(){function w(){}return function(x){w.prototype=x;
return new w();
};
}()),d=g._forceEnum=["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"],t=g._hasEnumBug=!{valueOf:0}.propertyIsEnumerable("valueOf"),q=g._hasProtoEnumBug=(function(){}).propertyIsEnumerable("prototype"),h=g.owns=function(x,w){return !!x&&p.call(x,w);
};
g.hasKey=h;
g.keys=(!o&&Object.keys)||function(A){if(!b.Lang.isObject(A)){throw new TypeError("Object.keys called on a non-object");
}var z=[],y,x,w;
if(q&&typeof A==="function"){for(x in A){if(h(A,x)&&x!=="prototype"){z.push(x);
}}}else{for(x in A){if(h(A,x)){z.push(x);
}}}if(t){for(y=0,w=d.length;
y<w;
++y){x=d[y];
if(h(A,x)){z.push(x);
}}}return z;
};
g.values=function(A){var z=g.keys(A),y=0,w=z.length,x=[];
for(;
y<w;
++y){x.push(A[z[y]]);
}return x;
};
g.size=function(x){try{return g.keys(x).length;
}catch(w){return 0;
}};
g.hasValue=function(x,w){return b.Array.indexOf(g.values(x),w)>-1;
};
g.each=function(z,x,A,y){var w;
for(w in z){if(y||h(z,w)){x.call(A||b,z[w],w,z);
}}return b;
};
g.some=function(z,x,A,y){var w;
for(w in z){if(y||h(z,w)){if(x.call(A||b,z[w],w,z)){return true;
}}}return false;
};
g.getValue=function(A,z){if(!b.Lang.isObject(A)){return v;
}var x,y=b.Array(z),w=y.length;
for(x=0;
A!==v&&x<w;
x++){A=A[y[x]];
}return A;
};
g.setValue=function(C,A,B){var w,z=b.Array(A),y=z.length-1,x=C;
if(y>=0){for(w=0;
x!==v&&w<y;
w++){x=x[z[w]];
}if(x!==v){x[z[w]]=B;
}else{return v;
}}return C;
};
g.isEmpty=function(w){return !g.keys(w).length;
};
YUI.Env.parseUA=function(C){var B=function(F){var G=0;
return parseFloat(F.replace(/\./g,function(){return(G++==1)?"":".";
}));
},E=b.config.win,w=E&&E.navigator,z={ie:0,opera:0,gecko:0,webkit:0,safari:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:w&&w.cajaVersion,secure:false,os:null},x=C||w&&w.userAgent,D=E&&E.location,y=D&&D.href,A;
z.userAgent=x;
z.secure=y&&(y.toLowerCase().indexOf("https")===0);
if(x){if((/windows|win32/i).test(x)){z.os="windows";
}else{if((/macintosh/i).test(x)){z.os="macintosh";
}else{if((/rhino/i).test(x)){z.os="rhino";
}}}if((/KHTML/).test(x)){z.webkit=1;
}A=x.match(/AppleWebKit\/([^\s]*)/);
if(A&&A[1]){z.webkit=B(A[1]);
z.safari=z.webkit;
if(/ Mobile\//.test(x)){z.mobile="Apple";
A=x.match(/OS ([^\s]*)/);
if(A&&A[1]){A=B(A[1].replace("_","."));
}z.ios=A;
z.ipad=z.ipod=z.iphone=0;
A=x.match(/iPad|iPod|iPhone/);
if(A&&A[0]){z[A[0].toLowerCase()]=z.ios;
}}else{A=x.match(/NokiaN[^\/]*|webOS\/\d\.\d/);
if(A){z.mobile=A[0];
}if(/webOS/.test(x)){z.mobile="WebOS";
A=x.match(/webOS\/([^\s]*);/);
if(A&&A[1]){z.webos=B(A[1]);
}}if(/ Android/.test(x)){if(/Mobile/.test(x)){z.mobile="Android";
}A=x.match(/Android ([^\s]*);/);
if(A&&A[1]){z.android=B(A[1]);
}}}A=x.match(/Chrome\/([^\s]*)/);
if(A&&A[1]){z.chrome=B(A[1]);
z.safari=0;
}else{A=x.match(/AdobeAIR\/([^\s]*)/);
if(A){z.air=A[0];
}}}if(!z.webkit){A=x.match(/Opera[\s\/]([^\s]*)/);
if(A&&A[1]){z.opera=B(A[1]);
A=x.match(/Version\/([^\s]*)/);
if(A&&A[1]){z.opera=B(A[1]);
}A=x.match(/Opera Mini[^;]*/);
if(A){z.mobile=A[0];
}}else{A=x.match(/MSIE\s([^;]*)/);
if(A&&A[1]){z.ie=B(A[1]);
}else{A=x.match(/Gecko\/([^\s]*)/);
if(A){z.gecko=1;
A=x.match(/rv:([^\s\)]*)/);
if(A&&A[1]){z.gecko=B(A[1]);
}}}}}}if(!C){YUI.Env.UA=z;
}return z;
};
b.UA=YUI.Env.UA||YUI.Env.parseUA();
YUI.Env.aliases={anim:["anim-base","anim-color","anim-curve","anim-easing","anim-node-plugin","anim-scroll","anim-xy"],app:["controller","model","model-list","view"],attribute:["attribute-base","attribute-complex"],autocomplete:["autocomplete-base","autocomplete-sources","autocomplete-list","autocomplete-plugin"],base:["base-base","base-pluginhost","base-build"],cache:["cache-base","cache-offline","cache-plugin"],collection:["array-extras","arraylist","arraylist-add","arraylist-filter","array-invoke"],dataschema:["dataschema-base","dataschema-json","dataschema-xml","dataschema-array","dataschema-text"],datasource:["datasource-local","datasource-io","datasource-get","datasource-function","datasource-cache","datasource-jsonschema","datasource-xmlschema","datasource-arrayschema","datasource-textschema","datasource-polling"],datatable:["datatable-base","datatable-datasource","datatable-sort","datatable-scroll"],datatype:["datatype-number","datatype-date","datatype-xml"],"datatype-date":["datatype-date-parse","datatype-date-format"],"datatype-number":["datatype-number-parse","datatype-number-format"],"datatype-xml":["datatype-xml-parse","datatype-xml-format"],dd:["dd-ddm-base","dd-ddm","dd-ddm-drop","dd-drag","dd-proxy","dd-constrain","dd-drop","dd-scroll","dd-delegate"],dom:["dom-base","dom-screen","dom-style","selector-native","selector"],editor:["frame","selection","exec-command","editor-base","editor-para","editor-br","editor-bidi","editor-tab","createlink-base"],event:["event-base","event-delegate","event-synthetic","event-mousewheel","event-mouseenter","event-key","event-focus","event-resize","event-hover","event-outside"],"event-custom":["event-custom-base","event-custom-complex"],"event-gestures":["event-flick","event-move"],highlight:["highlight-base","highlight-accentfold"],history:["history-base","history-hash","history-hash-ie","history-html5"],io:["io-base","io-xdr","io-form","io-upload-iframe","io-queue"],json:["json-parse","json-stringify"],loader:["loader-base","loader-rollup","loader-yui3"],node:["node-base","node-event-delegate","node-pluginhost","node-screen","node-style"],pluginhost:["pluginhost-base","pluginhost-config"],querystring:["querystring-parse","querystring-stringify"],recordset:["recordset-base","recordset-sort","recordset-filter","recordset-indexer"],resize:["resize-base","resize-proxy","resize-constrain"],slider:["slider-base","slider-value-range","clickable-rail","range-slider"],text:["text-accentfold","text-wordbreak"],widget:["widget-base","widget-htmlparser","widget-uievents","widget-skin"]};
},"3.4.1");
YUI.add("get",function(e){var B=e.UA,p=e.Lang,b="text/javascript",v="text/css",I="stylesheet",s="script",q="autopurge",A="utf-8",w="link",C="async",h=true,l={script:h,css:!(B.webkit||B.gecko)},z={},r=0,g,u=function(J){var K=J.timer;
if(K){clearTimeout(K);
J.timer=null;
}},m=function(M,J,P,N){var K=N||e.config.win,O=K.document,Q=O.createElement(M),L;
if(P){e.mix(J,P);
}for(L in J){if(J[L]&&J.hasOwnProperty(L)){Q.setAttribute(L,J[L]);
}}return Q;
},k=function(K,L,J){return m(w,{id:e.guid(),type:v,rel:I,href:K},J,L);
},E=function(K,L,J){return m(s,{id:e.guid(),type:b,src:K},J,L);
},a=function(K,L,J){return{tId:K.tId,win:K.win,data:K.data,nodes:K.nodes,msg:L,statusText:J,purge:function(){d(this.tId);
}};
},o=function(N,M,J){var L=z[N],K=L&&L.onEnd;
L.finished=true;
if(K){K.call(L.context,a(L,M,J));
}},F=function(M,L){var K=z[M],J=K.onFailure;
u(K);
if(J){J.call(K.context,a(K,L));
}o(M,L,"failure");
},y=function(J){F(J,"transaction "+J+" was aborted");
},x=function(L){var J=z[L],K=J.onSuccess;
u(J);
if(J.aborted){y(L);
}else{if(K){K.call(J.context,a(J));
}o(L,undefined,"OK");
}},H=function(J,M){var K=z[M],L=(p.isString(J))?K.win.document.getElementById(J):J;
if(!L){F(M,"target node not found: "+J);
}return L;
},d=function(O){var K,R,S,T,L,Q,P,N,M,J=z[O];
if(J){K=J.nodes;
M=K.length;
for(N=0;
N<M;
N++){L=K[N];
S=L.parentNode;
if(L.clearAttributes){L.clearAttributes();
}else{for(Q in L){if(L.hasOwnProperty(Q)){delete L[Q];
}}}S.removeChild(L);
}}J.nodes=[];
},t=function(N,J){var K=z[N],L=K.onProgress,M;
if(L){M=a(K);
M.url=J;
L.call(K.context,M);
}},D=function(L){var J=z[L],K=J.onTimeout;
if(K){K.call(J.context,a(J));
}o(L,"timeout","timeout");
},f=function(M,J){var L=z[M],K=(L&&!L.async);
if(!L){return;
}if(K){u(L);
}t(M,J);
if(!L.finished){if(L.aborted){y(M);
}else{if((--L.remaining)===0){x(M);
}else{if(K){i(M);
}}}}},c=function(K,M,L,J){if(B.ie){M.onreadystatechange=function(){var N=this.readyState;
if("loaded"===N||"complete"===N){M.onreadystatechange=null;
f(L,J);
}};
}else{if(B.webkit){if(K===s){M.addEventListener("load",function(){f(L,J);
},false);
}}else{M.onload=function(){f(L,J);
};
M.onerror=function(N){F(L,N+": "+J);
};
}}},G=function(L,P,O){var M=z[P],N=O.document,J=M.insertBefore||N.getElementsByTagName("base")[0],K;
if(J){K=H(J,P);
if(K){K.parentNode.insertBefore(L,K);
}}else{N.getElementsByTagName("head")[0].appendChild(L);
}},i=function(Q){var O=z[Q],L=O.type,K=O.attributes,P=O.win,N=O.timeout,M,J;
if(O.url.length>0){J=O.url.shift();
if(N&&!O.timer){O.timer=setTimeout(function(){D(Q);
},N);
}if(L===s){M=E(J,P,K);
}else{M=k(J,P,K);
}O.nodes.push(M);
c(L,M,Q,J);
G(M,Q,P);
if(!l[L]){f(Q,J);
}if(O.async){i(Q);
}}},n=function(){if(g){return;
}g=true;
var J,K;
for(J in z){if(z.hasOwnProperty(J)){K=z[J];
if(K.autopurge&&K.finished){d(K.tId);
delete z[J];
}}}g=false;
},j=function(K,J,L){L=L||{};
var O="q"+(r++),N=L.purgethreshold||e.Get.PURGE_THRESH,M;
if(r%N===0){n();
}M=z[O]=e.merge(L);
M.tId=O;
M.type=K;
M.url=J;
M.finished=false;
M.nodes=[];
M.win=M.win||e.config.win;
M.context=M.context||M;
M.autopurge=(q in M)?M.autopurge:(K===s)?true:false;
M.attributes=M.attributes||{};
M.attributes.charset=L.charset||M.attributes.charset||A;
if(C in M&&K===s){M.attributes.async=M.async;
}M.url=(p.isString(M.url))?[M.url]:M.url;
if(!M.url[0]){M.url.shift();
}M.remaining=M.url.length;
i(O);
return{tId:O};
};
e.Get={PURGE_THRESH:20,abort:function(K){var L=(p.isString(K))?K:K.tId,J=z[L];
if(J){J.aborted=true;
}},script:function(J,K){return j(s,J,K);
},css:function(J,K){return j("css",J,K);
}};
},"3.4.1",{requires:["yui-base"]});
YUI.add("features",function(b){var c={};
b.mix(b.namespace("Features"),{tests:c,add:function(d,e,f){c[d]=c[d]||{};
c[d][e]=f;
},all:function(e,f){var g=c[e],d=[];
if(g){b.Object.each(g,function(i,h){d.push(h+":"+(b.Features.test(e,h,f)?1:0));
});
}return(d.length)?d.join(";"):"";
},test:function(e,g,f){f=f||[];
var d,i,k,j=c[e],h=j&&j[g];
if(!h){}else{d=h.result;
if(b.Lang.isUndefined(d)){i=h.ua;
if(i){d=(b.UA[i]);
}k=h.test;
if(k&&((!i)||d)){d=k.apply(b,f);
}h.result=d;
}}return d;
}});
var a=b.Features.add;
a("load","0",{name:"graphics-canvas-default",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(d&&d.getContext&&d.getContext("2d")));
},trigger:"graphics"});
a("load","1",{name:"autocomplete-list-keys",test:function(d){return !(d.UA.ios||d.UA.android);
},trigger:"autocomplete-list"});
a("load","2",{name:"graphics-svg",test:function(e){var d=e.config.doc;
return(d&&d.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"});
a("load","3",{name:"history-hash-ie",test:function(e){var d=e.config.doc&&e.config.doc.documentMode;
return e.UA.ie&&(!("onhashchange" in e.config.win)||!d||d<8);
},trigger:"history-hash"});
a("load","4",{name:"graphics-vml-default",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!d||!d.getContext||!d.getContext("2d")));
},trigger:"graphics"});
a("load","5",{name:"graphics-svg-default",test:function(e){var d=e.config.doc;
return(d&&d.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"});
a("load","6",{name:"widget-base-ie",trigger:"widget-base",ua:"ie"});
a("load","7",{name:"transition-timer",test:function(g){var f=g.config.doc,e=(f)?f.documentElement:null,d=true;
if(e&&e.style){d=!("MozTransition" in e.style||"WebkitTransition" in e.style);
}return d;
},trigger:"transition"});
a("load","8",{name:"dom-style-ie",test:function(j){var h=j.Features.test,i=j.Features.add,f=j.config.win,g=j.config.doc,d="documentElement",e=false;
i("style","computedStyle",{test:function(){return f&&"getComputedStyle" in f;
}});
i("style","opacity",{test:function(){return g&&"opacity" in g[d].style;
}});
e=(!h("style","opacity")&&!h("style","computedStyle"));
return e;
},trigger:"dom-style"});
a("load","9",{name:"selector-css2",test:function(f){var e=f.config.doc,d=e&&!("querySelectorAll" in e);
return d;
},trigger:"selector"});
a("load","10",{name:"event-base-ie",test:function(e){var d=e.config.doc&&e.config.doc.implementation;
return(d&&(!d.hasFeature("Events","2.0")));
},trigger:"node-base"});
a("load","11",{name:"dd-gestures",test:function(d){return(d.config.win&&("ontouchstart" in d.config.win&&!d.UA.chrome));
},trigger:"dd-drag"});
a("load","12",{name:"scrollview-base-ie",trigger:"scrollview-base",ua:"ie"});
a("load","13",{name:"graphics-canvas",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(d&&d.getContext&&d.getContext("2d")));
},trigger:"graphics"});
a("load","14",{name:"graphics-vml",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!d||!d.getContext||!d.getContext("2d")));
},trigger:"graphics"});
},"3.4.1",{requires:["yui-base"]});
YUI.add("intl-base",function(b){var a=/[, ]/;
b.mix(b.namespace("Intl"),{lookupBestLang:function(g,h){var f,j,c,e;
function d(l){var k;
for(k=0;
k<h.length;
k+=1){if(l.toLowerCase()===h[k].toLowerCase()){return h[k];
}}}if(b.Lang.isString(g)){g=g.split(a);
}for(f=0;
f<g.length;
f+=1){j=g[f];
if(!j||j==="*"){continue;
}while(j.length>0){c=d(j);
if(c){return c;
}else{e=j.lastIndexOf("-");
if(e>=0){j=j.substring(0,e);
if(e>=2&&j.charAt(e-2)==="-"){j=j.substring(0,e-2);
}}else{break;
}}}}return"";
}});
},"3.4.1",{requires:["yui-base"]});
YUI.add("yui-log",function(d){var c=d,e="yui:log",a="undefined",b={debug:1,info:1,warn:1,error:1};
c.log=function(j,s,g,q){var l,p,n,k,o,i=c,r=i.config,h=(i.fire)?i:YUI.Env.globalEvents;
if(r.debug){if(g){p=r.logExclude;
n=r.logInclude;
if(n&&!(g in n)){l=1;
}else{if(n&&(g in n)){l=!n[g];
}else{if(p&&(g in p)){l=p[g];
}}}}if(!l){if(r.useBrowserConsole){k=(g)?g+": "+j:j;
if(i.Lang.isFunction(r.logFn)){r.logFn.call(i,j,s,g);
}else{if(typeof console!=a&&console.log){o=(s&&console[s]&&(s in b))?s:"log";
console[o](k);
}else{if(typeof opera!=a){opera.postError(k);
}}}}if(h&&!q){if(h==i&&(!h.getEvent(e))){h.publish(e,{broadcast:2});
}h.fire(e,{msg:j,cat:s,src:g});
}}}return i;
};
c.message=function(){return c.log.apply(c,arguments);
};
},"3.4.1",{requires:["yui-base"]});
YUI.add("yui-later",function(b){var a=[];
b.later=function(j,f,k,g,h){j=j||0;
g=(!b.Lang.isUndefined(g))?b.Array(g):a;
f=f||b.config.win||b;
var i=false,c=(f&&b.Lang.isString(k))?f[k]:k,d=function(){if(!i){if(!c.apply){c(g[0],g[1],g[2],g[3]);
}else{c.apply(f,g||a);
}}},e=(h)?setInterval(d,j):setTimeout(d,j);
return{id:e,interval:h,cancel:function(){i=true;
if(this.interval){clearInterval(e);
}else{clearTimeout(e);
}}};
};
b.Lang.later=b.later;
},"3.4.1",{requires:["yui-base"]});
YUI.add("loader-base",function(d){if(!YUI.Env[d.version]){(function(){var I=d.version,E="/build/",F=I+E,D=d.Env.base,A="gallery-2011.09.14-20-40",C="2in3",B="4",z="2.9.0",G=D+"combo?",H={version:I,root:F,base:d.Env.base,comboBase:G,skin:{defaultSkin:"sam",base:"assets/skins/",path:"skin.css",after:["cssreset","cssfonts","cssgrids","cssbase","cssreset-context","cssfonts-context"]},groups:{},patterns:{}},y=H.groups,x=function(K,L){var J=C+"."+(K||B)+"/"+(L||z)+E;
y.yui2.base=D+J;
y.yui2.root=J;
},w=function(J){var K=(J||A)+E;
y.gallery.base=D+K;
y.gallery.root=K;
};
y[I]={};
y.gallery={ext:false,combine:true,comboBase:G,update:w,patterns:{"gallery-":{},"lang/gallery-":{},"gallerycss-":{type:"css"}}};
y.yui2={combine:true,ext:false,comboBase:G,update:x,patterns:{"yui2-":{configFn:function(J){if(/-skin|reset|fonts|grids|base/.test(J.name)){J.type="css";
J.path=J.path.replace(/\.js/,".css");
J.path=J.path.replace(/\/yui2-skin/,"/assets/skins/sam/yui2-skin");
}}}}};
w();
x();
YUI.Env[I]=H;
}());
}var f={},c=[],m=2048,a=YUI.Env,p=a._loaded,q="css",k="js",v="intl",s=d.version,u="",e=d.Object,r=e.each,j=d.Array,h=a._loaderQueue,t=a[s],b="skin-",i=d.Lang,n=a.mods,l,o,g=function(x,y,z,w){var A=x+"/"+y;
if(!w){A+="-min";
}A+="."+(z||q);
return A;
};
if(YUI.Env.aliases){YUI.Env.aliases={};
}d.Env.meta=t;
d.Loader=function(A){var z=t.modules,x=this;
l=t.md5;
x.context=d;
x.base=d.Env.meta.base+d.Env.meta.root;
x.comboBase=d.Env.meta.comboBase;
x.combine=A.base&&(A.base.indexOf(x.comboBase.substr(0,20))>-1);
x.comboSep="&";
x.maxURLLength=m;
x.root=d.Env.meta.root;
x.timeout=0;
x.forceMap={};
x.allowRollup=false;
x.filters={};
x.required={};
x.patterns={};
x.moduleInfo={};
x.groups=d.merge(d.Env.meta.groups);
x.skin=d.merge(d.Env.meta.skin);
x.conditions={};
x.config=A;
x._internal=true;
o=a._renderedMods;
if(o){r(o,function y(C,B){x.moduleInfo[B]=C;
});
o=a._conditions;
r(o,function w(C,B){x.conditions[B]=C;
});
}else{r(z,x.addModule,x);
}if(!a._renderedMods){a._renderedMods=x.moduleInfo;
a._conditions=x.conditions;
}x._inspectPage();
x._internal=false;
x._config(A);
x.testresults=null;
if(d.config.tests){x.testresults=d.config.tests;
}x.sorted=[];
x.loaded=p[s];
x.dirty=true;
x.inserted={};
x.skipped={};
x.tested={};
};
d.Loader.prototype={FILTER_DEFS:{RAW:{searchExp:"-min\\.js",replaceStr:".js"},DEBUG:{searchExp:"-min\\.js",replaceStr:"-debug.js"}},_inspectPage:function(){r(n,function(y,x){if(y.details){var w=this.moduleInfo[x],A=y.details.requires,z=w&&w.requires;
if(w){if(!w._inspected&&A&&z.length!=A.length){delete w.expanded;
}}else{w=this.addModule(y.details,x);
}w._inspected=true;
}},this);
},_requires:function(C,B){var y,A,D,E,w=this.moduleInfo,x=w[C],z=w[B];
if(!x||!z){return false;
}A=x.expanded_map;
D=x.after_map;
if(D&&(B in D)){return true;
}D=z.after_map;
if(D&&(C in D)){return false;
}E=w[B]&&w[B].supersedes;
if(E){for(y=0;
y<E.length;
y++){if(this._requires(C,E[y])){return true;
}}}E=w[C]&&w[C].supersedes;
if(E){for(y=0;
y<E.length;
y++){if(this._requires(B,E[y])){return false;
}}}if(A&&(B in A)){return true;
}if(x.ext&&x.type==q&&!z.ext&&z.type==q){return true;
}return false;
},_config:function(C){var y,x,B,z,A,D,w=this;
if(C){for(y in C){if(C.hasOwnProperty(y)){B=C[y];
if(y=="require"){w.require(B);
}else{if(y=="skin"){d.mix(w.skin,C[y],true);
}else{if(y=="groups"){for(x in B){if(B.hasOwnProperty(x)){D=x;
A=B[x];
w.addGroup(A,D);
}}}else{if(y=="modules"){r(B,w.addModule,w);
}else{if(y=="gallery"){this.groups.gallery.update(B);
}else{if(y=="yui2"||y=="2in3"){this.groups.yui2.update(C["2in3"],C.yui2);
}else{if(y=="maxURLLength"){w[y]=Math.min(m,B);
}else{w[y]=B;
}}}}}}}}}}z=w.filter;
if(i.isString(z)){z=z.toUpperCase();
w.filterName=z;
w.filter=w.FILTER_DEFS[z];
if(z=="DEBUG"){w.require("yui-log","dump");
}}if(w.lang){w.require("intl-base","intl");
}},formatSkin:function(y,w){var x=b+y;
if(w){x=x+"-"+w;
}return x;
},_addSkin:function(F,D,E){var C,B,x,w,A=this.moduleInfo,y=this.skin,z=A[D]&&A[D].ext;
if(D){x=this.formatSkin(F,D);
if(!A[x]){C=A[D];
B=C.pkg||D;
w={name:x,group:C.group,type:"css",after:y.after,path:(E||B)+"/"+y.base+F+"/"+D+".css",ext:z};
if(C.base){w.base=C.base;
}if(C.configFn){w.configFn=C.configFn;
}this.addModule(w,x);
}}return x;
},addGroup:function(z,x){var y=z.modules,w=this;
x=x||z.name;
z.name=x;
w.groups[x]=z;
if(z.patterns){r(z.patterns,function(B,A){B.group=x;
w.patterns[A]=B;
});
}if(y){r(y,function(B,A){B.group=x;
w.addModule(B,A);
},w);
}},addModule:function(M,T){T=T||M.name;
if(this.moduleInfo[T]&&this.moduleInfo[T].temp){M=d.merge(this.moduleInfo[T],M);
}M.name=T;
if(!M||!M.name){return null;
}if(!M.type){M.type=k;
}if(!M.path&&!M.fullpath){M.path=g(T,T,M.type);
}M.supersedes=M.supersedes||M.use;
M.ext=("ext" in M)?M.ext:(this._internal)?false:true;
M.requires=this.filterRequires(M.requires)||[];
var Q=M.submodules,P,N,H,w,I,y,L,x,O,J,F,C,A,z,S,R,G,B,D,E=this.conditions,K;
this.moduleInfo[T]=M;
if(!M.langPack&&M.lang){J=j(M.lang);
for(O=0;
O<J.length;
O++){S=J[O];
F=this.getLangPackName(S,T);
y=this.moduleInfo[F];
if(!y){y=this._addLangPack(S,M,F);
}}}if(Q){w=M.supersedes||[];
N=0;
for(P in Q){if(Q.hasOwnProperty(P)){I=Q[P];
I.path=I.path||g(T,P,M.type);
I.pkg=T;
I.group=M.group;
if(I.supersedes){w=w.concat(I.supersedes);
}y=this.addModule(I,P);
w.push(P);
if(y.skinnable){M.skinnable=true;
G=this.skin.overrides;
if(G&&G[P]){for(O=0;
O<G[P].length;
O++){B=this._addSkin(G[P][O],P,T);
w.push(B);
}}B=this._addSkin(this.skin.defaultSkin,P,T);
w.push(B);
}if(I.lang&&I.lang.length){J=j(I.lang);
for(O=0;
O<J.length;
O++){S=J[O];
F=this.getLangPackName(S,T);
C=this.getLangPackName(S,P);
y=this.moduleInfo[F];
if(!y){y=this._addLangPack(S,M,F);
}A=A||j.hash(y.supersedes);
if(!(C in A)){y.supersedes.push(C);
}M.lang=M.lang||[];
z=z||j.hash(M.lang);
if(!(S in z)){M.lang.push(S);
}F=this.getLangPackName(u,T);
C=this.getLangPackName(u,P);
y=this.moduleInfo[F];
if(!y){y=this._addLangPack(S,M,F);
}if(!(C in A)){y.supersedes.push(C);
}}}N++;
}}M.supersedes=j.dedupe(w);
if(this.allowRollup){M.rollup=(N<4)?N:Math.min(N-1,4);
}}L=M.plugins;
if(L){for(P in L){if(L.hasOwnProperty(P)){x=L[P];
x.pkg=T;
x.path=x.path||g(T,P,M.type);
x.requires=x.requires||[];
x.group=M.group;
this.addModule(x,P);
if(M.skinnable){this._addSkin(this.skin.defaultSkin,P,T);
}}}}if(M.condition){H=M.condition.trigger;
if(YUI.Env.aliases[H]){H=YUI.Env.aliases[H];
}if(!d.Lang.isArray(H)){H=[H];
}for(P=0;
P<H.length;
P++){K=H[P];
D=M.condition.when;
E[K]=E[K]||{};
E[K][T]=M.condition;
if(D&&D!="after"){if(D=="instead"){M.supersedes=M.supersedes||[];
M.supersedes.push(K);
}else{}}else{M.after=M.after||[];
M.after.push(K);
}}}if(M.after){M.after_map=j.hash(M.after);
}if(M.configFn){R=M.configFn(M);
if(R===false){delete this.moduleInfo[T];
M=null;
}}return M;
},require:function(x){var w=(typeof x==="string")?j(arguments):x;
this.dirty=true;
this.required=d.merge(this.required,j.hash(this.filterRequires(w)));
this._explodeRollups();
},_explodeRollups:function(){var x=this,w,y=x.required;
if(!x.allowRollup){r(y,function(z,A){w=x.getModule(A);
if(w&&w.use){j.each(w.use,function(B){w=x.getModule(B);
if(w&&w.use){j.each(w.use,function(C){y[C]=true;
});
}else{y[B]=true;
}});
}});
x.required=y;
}},filterRequires:function(z){if(z){if(!d.Lang.isArray(z)){z=[z];
}z=d.Array(z);
var B=[],y,x,A,w;
for(y=0;
y<z.length;
y++){x=this.getModule(z[y]);
if(x&&x.use){for(A=0;
A<x.use.length;
A++){w=this.getModule(x.use[A]);
if(w&&w.use){B=d.Array.dedupe([].concat(B,this.filterRequires(w.use)));
}else{B.push(x.use[A]);
}}}else{B.push(z[y]);
}}z=B;
}return z;
},getRequires:function(S){if(!S||S._parsed){return c;
}var M,H,L,D,C,U,A=this.testresults,V=S.name,B,I,T=n[V]&&n[V].details,O,J,w,E,P,F,z,Q,R,y,G=S.lang||S.intl,N=this.moduleInfo,K=d.Features&&d.Features.tests.load,x;
if(S.temp&&T){P=S;
S=this.addModule(T,V);
S.group=P.group;
S.pkg=P.pkg;
delete S.expanded;
}if(S.expanded&&(!this.lang||S.langCache===this.lang)){return S.expanded;
}O=[];
x={};
E=this.filterRequires(S.requires);
if(S.lang){O.unshift("intl");
E.unshift("intl");
G=true;
}F=this.filterRequires(S.optional);
S._parsed=true;
S.langCache=this.lang;
for(M=0;
M<E.length;
M++){if(!x[E[M]]){O.push(E[M]);
x[E[M]]=true;
H=this.getModule(E[M]);
if(H){D=this.getRequires(H);
G=G||(H.expanded_map&&(v in H.expanded_map));
for(L=0;
L<D.length;
L++){O.push(D[L]);
}}}}E=this.filterRequires(S.supersedes);
if(E){for(M=0;
M<E.length;
M++){if(!x[E[M]]){if(S.submodules){O.push(E[M]);
}x[E[M]]=true;
H=this.getModule(E[M]);
if(H){D=this.getRequires(H);
G=G||(H.expanded_map&&(v in H.expanded_map));
for(L=0;
L<D.length;
L++){O.push(D[L]);
}}}}}if(F&&this.loadOptional){for(M=0;
M<F.length;
M++){if(!x[F[M]]){O.push(F[M]);
x[F[M]]=true;
H=N[F[M]];
if(H){D=this.getRequires(H);
G=G||(H.expanded_map&&(v in H.expanded_map));
for(L=0;
L<D.length;
L++){O.push(D[L]);
}}}}}B=this.conditions[V];
if(B){if(A&&K){r(A,function(W,Z){var X=K[Z].name;
if(!x[X]&&K[Z].trigger==V){if(W&&K[Z]){x[X]=true;
O.push(X);
}}});
}else{r(B,function(X,W){if(!x[W]){I=X&&((X.ua&&d.UA[X.ua])||(X.test&&X.test(d,E)));
if(I){x[W]=true;
O.push(W);
H=this.getModule(W);
if(H){D=this.getRequires(H);
for(L=0;
L<D.length;
L++){O.push(D[L]);
}}}}},this);
}}if(S.skinnable){Q=this.skin.overrides;
r(YUI.Env.aliases,function(W,X){if(d.Array.indexOf(W,V)>-1){R=X;
}});
if(Q&&(Q[V]||(R&&Q[R]))){y=V;
if(Q[R]){y=R;
}for(M=0;
M<Q[y].length;
M++){z=this._addSkin(Q[y][M],V);
O.push(z);
}}else{z=this._addSkin(this.skin.defaultSkin,V);
O.push(z);
}}S._parsed=false;
if(G){if(S.lang&&!S.langPack&&d.Intl){U=d.Intl.lookupBestLang(this.lang||u,S.lang);
C=this.getLangPackName(U,V);
if(C){O.unshift(C);
}}O.unshift(v);
}S.expanded_map=j.hash(O);
S.expanded=e.keys(S.expanded_map);
return S.expanded;
},getProvides:function(x){var w=this.getModule(x),z,y;
if(!w){return f;
}if(w&&!w.provides){z={};
y=w.supersedes;
if(y){j.each(y,function(A){d.mix(z,this.getProvides(A));
},this);
}z[x]=true;
w.provides=z;
}return w.provides;
},calculate:function(x,w){if(x||w||this.dirty){if(x){this._config(x);
}if(!this._init){this._setup();
}this._explode();
if(this.allowRollup){this._rollup();
}else{this._explodeRollups();
}this._reduce();
this._sort();
}},_addLangPack:function(B,w,A){var y=w.name,x,z=this.moduleInfo[A];
if(!z){x=g((w.pkg||y),A,k,true);
this.addModule({path:x,intl:true,langPack:true,ext:w.ext,group:w.group,supersedes:[]},A);
if(B){d.Env.lang=d.Env.lang||{};
d.Env.lang[B]=d.Env.lang[B]||{};
d.Env.lang[B][y]=true;
}}return this.moduleInfo[A];
},_setup:function(){var C=this.moduleInfo,z,A,y,w,x,B;
for(z in C){if(C.hasOwnProperty(z)){w=C[z];
if(w){w.requires=j.dedupe(w.requires);
if(w.lang&&w.lang.length){B=this.getLangPackName(u,z);
this._addLangPack(null,w,B);
}}}}x={};
if(!this.ignoreRegistered){d.mix(x,a.mods);
}if(this.ignore){d.mix(x,j.hash(this.ignore));
}for(y in x){if(x.hasOwnProperty(y)){d.mix(x,this.getProvides(y));
}}if(this.force){for(A=0;
A<this.force.length;
A++){if(this.force[A] in x){delete x[this.force[A]];
}}}d.mix(this.loaded,x);
this._init=true;
},getLangPackName:function(x,w){return("lang/"+w+((x)?"_"+x:""));
},_explode:function(){var A=this.required,w,z,x={},y=this;
y.dirty=false;
y._explodeRollups();
A=y.required;
r(A,function(B,C){if(!x[C]){x[C]=true;
w=y.getModule(C);
if(w){var D=w.expound;
if(D){A[D]=y.getModule(D);
z=y.getRequires(A[D]);
d.mix(A,j.hash(z));
}z=y.getRequires(w);
d.mix(A,j.hash(z));
}}});
},getModule:function(B){if(!B){return null;
}var A,z,x,w=this.moduleInfo[B],y=this.patterns;
if(!w){for(x in y){if(y.hasOwnProperty(x)){A=y[x];
if(B.indexOf(x)>-1){z=A;
break;
}}}if(z){if(A.action){A.action.call(this,B,x);
}else{w=this.addModule(d.merge(z),B);
w.temp=true;
}}}return w;
},_rollup:function(){},_reduce:function(B){B=B||this.required;
var y,x,A,w,z=this.loadType,C=this.ignore?j.hash(this.ignore):false;
for(y in B){if(B.hasOwnProperty(y)){w=this.getModule(y);
if(((this.loaded[y]||n[y])&&!this.forceMap[y]&&!this.ignoreRegistered)||(z&&w&&w.type!=z)){delete B[y];
}if(C&&C[y]){delete B[y];
}A=w&&w.supersedes;
if(A){for(x=0;
x<A.length;
x++){if(A[x] in B){delete B[A[x]];
}}}}}return B;
},_finish:function(y,x){h.running=false;
var w=this.onEnd;
if(w){w.call(this.context,{msg:y,data:this.data,success:x});
}this._continue();
},_onSuccess:function(){var y=this,x=d.merge(y.skipped),A,w=[],z=y.requireRegistration,C,B;
r(x,function(D){delete y.inserted[D];
});
y.skipped={};
r(y.inserted,function(E,D){var F=y.getModule(D);
if(F&&z&&F.type==k&&!(D in YUI.Env.mods)){w.push(D);
}else{d.mix(y.loaded,y.getProvides(D));
}});
A=y.onSuccess;
B=(w.length)?"notregistered":"success";
C=!(w.length);
if(A){A.call(y.context,{msg:B,data:y.data,success:C,failed:w,skipped:x});
}y._finish(B,C);
},_onFailure:function(y){var w=this.onFailure,x="failure: "+y.msg;
if(w){w.call(this.context,{msg:x,data:this.data,success:false});
}this._finish(x,false);
},_onTimeout:function(){var w=this.onTimeout;
if(w){w.call(this.context,{msg:"timeout",data:this.data,success:false});
}this._finish("timeout",false);
},_sort:function(){var F=e.keys(this.required),B={},w=0,y,E,D,A,z,C,x;
for(;
;
){y=F.length;
C=false;
for(A=w;
A<y;
A++){E=F[A];
for(z=A+1;
z<y;
z++){x=E+F[z];
if(!B[x]&&this._requires(E,F[z])){D=F.splice(z,1);
F.splice(A,0,D[0]);
B[x]=true;
C=true;
break;
}}if(C){break;
}else{w++;
}}if(!C){break;
}}this.sorted=F;
},partial:function(w,y,x){this.sorted=w;
this.insert(y,x,true);
},_insert:function(z,A,y,x){if(z){this._config(z);
}if(!x){this.calculate(A);
}this.loadType=y;
if(!y){var w=this;
this._internalCallback=function(){var C=w.onCSS,E,D,B;
if(this.insertBefore&&d.UA.ie){E=d.config.doc.getElementById(this.insertBefore);
D=E.parentNode;
B=E.nextSibling;
D.removeChild(E);
if(B){D.insertBefore(E,B);
}else{D.appendChild(E);
}}if(C){C.call(w.context,d);
}w._internalCallback=null;
w._insert(null,null,k);
};
this._insert(null,null,q);
return;
}this._loading=true;
this._combineComplete={};
this.loadNext();
},_continue:function(){if(!(h.running)&&h.size()>0){h.running=true;
h.next()();
}},insert:function(z,x,y){var w=this,A=d.merge(this);
delete A.require;
delete A.dirty;
h.add(function(){w._insert(A,z,x,y);
});
this._continue();
},loadNext:function(A){if(!this._loading){return;
}var H,P,O,M,z,E,B,L,D,G,N,w,C,K,y,F,Q,R,J=this,x=J.loadType,S=function(T){J.loadNext(T.data);
},I=function(V){J._combineComplete[x]=true;
var U,T=F.length;
for(U=0;
U<T;
U++){J.inserted[F[U]]=true;
}S(V);
};
if(J.combine&&(!J._combineComplete[x])){F=[];
J._combining=F;
H=J.sorted;
P=H.length;
R=J.comboBase;
z=R;
Q=[];
K={};
for(O=0;
O<P;
O++){C=R;
M=J.getModule(H[O]);
G=M&&M.group;
if(G){D=J.groups[G];
if(!D.combine){M.combine=false;
continue;
}M.combine=true;
if(D.comboBase){C=D.comboBase;
}if("root" in D&&i.isValue(D.root)){M.root=D.root;
}}K[C]=K[C]||[];
K[C].push(M);
}for(N in K){if(K.hasOwnProperty(N)){z=N;
y=K[N];
P=y.length;
for(O=0;
O<P;
O++){M=y[O];
if(M&&(M.type===x)&&(M.combine||!M.ext)){w=((i.isValue(M.root))?M.root:J.root)+M.path;
w=J._filter(w,M.name);
if((z!==N)&&(O<=(P-1))&&((w.length+z.length)>J.maxURLLength)){if(z.substr(z.length-1,1)===J.comboSep){z=z.substr(0,(z.length-1));
}Q.push(J._filter(z));
z=N;
}z+=w;
if(O<(P-1)){z+=J.comboSep;
}F.push(M.name);
}}if(F.length&&(z!=N)){if(z.substr(z.length-1,1)===J.comboSep){z=z.substr(0,(z.length-1));
}Q.push(J._filter(z));
}}}if(F.length){if(x===q){E=d.Get.css;
L=J.cssAttributes;
}else{E=d.Get.script;
L=J.jsAttributes;
}E(Q,{data:J._loading,onSuccess:I,onFailure:J._onFailure,onTimeout:J._onTimeout,insertBefore:J.insertBefore,charset:J.charset,attributes:L,timeout:J.timeout,autopurge:false,context:J});
return;
}else{J._combineComplete[x]=true;
}}if(A){if(A!==J._loading){return;
}J.inserted[A]=true;
if(J.onProgress){J.onProgress.call(J.context,{name:A,data:J.data});
}}H=J.sorted;
P=H.length;
for(O=0;
O<P;
O=O+1){if(H[O] in J.inserted){continue;
}if(H[O]===J._loading){return;
}M=J.getModule(H[O]);
if(!M){if(!J.skipped[H[O]]){B="Undefined module "+H[O]+" skipped";
J.skipped[H[O]]=true;
}continue;
}D=(M.group&&J.groups[M.group])||f;
if(!x||x===M.type){J._loading=H[O];
if(M.type===q){E=d.Get.css;
L=J.cssAttributes;
}else{E=d.Get.script;
L=J.jsAttributes;
}z=(M.fullpath)?J._filter(M.fullpath,H[O]):J._url(M.path,H[O],D.base||M.base);
E(z,{data:H[O],onSuccess:S,insertBefore:J.insertBefore,charset:J.charset,attributes:L,onFailure:J._onFailure,onTimeout:J._onTimeout,timeout:J.timeout,autopurge:false,context:J});
return;
}}J._loading=null;
E=J._internalCallback;
if(E){J._internalCallback=null;
E.call(J);
}else{J._onSuccess();
}},_filter:function(y,x){var A=this.filter,w=x&&(x in this.filters),z=w&&this.filters[x],B=this.moduleInfo[x]?this.moduleInfo[x].group:null;
if(B&&this.groups[B].filter){z=this.groups[B].filter;
w=true;
}if(y){if(w){A=(i.isString(z))?this.FILTER_DEFS[z.toUpperCase()]||null:z;
}if(A){y=y.replace(new RegExp(A.searchExp,"g"),A.replaceStr);
}}return y;
},_url:function(y,w,x){return this._filter((x||this.base||"")+y,w);
},resolve:function(A,C){var x=this,B,w,z,y={js:[],css:[]};
if(A){x.calculate();
}C=C||x.sorted;
for(B=0;
B<C.length;
B++){w=x.getModule(C[B]);
if(w){if(x.combine){z=x._filter((x.root+w.path),w.name,x.root);
}else{z=x._filter(w.fullpath,w.name,"")||x._url(w.path,w.name);
}y[w.type].push(z);
}}if(x.combine){y.js=[x.comboBase+y.js.join(x.comboSep)];
y.css=[x.comboBase+y.css.join(x.comboSep)];
}return y;
},hash:function(A,C){var x=this,B,w,z,y={js:{},css:{}};
if(A){x.calculate();
}C=C||x.sorted;
for(B=0;
B<C.length;
B++){w=x.getModule(C[B]);
if(w){z=x._filter(w.fullpath,w.name,"")||x._url(w.path,w.name);
y[w.type][w.name]=z;
}}return y;
}};
},"3.4.1",{requires:["get"]});
YUI.add("loader-rollup",function(a){a.Loader.prototype._rollup=function(){var k,h,g,o,b=this.required,e,f=this.moduleInfo,d,l,n;
if(this.dirty||!this.rollups){this.rollups={};
for(k in f){if(f.hasOwnProperty(k)){g=this.getModule(k);
if(g&&g.rollup){this.rollups[k]=g;
}}}this.forceMap=(this.force)?a.Array.hash(this.force):{};
}for(;
;
){d=false;
for(k in this.rollups){if(this.rollups.hasOwnProperty(k)){if(!b[k]&&((!this.loaded[k])||this.forceMap[k])){g=this.getModule(k);
o=g.supersedes||[];
e=false;
if(!g.rollup){continue;
}l=0;
for(h=0;
h<o.length;
h++){n=f[o[h]];
if(this.loaded[o[h]]&&!this.forceMap[o[h]]){e=false;
break;
}else{if(b[o[h]]&&g.type==n.type){l++;
e=(l>=g.rollup);
if(e){break;
}}}}if(e){b[k]=true;
d=true;
this.getRequires(g);
}}}}if(!d){break;
}}};
},"3.4.1",{requires:["loader-base"]});
YUI.add("loader-yui3",function(a){YUI.Env[a.version].modules=YUI.Env[a.version].modules||{"align-plugin":{requires:["node-screen","node-pluginhost"]},anim:{use:["anim-base","anim-color","anim-curve","anim-easing","anim-node-plugin","anim-scroll","anim-xy"]},"anim-base":{requires:["base-base","node-style"]},"anim-color":{requires:["anim-base"]},"anim-curve":{requires:["anim-xy"]},"anim-easing":{requires:["anim-base"]},"anim-node-plugin":{requires:["node-pluginhost","anim-base"]},"anim-scroll":{requires:["anim-base"]},"anim-xy":{requires:["anim-base","node-screen"]},app:{use:["controller","model","model-list","view"]},"array-extras":{requires:["yui-base"]},"array-invoke":{requires:["yui-base"]},arraylist:{requires:["yui-base"]},"arraylist-add":{requires:["arraylist"]},"arraylist-filter":{requires:["arraylist"]},arraysort:{requires:["yui-base"]},"async-queue":{requires:["event-custom"]},attribute:{use:["attribute-base","attribute-complex"]},"attribute-base":{requires:["event-custom"]},"attribute-complex":{requires:["attribute-base"]},autocomplete:{use:["autocomplete-base","autocomplete-sources","autocomplete-list","autocomplete-plugin"]},"autocomplete-base":{optional:["autocomplete-sources"],requires:["array-extras","base-build","escape","event-valuechange","node-base"]},"autocomplete-filters":{requires:["array-extras","text-wordbreak"]},"autocomplete-filters-accentfold":{requires:["array-extras","text-accentfold","text-wordbreak"]},"autocomplete-highlighters":{requires:["array-extras","highlight-base"]},"autocomplete-highlighters-accentfold":{requires:["array-extras","highlight-accentfold"]},"autocomplete-list":{after:["autocomplete-sources"],lang:["en"],requires:["autocomplete-base","event-resize","node-screen","selector-css3","shim-plugin","widget","widget-position","widget-position-align"],skinnable:true},"autocomplete-list-keys":{condition:{name:"autocomplete-list-keys",test:function(b){return !(b.UA.ios||b.UA.android);
},trigger:"autocomplete-list"},requires:["autocomplete-list","base-build"]},"autocomplete-plugin":{requires:["autocomplete-list","node-pluginhost"]},"autocomplete-sources":{optional:["io-base","json-parse","jsonp","yql"],requires:["autocomplete-base"]},base:{use:["base-base","base-pluginhost","base-build"]},"base-base":{after:["attribute-complex"],requires:["attribute-base"]},"base-build":{requires:["base-base"]},"base-pluginhost":{requires:["base-base","pluginhost"]},cache:{use:["cache-base","cache-offline","cache-plugin"]},"cache-base":{requires:["base"]},"cache-offline":{requires:["cache-base","json"]},"cache-plugin":{requires:["plugin","cache-base"]},calendar:{lang:["en","ja","ru"],requires:["calendar-base","calendarnavigator"],skinnable:true},"calendar-base":{lang:["en","ja","ru"],requires:["widget","substitute","datatype-date","datatype-date-math","cssgrids"],skinnable:true},calendarnavigator:{requires:["plugin","classnamemanager","datatype-date","node","substitute"],skinnable:true},charts:{requires:["dom","datatype-number","datatype-date","event-custom","event-mouseenter","widget","widget-position","widget-stack","graphics"]},classnamemanager:{requires:["yui-base"]},"clickable-rail":{requires:["slider-base"]},collection:{use:["array-extras","arraylist","arraylist-add","arraylist-filter","array-invoke"]},console:{lang:["en","es","ja"],requires:["yui-log","widget","substitute"],skinnable:true},"console-filters":{requires:["plugin","console"],skinnable:true},controller:{optional:["querystring-parse"],requires:["array-extras","base-build","history"]},cookie:{requires:["yui-base"]},"createlink-base":{requires:["editor-base"]},cssbase:{after:["cssreset","cssfonts","cssgrids","cssreset-context","cssfonts-context","cssgrids-context"],type:"css"},"cssbase-context":{after:["cssreset","cssfonts","cssgrids","cssreset-context","cssfonts-context","cssgrids-context"],type:"css"},cssfonts:{type:"css"},"cssfonts-context":{type:"css"},cssgrids:{optional:["cssreset","cssfonts"],type:"css"},cssreset:{type:"css"},"cssreset-context":{type:"css"},dataschema:{use:["dataschema-base","dataschema-json","dataschema-xml","dataschema-array","dataschema-text"]},"dataschema-array":{requires:["dataschema-base"]},"dataschema-base":{requires:["base"]},"dataschema-json":{requires:["dataschema-base","json"]},"dataschema-text":{requires:["dataschema-base"]},"dataschema-xml":{requires:["dataschema-base"]},datasource:{use:["datasource-local","datasource-io","datasource-get","datasource-function","datasource-cache","datasource-jsonschema","datasource-xmlschema","datasource-arrayschema","datasource-textschema","datasource-polling"]},"datasource-arrayschema":{requires:["datasource-local","plugin","dataschema-array"]},"datasource-cache":{requires:["datasource-local","plugin","cache-base"]},"datasource-function":{requires:["datasource-local"]},"datasource-get":{requires:["datasource-local","get"]},"datasource-io":{requires:["datasource-local","io-base"]},"datasource-jsonschema":{requires:["datasource-local","plugin","dataschema-json"]},"datasource-local":{requires:["base"]},"datasource-polling":{requires:["datasource-local"]},"datasource-textschema":{requires:["datasource-local","plugin","dataschema-text"]},"datasource-xmlschema":{requires:["datasource-local","plugin","dataschema-xml"]},datatable:{use:["datatable-base","datatable-datasource","datatable-sort","datatable-scroll"]},"datatable-base":{requires:["recordset-base","widget","substitute","event-mouseenter"],skinnable:true},"datatable-datasource":{requires:["datatable-base","plugin","datasource-local"]},"datatable-scroll":{requires:["datatable-base","plugin"]},"datatable-sort":{lang:["en"],requires:["datatable-base","plugin","recordset-sort"]},datatype:{use:["datatype-number","datatype-date","datatype-xml"]},"datatype-date":{supersedes:["datatype-date-format"],use:["datatype-date-parse","datatype-date-format"]},"datatype-date-format":{lang:["ar","ar-JO","ca","ca-ES","da","da-DK","de","de-AT","de-DE","el","el-GR","en","en-AU","en-CA","en-GB","en-IE","en-IN","en-JO","en-MY","en-NZ","en-PH","en-SG","en-US","es","es-AR","es-BO","es-CL","es-CO","es-EC","es-ES","es-MX","es-PE","es-PY","es-US","es-UY","es-VE","fi","fi-FI","fr","fr-BE","fr-CA","fr-FR","hi","hi-IN","id","id-ID","it","it-IT","ja","ja-JP","ko","ko-KR","ms","ms-MY","nb","nb-NO","nl","nl-BE","nl-NL","pl","pl-PL","pt","pt-BR","ro","ro-RO","ru","ru-RU","sv","sv-SE","th","th-TH","tr","tr-TR","vi","vi-VN","zh-Hans","zh-Hans-CN","zh-Hant","zh-Hant-HK","zh-Hant-TW"]},"datatype-date-math":{requires:["yui-base"]},"datatype-date-parse":{},"datatype-number":{use:["datatype-number-parse","datatype-number-format"]},"datatype-number-format":{},"datatype-number-parse":{},"datatype-xml":{use:["datatype-xml-parse","datatype-xml-format"]},"datatype-xml-format":{},"datatype-xml-parse":{},dd:{use:["dd-ddm-base","dd-ddm","dd-ddm-drop","dd-drag","dd-proxy","dd-constrain","dd-drop","dd-scroll","dd-delegate"]},"dd-constrain":{requires:["dd-drag"]},"dd-ddm":{requires:["dd-ddm-base","event-resize"]},"dd-ddm-base":{requires:["node","base","yui-throttle","classnamemanager"]},"dd-ddm-drop":{requires:["dd-ddm"]},"dd-delegate":{requires:["dd-drag","dd-drop-plugin","event-mouseenter"]},"dd-drag":{requires:["dd-ddm-base"]},"dd-drop":{requires:["dd-drag","dd-ddm-drop"]},"dd-drop-plugin":{requires:["dd-drop"]},"dd-gestures":{condition:{name:"dd-gestures",test:function(b){return(b.config.win&&("ontouchstart" in b.config.win&&!b.UA.chrome));
},trigger:"dd-drag"},requires:["dd-drag","event-synthetic","event-gestures"]},"dd-plugin":{optional:["dd-constrain","dd-proxy"],requires:["dd-drag"]},"dd-proxy":{requires:["dd-drag"]},"dd-scroll":{requires:["dd-drag"]},dial:{lang:["en","es"],requires:["widget","dd-drag","substitute","event-mouseenter","event-move","event-key","transition","intl"],skinnable:true},dom:{use:["dom-base","dom-screen","dom-style","selector-native","selector"]},"dom-base":{requires:["dom-core"]},"dom-core":{requires:["oop","features"]},"dom-deprecated":{requires:["dom-base"]},"dom-screen":{requires:["dom-base","dom-style"]},"dom-style":{requires:["dom-base"]},"dom-style-ie":{condition:{name:"dom-style-ie",test:function(h){var f=h.Features.test,g=h.Features.add,d=h.config.win,e=h.config.doc,b="documentElement",c=false;
g("style","computedStyle",{test:function(){return d&&"getComputedStyle" in d;
}});
g("style","opacity",{test:function(){return e&&"opacity" in e[b].style;
}});
c=(!f("style","opacity")&&!f("style","computedStyle"));
return c;
},trigger:"dom-style"},requires:["dom-style"]},dump:{requires:["yui-base"]},editor:{use:["frame","selection","exec-command","editor-base","editor-para","editor-br","editor-bidi","editor-tab","createlink-base"]},"editor-base":{requires:["base","frame","node","exec-command","selection"]},"editor-bidi":{requires:["editor-base"]},"editor-br":{requires:["editor-base"]},"editor-lists":{requires:["editor-base"]},"editor-para":{requires:["editor-base"]},"editor-tab":{requires:["editor-base"]},escape:{requires:["yui-base"]},event:{after:["node-base"],use:["event-base","event-delegate","event-synthetic","event-mousewheel","event-mouseenter","event-key","event-focus","event-resize","event-hover","event-outside"]},"event-base":{after:["node-base"],requires:["event-custom-base"]},"event-base-ie":{after:["event-base"],condition:{name:"event-base-ie",test:function(c){var b=c.config.doc&&c.config.doc.implementation;
return(b&&(!b.hasFeature("Events","2.0")));
},trigger:"node-base"},requires:["node-base"]},"event-custom":{use:["event-custom-base","event-custom-complex"]},"event-custom-base":{requires:["oop"]},"event-custom-complex":{requires:["event-custom-base"]},"event-delegate":{requires:["node-base"]},"event-flick":{requires:["node-base","event-touch","event-synthetic"]},"event-focus":{requires:["event-synthetic"]},"event-gestures":{use:["event-flick","event-move"]},"event-hover":{requires:["event-mouseenter"]},"event-key":{requires:["event-synthetic"]},"event-mouseenter":{requires:["event-synthetic"]},"event-mousewheel":{requires:["node-base"]},"event-move":{requires:["node-base","event-touch","event-synthetic"]},"event-outside":{requires:["event-synthetic"]},"event-resize":{requires:["node-base","event-synthetic"]},"event-simulate":{requires:["event-base"]},"event-synthetic":{requires:["node-base","event-custom-complex"]},"event-touch":{requires:["node-base"]},"event-valuechange":{requires:["event-focus","event-synthetic"]},"exec-command":{requires:["frame"]},features:{requires:["yui-base"]},frame:{requires:["base","node","selector-css3","substitute","yui-throttle"]},get:{requires:["yui-base"]},graphics:{requires:["node","event-custom","pluginhost"]},"graphics-canvas":{condition:{name:"graphics-canvas",test:function(d){var c=d.config.doc,b=c&&c.createElement("canvas");
return(c&&!c.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(b&&b.getContext&&b.getContext("2d")));
},trigger:"graphics"},requires:["graphics"]},"graphics-canvas-default":{condition:{name:"graphics-canvas-default",test:function(d){var c=d.config.doc,b=c&&c.createElement("canvas");
return(c&&!c.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(b&&b.getContext&&b.getContext("2d")));
},trigger:"graphics"}},"graphics-svg":{condition:{name:"graphics-svg",test:function(c){var b=c.config.doc;
return(b&&b.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"},requires:["graphics"]},"graphics-svg-default":{condition:{name:"graphics-svg-default",test:function(c){var b=c.config.doc;
return(b&&b.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"}},"graphics-vml":{condition:{name:"graphics-vml",test:function(d){var c=d.config.doc,b=c&&c.createElement("canvas");
return(c&&!c.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!b||!b.getContext||!b.getContext("2d")));
},trigger:"graphics"},requires:["graphics"]},"graphics-vml-default":{condition:{name:"graphics-vml-default",test:function(d){var c=d.config.doc,b=c&&c.createElement("canvas");
return(c&&!c.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!b||!b.getContext||!b.getContext("2d")));
},trigger:"graphics"}},highlight:{use:["highlight-base","highlight-accentfold"]},"highlight-accentfold":{requires:["highlight-base","text-accentfold"]},"highlight-base":{requires:["array-extras","classnamemanager","escape","text-wordbreak"]},history:{use:["history-base","history-hash","history-hash-ie","history-html5"]},"history-base":{requires:["event-custom-complex"]},"history-hash":{after:["history-html5"],requires:["event-synthetic","history-base","yui-later"]},"history-hash-ie":{condition:{name:"history-hash-ie",test:function(c){var b=c.config.doc&&c.config.doc.documentMode;
return c.UA.ie&&(!("onhashchange" in c.config.win)||!b||b<8);
},trigger:"history-hash"},requires:["history-hash","node-base"]},"history-html5":{optional:["json"],requires:["event-base","history-base","node-base"]},imageloader:{requires:["base-base","node-style","node-screen"]},intl:{requires:["intl-base","event-custom"]},"intl-base":{requires:["yui-base"]},io:{use:["io-base","io-xdr","io-form","io-upload-iframe","io-queue"]},"io-base":{requires:["event-custom-base","querystring-stringify-simple"]},"io-form":{requires:["io-base","node-base"]},"io-queue":{requires:["io-base","queue-promote"]},"io-upload-iframe":{requires:["io-base","node-base"]},"io-xdr":{requires:["io-base","datatype-xml-parse"]},json:{use:["json-parse","json-stringify"]},"json-parse":{requires:["yui-base"]},"json-stringify":{requires:["yui-base"]},jsonp:{requires:["get","oop"]},"jsonp-url":{requires:["jsonp"]},loader:{use:["loader-base","loader-rollup","loader-yui3"]},"loader-base":{requires:["get"]},"loader-rollup":{requires:["loader-base"]},"loader-yui3":{requires:["loader-base"]},model:{requires:["base-build","escape","json-parse"]},"model-list":{requires:["array-extras","array-invoke","arraylist","base-build","escape","json-parse","model"]},node:{use:["node-base","node-event-delegate","node-pluginhost","node-screen","node-style"]},"node-base":{requires:["event-base","node-core","dom-base"]},"node-core":{requires:["dom-core","selector"]},"node-deprecated":{requires:["node-base"]},"node-event-delegate":{requires:["node-base","event-delegate"]},"node-event-html5":{requires:["node-base"]},"node-event-simulate":{requires:["node-base","event-simulate"]},"node-flick":{requires:["classnamemanager","transition","event-flick","plugin"],skinnable:true},"node-focusmanager":{requires:["attribute","node","plugin","node-event-simulate","event-key","event-focus"]},"node-load":{requires:["node-base","io-base"]},"node-menunav":{requires:["node","classnamemanager","plugin","node-focusmanager"],skinnable:true},"node-pluginhost":{requires:["node-base","pluginhost"]},"node-screen":{requires:["dom-screen","node-base"]},"node-style":{requires:["dom-style","node-base"]},oop:{requires:["yui-base"]},overlay:{requires:["widget","widget-stdmod","widget-position","widget-position-align","widget-stack","widget-position-constrain"],skinnable:true},panel:{requires:["widget","widget-stdmod","widget-position","widget-position-align","widget-stack","widget-position-constrain","widget-modality","widget-autohide","widget-buttons"],skinnable:true},plugin:{requires:["base-base"]},pluginhost:{use:["pluginhost-base","pluginhost-config"]},"pluginhost-base":{requires:["yui-base"]},"pluginhost-config":{requires:["pluginhost-base"]},profiler:{requires:["yui-base"]},querystring:{use:["querystring-parse","querystring-stringify"]},"querystring-parse":{requires:["yui-base","array-extras"]},"querystring-parse-simple":{requires:["yui-base"]},"querystring-stringify":{requires:["yui-base"]},"querystring-stringify-simple":{requires:["yui-base"]},"queue-promote":{requires:["yui-base"]},"range-slider":{requires:["slider-base","slider-value-range","clickable-rail"]},recordset:{use:["recordset-base","recordset-sort","recordset-filter","recordset-indexer"]},"recordset-base":{requires:["base","arraylist"]},"recordset-filter":{requires:["recordset-base","array-extras","plugin"]},"recordset-indexer":{requires:["recordset-base","plugin"]},"recordset-sort":{requires:["arraysort","recordset-base","plugin"]},resize:{use:["resize-base","resize-proxy","resize-constrain"]},"resize-base":{requires:["base","widget","substitute","event","oop","dd-drag","dd-delegate","dd-drop"],skinnable:true},"resize-constrain":{requires:["plugin","resize-base"]},"resize-plugin":{optional:["resize-constrain"],requires:["resize-base","plugin"]},"resize-proxy":{requires:["plugin","resize-base"]},rls:{requires:["get","features"]},scrollview:{requires:["scrollview-base","scrollview-scrollbars"]},"scrollview-base":{requires:["widget","event-gestures","transition"],skinnable:true},"scrollview-base-ie":{condition:{name:"scrollview-base-ie",trigger:"scrollview-base",ua:"ie"},requires:["scrollview-base"]},"scrollview-list":{requires:["plugin","classnamemanager"],skinnable:true},"scrollview-paginator":{requires:["plugin"]},"scrollview-scrollbars":{requires:["classnamemanager","transition","plugin"],skinnable:true},selection:{requires:["node"]},selector:{requires:["selector-native"]},"selector-css2":{condition:{name:"selector-css2",test:function(d){var c=d.config.doc,b=c&&!("querySelectorAll" in c);
return b;
},trigger:"selector"},requires:["selector-native"]},"selector-css3":{requires:["selector-native","selector-css2"]},"selector-native":{requires:["dom-base"]},"shim-plugin":{requires:["node-style","node-pluginhost"]},slider:{use:["slider-base","slider-value-range","clickable-rail","range-slider"]},"slider-base":{requires:["widget","dd-constrain","substitute"],skinnable:true},"slider-value-range":{requires:["slider-base"]},sortable:{requires:["dd-delegate","dd-drop-plugin","dd-proxy"]},"sortable-scroll":{requires:["dd-scroll","sortable"]},stylesheet:{requires:["yui-base"]},substitute:{optional:["dump"],requires:["yui-base"]},swf:{requires:["event-custom","node","swfdetect","escape"]},swfdetect:{requires:["yui-base"]},tabview:{requires:["widget","widget-parent","widget-child","tabview-base","node-pluginhost","node-focusmanager"],skinnable:true},"tabview-base":{requires:["node-event-delegate","classnamemanager","skin-sam-tabview"]},"tabview-plugin":{requires:["tabview-base"]},test:{requires:["event-simulate","event-custom","substitute","json-stringify"],skinnable:true},text:{use:["text-accentfold","text-wordbreak"]},"text-accentfold":{requires:["array-extras","text-data-accentfold"]},"text-data-accentfold":{requires:["yui-base"]},"text-data-wordbreak":{requires:["yui-base"]},"text-wordbreak":{requires:["array-extras","text-data-wordbreak"]},transition:{requires:["node-style"]},"transition-timer":{condition:{name:"transition-timer",test:function(e){var d=e.config.doc,c=(d)?d.documentElement:null,b=true;
if(c&&c.style){b=!("MozTransition" in c.style||"WebkitTransition" in c.style);
}return b;
},trigger:"transition"},requires:["transition"]},uploader:{requires:["event-custom","node","base","swf"]},view:{requires:["base-build","node-event-delegate"]},widget:{use:["widget-base","widget-htmlparser","widget-uievents","widget-skin"]},"widget-anim":{requires:["plugin","anim-base","widget"]},"widget-autohide":{requires:["widget","event-outside","base-build","event-key"],skinnable:false},"widget-base":{requires:["attribute","event-focus","base-base","base-pluginhost","node-base","node-style","classnamemanager"],skinnable:true},"widget-base-ie":{condition:{name:"widget-base-ie",trigger:"widget-base",ua:"ie"},requires:["widget-base"]},"widget-buttons":{requires:["widget","base-build","widget-stdmod"],skinnable:true},"widget-child":{requires:["base-build","widget"]},"widget-htmlparser":{requires:["widget-base"]},"widget-locale":{requires:["widget-base"]},"widget-modality":{requires:["widget","event-outside","base-build"],skinnable:false},"widget-parent":{requires:["base-build","arraylist","widget"]},"widget-position":{requires:["base-build","node-screen","widget"]},"widget-position-align":{requires:["widget-position"]},"widget-position-constrain":{requires:["widget-position"]},"widget-skin":{requires:["widget-base"]},"widget-stack":{requires:["base-build","widget"],skinnable:true},"widget-stdmod":{requires:["base-build","widget"]},"widget-uievents":{requires:["widget-base","node-event-delegate"]},yql:{requires:["jsonp","jsonp-url"]},yui:{},"yui-base":{},"yui-later":{requires:["yui-base"]},"yui-log":{requires:["yui-base"]},"yui-rls":{},"yui-throttle":{requires:["yui-base"]}};
YUI.Env[a.version].md5="105ebffae27a0e3d7331f8cf5c0bb282";
},"3.4.1",{requires:["loader-base"]});
YUI.add("yui",function(a){},"3.4.1",{use:["yui-base","get","features","intl-base","yui-log","yui-later","loader-base","loader-rollup","loader-yui3"]});
if(typeof YUI!="undefined"){YUI._YUI=YUI;
}var YUI=function(){var c=0,f=this,b=arguments,a=b.length,e=function(h,g){return(h&&h.hasOwnProperty&&(h instanceof g));
},d=(typeof YUI_config!=="undefined")&&YUI_config;
if(!(e(f,YUI))){f=new YUI();
}else{f._init();
if(YUI.GlobalConfig){f.applyConfig(YUI.GlobalConfig);
}if(d){f.applyConfig(d);
}if(!a){f._setup();
}}if(a){for(;
c<a;
c++){f.applyConfig(b[c]);
}f._setup();
}f.instanceOf=e;
return f;
};
(function(){var p,b,q="3.4.1",h=".",n="http://yui.yahooapis.com/",t="yui3-js-enabled",l=function(){},g=Array.prototype.slice,r={"io.xdrReady":1,"io.xdrResponse":1,"SWF.eventHandler":1},f=(typeof window!="undefined"),e=(f)?window:null,v=(f)?e.document:null,d=v&&v.documentElement,a=d&&d.className,c={},i=new Date().getTime(),m=function(z,y,x,w){if(z&&z.addEventListener){z.addEventListener(y,x,w);
}else{if(z&&z.attachEvent){z.attachEvent("on"+y,x);
}}},u=function(A,z,y,w){if(A&&A.removeEventListener){try{A.removeEventListener(z,y,w);
}catch(x){}}else{if(A&&A.detachEvent){A.detachEvent("on"+z,y);
}}},s=function(){YUI.Env.windowLoaded=true;
YUI.Env.DOMReady=true;
if(f){u(window,"load",s);
}},j=function(y,x){var w=y.Env._loader;
if(w){w.ignoreRegistered=false;
w.onEnd=null;
w.data=null;
w.required=[];
w.loadType=null;
}else{w=new y.Loader(y.config);
y.Env._loader=w;
}YUI.Env.core=y.Array.dedupe([].concat(YUI.Env.core,["loader-base","loader-rollup","loader-yui3"]));
return w;
},o=function(y,x){for(var w in x){if(x.hasOwnProperty(w)){y[w]=x[w];
}}},k={success:true};
if(d&&a.indexOf(t)==-1){if(a){a+=" ";
}a+=t;
d.className=a;
}if(q.indexOf("@")>-1){q="3.3.0";
}p={applyConfig:function(D){D=D||l;
var y,A,z=this.config,B=z.modules,x=z.groups,C=z.rls,w=this.Env._loader;
for(A in D){if(D.hasOwnProperty(A)){y=D[A];
if(B&&A=="modules"){o(B,y);
}else{if(x&&A=="groups"){o(x,y);
}else{if(C&&A=="rls"){o(C,y);
}else{if(A=="win"){z[A]=y.contentWindow||y;
z.doc=z[A].document;
}else{if(A=="_yuid"){}else{z[A]=y;
}}}}}}}if(w){w._config(D);
}},_config:function(w){this.applyConfig(w);
},_init:function(){var y,z=this,w=YUI.Env,x=z.Env,A;
z.version=q;
if(!x){z.Env={core:["get","features","intl-base","yui-log","yui-later"],mods:{},versions:{},base:n,cdn:n+q+"/build/",_idx:0,_used:{},_attached:{},_missed:[],_yidx:0,_uidx:0,_guidp:"y",_loaded:{},_BASE_RE:/(?:\?(?:[^&]*&)*([^&]*))?\b(simpleyui|yui(?:-\w+)?)\/\2(?:-(min|debug))?\.js/,parseBasePath:function(F,D){var B=F.match(D),E,C;
if(B){E=RegExp.leftContext||F.slice(0,F.indexOf(B[0]));
C=B[3];
if(B[1]){E+="?"+B[1];
}E={filter:C,path:E};
}return E;
},getBase:w&&w.getBase||function(F){var D=(v&&v.getElementsByTagName("script"))||[],G=x.cdn,C,E,B,H;
for(E=0,B=D.length;
E<B;
++E){H=D[E].src;
if(H){C=z.Env.parseBasePath(H,F);
if(C){y=C.filter;
G=C.path;
break;
}}}return G;
}};
x=z.Env;
x._loaded[q]={};
if(w&&z!==YUI){x._yidx=++w._yidx;
x._guidp=("yui_"+q+"_"+x._yidx+"_"+i).replace(/\./g,"_");
}else{if(YUI._YUI){w=YUI._YUI.Env;
x._yidx+=w._yidx;
x._uidx+=w._uidx;
for(A in w){if(!(A in x)){x[A]=w[A];
}}delete YUI._YUI;
}}z.id=z.stamp(z);
c[z.id]=z;
}z.constructor=YUI;
z.config=z.config||{win:e,doc:v,debug:true,useBrowserConsole:true,throwFail:true,bootstrap:true,cacheUse:true,fetchCSS:true,use_rls:false,rls_timeout:2000};
if(YUI.Env.rls_disabled){z.config.use_rls=false;
}z.config.lang=z.config.lang||"en-US";
z.config.base=YUI.config.base||z.Env.getBase(z.Env._BASE_RE);
if(!y||(!("mindebug").indexOf(y))){y="min";
}y=(y)?"-"+y:y;
z.config.loaderPath=YUI.config.loaderPath||"loader/loader"+y+".js";
},_setup:function(B){var x,A=this,w=[],z=YUI.Env.mods,y=A.config.core||[].concat(YUI.Env.core);
for(x=0;
x<y.length;
x++){if(z[y[x]]){w.push(y[x]);
}}A._attach(["yui-base"]);
A._attach(w);
if(A.Loader){j(A);
}},applyTo:function(C,B,y){if(!(B in r)){this.log(B+": applyTo not allowed","warn","yui");
return null;
}var x=c[C],A,w,z;
if(x){A=B.split(".");
w=x;
for(z=0;
z<A.length;
z=z+1){w=w[A[z]];
if(!w){this.log("applyTo not found: "+B,"warn","yui");
}}return w.apply(x,y);
}return null;
},add:function(x,C,B,w){w=w||{};
var A=YUI.Env,D={name:x,fn:C,version:B,details:w},E,z,y=A.versions;
A.mods[x]=D;
y[B]=y[B]||{};
y[B][x]=D;
for(z in c){if(c.hasOwnProperty(z)){E=c[z].Env._loader;
if(E){if(!E.moduleInfo[x]){E.addModule(w,x);
}}}}return this;
},_attach:function(B,M){var F,N,L,I,w,D,y,z=YUI.Env.mods,G=YUI.Env.aliases,x=this,E,A=x.Env._loader,C=x.Env._attached,H=B.length,A,K=[];
for(F=0;
F<H;
F++){N=B[F];
L=z[N];
K.push(N);
if(A&&A.conditions[N]){x.Object.each(A.conditions[N],function(P){var O=P&&((P.ua&&x.UA[P.ua])||(P.test&&P.test(x)));
if(O){K.push(P.name);
}});
}}B=K;
H=B.length;
for(F=0;
F<H;
F++){if(!C[B[F]]){N=B[F];
L=z[N];
if(G&&G[N]){x._attach(G[N]);
continue;
}if(!L){if(A&&A.moduleInfo[N]){L=A.moduleInfo[N];
M=true;
}if(!M){if((N.indexOf("skin-")===-1)&&(N.indexOf("css")===-1)){x.Env._missed.push(N);
x.Env._missed=x.Array.dedupe(x.Env._missed);
x.message("NOT loaded: "+N,"warn","yui");
}}}else{C[N]=true;
for(E=0;
E<x.Env._missed.length;
E++){if(x.Env._missed[E]===N){x.message("Found: "+N+" (was reported as missing earlier)","warn","yui");
x.Env._missed.splice(E,1);
}}I=L.details;
w=I.requires;
D=I.use;
y=I.after;
if(w){for(E=0;
E<w.length;
E++){if(!C[w[E]]){if(!x._attach(w)){return false;
}break;
}}}if(y){for(E=0;
E<y.length;
E++){if(!C[y[E]]){if(!x._attach(y,true)){return false;
}break;
}}}if(L.fn){try{L.fn(x,N);
}catch(J){x.error("Attach error: "+N,J,N);
return false;
}}if(D){for(E=0;
E<D.length;
E++){if(!C[D[E]]){if(!x._attach(D)){return false;
}break;
}}}}}}return true;
},use:function(){var y=g.call(arguments,0),C=y[y.length-1],B=this,A=0,x,w=B.Env,z=true;
if(B.Lang.isFunction(C)){y.pop();
}else{C=null;
}if(B.Lang.isArray(y[0])){y=y[0];
}if(B.config.cacheUse){while((x=y[A++])){if(!w._attached[x]){z=false;
break;
}}if(z){if(y.length){}B._notify(C,k,y);
return B;
}}if(B._loading){B._useQueue=B._useQueue||new B.Queue();
B._useQueue.add([y,C]);
}else{B._use(y,function(E,D){E._notify(C,D,y);
});
}return B;
},_notify:function(z,w,x){if(!w.success&&this.config.loadErrorFn){this.config.loadErrorFn.call(this,this,z,w,x);
}else{if(z){try{z(this,w);
}catch(y){this.error("use callback error",y,x);
}}}},_use:function(y,A){if(!this.Array){this._attach(["yui-base"]);
}var M,F,N,K,x=this,O=YUI.Env,z=O.mods,w=x.Env,C=w._used,J=O._loaderQueue,R=y[0],E=x.Array,P=x.config,D=P.bootstrap,L=[],H=[],Q=true,B=P.fetchCSS,I=function(T,S){if(!T.length){return;
}E.each(T,function(W){if(!S){H.push(W);
}if(C[W]){return;
}var U=z[W],X,V;
if(U){C[W]=true;
X=U.details.requires;
V=U.details.use;
}else{if(!O._loaded[q][W]){L.push(W);
}else{C[W]=true;
}}if(X&&X.length){I(X);
}if(V&&V.length){I(V,1);
}});
},G=function(W){var U=W||{success:true,msg:"not dynamic"},T,S,V=true,X=U.data;
x._loading=false;
if(X){S=L;
L=[];
H=[];
I(X);
T=L.length;
if(T){if(L.sort().join()==S.sort().join()){T=false;
}}}if(T&&X){x._loading=false;
x._use(y,function(){if(x._attach(X)){x._notify(A,U,X);
}});
}else{if(X){V=x._attach(X);
}if(V){x._notify(A,U,y);
}}if(x._useQueue&&x._useQueue.size()&&!x._loading){x._use.apply(x,x._useQueue.next());
}};
if(R==="*"){Q=x._attach(x.Object.keys(z));
if(Q){G();
}return x;
}if(D&&x.Loader&&y.length){F=j(x);
F.require(y);
F.ignoreRegistered=true;
F.calculate(null,(B)?null:"js");
y=F.sorted;
}I(y);
M=L.length;
if(M){L=x.Object.keys(E.hash(L));
M=L.length;
}if(D&&M&&x.Loader){x._loading=true;
F=j(x);
F.onEnd=G;
F.context=x;
F.data=y;
F.ignoreRegistered=false;
F.require(y);
F.insert(null,(B)?null:"js");
}else{if(M&&x.config.use_rls&&!YUI.Env.rls_enabled){O._rls_queue=O._rls_queue||new x.Queue();
K=function(S,U){var T=function(W){G(W);
S.rls_advance();
},V=S._rls(U);
if(V){S.rls_oncomplete(function(W){T(W);
});
S.Get.script(V,{data:U,timeout:S.config.rls_timeout,onFailure:S.rls_handleFailure,onTimeout:S.rls_handleTimeout});
}else{T({success:true,data:U});
}};
O._rls_queue.add(function(){O._rls_in_progress=true;
x.rls_callback=A;
x.rls_locals(x,y,K);
});
if(!O._rls_in_progress&&O._rls_queue.size()){O._rls_queue.next()();
}}else{if(D&&M&&x.Get&&!w.bootstrapped){x._loading=true;
N=function(){x._loading=false;
J.running=false;
w.bootstrapped=true;
O._bootstrapping=false;
if(x._attach(["loader"])){x._use(y,A);
}};
if(O._bootstrapping){J.add(N);
}else{O._bootstrapping=true;
x.Get.script(P.base+P.loaderPath,{onEnd:N});
}}else{Q=x._attach(y);
if(Q){G();
}}}}return x;
},namespace:function(){var x=arguments,B=this,z=0,y,A,w;
for(;
z<x.length;
z++){w=x[z];
if(w.indexOf(h)){A=w.split(h);
for(y=(A[0]=="YAHOO")?1:0;
y<A.length;
y++){B[A[y]]=B[A[y]]||{};
B=B[A[y]];
}}else{B[w]=B[w]||{};
}}return B;
},log:l,message:l,dump:function(w){return""+w;
},error:function(A,y,x){var z=this,w;
if(z.config.errorFn){w=z.config.errorFn.apply(z,arguments);
}if(z.config.throwFail&&!w){throw (y||new Error(A));
}else{z.message(A,"error");
}return z;
},guid:function(w){var x=this.Env._guidp+"_"+(++this.Env._uidx);
return(w)?(w+x):x;
},stamp:function(y,z){var w;
if(!y){return y;
}if(y.uniqueID&&y.nodeType&&y.nodeType!==9){w=y.uniqueID;
}else{w=(typeof y==="string")?y:y._yuid;
}if(!w){w=this.guid();
if(!z){try{y._yuid=w;
}catch(x){w=null;
}}}return w;
},destroy:function(){var w=this;
if(w.Event){w.Event._unload();
}delete c[w.id];
delete w.Env;
delete w.config;
}};
YUI.prototype=p;
for(b in p){if(p.hasOwnProperty(b)){YUI[b]=p[b];
}}YUI._init();
if(f){m(window,"load",s);
}else{s();
}YUI.Env.add=m;
YUI.Env.remove=u;
if(typeof exports=="object"){exports.YUI=YUI;
}}());
YUI.add("yui-base",function(b){var i=b.Lang||(b.Lang={}),n=String.prototype,k=Object.prototype.toString,a={"undefined":"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"},c=/\{\s*([^|}]+?)\s*(?:\|([^}]*))?\s*\}/g,s=/^\s+|\s+$/g,e=b.config.win,o=e&&!!(e.MooTools||e.Prototype);
i.isArray=(!o&&Array.isArray)||function(w){return i.type(w)==="array";
};
i.isBoolean=function(w){return typeof w==="boolean";
};
i.isFunction=function(w){return i.type(w)==="function";
};
i.isDate=function(w){return i.type(w)==="date"&&w.toString()!=="Invalid Date"&&!isNaN(w);
};
i.isNull=function(w){return w===null;
};
i.isNumber=function(w){return typeof w==="number"&&isFinite(w);
};
i.isObject=function(y,x){var w=typeof y;
return(y&&(w==="object"||(!x&&(w==="function"||i.isFunction(y)))))||false;
};
i.isString=function(w){return typeof w==="string";
};
i.isUndefined=function(w){return typeof w==="undefined";
};
i.trim=n.trim?function(w){return w&&w.trim?w.trim():w;
}:function(w){try{return w.replace(s,"");
}catch(x){return w;
}};
i.trimLeft=n.trimLeft?function(w){return w.trimLeft();
}:function(w){return w.replace(/^\s+/,"");
};
i.trimRight=n.trimRight?function(w){return w.trimRight();
}:function(w){return w.replace(/\s+$/,"");
};
i.isValue=function(x){var w=i.type(x);
switch(w){case"number":return isFinite(x);
case"null":case"undefined":return false;
default:return !!w;
}};
i.type=function(w){return a[typeof w]||a[k.call(w)]||(w?"object":"null");
};
i.sub=function(w,x){return w.replace?w.replace(c,function(y,z){return i.isUndefined(x[z])?y:x[z];
}):w;
};
i.now=Date.now||function(){return new Date().getTime();
};
var f=b.Lang,r=Array.prototype,p=Object.prototype.hasOwnProperty;
function j(y,B,A){var x,w;
B||(B=0);
if(A||j.test(y)){try{return r.slice.call(y,B);
}catch(z){w=[];
for(x=y.length;
B<x;
++B){w.push(y[B]);
}return w;
}}return[y];
}b.Array=j;
j.dedupe=function(B){var A={},y=[],x,z,w;
for(x=0,w=B.length;
x<w;
++x){z=B[x];
if(!p.call(A,z)){A[z]=1;
y.push(z);
}}return y;
};
j.each=j.forEach=r.forEach?function(y,w,x){r.forEach.call(y||[],w,x||b);
return b;
}:function(A,y,z){for(var x=0,w=(A&&A.length)||0;
x<w;
++x){if(x in A){y.call(z||b,A[x],x,A);
}}return b;
};
j.hash=function(z,x){var A={},B=(x&&x.length)||0,y,w;
for(y=0,w=z.length;
y<w;
++y){if(y in z){A[z[y]]=B>y&&y in x?x[y]:true;
}}return A;
};
j.indexOf=r.indexOf?function(x,w){return r.indexOf.call(x,w);
}:function(z,y){for(var x=0,w=z.length;
x<w;
++x){if(x in z&&z[x]===y){return x;
}}return -1;
};
j.numericSort=function(x,w){return x-w;
};
j.some=r.some?function(y,w,x){return r.some.call(y,w,x);
}:function(A,y,z){for(var x=0,w=A.length;
x<w;
++x){if(x in A&&y.call(z,A[x],x,A)){return true;
}}return false;
};
j.test=function(y){var w=0;
if(f.isArray(y)){w=1;
}else{if(f.isObject(y)){try{if("length" in y&&!y.tagName&&!y.alert&&!y.apply){w=2;
}}catch(x){}}}return w;
};
function u(){this._init();
this.add.apply(this,arguments);
}u.prototype={_init:function(){this._q=[];
},next:function(){return this._q.shift();
},last:function(){return this._q.pop();
},add:function(){this._q.push.apply(this._q,arguments);
return this;
},size:function(){return this._q.length;
}};
b.Queue=u;
YUI.Env._loaderQueue=YUI.Env._loaderQueue||new u();
var m="__",p=Object.prototype.hasOwnProperty,l=b.Lang.isObject;
b.cached=function(y,w,x){w||(w={});
return function(z){var A=arguments.length>1?Array.prototype.join.call(arguments,m):String(z);
if(!(A in w)||(x&&w[A]==x)){w[A]=y.apply(y,arguments);
}return w[A];
};
};
b.merge=function(){var y=arguments,z=0,x=y.length,w={};
for(;
z<x;
++z){b.mix(w,y[z],true);
}return w;
};
b.mix=function(w,x,D,y,A,E){var B,H,G,z,I,C,F;
if(!w||!x){return w||b;
}if(A){if(A===2){b.mix(w.prototype,x.prototype,D,y,0,E);
}G=A===1||A===3?x.prototype:x;
F=A===1||A===4?w.prototype:w;
if(!G||!F){return w;
}}else{G=x;
F=w;
}B=D&&!E;
if(y){for(z=0,C=y.length;
z<C;
++z){I=y[z];
if(!p.call(G,I)){continue;
}H=B?false:I in F;
if(E&&H&&l(F[I],true)&&l(G[I],true)){b.mix(F[I],G[I],D,null,0,E);
}else{if(D||!H){F[I]=G[I];
}}}}else{for(I in G){if(!p.call(G,I)){continue;
}H=B?false:I in F;
if(E&&H&&l(F[I],true)&&l(G[I],true)){b.mix(F[I],G[I],D,null,0,E);
}else{if(D||!H){F[I]=G[I];
}}}if(b.Object._hasEnumBug){b.mix(F,G,D,b.Object._forceEnum,A,E);
}}return w;
};
var p=Object.prototype.hasOwnProperty,e=b.config.win,o=e&&!!(e.MooTools||e.Prototype),v,g=b.Object=(!o&&Object.create)?function(w){return Object.create(w);
}:(function(){function w(){}return function(x){w.prototype=x;
return new w();
};
}()),d=g._forceEnum=["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"],t=g._hasEnumBug=!{valueOf:0}.propertyIsEnumerable("valueOf"),q=g._hasProtoEnumBug=(function(){}).propertyIsEnumerable("prototype"),h=g.owns=function(x,w){return !!x&&p.call(x,w);
};
g.hasKey=h;
g.keys=(!o&&Object.keys)||function(A){if(!b.Lang.isObject(A)){throw new TypeError("Object.keys called on a non-object");
}var z=[],y,x,w;
if(q&&typeof A==="function"){for(x in A){if(h(A,x)&&x!=="prototype"){z.push(x);
}}}else{for(x in A){if(h(A,x)){z.push(x);
}}}if(t){for(y=0,w=d.length;
y<w;
++y){x=d[y];
if(h(A,x)){z.push(x);
}}}return z;
};
g.values=function(A){var z=g.keys(A),y=0,w=z.length,x=[];
for(;
y<w;
++y){x.push(A[z[y]]);
}return x;
};
g.size=function(x){try{return g.keys(x).length;
}catch(w){return 0;
}};
g.hasValue=function(x,w){return b.Array.indexOf(g.values(x),w)>-1;
};
g.each=function(z,x,A,y){var w;
for(w in z){if(y||h(z,w)){x.call(A||b,z[w],w,z);
}}return b;
};
g.some=function(z,x,A,y){var w;
for(w in z){if(y||h(z,w)){if(x.call(A||b,z[w],w,z)){return true;
}}}return false;
};
g.getValue=function(A,z){if(!b.Lang.isObject(A)){return v;
}var x,y=b.Array(z),w=y.length;
for(x=0;
A!==v&&x<w;
x++){A=A[y[x]];
}return A;
};
g.setValue=function(C,A,B){var w,z=b.Array(A),y=z.length-1,x=C;
if(y>=0){for(w=0;
x!==v&&w<y;
w++){x=x[z[w]];
}if(x!==v){x[z[w]]=B;
}else{return v;
}}return C;
};
g.isEmpty=function(w){return !g.keys(w).length;
};
YUI.Env.parseUA=function(C){var B=function(F){var G=0;
return parseFloat(F.replace(/\./g,function(){return(G++==1)?"":".";
}));
},E=b.config.win,w=E&&E.navigator,z={ie:0,opera:0,gecko:0,webkit:0,safari:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:w&&w.cajaVersion,secure:false,os:null},x=C||w&&w.userAgent,D=E&&E.location,y=D&&D.href,A;
z.userAgent=x;
z.secure=y&&(y.toLowerCase().indexOf("https")===0);
if(x){if((/windows|win32/i).test(x)){z.os="windows";
}else{if((/macintosh/i).test(x)){z.os="macintosh";
}else{if((/rhino/i).test(x)){z.os="rhino";
}}}if((/KHTML/).test(x)){z.webkit=1;
}A=x.match(/AppleWebKit\/([^\s]*)/);
if(A&&A[1]){z.webkit=B(A[1]);
z.safari=z.webkit;
if(/ Mobile\//.test(x)){z.mobile="Apple";
A=x.match(/OS ([^\s]*)/);
if(A&&A[1]){A=B(A[1].replace("_","."));
}z.ios=A;
z.ipad=z.ipod=z.iphone=0;
A=x.match(/iPad|iPod|iPhone/);
if(A&&A[0]){z[A[0].toLowerCase()]=z.ios;
}}else{A=x.match(/NokiaN[^\/]*|webOS\/\d\.\d/);
if(A){z.mobile=A[0];
}if(/webOS/.test(x)){z.mobile="WebOS";
A=x.match(/webOS\/([^\s]*);/);
if(A&&A[1]){z.webos=B(A[1]);
}}if(/ Android/.test(x)){if(/Mobile/.test(x)){z.mobile="Android";
}A=x.match(/Android ([^\s]*);/);
if(A&&A[1]){z.android=B(A[1]);
}}}A=x.match(/Chrome\/([^\s]*)/);
if(A&&A[1]){z.chrome=B(A[1]);
z.safari=0;
}else{A=x.match(/AdobeAIR\/([^\s]*)/);
if(A){z.air=A[0];
}}}if(!z.webkit){A=x.match(/Opera[\s\/]([^\s]*)/);
if(A&&A[1]){z.opera=B(A[1]);
A=x.match(/Version\/([^\s]*)/);
if(A&&A[1]){z.opera=B(A[1]);
}A=x.match(/Opera Mini[^;]*/);
if(A){z.mobile=A[0];
}}else{A=x.match(/MSIE\s([^;]*)/);
if(A&&A[1]){z.ie=B(A[1]);
}else{A=x.match(/Gecko\/([^\s]*)/);
if(A){z.gecko=1;
A=x.match(/rv:([^\s\)]*)/);
if(A&&A[1]){z.gecko=B(A[1]);
}}}}}}if(!C){YUI.Env.UA=z;
}return z;
};
b.UA=YUI.Env.UA||YUI.Env.parseUA();
YUI.Env.aliases={anim:["anim-base","anim-color","anim-curve","anim-easing","anim-node-plugin","anim-scroll","anim-xy"],app:["controller","model","model-list","view"],attribute:["attribute-base","attribute-complex"],autocomplete:["autocomplete-base","autocomplete-sources","autocomplete-list","autocomplete-plugin"],base:["base-base","base-pluginhost","base-build"],cache:["cache-base","cache-offline","cache-plugin"],collection:["array-extras","arraylist","arraylist-add","arraylist-filter","array-invoke"],dataschema:["dataschema-base","dataschema-json","dataschema-xml","dataschema-array","dataschema-text"],datasource:["datasource-local","datasource-io","datasource-get","datasource-function","datasource-cache","datasource-jsonschema","datasource-xmlschema","datasource-arrayschema","datasource-textschema","datasource-polling"],datatable:["datatable-base","datatable-datasource","datatable-sort","datatable-scroll"],datatype:["datatype-number","datatype-date","datatype-xml"],"datatype-date":["datatype-date-parse","datatype-date-format"],"datatype-number":["datatype-number-parse","datatype-number-format"],"datatype-xml":["datatype-xml-parse","datatype-xml-format"],dd:["dd-ddm-base","dd-ddm","dd-ddm-drop","dd-drag","dd-proxy","dd-constrain","dd-drop","dd-scroll","dd-delegate"],dom:["dom-base","dom-screen","dom-style","selector-native","selector"],editor:["frame","selection","exec-command","editor-base","editor-para","editor-br","editor-bidi","editor-tab","createlink-base"],event:["event-base","event-delegate","event-synthetic","event-mousewheel","event-mouseenter","event-key","event-focus","event-resize","event-hover","event-outside"],"event-custom":["event-custom-base","event-custom-complex"],"event-gestures":["event-flick","event-move"],highlight:["highlight-base","highlight-accentfold"],history:["history-base","history-hash","history-hash-ie","history-html5"],io:["io-base","io-xdr","io-form","io-upload-iframe","io-queue"],json:["json-parse","json-stringify"],loader:["loader-base","loader-rollup","loader-yui3"],node:["node-base","node-event-delegate","node-pluginhost","node-screen","node-style"],pluginhost:["pluginhost-base","pluginhost-config"],querystring:["querystring-parse","querystring-stringify"],recordset:["recordset-base","recordset-sort","recordset-filter","recordset-indexer"],resize:["resize-base","resize-proxy","resize-constrain"],slider:["slider-base","slider-value-range","clickable-rail","range-slider"],text:["text-accentfold","text-wordbreak"],widget:["widget-base","widget-htmlparser","widget-uievents","widget-skin"]};
},"3.4.1");
YUI.add("get",function(e){var B=e.UA,p=e.Lang,b="text/javascript",v="text/css",I="stylesheet",s="script",q="autopurge",A="utf-8",w="link",C="async",h=true,l={script:h,css:!(B.webkit||B.gecko)},z={},r=0,g,u=function(J){var K=J.timer;
if(K){clearTimeout(K);
J.timer=null;
}},m=function(M,J,P,N){var K=N||e.config.win,O=K.document,Q=O.createElement(M),L;
if(P){e.mix(J,P);
}for(L in J){if(J[L]&&J.hasOwnProperty(L)){Q.setAttribute(L,J[L]);
}}return Q;
},k=function(K,L,J){return m(w,{id:e.guid(),type:v,rel:I,href:K},J,L);
},E=function(K,L,J){return m(s,{id:e.guid(),type:b,src:K},J,L);
},a=function(K,L,J){return{tId:K.tId,win:K.win,data:K.data,nodes:K.nodes,msg:L,statusText:J,purge:function(){d(this.tId);
}};
},o=function(N,M,J){var L=z[N],K=L&&L.onEnd;
L.finished=true;
if(K){K.call(L.context,a(L,M,J));
}},F=function(M,L){var K=z[M],J=K.onFailure;
u(K);
if(J){J.call(K.context,a(K,L));
}o(M,L,"failure");
},y=function(J){F(J,"transaction "+J+" was aborted");
},x=function(L){var J=z[L],K=J.onSuccess;
u(J);
if(J.aborted){y(L);
}else{if(K){K.call(J.context,a(J));
}o(L,undefined,"OK");
}},H=function(J,M){var K=z[M],L=(p.isString(J))?K.win.document.getElementById(J):J;
if(!L){F(M,"target node not found: "+J);
}return L;
},d=function(O){var K,R,S,T,L,Q,P,N,M,J=z[O];
if(J){K=J.nodes;
M=K.length;
for(N=0;
N<M;
N++){L=K[N];
S=L.parentNode;
if(L.clearAttributes){L.clearAttributes();
}else{for(Q in L){if(L.hasOwnProperty(Q)){delete L[Q];
}}}S.removeChild(L);
}}J.nodes=[];
},t=function(N,J){var K=z[N],L=K.onProgress,M;
if(L){M=a(K);
M.url=J;
L.call(K.context,M);
}},D=function(L){var J=z[L],K=J.onTimeout;
if(K){K.call(J.context,a(J));
}o(L,"timeout","timeout");
},f=function(M,J){var L=z[M],K=(L&&!L.async);
if(!L){return;
}if(K){u(L);
}t(M,J);
if(!L.finished){if(L.aborted){y(M);
}else{if((--L.remaining)===0){x(M);
}else{if(K){i(M);
}}}}},c=function(K,M,L,J){if(B.ie){M.onreadystatechange=function(){var N=this.readyState;
if("loaded"===N||"complete"===N){M.onreadystatechange=null;
f(L,J);
}};
}else{if(B.webkit){if(K===s){M.addEventListener("load",function(){f(L,J);
},false);
}}else{M.onload=function(){f(L,J);
};
M.onerror=function(N){F(L,N+": "+J);
};
}}},G=function(L,P,O){var M=z[P],N=O.document,J=M.insertBefore||N.getElementsByTagName("base")[0],K;
if(J){K=H(J,P);
if(K){K.parentNode.insertBefore(L,K);
}}else{N.getElementsByTagName("head")[0].appendChild(L);
}},i=function(Q){var O=z[Q],L=O.type,K=O.attributes,P=O.win,N=O.timeout,M,J;
if(O.url.length>0){J=O.url.shift();
if(N&&!O.timer){O.timer=setTimeout(function(){D(Q);
},N);
}if(L===s){M=E(J,P,K);
}else{M=k(J,P,K);
}O.nodes.push(M);
c(L,M,Q,J);
G(M,Q,P);
if(!l[L]){f(Q,J);
}if(O.async){i(Q);
}}},n=function(){if(g){return;
}g=true;
var J,K;
for(J in z){if(z.hasOwnProperty(J)){K=z[J];
if(K.autopurge&&K.finished){d(K.tId);
delete z[J];
}}}g=false;
},j=function(K,J,L){L=L||{};
var O="q"+(r++),N=L.purgethreshold||e.Get.PURGE_THRESH,M;
if(r%N===0){n();
}M=z[O]=e.merge(L);
M.tId=O;
M.type=K;
M.url=J;
M.finished=false;
M.nodes=[];
M.win=M.win||e.config.win;
M.context=M.context||M;
M.autopurge=(q in M)?M.autopurge:(K===s)?true:false;
M.attributes=M.attributes||{};
M.attributes.charset=L.charset||M.attributes.charset||A;
if(C in M&&K===s){M.attributes.async=M.async;
}M.url=(p.isString(M.url))?[M.url]:M.url;
if(!M.url[0]){M.url.shift();
}M.remaining=M.url.length;
i(O);
return{tId:O};
};
e.Get={PURGE_THRESH:20,abort:function(K){var L=(p.isString(K))?K:K.tId,J=z[L];
if(J){J.aborted=true;
}},script:function(J,K){return j(s,J,K);
},css:function(J,K){return j("css",J,K);
}};
},"3.4.1",{requires:["yui-base"]});
YUI.add("features",function(b){var c={};
b.mix(b.namespace("Features"),{tests:c,add:function(d,e,f){c[d]=c[d]||{};
c[d][e]=f;
},all:function(e,f){var g=c[e],d=[];
if(g){b.Object.each(g,function(i,h){d.push(h+":"+(b.Features.test(e,h,f)?1:0));
});
}return(d.length)?d.join(";"):"";
},test:function(e,g,f){f=f||[];
var d,i,k,j=c[e],h=j&&j[g];
if(!h){}else{d=h.result;
if(b.Lang.isUndefined(d)){i=h.ua;
if(i){d=(b.UA[i]);
}k=h.test;
if(k&&((!i)||d)){d=k.apply(b,f);
}h.result=d;
}}return d;
}});
var a=b.Features.add;
a("load","0",{name:"graphics-canvas-default",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(d&&d.getContext&&d.getContext("2d")));
},trigger:"graphics"});
a("load","1",{name:"autocomplete-list-keys",test:function(d){return !(d.UA.ios||d.UA.android);
},trigger:"autocomplete-list"});
a("load","2",{name:"graphics-svg",test:function(e){var d=e.config.doc;
return(d&&d.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"});
a("load","3",{name:"history-hash-ie",test:function(e){var d=e.config.doc&&e.config.doc.documentMode;
return e.UA.ie&&(!("onhashchange" in e.config.win)||!d||d<8);
},trigger:"history-hash"});
a("load","4",{name:"graphics-vml-default",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!d||!d.getContext||!d.getContext("2d")));
},trigger:"graphics"});
a("load","5",{name:"graphics-svg-default",test:function(e){var d=e.config.doc;
return(d&&d.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"});
a("load","6",{name:"widget-base-ie",trigger:"widget-base",ua:"ie"});
a("load","7",{name:"transition-timer",test:function(g){var f=g.config.doc,e=(f)?f.documentElement:null,d=true;
if(e&&e.style){d=!("MozTransition" in e.style||"WebkitTransition" in e.style);
}return d;
},trigger:"transition"});
a("load","8",{name:"dom-style-ie",test:function(j){var h=j.Features.test,i=j.Features.add,f=j.config.win,g=j.config.doc,d="documentElement",e=false;
i("style","computedStyle",{test:function(){return f&&"getComputedStyle" in f;
}});
i("style","opacity",{test:function(){return g&&"opacity" in g[d].style;
}});
e=(!h("style","opacity")&&!h("style","computedStyle"));
return e;
},trigger:"dom-style"});
a("load","9",{name:"selector-css2",test:function(f){var e=f.config.doc,d=e&&!("querySelectorAll" in e);
return d;
},trigger:"selector"});
a("load","10",{name:"event-base-ie",test:function(e){var d=e.config.doc&&e.config.doc.implementation;
return(d&&(!d.hasFeature("Events","2.0")));
},trigger:"node-base"});
a("load","11",{name:"dd-gestures",test:function(d){return(d.config.win&&("ontouchstart" in d.config.win&&!d.UA.chrome));
},trigger:"dd-drag"});
a("load","12",{name:"scrollview-base-ie",trigger:"scrollview-base",ua:"ie"});
a("load","13",{name:"graphics-canvas",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(d&&d.getContext&&d.getContext("2d")));
},trigger:"graphics"});
a("load","14",{name:"graphics-vml",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!d||!d.getContext||!d.getContext("2d")));
},trigger:"graphics"});
},"3.4.1",{requires:["yui-base"]});
YUI.add("intl-base",function(b){var a=/[, ]/;
b.mix(b.namespace("Intl"),{lookupBestLang:function(g,h){var f,j,c,e;
function d(l){var k;
for(k=0;
k<h.length;
k+=1){if(l.toLowerCase()===h[k].toLowerCase()){return h[k];
}}}if(b.Lang.isString(g)){g=g.split(a);
}for(f=0;
f<g.length;
f+=1){j=g[f];
if(!j||j==="*"){continue;
}while(j.length>0){c=d(j);
if(c){return c;
}else{e=j.lastIndexOf("-");
if(e>=0){j=j.substring(0,e);
if(e>=2&&j.charAt(e-2)==="-"){j=j.substring(0,e-2);
}}else{break;
}}}}return"";
}});
},"3.4.1",{requires:["yui-base"]});
YUI.add("yui-log",function(d){var c=d,e="yui:log",a="undefined",b={debug:1,info:1,warn:1,error:1};
c.log=function(j,s,g,q){var l,p,n,k,o,i=c,r=i.config,h=(i.fire)?i:YUI.Env.globalEvents;
if(r.debug){if(g){p=r.logExclude;
n=r.logInclude;
if(n&&!(g in n)){l=1;
}else{if(n&&(g in n)){l=!n[g];
}else{if(p&&(g in p)){l=p[g];
}}}}if(!l){if(r.useBrowserConsole){k=(g)?g+": "+j:j;
if(i.Lang.isFunction(r.logFn)){r.logFn.call(i,j,s,g);
}else{if(typeof console!=a&&console.log){o=(s&&console[s]&&(s in b))?s:"log";
console[o](k);
}else{if(typeof opera!=a){opera.postError(k);
}}}}if(h&&!q){if(h==i&&(!h.getEvent(e))){h.publish(e,{broadcast:2});
}h.fire(e,{msg:j,cat:s,src:g});
}}}return i;
};
c.message=function(){return c.log.apply(c,arguments);
};
},"3.4.1",{requires:["yui-base"]});
YUI.add("yui-later",function(b){var a=[];
b.later=function(j,f,k,g,h){j=j||0;
g=(!b.Lang.isUndefined(g))?b.Array(g):a;
f=f||b.config.win||b;
var i=false,c=(f&&b.Lang.isString(k))?f[k]:k,d=function(){if(!i){if(!c.apply){c(g[0],g[1],g[2],g[3]);
}else{c.apply(f,g||a);
}}},e=(h)?setInterval(d,j):setTimeout(d,j);
return{id:e,interval:h,cancel:function(){i=true;
if(this.interval){clearInterval(e);
}else{clearTimeout(e);
}}};
};
b.Lang.later=b.later;
},"3.4.1",{requires:["yui-base"]});
YUI.add("yui",function(a){},"3.4.1",{use:["yui-base","get","features","intl-base","yui-log","yui-later"]});
YUI.add("oop",function(h){var d=h.Lang,c=h.Array,b=Object.prototype,a="_~yuim~_",e=b.hasOwnProperty,g=b.toString;
function f(l,k,m,i,j){if(l&&l[j]&&l!==h){return l[j].call(l,k,m);
}else{switch(c.test(l)){case 1:return c[j](l,k,m);
case 2:return c[j](h.Array(l,0,true),k,m);
default:return h.Object[j](l,k,m,i);
}}}h.augment=function(i,k,r,o,s){var n=i.prototype,m=n&&k,q=k.prototype,v=n||i,j,u,p,l,t;
s=s?h.Array(s):[];
if(m){u={};
p={};
l={};
j=function(x,w){if(r||!(w in n)){if(g.call(x)==="[object Function]"){l[w]=x;
u[w]=p[w]=function(){return t(this,x,arguments);
};
}else{u[w]=x;
}}};
t=function(w,y,z){for(var x in l){if(e.call(l,x)&&w[x]===p[x]){w[x]=l[x];
}}k.apply(w,s);
return y.apply(w,z);
};
if(o){h.Array.each(o,function(w){if(w in q){j(q[w],w);
}});
}else{h.Object.each(q,j,null,true);
}}h.mix(v,u||q,r,o);
if(!m){k.apply(v,s);
}return i;
};
h.aggregate=function(k,j,i,l){return h.mix(k,j,i,l,0,true);
};
h.extend=function(l,k,i,n){if(!k||!l){h.error("extend failed, verify dependencies");
}var m=k.prototype,j=h.Object(m);
l.prototype=j;
j.constructor=l;
l.superclass=m;
if(k!=Object&&m.constructor==b.constructor){m.constructor=k;
}if(i){h.mix(j,i,true);
}if(n){h.mix(l,n,true);
}return l;
};
h.each=function(k,j,l,i){return f(k,j,l,i,"each");
};
h.some=function(k,j,l,i){return f(k,j,l,i,"some");
};
h.clone=function(l,m,r,s,k,q){if(!d.isObject(l)){return l;
}if(h.instanceOf(l,YUI)){return l;
}var n,j=q||{},i,p=h.each;
switch(d.type(l)){case"date":return new Date(l);
case"regexp":return l;
case"function":return l;
case"array":n=[];
break;
default:if(l[a]){return j[l[a]];
}i=h.guid();
n=(m)?{}:h.Object(l);
l[a]=i;
j[i]=l;
}if(!l.addEventListener&&!l.attachEvent){p(l,function(t,o){if((o||o===0)&&(!r||(r.call(s||this,t,o,this,l)!==false))){if(o!==a){if(o=="prototype"){}else{this[o]=h.clone(t,m,r,s,k||l,j);
}}}},n);
}if(!q){h.Object.each(j,function(t,o){if(t[a]){try{delete t[a];
}catch(u){t[a]=null;
}}},this);
j=null;
}return n;
};
h.bind=function(i,k){var j=arguments.length>2?h.Array(arguments,2,true):null;
return function(){var m=d.isString(i)?k[i]:i,l=(j)?j.concat(h.Array(arguments,0,true)):arguments;
return m.apply(k||m,l);
};
};
h.rbind=function(i,k){var j=arguments.length>2?h.Array(arguments,2,true):null;
return function(){var m=d.isString(i)?k[i]:i,l=(j)?h.Array(arguments,0,true).concat(j):arguments;
return m.apply(k||m,l);
};
};
},"3.4.1",{requires:["yui-base"]});
YUI.add("event-custom-base",function(b){b.Env.evt={handles:{},plugins:{}};
var g=0,i=1,p={objs:{},before:function(s,u,v,w){var t=s,r;
if(w){r=[s,w].concat(b.Array(arguments,4,true));
t=b.rbind.apply(b,r);
}return this._inject(g,t,u,v);
},after:function(s,u,v,w){var t=s,r;
if(w){r=[s,w].concat(b.Array(arguments,4,true));
t=b.rbind.apply(b,r);
}return this._inject(i,t,u,v);
},_inject:function(r,t,u,w){var x=b.stamp(u),v,s;
if(!this.objs[x]){this.objs[x]={};
}v=this.objs[x];
if(!v[w]){v[w]=new b.Do.Method(u,w);
u[w]=function(){return v[w].exec.apply(v[w],arguments);
};
}s=x+b.stamp(t)+w;
v[w].register(s,t,r);
return new b.EventHandle(v[w],s);
},detach:function(r){if(r.detach){r.detach();
}},_unload:function(s,r){}};
b.Do=p;
p.Method=function(r,s){this.obj=r;
this.methodName=s;
this.method=r[s];
this.before={};
this.after={};
};
p.Method.prototype.register=function(s,t,r){if(r){this.after[s]=t;
}else{this.before[s]=t;
}};
p.Method.prototype._delete=function(r){delete this.before[r];
delete this.after[r];
};
p.Method.prototype.exec=function(){var t=b.Array(arguments,0,true),u,s,x,v=this.before,r=this.after,w=false;
for(u in v){if(v.hasOwnProperty(u)){s=v[u].apply(this.obj,t);
if(s){switch(s.constructor){case p.Halt:return s.retVal;
case p.AlterArgs:t=s.newArgs;
break;
case p.Prevent:w=true;
break;
default:}}}}if(!w){s=this.method.apply(this.obj,t);
}p.originalRetVal=s;
p.currentRetVal=s;
for(u in r){if(r.hasOwnProperty(u)){x=r[u].apply(this.obj,t);
if(x&&x.constructor==p.Halt){return x.retVal;
}else{if(x&&x.constructor==p.AlterReturn){s=x.newRetVal;
p.currentRetVal=s;
}}}}return s;
};
p.AlterArgs=function(s,r){this.msg=s;
this.newArgs=r;
};
p.AlterReturn=function(s,r){this.msg=s;
this.newRetVal=r;
};
p.Halt=function(s,r){this.msg=s;
this.retVal=r;
};
p.Prevent=function(r){this.msg=r;
};
p.Error=p.Halt;
var m="after",q=["broadcast","monitored","bubbles","context","contextFn","currentTarget","defaultFn","defaultTargetOnly","details","emitFacade","fireOnce","async","host","preventable","preventedFn","queuable","silent","stoppedFn","target","type"],n=9,a="yui:log";
b.CustomEvent=function(r,s){s=s||{};
this.id=b.stamp(this);
this.type=r;
this.context=b;
this.logSystem=(r==a);
this.silent=this.logSystem;
this.subscribers={};
this.afters={};
this.preventable=true;
this.bubbles=true;
this.signature=n;
this.subCount=0;
this.afterCount=0;
this.applyConfig(s,true);
};
b.CustomEvent.prototype={constructor:b.CustomEvent,hasSubs:function(r){var v=this.subCount,t=this.afterCount,u=this.sibling;
if(u){v+=u.subCount;
t+=u.afterCount;
}if(r){return(r=="after")?t:v;
}return(v+t);
},monitor:function(t){this.monitored=true;
var s=this.id+"|"+this.type+"_"+t,r=b.Array(arguments,0,true);
r[0]=s;
return this.host.on.apply(this.host,r);
},getSubs:function(){var u=b.merge(this.subscribers),r=b.merge(this.afters),t=this.sibling;
if(t){b.mix(u,t.subscribers);
b.mix(r,t.afters);
}return[u,r];
},applyConfig:function(s,r){if(s){b.mix(this,s,r,q);
}},_on:function(w,u,t,r){if(!w){this.log("Invalid callback for CE: "+this.type);
}var v=new b.Subscriber(w,u,t,r);
if(this.fireOnce&&this.fired){if(this.async){setTimeout(b.bind(this._notify,this,v,this.firedWith),0);
}else{this._notify(v,this.firedWith);
}}if(r==m){this.afters[v.id]=v;
this.afterCount++;
}else{this.subscribers[v.id]=v;
this.subCount++;
}return new b.EventHandle(this,v);
},subscribe:function(t,s){var r=(arguments.length>2)?b.Array(arguments,2,true):null;
return this._on(t,s,r,true);
},on:function(t,s){var r=(arguments.length>2)?b.Array(arguments,2,true):null;
if(this.host){this.host._monitor("attach",this.type,{args:arguments});
}return this._on(t,s,r,true);
},after:function(t,s){var r=(arguments.length>2)?b.Array(arguments,2,true):null;
return this._on(t,s,r,m);
},detach:function(w,u){if(w&&w.detach){return w.detach();
}var t,v,x=0,r=b.merge(this.subscribers,this.afters);
for(t in r){if(r.hasOwnProperty(t)){v=r[t];
if(v&&(!w||w===v.fn)){this._delete(v);
x++;
}}}return x;
},unsubscribe:function(){return this.detach.apply(this,arguments);
},_notify:function(v,u,r){this.log(this.type+"->sub: "+v.id);
var t;
t=v.notify(u,this);
if(false===t||this.stopped>1){this.log(this.type+" cancelled by subscriber");
return false;
}return true;
},log:function(s,r){if(!this.silent){}},fire:function(){if(this.fireOnce&&this.fired){this.log("fireOnce event: "+this.type+" already fired");
return true;
}else{var r=b.Array(arguments,0,true);
this.fired=true;
this.firedWith=r;
if(this.emitFacade){return this.fireComplex(r);
}else{return this.fireSimple(r);
}}},fireSimple:function(r){this.stopped=0;
this.prevented=0;
if(this.hasSubs()){var s=this.getSubs();
this._procSubs(s[0],r);
this._procSubs(s[1],r);
}this._broadcast(r);
return this.stopped?false:true;
},fireComplex:function(r){r[0]=r[0]||{};
return this.fireSimple(r);
},_procSubs:function(v,t,r){var w,u;
for(u in v){if(v.hasOwnProperty(u)){w=v[u];
if(w&&w.fn){if(false===this._notify(w,t,r)){this.stopped=2;
}if(this.stopped==2){return false;
}}}}return true;
},_broadcast:function(s){if(!this.stopped&&this.broadcast){var r=b.Array(s);
r.unshift(this.type);
if(this.host!==b){b.fire.apply(b,r);
}if(this.broadcast==2){b.Global.fire.apply(b.Global,r);
}}},unsubscribeAll:function(){return this.detachAll.apply(this,arguments);
},detachAll:function(){return this.detach();
},_delete:function(r){if(r){if(this.subscribers[r.id]){delete this.subscribers[r.id];
this.subCount--;
}if(this.afters[r.id]){delete this.afters[r.id];
this.afterCount--;
}}if(this.host){this.host._monitor("detach",this.type,{ce:this,sub:r});
}if(r){r.deleted=true;
}}};
b.Subscriber=function(t,s,r){this.fn=t;
this.context=s;
this.id=b.stamp(this);
this.args=r;
};
b.Subscriber.prototype={constructor:b.Subscriber,_notify:function(v,t,u){if(this.deleted&&!this.postponed){if(this.postponed){delete this.fn;
delete this.context;
}else{delete this.postponed;
return null;
}}var r=this.args,s;
switch(u.signature){case 0:s=this.fn.call(v,u.type,t,v);
break;
case 1:s=this.fn.call(v,t[0]||null,v);
break;
default:if(r||t){t=t||[];
r=(r)?t.concat(r):t;
s=this.fn.apply(v,r);
}else{s=this.fn.call(v);
}}if(this.once){u._delete(this);
}return s;
},notify:function(s,u){var v=this.context,r=true;
if(!v){v=(u.contextFn)?u.contextFn():u.context;
}if(b.config.throwFail){r=this._notify(v,s,u);
}else{try{r=this._notify(v,s,u);
}catch(t){b.error(this+" failed: "+t.message,t);
}}return r;
},contains:function(s,r){if(r){return((this.fn==s)&&this.context==r);
}else{return(this.fn==s);
}}};
b.EventHandle=function(r,s){this.evt=r;
this.sub=s;
};
b.EventHandle.prototype={batch:function(r,s){r.call(s||this,this);
if(b.Lang.isArray(this.evt)){b.Array.each(this.evt,function(t){t.batch.call(s||t,r);
});
}},detach:function(){var r=this.evt,t=0,s;
if(r){if(b.Lang.isArray(r)){for(s=0;
s<r.length;
s++){t+=r[s].detach();
}}else{r._delete(this.sub);
t=1;
}}return t;
},monitor:function(r){return this.evt.monitor.apply(this.evt,arguments);
}};
var j=b.Lang,h=":",e="|",l="~AFTER~",k=b.Array,c=b.cached(function(r){return r.replace(/(.*)(:)(.*)/,"*$2$3");
}),o=b.cached(function(r,s){if(!s||!j.isString(r)||r.indexOf(h)>-1){return r;
}return s+h+r;
}),f=b.cached(function(u,w){var s=u,v,x,r;
if(!j.isString(s)){return s;
}r=s.indexOf(l);
if(r>-1){x=true;
s=s.substr(l.length);
}r=s.indexOf(e);
if(r>-1){v=s.substr(0,(r));
s=s.substr(r+1);
if(s=="*"){s=null;
}}return[v,(w)?o(s,w):s,x,s];
}),d=function(r){var s=(j.isObject(r))?r:{};
this._yuievt=this._yuievt||{id:b.guid(),events:{},targets:{},config:s,chain:("chain" in s)?s.chain:b.config.chain,bubbling:false,defaults:{context:s.context||this,host:this,emitFacade:s.emitFacade,fireOnce:s.fireOnce,queuable:s.queuable,monitored:s.monitored,broadcast:s.broadcast,defaultTargetOnly:s.defaultTargetOnly,bubbles:("bubbles" in s)?s.bubbles:true}};
};
d.prototype={constructor:d,once:function(){var r=this.on.apply(this,arguments);
r.batch(function(s){if(s.sub){s.sub.once=true;
}});
return r;
},onceAfter:function(){var r=this.after.apply(this,arguments);
r.batch(function(s){if(s.sub){s.sub.once=true;
}});
return r;
},parseType:function(r,s){return f(r,s||this._yuievt.config.prefix);
},on:function(v,A,t){var D=f(v,this._yuievt.config.prefix),F,G,s,J,C,B,H,x=b.Env.evt.handles,u,r,y,I=b.Node,E,z,w;
this._monitor("attach",D[1],{args:arguments,category:D[0],after:D[2]});
if(j.isObject(v)){if(j.isFunction(v)){return b.Do.before.apply(b.Do,arguments);
}F=A;
G=t;
s=k(arguments,0,true);
J=[];
if(j.isArray(v)){w=true;
}u=v._after;
delete v._after;
b.each(v,function(M,L){if(j.isObject(M)){F=M.fn||((j.isFunction(M))?M:F);
G=M.context||G;
}var K=(u)?l:"";
s[0]=K+((w)?M:L);
s[1]=F;
s[2]=G;
J.push(this.on.apply(this,s));
},this);
return(this._yuievt.chain)?this:new b.EventHandle(J);
}B=D[0];
u=D[2];
y=D[3];
if(I&&b.instanceOf(this,I)&&(y in I.DOM_EVENTS)){s=k(arguments,0,true);
s.splice(2,0,I.getDOMNode(this));
return b.on.apply(b,s);
}v=D[1];
if(b.instanceOf(this,YUI)){r=b.Env.evt.plugins[v];
s=k(arguments,0,true);
s[0]=y;
if(I){E=s[2];
if(b.instanceOf(E,b.NodeList)){E=b.NodeList.getDOMNodes(E);
}else{if(b.instanceOf(E,I)){E=I.getDOMNode(E);
}}z=(y in I.DOM_EVENTS);
if(z){s[2]=E;
}}if(r){H=r.on.apply(b,s);
}else{if((!v)||z){H=b.Event._attach(s);
}}}if(!H){C=this._yuievt.events[v]||this.publish(v);
H=C._on(A,t,(arguments.length>3)?k(arguments,3,true):null,(u)?"after":true);
}if(B){x[B]=x[B]||{};
x[B][v]=x[B][v]||[];
x[B][v].push(H);
}return(this._yuievt.chain)?this:H;
},subscribe:function(){return this.on.apply(this,arguments);
},detach:function(A,C,r){var G=this._yuievt.events,v,x=b.Node,E=x&&(b.instanceOf(this,x));
if(!A&&(this!==b)){for(v in G){if(G.hasOwnProperty(v)){G[v].detach(C,r);
}}if(E){b.Event.purgeElement(x.getDOMNode(this));
}return this;
}var u=f(A,this._yuievt.config.prefix),z=j.isArray(u)?u[0]:null,H=(u)?u[3]:null,w,D=b.Env.evt.handles,F,B,y,t,s=function(M,K,L){var J=M[K],N,I;
if(J){for(I=J.length-1;
I>=0;
--I){N=J[I].evt;
if(N.host===L||N.el===L){J[I].detach();
}}}};
if(z){B=D[z];
A=u[1];
F=(E)?b.Node.getDOMNode(this):this;
if(B){if(A){s(B,A,F);
}else{for(v in B){if(B.hasOwnProperty(v)){s(B,v,F);
}}}return this;
}}else{if(j.isObject(A)&&A.detach){A.detach();
return this;
}else{if(E&&((!H)||(H in x.DOM_EVENTS))){y=k(arguments,0,true);
y[2]=x.getDOMNode(this);
b.detach.apply(b,y);
return this;
}}}w=b.Env.evt.plugins[H];
if(b.instanceOf(this,YUI)){y=k(arguments,0,true);
if(w&&w.detach){w.detach.apply(b,y);
return this;
}else{if(!A||(!w&&x&&(A in x.DOM_EVENTS))){y[0]=A;
b.Event.detach.apply(b.Event,y);
return this;
}}}t=G[u[1]];
if(t){t.detach(C,r);
}return this;
},unsubscribe:function(){return this.detach.apply(this,arguments);
},detachAll:function(r){return this.detach(r);
},unsubscribeAll:function(){return this.detachAll.apply(this,arguments);
},publish:function(t,u){var s,y,r,x,w=this._yuievt,v=w.config.prefix;
t=(v)?o(t,v):t;
this._monitor("publish",t,{args:arguments});
if(j.isObject(t)){r={};
b.each(t,function(A,z){r[z]=this.publish(z,A||u);
},this);
return r;
}s=w.events;
y=s[t];
if(y){if(u){y.applyConfig(u,true);
}}else{x=w.defaults;
y=new b.CustomEvent(t,(u)?b.merge(x,u):x);
s[t]=y;
}return s[t];
},_monitor:function(u,r,v){var s,t=this.getEvent(r);
if((this._yuievt.config.monitored&&(!t||t.monitored))||(t&&t.monitored)){s=r+"_"+u;
v.monitored=u;
this.fire.call(this,s,v);
}},fire:function(v){var z=j.isString(v),u=(z)?v:(v&&v.type),y,s,x=this._yuievt.config.prefix,w,r=(z)?k(arguments,1,true):arguments;
u=(x)?o(u,x):u;
this._monitor("fire",u,{args:r});
y=this.getEvent(u,true);
w=this.getSibling(u,y);
if(w&&!y){y=this.publish(u);
}if(!y){if(this._yuievt.hasTargets){return this.bubble({type:u},r,this);
}s=true;
}else{y.sibling=w;
s=y.fire.apply(y,r);
}return(this._yuievt.chain)?this:s;
},getSibling:function(r,t){var s;
if(r.indexOf(h)>-1){r=c(r);
s=this.getEvent(r,true);
if(s){s.applyConfig(t);
s.bubbles=false;
s.broadcast=0;
}}return s;
},getEvent:function(s,r){var u,t;
if(!r){u=this._yuievt.config.prefix;
s=(u)?o(s,u):s;
}t=this._yuievt.events;
return t[s]||null;
},after:function(t,s){var r=k(arguments,0,true);
switch(j.type(t)){case"function":return b.Do.after.apply(b.Do,arguments);
case"array":case"object":r[0]._after=true;
break;
default:r[0]=l+t;
}return this.on.apply(this,r);
},before:function(){return this.on.apply(this,arguments);
}};
b.EventTarget=d;
b.mix(b,d.prototype);
d.call(b,{bubbles:false});
YUI.Env.globalEvents=YUI.Env.globalEvents||new d();
b.Global=YUI.Env.globalEvents;
},"3.4.1",{requires:["oop"]});
YUI.add("features",function(b){var c={};
b.mix(b.namespace("Features"),{tests:c,add:function(d,e,f){c[d]=c[d]||{};
c[d][e]=f;
},all:function(e,f){var g=c[e],d=[];
if(g){b.Object.each(g,function(i,h){d.push(h+":"+(b.Features.test(e,h,f)?1:0));
});
}return(d.length)?d.join(";"):"";
},test:function(e,g,f){f=f||[];
var d,i,k,j=c[e],h=j&&j[g];
if(!h){}else{d=h.result;
if(b.Lang.isUndefined(d)){i=h.ua;
if(i){d=(b.UA[i]);
}k=h.test;
if(k&&((!i)||d)){d=k.apply(b,f);
}h.result=d;
}}return d;
}});
var a=b.Features.add;
a("load","0",{name:"graphics-canvas-default",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(d&&d.getContext&&d.getContext("2d")));
},trigger:"graphics"});
a("load","1",{name:"autocomplete-list-keys",test:function(d){return !(d.UA.ios||d.UA.android);
},trigger:"autocomplete-list"});
a("load","2",{name:"graphics-svg",test:function(e){var d=e.config.doc;
return(d&&d.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"});
a("load","3",{name:"history-hash-ie",test:function(e){var d=e.config.doc&&e.config.doc.documentMode;
return e.UA.ie&&(!("onhashchange" in e.config.win)||!d||d<8);
},trigger:"history-hash"});
a("load","4",{name:"graphics-vml-default",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!d||!d.getContext||!d.getContext("2d")));
},trigger:"graphics"});
a("load","5",{name:"graphics-svg-default",test:function(e){var d=e.config.doc;
return(d&&d.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));
},trigger:"graphics"});
a("load","6",{name:"widget-base-ie",trigger:"widget-base",ua:"ie"});
a("load","7",{name:"transition-timer",test:function(g){var f=g.config.doc,e=(f)?f.documentElement:null,d=true;
if(e&&e.style){d=!("MozTransition" in e.style||"WebkitTransition" in e.style);
}return d;
},trigger:"transition"});
a("load","8",{name:"dom-style-ie",test:function(j){var h=j.Features.test,i=j.Features.add,f=j.config.win,g=j.config.doc,d="documentElement",e=false;
i("style","computedStyle",{test:function(){return f&&"getComputedStyle" in f;
}});
i("style","opacity",{test:function(){return g&&"opacity" in g[d].style;
}});
e=(!h("style","opacity")&&!h("style","computedStyle"));
return e;
},trigger:"dom-style"});
a("load","9",{name:"selector-css2",test:function(f){var e=f.config.doc,d=e&&!("querySelectorAll" in e);
return d;
},trigger:"selector"});
a("load","10",{name:"event-base-ie",test:function(e){var d=e.config.doc&&e.config.doc.implementation;
return(d&&(!d.hasFeature("Events","2.0")));
},trigger:"node-base"});
a("load","11",{name:"dd-gestures",test:function(d){return(d.config.win&&("ontouchstart" in d.config.win&&!d.UA.chrome));
},trigger:"dd-drag"});
a("load","12",{name:"scrollview-base-ie",trigger:"scrollview-base",ua:"ie"});
a("load","13",{name:"graphics-canvas",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(d&&d.getContext&&d.getContext("2d")));
},trigger:"graphics"});
a("load","14",{name:"graphics-vml",test:function(f){var e=f.config.doc,d=e&&e.createElement("canvas");
return(e&&!e.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(!d||!d.getContext||!d.getContext("2d")));
},trigger:"graphics"});
},"3.4.1",{requires:["yui-base"]});
YUI.add("dom-core",function(e){var n="nodeType",c="ownerDocument",b="documentElement",a="defaultView",g="parentWindow",j="tagName",k="parentNode",i="previousSibling",l="nextSibling",h="contains",d="compareDocumentPosition",m=[],f={byId:function(p,o){return f.allById(p,o)[0]||null;
},ancestor:function(p,q,s,r){var o=null;
if(s){o=(!q||q(p))?p:null;
}return o||f.elementByAxis(p,k,q,null,r);
},ancestors:function(q,r,t,s){var p=q,o=[];
while((p=f.ancestor(p,r,t,s))){t=false;
if(p){o.unshift(p);
if(s&&s(p)){return o;
}}}return o;
},elementByAxis:function(p,s,r,q,o){while(p&&(p=p[s])){if((q||p[j])&&(!r||r(p))){return p;
}if(o&&o(p)){return null;
}}return null;
},contains:function(p,q){var o=false;
if(!q||!p||!q[n]||!p[n]){o=false;
}else{if(p[h]){if(e.UA.opera||q[n]===1){o=p[h](q);
}else{o=f._bruteContains(p,q);
}}else{if(p[d]){if(p===q||!!(p[d](q)&16)){o=true;
}}}}return o;
},inDoc:function(q,r){var p=false,o;
if(q&&q.nodeType){(r)||(r=q[c]);
o=r[b];
if(o&&o.contains&&q.tagName){p=o.contains(q);
}else{p=f.contains(o,q);
}}return p;
},allById:function(t,o){o=o||e.config.doc;
var p=[],q=[],r,s;
if(o.querySelectorAll){q=o.querySelectorAll('[id="'+t+'"]');
}else{if(o.all){p=o.all(t);
if(p){if(p.nodeName){if(p.id===t){q.push(p);
p=m;
}else{p=[p];
}}if(p.length){for(r=0;
s=p[r++];
){if(s.id===t||(s.attributes&&s.attributes.id&&s.attributes.id.value===t)){q.push(s);
}}}}}else{q=[f._getDoc(o).getElementById(t)];
}}return q;
},isWindow:function(o){return !!(o&&o.alert&&o.document);
},_removeChildNodes:function(o){while(o.firstChild){o.removeChild(o.firstChild);
}},siblings:function(r,q){var o=[],p=r;
while((p=p[i])){if(p[j]&&(!q||q(p))){o.unshift(p);
}}p=r;
while((p=p[l])){if(p[j]&&(!q||q(p))){o.push(p);
}}return o;
},_bruteContains:function(o,p){while(p){if(o===p){return true;
}p=p.parentNode;
}return false;
},_getRegExp:function(p,o){o=o||"";
f._regexCache=f._regexCache||{};
if(!f._regexCache[p+o]){f._regexCache[p+o]=new RegExp(p,o);
}return f._regexCache[p+o];
},_getDoc:function(o){var p=e.config.doc;
if(o){p=(o[n]===9)?o:o[c]||o.document||e.config.doc;
}return p;
},_getWin:function(o){var p=f._getDoc(o);
return p[a]||p[g]||e.config.win;
},_batch:function(o,w,u,t,s,q){w=(typeof w==="string")?f[w]:w;
var x,r=0,p,v;
if(w&&o){while((p=o[r++])){x=x=w.call(f,p,u,t,s,q);
if(typeof x!=="undefined"){(v)||(v=[]);
v.push(x);
}}}return(typeof v!=="undefined")?v:o;
},wrap:function(r,p){var q=e.DOM.create(p),o=q.getElementsByTagName("*");
if(o.length){q=o[o.length-1];
}if(r.parentNode){r.parentNode.replaceChild(q,r);
}q.appendChild(r);
},unwrap:function(r){var p=r.parentNode,q=p.lastChild,o=r,s;
if(p){s=p.parentNode;
if(s){r=p.firstChild;
while(r!==q){o=r.nextSibling;
s.insertBefore(r,p);
r=o;
}s.replaceChild(q,p);
}else{p.removeChild(r);
}}},generateID:function(o){var p=o.id;
if(!p){p=e.stamp(o);
o.id=p;
}return p;
}};
e.DOM=f;
},"3.4.1",{requires:["oop","features"]});
YUI.add("dom-base",function(b){var o=b.config.doc.documentElement,g=b.DOM,m="tagName",a="ownerDocument",c="",n=b.Features.add,k=b.Features.test;
b.mix(g,{getText:(o.textContent!==undefined)?function(s){var r="";
if(s){r=s.textContent;
}return r||"";
}:function(s){var r="";
if(s){r=s.innerText||s.nodeValue;
}return r||"";
},setText:(o.textContent!==undefined)?function(r,s){if(r){r.textContent=s;
}}:function(r,s){if("innerText" in r){r.innerText=s;
}else{if("nodeValue" in r){r.nodeValue=s;
}}},CUSTOM_ATTRIBUTES:(!o.hasAttribute)?{"for":"htmlFor","class":"className"}:{htmlFor:"for",className:"class"},setAttribute:function(t,r,u,s){if(t&&r&&t.setAttribute){r=g.CUSTOM_ATTRIBUTES[r]||r;
t.setAttribute(r,u,s);
}},getAttribute:function(u,r,t){t=(t!==undefined)?t:2;
var s="";
if(u&&r&&u.getAttribute){r=g.CUSTOM_ATTRIBUTES[r]||r;
s=u.getAttribute(r,t);
if(s===null){s="";
}}return s;
},VALUE_SETTERS:{},VALUE_GETTERS:{},getValue:function(t){var s="",r;
if(t&&t[m]){r=g.VALUE_GETTERS[t[m].toLowerCase()];
if(r){s=r(t);
}else{s=t.value;
}}if(s===c){s=c;
}return(typeof s==="string")?s:"";
},setValue:function(r,s){var t;
if(r&&r[m]){t=g.VALUE_SETTERS[r[m].toLowerCase()];
if(t){t(r,s);
}else{r.value=s;
}}},creators:{}});
n("value-set","select",{test:function(){var r=b.config.doc.createElement("select");
r.innerHTML="<option>1</option><option>2</option>";
r.value="2";
return(r.value&&r.value==="2");
}});
if(!k("value-set","select")){g.VALUE_SETTERS.select=function(u,v){for(var s=0,r=u.getElementsByTagName("option"),t;
t=r[s++];
){if(g.getValue(t)===v){t.selected=true;
break;
}}};
}b.mix(g.VALUE_GETTERS,{button:function(r){return(r.attributes&&r.attributes.value)?r.attributes.value.value:"";
}});
b.mix(g.VALUE_SETTERS,{button:function(s,t){var r=s.attributes.value;
if(!r){r=s[a].createAttribute("value");
s.setAttributeNode(r);
}r.value=t;
}});
b.mix(g.VALUE_GETTERS,{option:function(s){var r=s.attributes;
return(r.value&&r.value.specified)?s.value:s.text;
},select:function(s){var t=s.value,r=s.options;
if(r&&r.length){if(s.multiple){}else{t=g.getValue(r[s.selectedIndex]);
}}return t;
}});
var h,f,q;
b.mix(b.DOM,{hasClass:function(t,s){var r=b.DOM._getRegExp("(?:^|\\s+)"+s+"(?:\\s+|$)");
return r.test(t.className);
},addClass:function(s,r){if(!b.DOM.hasClass(s,r)){s.className=b.Lang.trim([s.className,r].join(" "));
}},removeClass:function(s,r){if(r&&f(s,r)){s.className=b.Lang.trim(s.className.replace(b.DOM._getRegExp("(?:^|\\s+)"+r+"(?:\\s+|$)")," "));
if(f(s,r)){q(s,r);
}}},replaceClass:function(s,r,t){q(s,r);
h(s,t);
},toggleClass:function(s,r,t){var u=(t!==undefined)?t:!(f(s,r));
if(u){h(s,r);
}else{q(s,r);
}}});
f=b.DOM.hasClass;
q=b.DOM.removeClass;
h=b.DOM.addClass;
var e=/<([a-z]+)/i,g=b.DOM,n=b.Features.add,k=b.Features.test,j={},i=function(t,r){var u=b.config.doc.createElement("div"),s=true;
u.innerHTML=t;
if(!u.firstChild||u.firstChild.tagName!==r.toUpperCase()){s=false;
}return s;
},p=/(?:\/(?:thead|tfoot|tbody|caption|col|colgroup)>)+\s*<tbody/,d="<table>",l="</table>";
b.mix(b.DOM,{_fragClones:{},_create:function(s,t,r){r=r||"div";
var u=g._fragClones[r];
if(u){u=u.cloneNode(false);
}else{u=g._fragClones[r]=t.createElement(r);
}u.innerHTML=s;
return u;
},create:function(v,y){if(typeof v==="string"){v=b.Lang.trim(v);
}y=y||b.config.doc;
var u=e.exec(v),w=g._create,s=j,x=null,t,z,r;
if(v!=undefined){if(u&&u[1]){t=s[u[1].toLowerCase()];
if(typeof t==="function"){w=t;
}else{z=t;
}}r=w(v,y,z).childNodes;
if(r.length===1){x=r[0].parentNode.removeChild(r[0]);
}else{if(r[0]&&r[0].className==="yui3-big-dummy"){if(r.length===2){x=r[0].nextSibling;
}else{r[0].parentNode.removeChild(r[0]);
x=g._nl2frag(r,y);
}}else{x=g._nl2frag(r,y);
}}}return x;
},_nl2frag:function(s,v){var t=null,u,r;
if(s&&(s.push||s.item)&&s[0]){v=v||s[0].ownerDocument;
t=v.createDocumentFragment();
if(s.item){s=b.Array(s,0,true);
}for(u=0,r=s.length;
u<r;
u++){t.appendChild(s[u]);
}}return t;
},addHTML:function(y,x,t){var r=y.parentNode,v=0,w,s=x,u;
if(x!=undefined){if(x.nodeType){u=x;
}else{if(typeof x=="string"||typeof x=="number"){s=u=g.create(x);
}else{if(x[0]&&x[0].nodeType){u=b.config.doc.createDocumentFragment();
while((w=x[v++])){u.appendChild(w);
}}}}}if(t){if(u&&t.parentNode){t.parentNode.insertBefore(u,t);
}else{switch(t){case"replace":while(y.firstChild){y.removeChild(y.firstChild);
}if(u){y.appendChild(u);
}break;
case"before":if(u){r.insertBefore(u,y);
}break;
case"after":if(u){if(y.nextSibling){r.insertBefore(u,y.nextSibling);
}else{r.appendChild(u);
}}break;
default:if(u){y.appendChild(u);
}}}}else{if(u){y.appendChild(u);
}}return s;
}});
n("innerhtml","table",{test:function(){var r=b.config.doc.createElement("table");
try{r.innerHTML="<tbody></tbody>";
}catch(s){return false;
}return(r.firstChild&&r.firstChild.nodeName==="TBODY");
}});
n("innerhtml-div","tr",{test:function(){return i("<tr></tr>","tr");
}});
n("innerhtml-div","script",{test:function(){return i("<script><\/script>","script");
}});
if(!k("innerhtml","table")){j.tbody=function(s,t){var u=g.create(d+s+l,t),r=u.children.tags("tbody")[0];
if(u.children.length>1&&r&&!p.test(s)){r.parentNode.removeChild(r);
}return u;
};
}if(!k("innerhtml-div","script")){j.script=function(r,s){var t=s.createElement("div");
t.innerHTML="-"+r;
t.removeChild(t.firstChild);
return t;
};
j.link=j.style=j.script;
}if(!k("innerhtml-div","tr")){b.mix(j,{option:function(r,s){return g.create('<select><option class="yui3-big-dummy" selected></option>'+r+"</select>",s);
},tr:function(r,s){return g.create("<tbody>"+r+"</tbody>",s);
},td:function(r,s){return g.create("<tr>"+r+"</tr>",s);
},col:function(r,s){return g.create("<colgroup>"+r+"</colgroup>",s);
},tbody:"table"});
b.mix(j,{legend:"fieldset",th:j.td,thead:j.tbody,tfoot:j.tbody,caption:j.tbody,colgroup:j.tbody,optgroup:j.option});
}g.creators=j;
b.mix(b.DOM,{setWidth:function(s,r){b.DOM._setSize(s,"width",r);
},setHeight:function(s,r){b.DOM._setSize(s,"height",r);
},_setSize:function(s,u,t){t=(t>0)?t:0;
var r=0;
s.style[u]=t+"px";
r=(u==="height")?s.offsetHeight:s.offsetWidth;
if(r>t){t=t-(r-t);
if(t<0){t=0;
}s.style[u]=t+"px";
}}});
},"3.4.1",{requires:["dom-core"]});
YUI.add("dom-style",function(a){(function(e){var p="documentElement",b="defaultView",n="ownerDocument",h="style",i="float",r="cssFloat",s="styleFloat",k="transparent",d="getComputedStyle",c="getBoundingClientRect",o=e.config.win,g=e.config.doc,t=undefined,q=e.DOM,f="transform",l=["WebkitTransform","MozTransform","OTransform"],m=/color$/i,j=/width|height|top|left|right|bottom|margin|padding/i;
e.Array.each(l,function(u){if(u in g[p].style){f=u;
}});
e.mix(q,{DEFAULT_UNIT:"px",CUSTOM_STYLES:{},setStyle:function(x,u,y,w){w=w||x.style;
var v=q.CUSTOM_STYLES;
if(w){if(y===null||y===""){y="";
}else{if(!isNaN(new Number(y))&&j.test(u)){y+=q.DEFAULT_UNIT;
}}if(u in v){if(v[u].set){v[u].set(x,y,w);
return;
}else{if(typeof v[u]==="string"){u=v[u];
}}}else{if(u===""){u="cssText";
y="";
}}w[u]=y;
}},getStyle:function(x,u,w){w=w||x.style;
var v=q.CUSTOM_STYLES,y="";
if(w){if(u in v){if(v[u].get){return v[u].get(x,u,w);
}else{if(typeof v[u]==="string"){u=v[u];
}}}y=w[u];
if(y===""){y=q[d](x,u);
}}return y;
},setStyles:function(v,w){var u=v.style;
e.each(w,function(x,y){q.setStyle(v,y,x,u);
},q);
},getComputedStyle:function(w,u){var y="",x=w[n],v;
if(w[h]&&x[b]&&x[b][d]){v=x[b][d](w,null);
if(v){y=v[u];
}}return y;
}});
if(g[p][h][r]!==t){q.CUSTOM_STYLES[i]=r;
}else{if(g[p][h][s]!==t){q.CUSTOM_STYLES[i]=s;
}}if(e.UA.opera){q[d]=function(w,v){var u=w[n][b],x=u[d](w,"")[v];
if(m.test(v)){x=e.Color.toRGB(x);
}return x;
};
}if(e.UA.webkit){q[d]=function(w,v){var u=w[n][b],x=u[d](w,"")[v];
if(x==="rgba(0, 0, 0, 0)"){x=k;
}return x;
};
}e.DOM._getAttrOffset=function(y,v){var A=e.DOM[d](y,v),x=y.offsetParent,u,w,z;
if(A==="auto"){u=e.DOM.getStyle(y,"position");
if(u==="static"||u==="relative"){A=0;
}else{if(x&&x[c]){w=x[c]()[v];
z=y[c]()[v];
if(v==="left"||v==="top"){A=z-w;
}else{A=w-y[c]()[v];
}}}}return A;
};
e.DOM._getOffset=function(u){var w,v=null;
if(u){w=q.getStyle(u,"position");
v=[parseInt(q[d](u,"left"),10),parseInt(q[d](u,"top"),10)];
if(isNaN(v[0])){v[0]=parseInt(q.getStyle(u,"left"),10);
if(isNaN(v[0])){v[0]=(w==="relative")?0:u.offsetLeft||0;
}}if(isNaN(v[1])){v[1]=parseInt(q.getStyle(u,"top"),10);
if(isNaN(v[1])){v[1]=(w==="relative")?0:u.offsetTop||0;
}}}return v;
};
q.CUSTOM_STYLES.transform={set:function(v,w,u){u[f]=w;
},get:function(v,u){return q[d](v,f);
}};
})(a);
(function(d){var b=parseInt,c=RegExp;
d.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(e){if(!d.Color.re_RGB.test(e)){e=d.Color.toHex(e);
}if(d.Color.re_hex.exec(e)){e="rgb("+[b(c.$1,16),b(c.$2,16),b(c.$3,16)].join(", ")+")";
}return e;
},toHex:function(f){f=d.Color.KEYWORDS[f]||f;
if(d.Color.re_RGB.exec(f)){f=[Number(c.$1).toString(16),Number(c.$2).toString(16),Number(c.$3).toString(16)];
for(var e=0;
e<f.length;
e++){if(f[e].length<2){f[e]="0"+f[e];
}}f=f.join("");
}if(f.length<6){f=f.replace(d.Color.re_hex3,"$1$1");
}if(f!=="transparent"&&f.indexOf("#")<0){f="#"+f;
}return f.toUpperCase();
}};
})(a);
},"3.4.1",{requires:["dom-base"]});
YUI.add("dom-style-ie",function(a){(function(d){var A="hasLayout",l="px",m="filter",b="filters",x="opacity",q="auto",h="borderWidth",k="borderTopWidth",u="borderRightWidth",z="borderBottomWidth",i="borderLeftWidth",j="width",s="height",v="transparent",w="visible",c="getComputedStyle",C=undefined,B=d.config.doc.documentElement,p=d.Features.test,n=d.Features.add,t=/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz|%){1}?/i,o=(d.UA.ie>=8),f=function(e){return e.currentStyle||e.style;
},r={CUSTOM_STYLES:{},get:function(e,E){var D="",F;
if(e){F=f(e)[E];
if(E===x&&d.DOM.CUSTOM_STYLES[x]){D=d.DOM.CUSTOM_STYLES[x].get(e);
}else{if(!F||(F.indexOf&&F.indexOf(l)>-1)){D=F;
}else{if(d.DOM.IE.COMPUTED[E]){D=d.DOM.IE.COMPUTED[E](e,E);
}else{if(t.test(F)){D=r.getPixel(e,E)+l;
}else{D=F;
}}}}}return D;
},sizeOffsets:{width:["Left","Right"],height:["Top","Bottom"],top:["Top"],bottom:["Bottom"]},getOffset:function(E,e){var I=f(E)[e],J=e.charAt(0).toUpperCase()+e.substr(1),F="offset"+J,D="pixel"+J,H=r.sizeOffsets[e],G=E.ownerDocument.compatMode,K="";
if(I===q||I.indexOf("%")>-1){K=E["offset"+J];
if(G!=="BackCompat"){if(H[0]){K-=r.getPixel(E,"padding"+H[0]);
K-=r.getBorderWidth(E,"border"+H[0]+"Width",1);
}if(H[1]){K-=r.getPixel(E,"padding"+H[1]);
K-=r.getBorderWidth(E,"border"+H[1]+"Width",1);
}}}else{if(!E.style[D]&&!E.style[e]){E.style[e]=I;
}K=E.style[D];
}return K+l;
},borderMap:{thin:(o)?"1px":"2px",medium:(o)?"3px":"4px",thick:(o)?"5px":"6px"},getBorderWidth:function(D,F,e){var E=e?"":l,G=D.currentStyle[F];
if(G.indexOf(l)<0){if(r.borderMap[G]&&D.currentStyle.borderStyle!=="none"){G=r.borderMap[G];
}else{G=0;
}}return(e)?parseFloat(G):G;
},getPixel:function(E,e){var G=null,D=f(E),H=D.right,F=D[e];
E.style.right=F;
G=E.style.pixelRight;
E.style.right=H;
return G;
},getMargin:function(E,e){var F,D=f(E);
if(D[e]==q){F=0;
}else{F=r.getPixel(E,e);
}return F+l;
},getVisibility:function(D,e){var E;
while((E=D.currentStyle)&&E[e]=="inherit"){D=D.parentNode;
}return(E)?E[e]:w;
},getColor:function(D,e){var E=f(D)[e];
if(!E||E===v){d.DOM.elementByAxis(D,"parentNode",null,function(F){E=f(F)[e];
if(E&&E!==v){D=F;
return true;
}});
}return d.Color.toRGB(E);
},getBorderColor:function(D,e){var E=f(D),F=E[e]||E.color;
return d.Color.toRGB(d.Color.toHex(F));
}},g={};
n("style","computedStyle",{test:function(){return"getComputedStyle" in d.config.win;
}});
n("style","opacity",{test:function(){return"opacity" in B.style;
}});
n("style","filter",{test:function(){return"filters" in B;
}});
if(!p("style","opacity")&&p("style","filter")){d.DOM.CUSTOM_STYLES[x]={get:function(E){var G=100;
try{G=E[b]["DXImageTransform.Microsoft.Alpha"][x];
}catch(F){try{G=E[b]("alpha")[x];
}catch(D){}}return G/100;
},set:function(E,H,D){var G,F=f(E),e=F[m];
D=D||E.style;
if(H===""){G=(x in F)?F[x]:1;
H=G;
}if(typeof e=="string"){D[m]=e.replace(/alpha([^)]*\))/gi,"")+((H<1)?"alpha("+x+"="+H*100+")":"");
if(!D[m]){D.removeAttribute(m);
}if(!F[A]){D.zoom=1;
}}}};
}try{d.config.doc.createElement("div").style.height="-1px";
}catch(y){d.DOM.CUSTOM_STYLES.height={set:function(E,F,D){var e=parseFloat(F);
if(e>=0||F==="auto"||F===""){D.height=F;
}else{}}};
d.DOM.CUSTOM_STYLES.width={set:function(E,F,D){var e=parseFloat(F);
if(e>=0||F==="auto"||F===""){D.width=F;
}else{}}};
}if(!p("style","computedStyle")){g[j]=g[s]=r.getOffset;
g.color=g.backgroundColor=r.getColor;
g[h]=g[k]=g[u]=g[z]=g[i]=r.getBorderWidth;
g.marginTop=g.marginRight=g.marginBottom=g.marginLeft=r.getMargin;
g.visibility=r.getVisibility;
g.borderColor=g.borderTopColor=g.borderRightColor=g.borderBottomColor=g.borderLeftColor=r.getBorderColor;
d.DOM[c]=r.get;
d.namespace("DOM.IE");
d.DOM.IE.COMPUTED=g;
d.DOM.IE.ComputedStyle=r;
}})(a);
},"3.4.1",{requires:["dom-style"]});
YUI.add("selector-native",function(a){(function(e){e.namespace("Selector");
var c="compareDocumentPosition",d="ownerDocument";
var b={_foundCache:[],useNative:true,_compare:("sourceIndex" in e.config.doc.documentElement)?function(i,h){var g=i.sourceIndex,f=h.sourceIndex;
if(g===f){return 0;
}else{if(g>f){return 1;
}}return -1;
}:(e.config.doc.documentElement[c]?function(g,f){if(g[c](f)&4){return -1;
}else{return 1;
}}:function(j,i){var h,f,g;
if(j&&i){h=j[d].createRange();
h.setStart(j,0);
f=i[d].createRange();
f.setStart(i,0);
g=h.compareBoundaryPoints(1,f);
}return g;
}),_sort:function(f){if(f){f=e.Array(f,0,true);
if(f.sort){f.sort(b._compare);
}}return f;
},_deDupe:function(f){var g=[],h,j;
for(h=0;
(j=f[h++]);
){if(!j._found){g[g.length]=j;
j._found=true;
}}for(h=0;
(j=g[h++]);
){j._found=null;
j.removeAttribute("_found");
}return g;
},query:function(g,o,p,f){o=o||e.config.doc;
var l=[],h=(e.Selector.useNative&&e.config.doc.querySelector&&!f),k=[[g,o]],m,q,j,n=(h)?e.Selector._nativeQuery:e.Selector._bruteQuery;
if(g&&n){if(!f&&(!h||o.tagName)){k=b._splitQueries(g,o);
}for(j=0;
(m=k[j++]);
){q=n(m[0],m[1],p);
if(!p){q=e.Array(q,0,true);
}if(q){l=l.concat(q);
}}if(k.length>1){l=b._sort(b._deDupe(l));
}}return(p)?(l[0]||null):l;
},_splitQueries:function(h,l){var g=h.split(","),j=[],m="",k,f;
if(l){if(l.tagName){l.id=l.id||e.guid();
m='[id="'+l.id+'"] ';
}for(k=0,f=g.length;
k<f;
++k){h=m+g[k];
j.push([h,l]);
}}return j;
},_nativeQuery:function(f,g,h){if(e.UA.webkit&&f.indexOf(":checked")>-1&&(e.Selector.pseudos&&e.Selector.pseudos.checked)){return e.Selector.query(f,g,h,true);
}try{return g["querySelector"+(h?"":"All")](f);
}catch(i){return e.Selector.query(f,g,h,true);
}},filter:function(g,f){var h=[],j,k;
if(g&&f){for(j=0;
(k=g[j++]);
){if(e.Selector.test(k,f)){h[h.length]=k;
}}}else{}return h;
},test:function(h,k,p){var n=false,f=false,g,q,t,o,s,m,l,r;
if(h&&h.tagName){if(typeof k=="function"){n=k.call(h,h);
}else{g=k.split(",");
if(!p&&!e.DOM.inDoc(h)){q=h.parentNode;
if(q){p=q;
}else{s=h[d].createDocumentFragment();
s.appendChild(h);
p=s;
f=true;
}}p=p||h[d];
if(!h.id){h.id=e.guid();
}for(m=0;
(r=g[m++]);
){r+='[id="'+h.id+'"]';
o=e.Selector.query(r,p);
for(l=0;
t=o[l++];
){if(t===h){n=true;
break;
}}if(n){break;
}}if(f){s.removeChild(h);
}}}return n;
},ancestor:function(g,f,h){return e.DOM.ancestor(g,function(i){return e.Selector.test(i,f);
},h);
}};
e.mix(e.Selector,b,true);
})(a);
},"3.4.1",{requires:["dom-base"]});
YUI.add("selector",function(a){},"3.4.1",{requires:["selector-native"]});
YUI.add("selector-css2",function(g){var h="parentNode",d="tagName",e="attributes",a="combinator",f="pseudos",c=g.Selector,b={_reRegExpTokens:/([\^\$\?\[\]\*\+\-\.\(\)\|\\])/,SORT_RESULTS:true,_children:function(n,j){var k=n.children,m,l=[],o,p;
if(n.children&&j&&n.children.tags){l=n.children.tags(j);
}else{if((!k&&n[d])||(k&&j)){o=k||n.childNodes;
k=[];
for(m=0;
(p=o[m++]);
){if(p.tagName){if(!j||j===p.tagName){k.push(p);
}}}}}return k||[];
},_re:{attr:/(\[[^\]]*\])/g,esc:/\\[:\[\]\(\)#\.\'\>+~"]/gi,pseudos:/(\([^\)]*\))/g},shorthand:{"\\#(-?[_a-z0-9]+[-\\w\\uE000]*)":"[id=$1]","\\.(-?[_a-z]+[-\\w\\uE000]*)":"[className~=$1]"},operators:{"":function(j,i){return g.DOM.getAttribute(j,i)!=="";
},"~=":"(?:^|\\s+){val}(?:\\s+|$)","|=":"^{val}-?"},pseudos:{"first-child":function(i){return g.Selector._children(i[h])[0]===i;
}},_bruteQuery:function(n,r,t){var o=[],i=[],q=c._tokenize(n),m=q[q.length-1],s=g.DOM._getDoc(r),k,j,p,l;
if(m){j=m.id;
p=m.className;
l=m.tagName||"*";
if(r.getElementsByTagName){if(j&&(r.all||(r.nodeType===9||g.DOM.inDoc(r)))){i=g.DOM.allById(j,r);
}else{if(p){i=r.getElementsByClassName(p);
}else{i=r.getElementsByTagName(l);
}}}else{k=r.firstChild;
while(k){if(k.tagName){i.push(k);
}k=k.nextSilbing||k.firstChild;
}}if(i.length){o=c._filterNodes(i,q,t);
}}return o;
},_filterNodes:function(u,q,s){var z=0,y,A=q.length,t=A-1,p=[],w=u[0],D=w,B=g.Selector.getters,o,x,m,r,k,v,l,C;
for(z=0;
(D=w=u[z++]);
){t=A-1;
r=null;
testLoop:while(D&&D.tagName){m=q[t];
l=m.tests;
y=l.length;
if(y&&!k){while((C=l[--y])){o=C[1];
if(B[C[0]]){v=B[C[0]](D,C[0]);
}else{v=D[C[0]];
if(v===undefined&&D.getAttribute){v=D.getAttribute(C[0]);
}}if((o==="="&&v!==C[2])||(typeof o!=="string"&&o.test&&!o.test(v))||(!o.test&&typeof o==="function"&&!o(D,C[0],C[2]))){if((D=D[r])){while(D&&(!D.tagName||(m.tagName&&m.tagName!==D.tagName))){D=D[r];
}}continue testLoop;
}}}t--;
if(!k&&(x=m.combinator)){r=x.axis;
D=D[r];
while(D&&!D.tagName){D=D[r];
}if(x.direct){r=null;
}}else{p.push(w);
if(s){return p;
}break;
}}}w=D=null;
return p;
},combinators:{" ":{axis:"parentNode"},">":{axis:"parentNode",direct:true},"+":{axis:"previousSibling",direct:true}},_parsers:[{name:e,re:/^\uE003(-?[a-z]+[\w\-]*)+([~\|\^\$\*!=]=?)?['"]?([^\uE004'"]*)['"]?\uE004/i,fn:function(l,m){var k=l[2]||"",i=c.operators,j=(l[3])?l[3].replace(/\\/g,""):"",n;
if((l[1]==="id"&&k==="=")||(l[1]==="className"&&g.config.doc.documentElement.getElementsByClassName&&(k==="~="||k==="="))){m.prefilter=l[1];
l[3]=j;
m[l[1]]=(l[1]==="id")?l[3]:j;
}if(k in i){n=i[k];
if(typeof n==="string"){l[3]=j.replace(c._reRegExpTokens,"\\$1");
n=new RegExp(n.replace("{val}",l[3]));
}l[2]=n;
}if(!m.last||m.prefilter!==l[1]){return l.slice(1);
}}},{name:d,re:/^((?:-?[_a-z]+[\w-]*)|\*)/i,fn:function(j,k){var i=j[1].toUpperCase();
k.tagName=i;
if(i!=="*"&&(!k.last||k.prefilter)){return[d,"=",i];
}if(!k.prefilter){k.prefilter="tagName";
}}},{name:a,re:/^\s*([>+~]|\s)\s*/,fn:function(i,j){}},{name:f,re:/^:([\-\w]+)(?:\uE005['"]?([^\uE005]*)['"]?\uE006)*/i,fn:function(i,j){var k=c[f][i[1]];
if(k){if(i[2]){i[2]=i[2].replace(/\\/g,"");
}return[i[2],k];
}else{return false;
}}}],_getToken:function(i){return{tagName:null,id:null,className:null,attributes:{},combinator:null,tests:[]};
},_tokenize:function(l){l=l||"";
l=c._replaceShorthand(g.Lang.trim(l));
var k=c._getToken(),q=l,p=[],r=false,n,o,m,j;
outer:do{r=false;
for(m=0;
(j=c._parsers[m++]);
){if((n=j.re.exec(l))){if(j.name!==a){k.selector=l;
}l=l.replace(n[0],"");
if(!l.length){k.last=true;
}if(c._attrFilters[n[1]]){n[1]=c._attrFilters[n[1]];
}o=j.fn(n,k);
if(o===false){r=false;
break outer;
}else{if(o){k.tests.push(o);
}}if(!l.length||j.name===a){p.push(k);
k=c._getToken(k);
if(j.name===a){k.combinator=g.Selector.combinators[n[1]];
}}r=true;
}}}while(r&&l.length);
if(!r||l.length){p=[];
}return p;
},_replaceShorthand:function(k){var m=c.shorthand,l=k.match(c._re.esc),n,q,p,o,j;
if(l){k=k.replace(c._re.esc,"\uE000");
}n=k.match(c._re.attr);
q=k.match(c._re.pseudos);
if(n){k=k.replace(c._re.attr,"\uE001");
}if(q){k=k.replace(c._re.pseudos,"\uE002");
}for(p in m){if(m.hasOwnProperty(p)){k=k.replace(new RegExp(p,"gi"),m[p]);
}}if(n){for(o=0,j=n.length;
o<j;
++o){k=k.replace(/\uE001/,n[o]);
}}if(q){for(o=0,j=q.length;
o<j;
++o){k=k.replace(/\uE002/,q[o]);
}}k=k.replace(/\[/g,"\uE003");
k=k.replace(/\]/g,"\uE004");
k=k.replace(/\(/g,"\uE005");
k=k.replace(/\)/g,"\uE006");
if(l){for(o=0,j=l.length;
o<j;
++o){k=k.replace("\uE000",l[o]);
}}return k;
},_attrFilters:{"class":"className","for":"htmlFor"},getters:{href:function(j,i){return g.DOM.getAttribute(j,i);
}}};
g.mix(g.Selector,b,true);
g.Selector.getters.src=g.Selector.getters.rel=g.Selector.getters.href;
if(g.Selector.useNative&&g.config.doc.querySelector){g.Selector.shorthand["\\.(-?[_a-z]+[-\\w]*)"]="[class~=$1]";
}},"3.4.1",{requires:["selector-native"]});
YUI.add("dump",function(g){var b=g.Lang,c="{...}",f="f(){...}",a=", ",d=" => ",e=function(p,n){var j,h,l=[],k=b.type(p);
if(!b.isObject(p)){return p+"";
}else{if(k=="date"){return p;
}else{if(p.nodeType&&p.tagName){return p.tagName+"#"+p.id;
}else{if(p.document&&p.navigator){return"window";
}else{if(p.location&&p.body){return"document";
}else{if(k=="function"){return f;
}}}}}}n=(b.isNumber(n))?n:3;
if(k=="array"){l.push("[");
for(j=0,h=p.length;
j<h;
j=j+1){if(b.isObject(p[j])){l.push((n>0)?b.dump(p[j],n-1):c);
}else{l.push(p[j]);
}l.push(a);
}if(l.length>1){l.pop();
}l.push("]");
}else{if(k=="regexp"){l.push(p.toString());
}else{l.push("{");
for(j in p){if(p.hasOwnProperty(j)){try{l.push(j+d);
if(b.isObject(p[j])){l.push((n>0)?b.dump(p[j],n-1):c);
}else{l.push(p[j]);
}l.push(a);
}catch(m){l.push("Error: "+m.message);
}}}if(l.length>1){l.pop();
}l.push("}");
}}return l.join("");
};
g.dump=e;
b.dump=e;
},"3.4.1",{requires:["yui-base"]});
YUI.add("node-core",function(c){var j=".",e="nodeName",n="nodeType",b="ownerDocument",m="tagName",d="_yuid",i={},p=Array.prototype.slice,f=c.DOM,k=function(r){if(!this.getDOMNode){return new k(r);
}if(typeof r=="string"){r=k._fromString(r);
if(!r){return null;
}}var q=(r.nodeType!==9)?r.uniqueID:r[d];
if(q&&k._instances[q]&&k._instances[q]._node!==r){r[d]=null;
}q=q||c.stamp(r);
if(!q){q=c.guid();
}this[d]=q;
this._node=r;
this._stateProxy=r;
if(this._initPlugins){this._initPlugins();
}},o=function(r){var q=null;
if(r){q=(typeof r=="string")?function(s){return c.Selector.test(s,r);
}:function(s){return r(c.one(s));
};
}return q;
};
k.ATTRS={};
k.DOM_EVENTS={};
k._fromString=function(q){if(q){if(q.indexOf("doc")===0){q=c.config.doc;
}else{if(q.indexOf("win")===0){q=c.config.win;
}else{q=c.Selector.query(q,null,true);
}}}return q||null;
};
k.NAME="node";
k.re_aria=/^(?:role$|aria-)/;
k.SHOW_TRANSITION="fadeIn";
k.HIDE_TRANSITION="fadeOut";
k._instances={};
k.getDOMNode=function(q){if(q){return(q.nodeType)?q:q._node||null;
}return null;
};
k.scrubVal=function(r,q){if(r){if(typeof r=="object"||typeof r=="function"){if(n in r||f.isWindow(r)){r=c.one(r);
}else{if((r.item&&!r._nodes)||(r[0]&&r[0][n])){r=c.all(r);
}}}}else{if(typeof r==="undefined"){r=q;
}else{if(r===null){r=null;
}}}return r;
};
k.addMethod=function(q,s,r){if(q&&s&&typeof s=="function"){k.prototype[q]=function(){var u=p.call(arguments),v=this,t;
if(u[0]&&c.instanceOf(u[0],k)){u[0]=u[0]._node;
}if(u[1]&&c.instanceOf(u[1],k)){u[1]=u[1]._node;
}u.unshift(v._node);
t=s.apply(v,u);
if(t){t=k.scrubVal(t,v);
}(typeof t!="undefined")||(t=v);
return t;
};
}else{}};
k.importMethod=function(s,q,r){if(typeof q=="string"){r=r||q;
k.addMethod(r,s[q],s);
}else{c.Array.each(q,function(t){k.importMethod(s,t);
});
}};
k.one=function(t){var q=null,s,r;
if(t){if(typeof t=="string"){t=k._fromString(t);
if(!t){return null;
}}else{if(t.getDOMNode){return t;
}}if(t.nodeType||c.DOM.isWindow(t)){r=(t.uniqueID&&t.nodeType!==9)?t.uniqueID:t._yuid;
q=k._instances[r];
s=q?q._node:null;
if(!q||(s&&t!==s)){q=new k(t);
if(t.nodeType!=11){k._instances[q[d]]=q;
}}}}return q;
};
k.DEFAULT_SETTER=function(q,s){var r=this._stateProxy,t;
if(q.indexOf(j)>-1){t=q;
q=q.split(j);
c.Object.setValue(r,q,s);
}else{if(typeof r[q]!="undefined"){r[q]=s;
}}return s;
};
k.DEFAULT_GETTER=function(q){var r=this._stateProxy,s;
if(q.indexOf&&q.indexOf(j)>-1){s=c.Object.getValue(r,q.split(j));
}else{if(typeof r[q]!="undefined"){s=r[q];
}}return s;
};
c.mix(k.prototype,{toString:function(){var t=this[d]+": not bound to a node",s=this._node,q,u,r;
if(s){q=s.attributes;
u=(q&&q.id)?s.getAttribute("id"):null;
r=(q&&q.className)?s.getAttribute("className"):null;
t=s[e];
if(u){t+="#"+u;
}if(r){t+="."+r.replace(" ",".");
}t+=" "+this[d];
}return t;
},get:function(q){var r;
if(this._getAttr){r=this._getAttr(q);
}else{r=this._get(q);
}if(r){r=k.scrubVal(r,this);
}else{if(r===null){r=null;
}}return r;
},_get:function(q){var r=k.ATTRS[q],s;
if(r&&r.getter){s=r.getter.call(this);
}else{if(k.re_aria.test(q)){s=this._node.getAttribute(q,2);
}else{s=k.DEFAULT_GETTER.apply(this,arguments);
}}return s;
},set:function(q,s){var r=k.ATTRS[q];
if(this._setAttr){this._setAttr.apply(this,arguments);
}else{if(r&&r.setter){r.setter.call(this,s,q);
}else{if(k.re_aria.test(q)){this._node.setAttribute(q,s);
}else{k.DEFAULT_SETTER.apply(this,arguments);
}}}return this;
},setAttrs:function(q){if(this._setAttrs){this._setAttrs(q);
}else{c.Object.each(q,function(r,s){this.set(s,r);
},this);
}return this;
},getAttrs:function(r){var q={};
if(this._getAttrs){this._getAttrs(r);
}else{c.Array.each(r,function(s,t){q[s]=this.get(s);
},this);
}return q;
},compareTo:function(q){var r=this._node;
if(c.instanceOf(q,k)){q=q._node;
}return r===q;
},inDoc:function(r){var q=this._node;
r=(r)?r._node||r:q[b];
if(r.documentElement){return f.contains(r.documentElement,q);
}},getById:function(s){var r=this._node,q=f.byId(s,r[b]);
if(q&&f.contains(r,q)){q=c.one(q);
}else{q=null;
}return q;
},ancestor:function(q,s,r){if(arguments.length===2&&(typeof s=="string"||typeof s=="function")){r=s;
}return c.one(f.ancestor(this._node,o(q),s,o(r)));
},ancestors:function(q,s,r){if(arguments.length===2&&(typeof s=="string"||typeof s=="function")){r=s;
}return c.all(f.ancestors(this._node,o(q),s,o(r)));
},previous:function(r,q){return c.one(f.elementByAxis(this._node,"previousSibling",o(r),q));
},next:function(r,q){return c.one(f.elementByAxis(this._node,"nextSibling",o(r),q));
},siblings:function(q){return c.all(f.siblings(this._node,o(q)));
},one:function(q){return c.one(c.Selector.query(q,this._node,true));
},all:function(q){var r=c.all(c.Selector.query(q,this._node));
r._query=q;
r._queryRoot=this._node;
return r;
},test:function(q){return c.Selector.test(this._node,q);
},remove:function(q){var r=this._node;
if(r&&r.parentNode){r.parentNode.removeChild(r);
}if(q){this.destroy();
}return this;
},replace:function(q){var r=this._node;
if(typeof q=="string"){q=k.create(q);
}r.parentNode.replaceChild(k.getDOMNode(q),r);
return this;
},replaceChild:function(r,q){if(typeof r=="string"){r=f.create(r);
}return c.one(this._node.replaceChild(k.getDOMNode(r),k.getDOMNode(q)));
},destroy:function(s){var r=c.config.doc.uniqueID?"uniqueID":"_yuid",q;
this.purge();
if(this.unplug){this.unplug();
}this.clearData();
if(s){c.NodeList.each(this.all("*"),function(t){q=k._instances[t[r]];
if(q){q.destroy();
}});
}this._node=null;
this._stateProxy=null;
delete k._instances[this._yuid];
},invoke:function(x,r,q,w,v,u){var t=this._node,s;
if(r&&c.instanceOf(r,k)){r=r._node;
}if(q&&c.instanceOf(q,k)){q=q._node;
}s=t[x](r,q,w,v,u);
return k.scrubVal(s,this);
},swap:c.config.doc.documentElement.swapNode?function(q){this._node.swapNode(k.getDOMNode(q));
}:function(q){q=k.getDOMNode(q);
var s=this._node,r=q.parentNode,t=q.nextSibling;
if(t===s){r.insertBefore(s,q);
}else{if(q===s.nextSibling){r.insertBefore(q,s);
}else{s.parentNode.replaceChild(q,s);
f.addHTML(r,s,t);
}}return this;
},getData:function(r){var q;
this._data=this._data||{};
if(arguments.length){q=this._data[r];
}else{q=this._data;
}return q;
},setData:function(q,r){this._data=this._data||{};
if(arguments.length>1){this._data[q]=r;
}else{this._data=q;
}return this;
},clearData:function(q){if("_data" in this){if(q){delete this._data[q];
}else{delete this._data;
}}return this;
},hasMethod:function(r){var q=this._node;
return !!(q&&r in q&&typeof q[r]!="unknown"&&(typeof q[r]=="function"||String(q[r]).indexOf("function")===1));
},isFragment:function(){return(this.get("nodeType")===11);
},empty:function(){this.get("childNodes").remove().destroy(true);
return this;
},getDOMNode:function(){return this._node;
}},true);
c.Node=k;
c.one=k.one;
var a=function(q){var r=[];
if(q){if(typeof q==="string"){this._query=q;
q=c.Selector.query(q);
}else{if(q.nodeType||f.isWindow(q)){q=[q];
}else{if(q._node){q=[q._node];
}else{if(q[0]&&q[0]._node){c.Array.each(q,function(s){if(s._node){r.push(s._node);
}});
q=r;
}else{q=c.Array(q,0,true);
}}}}}this._nodes=q||[];
};
a.NAME="NodeList";
a.getDOMNodes=function(q){return(q&&q._nodes)?q._nodes:q;
};
a.each=function(q,t,s){var r=q._nodes;
if(r&&r.length){c.Array.each(r,t,s||q);
}else{}};
a.addMethod=function(q,s,r){if(q&&s){a.prototype[q]=function(){var u=[],t=arguments;
c.Array.each(this._nodes,function(z){var y=(z.uniqueID&&z.nodeType!==9)?"uniqueID":"_yuid",w=c.Node._instances[z[y]],x,v;
if(!w){w=a._getTempNode(z);
}x=r||w;
v=s.apply(x,t);
if(v!==undefined&&v!==w){u[u.length]=v;
}});
return u.length?u:this;
};
}else{}};
a.importMethod=function(s,q,r){if(typeof q==="string"){r=r||q;
a.addMethod(q,s[q]);
}else{c.Array.each(q,function(t){a.importMethod(s,t);
});
}};
a._getTempNode=function(r){var q=a._tempNode;
if(!q){q=c.Node.create("<div></div>");
a._tempNode=q;
}q._node=r;
q._stateProxy=r;
return q;
};
c.mix(a.prototype,{item:function(q){return c.one((this._nodes||[])[q]);
},each:function(s,r){var q=this;
c.Array.each(this._nodes,function(u,t){u=c.one(u);
return s.call(r||u,u,t,q);
});
return q;
},batch:function(r,q){var s=this;
c.Array.each(this._nodes,function(v,u){var t=c.Node._instances[v[d]];
if(!t){t=a._getTempNode(v);
}return r.call(q||t,t,u,s);
});
return s;
},some:function(s,r){var q=this;
return c.Array.some(this._nodes,function(u,t){u=c.one(u);
r=r||u;
return s.call(r,u,t,q);
});
},toFrag:function(){return c.one(c.DOM._nl2frag(this._nodes));
},indexOf:function(q){return c.Array.indexOf(this._nodes,c.Node.getDOMNode(q));
},filter:function(q){return c.all(c.Selector.filter(this._nodes,q));
},modulus:function(t,s){s=s||0;
var q=[];
a.each(this,function(u,r){if(r%t===s){q.push(u);
}});
return c.all(q);
},odd:function(){return this.modulus(2,1);
},even:function(){return this.modulus(2);
},destructor:function(){},refresh:function(){var t,r=this._nodes,s=this._query,q=this._queryRoot;
if(s){if(!q){if(r&&r[0]&&r[0].ownerDocument){q=r[0].ownerDocument;
}}this._nodes=c.Selector.query(s,q);
}return this;
},_prepEvtArgs:function(t,s,r){var q=c.Array(arguments,0,true);
if(q.length<2){q[2]=this._nodes;
}else{q.splice(2,0,this._nodes);
}q[3]=r||this;
return q;
},on:function(s,r,q){return c.on.apply(c,this._prepEvtArgs.apply(this,arguments));
},once:function(s,r,q){return c.once.apply(c,this._prepEvtArgs.apply(this,arguments));
},after:function(s,r,q){return c.after.apply(c,this._prepEvtArgs.apply(this,arguments));
},size:function(){return this._nodes.length;
},isEmpty:function(){return this._nodes.length<1;
},toString:function(){var t="",s=this[d]+": not bound to any nodes",q=this._nodes,r;
if(q&&q[0]){r=q[0];
t+=r[e];
if(r.id){t+="#"+r.id;
}if(r.className){t+="."+r.className.replace(" ",".");
}if(q.length>1){t+="...["+q.length+" items]";
}}return t||s;
},getDOMNodes:function(){return this._nodes;
}},true);
a.importMethod(c.Node.prototype,["destroy","empty","remove","set"]);
a.prototype.get=function(r){var u=[],t=this._nodes,s=false,v=a._getTempNode,q,w;
if(t[0]){q=c.Node._instances[t[0]._yuid]||v(t[0]);
w=q._get(r);
if(w&&w.nodeType){s=true;
}}c.Array.each(t,function(x){q=c.Node._instances[x._yuid];
if(!q){q=v(x);
}w=q._get(r);
if(!s){w=c.Node.scrubVal(w,q);
}u.push(w);
});
return(s)?c.all(u):u;
};
c.NodeList=a;
c.all=function(q){return new a(q);
};
c.Node.all=c.all;
var l=c.NodeList,h=Array.prototype,g={concat:1,pop:0,push:0,shift:0,slice:1,splice:1,unshift:0};
c.Object.each(g,function(r,q){l.prototype[q]=function(){var u=[],v=0,s,t;
while(typeof(s=arguments[v++])!="undefined"){u.push(s._node||s._nodes||s);
}t=h[q].apply(this._nodes,u);
if(r){t=c.all(t);
}else{t=c.Node.scrubVal(t);
}return t;
};
});
c.Array.each(["removeChild","hasChildNodes","cloneNode","hasAttribute","scrollIntoView","getElementsByTagName","focus","blur","submit","reset","select","createCaption"],function(q){c.Node.prototype[q]=function(u,s,r){var t=this.invoke(q,u,s,r);
return t;
};
});
c.Node.prototype.removeAttribute=function(q){var r=this._node;
if(r){r.removeAttribute(q);
}return this;
};
c.Node.importMethod(c.DOM,["contains","setAttribute","getAttribute","wrap","unwrap","generateID"]);
c.NodeList.importMethod(c.Node.prototype,["getAttribute","setAttribute","removeAttribute","unwrap","wrap","generateID"]);
},"3.4.1",{requires:["dom-core","selector"]});
YUI.add("node-base",function(e){var d=["hasClass","addClass","removeClass","replaceClass","toggleClass"];
e.Node.importMethod(e.DOM,d);
e.NodeList.importMethod(e.Node.prototype,d);
var c=e.Node,b=e.DOM;
c.create=function(f,g){if(g&&g._node){g=g._node;
}return e.one(b.create(f,g));
};
e.mix(c.prototype,{create:c.create,insert:function(g,f){this._insert(g,f);
return this;
},_insert:function(i,g){var h=this._node,f=null;
if(typeof g=="number"){g=this._node.childNodes[g];
}else{if(g&&g._node){g=g._node;
}}if(i&&typeof i!="string"){i=i._node||i._nodes||i;
}f=b.addHTML(h,i,g);
return f;
},prepend:function(f){return this.insert(f,0);
},append:function(f){return this.insert(f,null);
},appendChild:function(f){return c.scrubVal(this._insert(f));
},insertBefore:function(g,f){return e.Node.scrubVal(this._insert(g,f));
},appendTo:function(f){e.one(f).append(this);
return this;
},setContent:function(f){this._insert(f,"replace");
return this;
},getContent:function(f){return this.get("innerHTML");
}});
e.NodeList.importMethod(e.Node.prototype,["append","insert","appendChild","insertBefore","prepend","setContent","getContent"]);
var c=e.Node,b=e.DOM;
c.ATTRS={text:{getter:function(){return b.getText(this._node);
},setter:function(f){b.setText(this._node,f);
return f;
}},"for":{getter:function(){return b.getAttribute(this._node,"for");
},setter:function(f){b.setAttribute(this._node,"for",f);
return f;
}},options:{getter:function(){return this._node.getElementsByTagName("option");
}},children:{getter:function(){var j=this._node,h=j.children,k,g,f;
if(!h){k=j.childNodes;
h=[];
for(g=0,f=k.length;
g<f;
++g){if(k[g][TAG_NAME]){h[h.length]=k[g];
}}}return e.all(h);
}},value:{getter:function(){return b.getValue(this._node);
},setter:function(f){b.setValue(this._node,f);
return f;
}}};
e.Node.importMethod(e.DOM,["setAttribute","getAttribute"]);
var c=e.Node;
var a=e.NodeList;
c.DOM_EVENTS={abort:1,beforeunload:1,blur:1,change:1,click:1,close:1,command:1,contextmenu:1,dblclick:1,DOMMouseScroll:1,drag:1,dragstart:1,dragenter:1,dragover:1,dragleave:1,dragend:1,drop:1,error:1,focus:1,key:1,keydown:1,keypress:1,keyup:1,load:1,message:1,mousedown:1,mouseenter:1,mouseleave:1,mousemove:1,mousemultiwheel:1,mouseout:1,mouseover:1,mouseup:1,mousewheel:1,orientationchange:1,reset:1,resize:1,select:1,selectstart:1,submit:1,scroll:1,textInput:1,unload:1};
e.mix(c.DOM_EVENTS,e.Env.evt.plugins);
e.augment(c,e.EventTarget);
e.mix(c.prototype,{purge:function(g,f){e.Event.purgeElement(this._node,g,f);
return this;
}});
e.mix(e.NodeList.prototype,{_prepEvtArgs:function(i,h,g){var f=e.Array(arguments,0,true);
if(f.length<2){f[2]=this._nodes;
}else{f.splice(2,0,this._nodes);
}f[3]=g||this;
return f;
},on:function(h,g,f){return e.on.apply(e,this._prepEvtArgs.apply(this,arguments));
},once:function(h,g,f){return e.once.apply(e,this._prepEvtArgs.apply(this,arguments));
},after:function(h,g,f){return e.after.apply(e,this._prepEvtArgs.apply(this,arguments));
},onceAfter:function(h,g,f){return e.onceAfter.apply(e,this._prepEvtArgs.apply(this,arguments));
}});
a.importMethod(e.Node.prototype,["detach","detachAll"]);
e.mix(e.Node.ATTRS,{offsetHeight:{setter:function(f){e.DOM.setHeight(this._node,f);
return f;
},getter:function(){return this._node.offsetHeight;
}},offsetWidth:{setter:function(f){e.DOM.setWidth(this._node,f);
return f;
},getter:function(){return this._node.offsetWidth;
}}});
e.mix(e.Node.prototype,{sizeTo:function(f,g){var i;
if(arguments.length<2){i=e.one(f);
f=i.get("offsetWidth");
g=i.get("offsetHeight");
}this.setAttrs({offsetWidth:f,offsetHeight:g});
}});
var c=e.Node;
e.mix(c.prototype,{show:function(f){f=arguments[arguments.length-1];
this.toggleView(true,f);
return this;
},_show:function(){this.setStyle("display","");
},_isHidden:function(){return e.DOM.getStyle(this._node,"display")==="none";
},toggleView:function(f,g){this._toggleView.apply(this,arguments);
},_toggleView:function(f,g){g=arguments[arguments.length-1];
if(typeof f!="boolean"){f=(this._isHidden())?1:0;
}if(f){this._show();
}else{this._hide();
}if(typeof g=="function"){g.call(this);
}return this;
},hide:function(f){f=arguments[arguments.length-1];
this.toggleView(false,f);
return this;
},_hide:function(){this.setStyle("display","none");
}});
e.NodeList.importMethod(e.Node.prototype,["show","hide","toggleView"]);
if(!e.config.doc.documentElement.hasAttribute){e.Node.prototype.hasAttribute=function(f){if(f==="value"){if(this.get("value")!==""){return true;
}}return !!(this._node.attributes[f]&&this._node.attributes[f].specified);
};
}e.Node.prototype.focus=function(){try{this._node.focus();
}catch(f){}return this;
};
e.Node.ATTRS.type={setter:function(g){if(g==="hidden"){try{this._node.type="hidden";
}catch(f){this.setStyle("display","none");
this._inputType="hidden";
}}else{try{this._node.type=g;
}catch(f){}}return g;
},getter:function(){return this._inputType||this._node.type;
},_bypassProxy:true};
if(e.config.doc.createElement("form").elements.nodeType){e.Node.ATTRS.elements={getter:function(){return this.all("input, textarea, button, select");
}};
}},"3.4.1",{requires:["dom-base","node-core","event-base"]});
(function(){var a=YUI.Env;
if(!a._ready){a._ready=function(){a.DOMReady=true;
a.remove(YUI.config.doc,"DOMContentLoaded",a._ready);
};
a.add(YUI.config.doc,"DOMContentLoaded",a._ready);
}})();
YUI.add("event-base",function(e){e.publish("domready",{fireOnce:true,async:true});
if(YUI.Env.DOMReady){e.fire("domready");
}else{e.Do.before(function(){e.fire("domready");
},YUI.Env,"_ready");
}var b=e.UA,d={},a={63232:38,63233:40,63234:37,63235:39,63276:33,63277:34,25:9,63272:46,63273:36,63275:35},c=function(h){if(!h){return h;
}try{if(h&&3==h.nodeType){h=h.parentNode;
}}catch(g){return null;
}return e.one(h);
},f=function(g,h,i){this._event=g;
this._currentTarget=h;
this._wrapper=i||d;
this.init();
};
e.extend(f,Object,{init:function(){var i=this._event,j=this._wrapper.overrides,g=i.pageX,l=i.pageY,k,h=this._currentTarget;
this.altKey=i.altKey;
this.ctrlKey=i.ctrlKey;
this.metaKey=i.metaKey;
this.shiftKey=i.shiftKey;
this.type=(j&&j.type)||i.type;
this.clientX=i.clientX;
this.clientY=i.clientY;
this.pageX=g;
this.pageY=l;
k=i.keyCode||i.charCode;
if(b.webkit&&(k in a)){k=a[k];
}this.keyCode=k;
this.charCode=k;
this.which=i.which||i.charCode||k;
this.button=this.which;
this.target=c(i.target);
this.currentTarget=c(h);
this.relatedTarget=c(i.relatedTarget);
if(i.type=="mousewheel"||i.type=="DOMMouseScroll"){this.wheelDelta=(i.detail)?(i.detail*-1):Math.round(i.wheelDelta/80)||((i.wheelDelta<0)?-1:1);
}if(this._touch){this._touch(i,h,this._wrapper);
}},stopPropagation:function(){this._event.stopPropagation();
this._wrapper.stopped=1;
this.stopped=1;
},stopImmediatePropagation:function(){var g=this._event;
if(g.stopImmediatePropagation){g.stopImmediatePropagation();
}else{this.stopPropagation();
}this._wrapper.stopped=2;
this.stopped=2;
},preventDefault:function(g){var h=this._event;
h.preventDefault();
h.returnValue=g||false;
this._wrapper.prevented=1;
this.prevented=1;
},halt:function(g){if(g){this.stopImmediatePropagation();
}else{this.stopPropagation();
}this.preventDefault();
}});
f.resolve=c;
e.DOM2EventFacade=f;
e.DOMEventFacade=f;
(function(){e.Env.evt.dom_wrappers={};
e.Env.evt.dom_map={};
var q=e.Env.evt,i=e.config,n=i.win,s=YUI.Env.add,l=YUI.Env.remove,p=function(){YUI.Env.windowLoaded=true;
e.Event._load();
l(n,"load",p);
},g=function(){e.Event._unload();
},j="domready",m="~yui|2|compat~",o=function(u){try{return(u&&typeof u!=="string"&&e.Lang.isNumber(u.length)&&!u.tagName&&!u.alert);
}catch(t){return false;
}},h=e.CustomEvent.prototype._delete,k=function(u){var t=h.apply(this,arguments);
if(!this.subCount&&!this.afterCount){e.Event._clean(this);
}return t;
},r=function(){var v=false,w=0,u=[],x=q.dom_wrappers,t=null,y=q.dom_map;
return{POLL_RETRYS:1000,POLL_INTERVAL:40,lastError:null,_interval:null,_dri:null,DOMReady:false,startInterval:function(){if(!r._interval){r._interval=setInterval(r._poll,r.POLL_INTERVAL);
}},onAvailable:function(z,D,H,A,E,G){var F=e.Array(z),B,C;
for(B=0;
B<F.length;
B=B+1){u.push({id:F[B],fn:D,obj:H,override:A,checkReady:E,compat:G});
}w=this.POLL_RETRYS;
setTimeout(r._poll,0);
C=new e.EventHandle({_delete:function(){if(C.handle){C.handle.detach();
return;
}var J,I;
for(J=0;
J<F.length;
J++){for(I=0;
I<u.length;
I++){if(F[J]===u[I].id){u.splice(I,1);
}}}}});
return C;
},onContentReady:function(D,B,C,A,z){return r.onAvailable(D,B,C,A,true,z);
},attach:function(C,B,A,z){return r._attach(e.Array(arguments,0,true));
},_createWrapper:function(F,E,z,A,D){var C,G=e.stamp(F),B="event:"+G+E;
if(false===D){B+="native";
}if(z){B+="capture";
}C=x[B];
if(!C){C=e.publish(B,{silent:true,bubbles:false,contextFn:function(){if(A){return C.el;
}else{C.nodeRef=C.nodeRef||e.one(C.el);
return C.nodeRef;
}}});
C.overrides={};
C.el=F;
C.key=B;
C.domkey=G;
C.type=E;
C.fn=function(H){C.fire(r.getEvent(H,F,(A||(false===D))));
};
C.capture=z;
if(F==n&&E=="load"){C.fireOnce=true;
t=B;
}C._delete=k;
x[B]=C;
y[G]=y[G]||{};
y[G][B]=C;
s(F,E,C.fn,z);
}return C;
},_attach:function(F,E){var K,M,C,J,z,B=false,D,G=F[0],H=F[1],A=F[2]||n,N=E&&E.facade,L=E&&E.capture,I=E&&E.overrides;
if(F[F.length-1]===m){K=true;
}if(!H||!H.call){return false;
}if(o(A)){M=[];
e.each(A,function(P,O){F[2]=P;
M.push(r._attach(F.slice(),E));
});
return new e.EventHandle(M);
}else{if(e.Lang.isString(A)){if(K){C=e.DOM.byId(A);
}else{C=e.Selector.query(A);
switch(C.length){case 0:C=null;
break;
case 1:C=C[0];
break;
default:F[2]=C;
return r._attach(F,E);
}}if(C){A=C;
}else{D=r.onAvailable(A,function(){D.handle=r._attach(F,E);
},r,true,false,K);
return D;
}}}if(!A){return false;
}if(e.Node&&e.instanceOf(A,e.Node)){A=e.Node.getDOMNode(A);
}J=r._createWrapper(A,G,L,K,N);
if(I){e.mix(J.overrides,I);
}if(A==n&&G=="load"){if(YUI.Env.windowLoaded){B=true;
}}if(K){F.pop();
}z=F[3];
D=J._on(H,z,(F.length>4)?F.slice(4):null);
if(B){J.fire();
}return D;
},detach:function(G,H,B,E){var F=e.Array(arguments,0,true),J,C,I,D,z,A;
if(F[F.length-1]===m){J=true;
}if(G&&G.detach){return G.detach();
}if(typeof B=="string"){if(J){B=e.DOM.byId(B);
}else{B=e.Selector.query(B);
C=B.length;
if(C<1){B=null;
}else{if(C==1){B=B[0];
}}}}if(!B){return false;
}if(B.detach){F.splice(2,1);
return B.detach.apply(B,F);
}else{if(o(B)){I=true;
for(D=0,C=B.length;
D<C;
++D){F[2]=B[D];
I=(e.Event.detach.apply(e.Event,F)&&I);
}return I;
}}if(!G||!H||!H.call){return r.purgeElement(B,false,G);
}z="event:"+e.stamp(B)+G;
A=x[z];
if(A){return A.detach(H);
}else{return false;
}},getEvent:function(C,A,z){var B=C||n.event;
return(z)?B:new e.DOMEventFacade(B,A,x["event:"+e.stamp(A)+C.type]);
},generateId:function(z){return e.DOM.generateID(z);
},_isValidCollection:o,_load:function(z){if(!v){v=true;
if(e.fire){e.fire(j);
}r._poll();
}},_poll:function(){if(r.locked){return;
}if(e.UA.ie&&!YUI.Env.DOMReady){r.startInterval();
return;
}r.locked=true;
var A,z,E,B,D,F,C=!v;
if(!C){C=(w>0);
}D=[];
F=function(I,J){var H,G=J.override;
if(J.compat){if(J.override){if(G===true){H=J.obj;
}else{H=G;
}}else{H=I;
}J.fn.call(H,J.obj);
}else{H=J.obj||e.one(I);
J.fn.apply(H,(e.Lang.isArray(G))?G:[]);
}};
for(A=0,z=u.length;
A<z;
++A){E=u[A];
if(E&&!E.checkReady){B=(E.compat)?e.DOM.byId(E.id):e.Selector.query(E.id,null,true);
if(B){F(B,E);
u[A]=null;
}else{D.push(E);
}}}for(A=0,z=u.length;
A<z;
++A){E=u[A];
if(E&&E.checkReady){B=(E.compat)?e.DOM.byId(E.id):e.Selector.query(E.id,null,true);
if(B){if(v||(B.get&&B.get("nextSibling"))||B.nextSibling){F(B,E);
u[A]=null;
}}else{D.push(E);
}}}w=(D.length===0)?0:w-1;
if(C){r.startInterval();
}else{clearInterval(r._interval);
r._interval=null;
}r.locked=false;
return;
},purgeElement:function(B,z,G){var E=(e.Lang.isString(B))?e.Selector.query(B,null,true):B,H=r.getListeners(E,G),D,F,C,A;
if(z&&E){H=H||[];
C=e.Selector.query("*",E);
D=0;
F=C.length;
for(;
D<F;
++D){A=r.getListeners(C[D],G);
if(A){H=H.concat(A);
}}}if(H){for(D=0,F=H.length;
D<F;
++D){H[D].detachAll();
}}},_clean:function(B){var A=B.key,z=B.domkey;
l(B.el,B.type,B.fn,B.capture);
delete x[A];
delete e._yuievt.events[A];
if(y[z]){delete y[z][A];
if(!e.Object.size(y[z])){delete y[z];
}}},getListeners:function(D,C){var E=e.stamp(D,true),z=y[E],B=[],A=(C)?"event:"+E+C:null,F=q.plugins;
if(!z){return null;
}if(A){if(F[C]&&F[C].eventDef){A+="_synth";
}if(z[A]){B.push(z[A]);
}A+="native";
if(z[A]){B.push(z[A]);
}}else{e.each(z,function(H,G){B.push(H);
});
}return(B.length)?B:null;
},_unload:function(z){e.each(x,function(B,A){if(B.type=="unload"){B.fire(z);
}B.detachAll();
});
l(n,"unload",g);
},nativeAdd:s,nativeRemove:l};
}();
e.Event=r;
if(i.injected||YUI.Env.windowLoaded){p();
}else{s(n,"load",p);
}if(e.UA.ie){e.on(j,r._poll);
}s(n,"unload",g);
r.Custom=e.CustomEvent;
r.Subscriber=e.Subscriber;
r.Target=e.EventTarget;
r.Handle=e.EventHandle;
r.Facade=e.EventFacade;
r._poll();
})();
e.Env.evt.plugins.available={on:function(i,h,k,j){var g=arguments.length>4?e.Array(arguments,4,true):null;
return e.Event.onAvailable.call(e.Event,k,h,j,g);
}};
e.Env.evt.plugins.contentready={on:function(i,h,k,j){var g=arguments.length>4?e.Array(arguments,4,true):null;
return e.Event.onContentReady.call(e.Event,k,h,j,g);
}};
},"3.4.1",{requires:["event-custom-base"]});
(function(){var b,f=YUI.Env,d=YUI.config,g=d.doc,c=g&&g.documentElement,e="onreadystatechange",a=d.pollInterval||40;
if(c.doScroll&&!f._ieready){f._ieready=function(){f._ready();
};
/*! DOMReady: based on work by: Dean Edwards/John Resig/Matthias Miller/Diego Perini */
if(self!==self.top){b=function(){if(g.readyState=="complete"){f.remove(g,e,b);
f.ieready();
}};
f.add(g,e,b);
}else{f._dri=setInterval(function(){try{c.doScroll("left");
clearInterval(f._dri);
f._dri=null;
f._ieready();
}catch(h){}},a);
}}})();
YUI.add("event-base-ie",function(c){function h(){c.DOM2EventFacade.apply(this,arguments);
}function i(n){var l=c.config.doc.createEventObject(n),m=i.prototype;
l.hasOwnProperty=function(){return true;
};
l.init=m.init;
l.halt=m.halt;
l.preventDefault=m.preventDefault;
l.stopPropagation=m.stopPropagation;
l.stopImmediatePropagation=m.stopImmediatePropagation;
c.DOM2EventFacade.apply(l,arguments);
return l;
}var a=c.config.doc&&c.config.doc.implementation,b=c.config.lazyEventFacade,j={0:1,4:2,2:3},d={mouseout:"toElement",mouseover:"fromElement"},k=c.DOM2EventFacade.resolve,f={init:function(){h.superclass.init.apply(this,arguments);
var o=this._event,m,r,p,l,q,n;
this.target=k(o.srcElement);
if(("clientX" in o)&&(!m)&&(0!==m)){m=o.clientX;
r=o.clientY;
p=c.config.doc;
l=p.body;
q=p.documentElement;
m+=(q.scrollLeft||(l&&l.scrollLeft)||0);
r+=(q.scrollTop||(l&&l.scrollTop)||0);
this.pageX=m;
this.pageY=r;
}if(o.type=="mouseout"){n=o.toElement;
}else{if(o.type=="mouseover"){n=o.fromElement;
}}this.relatedTarget=k(n||o.relatedTarget);
if(o.button!==undefined){this.which=this.button=j[o.button]||o.button;
}},stopPropagation:function(){this._event.cancelBubble=true;
this._wrapper.stopped=1;
this.stopped=1;
},stopImmediatePropagation:function(){this.stopPropagation();
this._wrapper.stopped=2;
this.stopped=2;
},preventDefault:function(e){this._event.returnValue=e||false;
this._wrapper.prevented=1;
this.prevented=1;
}};
c.extend(h,c.DOM2EventFacade,f);
c.extend(i,c.DOM2EventFacade,f);
i.prototype.init=function(){var l=this._event,m=this._wrapper.overrides,p=i._define,o=i._lazyProperties,n;
this.altKey=l.altKey;
this.ctrlKey=l.ctrlKey;
this.metaKey=l.metaKey;
this.shiftKey=l.shiftKey;
this.type=(m&&m.type)||l.type;
this.clientX=l.clientX;
this.clientY=l.clientY;
for(n in o){if(o.hasOwnProperty(n)){p(this,n,o[n]);
}}if(this._touch){this._touch(l,this._currentTarget,this._wrapper);
}};
i._lazyProperties={charCode:function(){var l=this._event;
return l.keyCode||l.charCode;
},keyCode:function(){return this.charCode;
},button:function(){var l=this._event;
return(l.button!==undefined)?(j[l.button]||l.button):(l.which||l.charCode||this.charCode);
},which:function(){return this.button;
},target:function(){return k(this._event.srcElement);
},relatedTarget:function(){var m=this._event,l=d[m.type]||"relatedTarget";
return k(m[l]||m.relatedTarget);
},currentTarget:function(){return k(this._currentTarget);
},wheelDelta:function(){var l=this._event;
if(l.type==="mousewheel"||l.type==="DOMMouseScroll"){return(l.detail)?(l.detail*-1):Math.round(l.wheelDelta/80)||((l.wheelDelta<0)?-1:1);
}},pageX:function(){var n=this._event,p=n.pageX,m,o,l;
if(p===undefined){m=c.config.doc;
o=m.body&&m.body.scrollLeft;
l=m.documentElement.scrollLeft;
p=n.clientX+(l||o||0);
}return p;
},pageY:function(){var n=this._event,p=n.pageY,m,o,l;
if(p===undefined){m=c.config.doc;
o=m.body&&m.body.scrollTop;
l=m.documentElement.scrollTop;
p=n.clientY+(l||o||0);
}return p;
}};
i._define=function(m,n,e){function l(o){var p=(arguments.length)?o:e.call(this);
delete m[n];
Object.defineProperty(m,n,{value:p,configurable:true,writable:true});
return p;
}Object.defineProperty(m,n,{get:l,set:l,configurable:true});
};
if(a&&(!a.hasFeature("Events","2.0"))){if(b){try{Object.defineProperty(c.config.doc.createEventObject(),"z",{});
}catch(g){b=false;
}}c.DOMEventFacade=(b)?i:h;
}},"3.4.1",{after:["event-base"],requires:["node-base"]});
YUI.add("event-delegate",function(a){var c=a.Array,h=a.Lang,b=h.isString,i=h.isObject,e=h.isArray,g=a.Selector.test,d=a.Env.evt.handles;
function f(u,w,l,k){var s=c(arguments,0,true),t=b(l)?l:null,r,o,j,n,v,m,q,x,p;
if(i(u)){x=[];
if(e(u)){for(m=0,q=u.length;
m<q;
++m){s[0]=u[m];
x.push(a.delegate.apply(a,s));
}}else{s.unshift(null);
for(m in u){if(u.hasOwnProperty(m)){s[0]=m;
s[1]=u[m];
x.push(a.delegate.apply(a,s));
}}}return new a.EventHandle(x);
}r=u.split(/\|/);
if(r.length>1){v=r.shift();
s[0]=u=r.shift();
}o=a.Node.DOM_EVENTS[u];
if(i(o)&&o.delegate){p=o.delegate.apply(o,arguments);
}if(!p){if(!u||!w||!l||!k){return;
}j=(t)?a.Selector.query(t,null,true):l;
if(!j&&b(l)){p=a.on("available",function(){a.mix(p,a.delegate.apply(a,s),true);
},l);
}if(!p&&j){s.splice(2,2,j);
p=a.Event._attach(s,{facade:false});
p.sub.filter=k;
p.sub._notify=f.notifySub;
}}if(p&&v){n=d[v]||(d[v]={});
n=n[u]||(n[u]=[]);
n.push(p);
}return p;
}f.notifySub=function(q,l,p){l=l.slice();
if(this.args){l.push.apply(l,this.args);
}var o=f._applyFilter(this.filter,l,p),n,m,j,k;
if(o){o=c(o);
n=l[0]=new a.DOMEventFacade(l[0],p.el,p);
n.container=a.one(p.el);
for(m=0,j=o.length;
m<j&&!n.stopped;
++m){n.currentTarget=a.one(o[m]);
k=this.fn.apply(this.context||n.currentTarget,l);
if(k===false){break;
}}return k;
}};
f.compileFilter=a.cached(function(j){return function(l,k){return g(l._node,j,k.currentTarget._node);
};
});
f._applyFilter=function(n,l,q){var p=l[0],j=q.el,o=p.target||p.srcElement,k=[],m=false;
if(o.nodeType===3){o=o.parentNode;
}l.unshift(o);
if(b(n)){while(o){m=(o===j);
if(g(o,n,(m?null:j))){k.push(o);
}if(m){break;
}o=o.parentNode;
}}else{l[0]=a.one(o);
l[1]=new a.DOMEventFacade(p,j,q);
while(o){if(n.apply(l[0],l)){k.push(o);
}if(o===j){break;
}o=o.parentNode;
l[0]=a.one(o);
}l[1]=p;
}if(k.length<=1){k=k[0];
}l.shift();
return k;
};
a.delegate=a.Event.delegate=f;
},"3.4.1",{requires:["node-base"]});
YUI.add("event-custom-complex",function(f){var b,e,d={},a=f.CustomEvent.prototype,c=f.EventTarget.prototype;
f.EventFacade=function(h,g){h=h||d;
this._event=h;
this.details=h.details;
this.type=h.type;
this._type=h.type;
this.target=h.target;
this.currentTarget=g;
this.relatedTarget=h.relatedTarget;
};
f.extend(f.EventFacade,Object,{stopPropagation:function(){this._event.stopPropagation();
this.stopped=1;
},stopImmediatePropagation:function(){this._event.stopImmediatePropagation();
this.stopped=2;
},preventDefault:function(){this._event.preventDefault();
this.prevented=1;
},halt:function(g){this._event.halt(g);
this.prevented=1;
this.stopped=(g)?2:1;
}});
a.fireComplex=function(p){var r,l,g,n,i,o,u,j,h,t=this,s=t.host||t,m,k;
if(t.stack){if(t.queuable&&t.type!=t.stack.next.type){t.log("queue "+t.type);
t.stack.queue.push([t,p]);
return true;
}}r=t.stack||{id:t.id,next:t,silent:t.silent,stopped:0,prevented:0,bubbling:null,type:t.type,afterQueue:new f.Queue(),defaultTargetOnly:t.defaultTargetOnly,queue:[]};
j=t.getSubs();
t.stopped=(t.type!==r.type)?0:r.stopped;
t.prevented=(t.type!==r.type)?0:r.prevented;
t.target=t.target||s;
u=new f.EventTarget({fireOnce:true,context:s});
t.events=u;
if(t.stoppedFn){u.on("stopped",t.stoppedFn);
}t.currentTarget=s;
t.details=p.slice();
t.log("Firing "+t.type);
t._facade=null;
l=t._getFacade(p);
if(f.Lang.isObject(p[0])){p[0]=l;
}else{p.unshift(l);
}if(j[0]){t._procSubs(j[0],p,l);
}if(t.bubbles&&s.bubble&&!t.stopped){k=r.bubbling;
r.bubbling=t.type;
if(r.type!=t.type){r.stopped=0;
r.prevented=0;
}o=s.bubble(t,p,null,r);
t.stopped=Math.max(t.stopped,r.stopped);
t.prevented=Math.max(t.prevented,r.prevented);
r.bubbling=k;
}if(t.prevented){if(t.preventedFn){t.preventedFn.apply(s,p);
}}else{if(t.defaultFn&&((!t.defaultTargetOnly&&!r.defaultTargetOnly)||s===l.target)){t.defaultFn.apply(s,p);
}}t._broadcast(p);
if(j[1]&&!t.prevented&&t.stopped<2){if(r.id===t.id||t.type!=s._yuievt.bubbling){t._procSubs(j[1],p,l);
while((m=r.afterQueue.last())){m();
}}else{h=j[1];
if(r.execDefaultCnt){h=f.merge(h);
f.each(h,function(q){q.postponed=true;
});
}r.afterQueue.add(function(){t._procSubs(h,p,l);
});
}}t.target=null;
if(r.id===t.id){n=r.queue;
while(n.length){g=n.pop();
i=g[0];
r.next=i;
i.fire.apply(i,g[1]);
}t.stack=null;
}o=!(t.stopped);
if(t.type!=s._yuievt.bubbling){r.stopped=0;
r.prevented=0;
t.stopped=0;
t.prevented=0;
}return o;
};
a._getFacade=function(){var g=this._facade,j,i,h=this.details;
if(!g){g=new f.EventFacade(this,this.currentTarget);
}j=h&&h[0];
if(f.Lang.isObject(j,true)){i={};
f.mix(i,g,true,e);
f.mix(g,j,true);
f.mix(g,i,true,e);
g.type=j.type||g.type;
}g.details=this.details;
g.target=this.originalTarget||this.target;
g.currentTarget=this.currentTarget;
g.stopped=0;
g.prevented=0;
this._facade=g;
return this._facade;
};
a.stopPropagation=function(){this.stopped=1;
if(this.stack){this.stack.stopped=1;
}this.events.fire("stopped",this);
};
a.stopImmediatePropagation=function(){this.stopped=2;
if(this.stack){this.stack.stopped=2;
}this.events.fire("stopped",this);
};
a.preventDefault=function(){if(this.preventable){this.prevented=1;
if(this.stack){this.stack.prevented=1;
}}};
a.halt=function(g){if(g){this.stopImmediatePropagation();
}else{this.stopPropagation();
}this.preventDefault();
};
c.addTarget=function(g){this._yuievt.targets[f.stamp(g)]=g;
this._yuievt.hasTargets=true;
};
c.getTargets=function(){return f.Object.values(this._yuievt.targets);
};
c.removeTarget=function(g){delete this._yuievt.targets[f.stamp(g)];
};
c.bubble=function(u,q,o,s){var m=this._yuievt.targets,p=true,v,r=u&&u.type,h,l,n,j,g=o||(u&&u.target)||this,k;
if(!u||((!u.stopped)&&m)){for(l in m){if(m.hasOwnProperty(l)){v=m[l];
h=v.getEvent(r,true);
j=v.getSibling(r,h);
if(j&&!h){h=v.publish(r);
}k=v._yuievt.bubbling;
v._yuievt.bubbling=r;
if(!h){if(v._yuievt.hasTargets){v.bubble(u,q,g,s);
}}else{h.sibling=j;
h.target=g;
h.originalTarget=g;
h.currentTarget=v;
n=h.broadcast;
h.broadcast=false;
h.emitFacade=true;
h.stack=s;
p=p&&h.fire.apply(h,q||u.details||[]);
h.broadcast=n;
h.originalTarget=null;
if(h.stopped){break;
}}v._yuievt.bubbling=k;
}}}return p;
};
b=new f.EventFacade();
e=f.Object.keys(b);
},"3.4.1",{requires:["event-custom-base"]});
YUI.add("event-synthetic",function(b){var j=b.Env.evt.dom_map,d=b.Array,i=b.Lang,l=i.isObject,c=i.isString,e=i.isArray,g=b.Selector.query,k=function(){};
function h(n,m){this.handle=n;
this.emitFacade=m;
}h.prototype.fire=function(s){var t=d(arguments,0,true),q=this.handle,o=q.evt,m=q.sub,p=m.context,u=m.filter,n=s||{},r;
if(this.emitFacade){if(!s||!s.preventDefault){n=o._getFacade();
if(l(s)&&!s.preventDefault){b.mix(n,s,true);
t[0]=n;
}else{t.unshift(n);
}}n.type=o.type;
n.details=t.slice();
if(u){n.container=o.host;
}}else{if(u&&l(s)&&s.currentTarget){t.shift();
}}m.context=p||n.currentTarget||o.host;
r=o.fire.apply(o,t);
m.context=p;
return r;
};
function f(o,n,m){this.handles=[];
this.el=o;
this.key=m;
this.domkey=n;
}f.prototype={constructor:f,type:"_synth",fn:k,capture:false,register:function(m){m.evt.registry=this;
this.handles.push(m);
},unregister:function(p){var o=this.handles,n=j[this.domkey],m;
for(m=o.length-1;
m>=0;
--m){if(o[m].sub===p){o.splice(m,1);
break;
}}if(!o.length){delete n[this.key];
if(!b.Object.size(n)){delete j[this.domkey];
}}},detachAll:function(){var n=this.handles,m=n.length;
while(--m>=0){n[m].detach();
}}};
function a(){this._init.apply(this,arguments);
}b.mix(a,{Notifier:h,SynthRegistry:f,getRegistry:function(s,r,p){var q=s._node,o=b.stamp(q),n="event:"+o+r+"_synth",m=j[o];
if(p){if(!m){m=j[o]={};
}if(!m[n]){m[n]=new f(q,o,n);
}}return(m&&m[n])||null;
},_deleteSub:function(n){if(n&&n.fn){var m=this.eventDef,o=(n.filter)?"detachDelegate":"detach";
this.subscribers={};
this.subCount=0;
m[o](n.node,n,this.notifier,n.filter);
this.registry.unregister(n);
delete n.fn;
delete n.node;
delete n.context;
}},prototype:{constructor:a,_init:function(){var m=this.publishConfig||(this.publishConfig={});
this.emitFacade=("emitFacade" in m)?m.emitFacade:true;
m.emitFacade=false;
},processArgs:k,on:k,detach:k,delegate:k,detachDelegate:k,_on:function(s,t){var u=[],o=s.slice(),p=this.processArgs(s,t),q=s[2],m=t?"delegate":"on",n,r;
n=(c(q))?g(q):d(q||b.one(b.config.win));
if(!n.length&&c(q)){r=b.on("available",function(){b.mix(r,b[m].apply(b,o),true);
},q);
return r;
}b.Array.each(n,function(w){var x=s.slice(),v;
w=b.one(w);
if(w){if(t){v=x.splice(3,1)[0];
}x.splice(0,4,x[1],x[3]);
if(!this.preventDups||!this.getSubs(w,s,null,true)){u.push(this._subscribe(w,m,x,p,v));
}}},this);
return(u.length===1)?u[0]:new b.EventHandle(u);
},_subscribe:function(q,o,t,r,p){var v=new b.CustomEvent(this.type,this.publishConfig),s=v.on.apply(v,t),u=new h(s,this.emitFacade),n=a.getRegistry(q,this.type,true),m=s.sub;
m.node=q;
m.filter=p;
if(r){this.applyArgExtras(r,m);
}b.mix(v,{eventDef:this,notifier:u,host:q,currentTarget:q,target:q,el:q._node,_delete:a._deleteSub},true);
s.notifier=u;
n.register(s);
this[o](q,m,u,p);
return s;
},applyArgExtras:function(m,n){n._extra=m;
},_detach:function(o){var t=o[2],r=(c(t))?g(t):d(t),s,q,m,p,n;
o.splice(2,1);
for(q=0,m=r.length;
q<m;
++q){s=b.one(r[q]);
if(s){p=this.getSubs(s,o);
if(p){for(n=p.length-1;
n>=0;
--n){p[n].detach();
}}}}},getSubs:function(o,u,n,q){var m=a.getRegistry(o,this.type),v=[],t,p,s,r;
if(m){t=m.handles;
if(!n){n=this.subMatch;
}for(p=0,s=t.length;
p<s;
++p){r=t[p];
if(n.call(this,r.sub,u)){if(q){return r;
}else{v.push(t[p]);
}}}}return v.length&&v;
},subMatch:function(n,m){return !m[1]||n.fn===m[1];
}}},true);
b.SyntheticEvent=a;
b.Event.define=function(o,n,q){var p,r,m;
if(o&&o.type){p=o;
q=n;
}else{if(n){p=b.merge({type:o},n);
}}if(p){if(q||!b.Node.DOM_EVENTS[p.type]){r=function(){a.apply(this,arguments);
};
b.extend(r,a,p);
m=new r();
o=m.type;
b.Node.DOM_EVENTS[o]=b.Env.evt.plugins[o]={eventDef:m,on:function(){return m._on(d(arguments));
},delegate:function(){return m._on(d(arguments),true);
},detach:function(){return m._detach(d(arguments));
}};
}}else{if(c(o)||e(o)){b.Array.each(d(o),function(s){b.Node.DOM_EVENTS[s]=1;
});
}}return m;
};
},"3.4.1",{requires:["node-base","event-custom-complex"]});
YUI.add("event-mousewheel",function(c){var b="DOMMouseScroll",a=function(e){var d=c.Array(e,0,true),f;
if(c.UA.gecko){d[0]=b;
f=c.config.win;
}else{f=c.config.doc;
}if(d.length<3){d[2]=f;
}else{d.splice(2,0,f);
}return d;
};
c.Env.evt.plugins.mousewheel={on:function(){return c.Event._attach(a(arguments));
},detach:function(){return c.Event.detach.apply(c.Event,a(arguments));
}};
},"3.4.1",{requires:["node-base"]});
YUI.add("event-mouseenter",function(f){var b=f.Env.evt.dom_wrappers,d=f.DOM.contains,c=f.Array,e=function(){},a={proxyType:"mouseover",relProperty:"fromElement",_notify:function(k,i,h){var g=this._node,j=k.relatedTarget||k[i];
if(g!==j&&!d(g,j)){h.fire(new f.DOMEventFacade(k,g,b["event:"+f.stamp(g)+k.type]));
}},on:function(k,i,j){var h=f.Node.getDOMNode(k),g=[this.proxyType,this._notify,h,null,this.relProperty,j];
i.handle=f.Event._attach(g,{facade:false});
},detach:function(h,g){g.handle.detach();
},delegate:function(l,j,k,i){var h=f.Node.getDOMNode(l),g=[this.proxyType,e,h,null,k];
j.handle=f.Event._attach(g,{facade:false});
j.handle.sub.filter=i;
j.handle.sub.relProperty=this.relProperty;
j.handle.sub._notify=this._filterNotify;
},_filterNotify:function(j,p,g){p=p.slice();
if(this.args){p.push.apply(p,this.args);
}var h=f.delegate._applyFilter(this.filter,p,g),q=p[0].relatedTarget||p[0][this.relProperty],o,k,m,n,l;
if(h){h=c(h);
for(k=0,m=h.length&&(!o||!o.stopped);
k<m;
++k){l=h[0];
if(!d(l,q)){if(!o){o=new f.DOMEventFacade(p[0],l,g);
o.container=f.one(g.el);
}o.currentTarget=f.one(l);
n=p[1].fire(o);
if(n===false){break;
}}}}return n;
},detachDelegate:function(h,g){g.handle.detach();
}};
f.Event.define("mouseenter",a,true);
f.Event.define("mouseleave",f.merge(a,{proxyType:"mouseout",relProperty:"toElement"}),true);
},"3.4.1",{requires:["event-synthetic"]});
YUI.add("event-key",function(g){var e="+alt",c="+ctrl",d="+meta",b="+shift",a=g.Lang.trim,f={KEY_MAP:{enter:13,esc:27,backspace:8,tab:9,pageup:33,pagedown:34},_typeRE:/^(up|down|press):/,_keysRE:/^(?:up|down|press):|\+(alt|ctrl|meta|shift)/g,processArgs:function(m){var p=m.splice(3,1)[0],o=g.Array.hash(p.match(/\+(?:alt|ctrl|meta|shift)\b/g)||[]),j={type:this._typeRE.test(p)?RegExp.$1:null,mods:o,keys:null},n=p.replace(this._keysRE,""),k,q,h,l;
if(n){n=n.split(",");
j.keys={};
for(l=n.length-1;
l>=0;
--l){k=a(n[l]);
if(!k){continue;
}if(+k==k){j.keys[k]=o;
}else{h=k.toLowerCase();
if(this.KEY_MAP[h]){j.keys[this.KEY_MAP[h]]=o;
if(!j.type){j.type="down";
}}else{q=k.charAt(0).toUpperCase();
h=h.charAt(0);
j.keys[q.charCodeAt(0)]=(h!==q&&k===q)?g.merge(o,{"+shift":true}):o;
}}}}if(!j.type){j.type="press";
}return j;
},on:function(n,k,m,j){var h=k._extra,i="key"+h.type,l=h.keys,o=(j)?"delegate":"on";
k._detach=n[o](i,function(q){var p=l?l[q.keyCode]:h.mods;
if(p&&(!p[e]||(p[e]&&q.altKey))&&(!p[c]||(p[c]&&q.ctrlKey))&&(!p[d]||(p[d]&&q.metaKey))&&(!p[b]||(p[b]&&q.shiftKey))){m.fire(q);
}},j);
},detach:function(j,h,i){h._detach.detach();
}};
f.delegate=f.on;
f.detachDelegate=f.detach;
g.Event.define("key",f,true);
},"3.4.1",{requires:["event-synthetic"]});
YUI.add("event-focus",function(e){var d=e.Event,c=e.Lang,a=c.isString,b=c.isFunction(e.DOM.create('<p onbeforeactivate=";"/>').onbeforeactivate);
function f(h,g,j){var i="_"+h+"Notifiers";
e.Event.define(h,{_attach:function(l,m,k){if(e.DOM.isWindow(l)){return d._attach([h,function(n){m.fire(n);
},l]);
}else{return d._attach([g,this._proxy,l,this,m,k],{capture:true});
}},_proxy:function(o,s,p){var m=o.target,q=m.getData(i),t=e.stamp(o.currentTarget._node),k=(b||o.target!==o.currentTarget),l=s.handle.sub,r=[m,o].concat(l.args||[]),n;
s.currentTarget=(p)?m:o.currentTarget;
s.container=(p)?o.currentTarget:null;
if(!l.filter||l.filter.apply(m,r)){if(!q){q={};
m.setData(i,q);
if(k){n=d._attach([j,this._notify,m._node]).sub;
n.once=true;
}}if(!q[t]){q[t]=[];
}q[t].push(s);
if(!k){this._notify(o);
}}},_notify:function(p,l){var m=p.currentTarget,r=m.getData(i),s=m.get("ownerDocument")||m,q=m,k=[],t,n,o;
if(r){while(q&&q!==s){k.push.apply(k,r[e.stamp(q)]||[]);
q=q.get("parentNode");
}k.push.apply(k,r[e.stamp(s)]||[]);
for(n=0,o=k.length;
n<o;
++n){t=k[n];
p.currentTarget=k[n].currentTarget;
if(t.container){p.container=t.container;
}t.fire(p);
}m.clearData(i);
}},on:function(m,k,l){k.onHandle=this._attach(m._node,l);
},detach:function(l,k){k.onHandle.detach();
},delegate:function(n,l,m,k){if(a(k)){l.filter=e.delegate.compileFilter(k);
}l.delegateHandle=this._attach(n._node,m,true);
},detachDelegate:function(l,k){k.delegateHandle.detach();
}},true);
}if(b){f("focus","beforeactivate","focusin");
f("blur","beforedeactivate","focusout");
}else{f("focus","focus","focus");
f("blur","blur","blur");
}},"3.4.1",{requires:["event-synthetic"]});
YUI.add("event-resize",function(e){var b=e.Env.evt.dom_wrappers,d=e.config.win,c="event:"+e.stamp(d)+"resizenative",a;
e.Event.define("windowresize",{on:(e.UA.gecko&&e.UA.gecko<1.91)?function(h,f,g){f._handle=e.Event._attach(["resize",function(i){g.fire(new e.DOMEventFacade(i,d,b[c]));
}],{facade:false});
}:function(i,g,h){var f=e.config.windowResizeDelay||100;
g._handle=e.Event._attach(["resize",function(j){if(g._timer){g._timer.cancel();
}g._timer=e.later(f,e,function(){h.fire(new e.DOMEventFacade(j,d,b[c]));
});
}],{facade:false});
},detach:function(g,f){if(f._timer){f._timer.cancel();
}f._handle.detach();
}});
},"3.4.1",{requires:["event-synthetic"]});
YUI.add("event-hover",function(d){var c=d.Lang.isFunction,b=function(){},a={processArgs:function(e){var f=c(e[2])?2:3;
return(c(e[f]))?e.splice(f,1)[0]:b;
},on:function(i,g,h,f){var e=(g.args)?g.args.slice():[];
e.unshift(null);
g._detach=i[(f)?"delegate":"on"]({mouseenter:function(j){j.phase="over";
h.fire(j);
},mouseleave:function(j){var k=g.context||this;
e[0]=j;
j.type="hover";
j.phase="out";
g._extra.apply(k,e);
}},f);
},detach:function(g,e,f){e._detach.detach();
}};
a.delegate=a.on;
a.detachDelegate=a.detach;
d.Event.define("hover",a);
},"3.4.1",{requires:["event-mouseenter"]});
YUI.add("event-outside",function(b){var a=["blur","change","click","dblclick","focus","keydown","keypress","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","select","submit"];
b.Event.defineOutside=function(e,d){d=d||(e+"outside");
var c={on:function(h,f,g){f.handle=b.one("doc").on(e,function(i){if(this.isOutside(h,i.target)){i.currentTarget=h;
g.fire(i);
}},this);
},detach:function(h,f,g){f.handle.detach();
},delegate:function(i,g,h,f){g.handle=b.one("doc").delegate(e,function(j){if(this.isOutside(i,j.target)){h.fire(j);
}},f,this);
},isOutside:function(f,g){return g!==f&&!g.ancestor(function(h){return h===f;
});
}};
c.detachDelegate=c.detach;
b.Event.define(d,c);
};
b.Array.each(a,function(c){b.Event.defineOutside(c);
});
},"3.4.1",{requires:["event-synthetic"]});
YUI.add("event-simulate",function(a){(function(){var k=a.Lang,j=a.Array,f=k.isFunction,d=k.isString,g=k.isBoolean,o=k.isObject,n=k.isNumber,m=a.config.doc,p={click:1,dblclick:1,mouseover:1,mouseout:1,mousedown:1,mouseup:1,mousemove:1},l={keydown:1,keyup:1,keypress:1},c={blur:1,change:1,focus:1,resize:1,scroll:1,select:1},e={scroll:1,resize:1,reset:1,submit:1,change:1,select:1,error:1,abort:1};
a.mix(e,p);
a.mix(e,l);
function i(v,z,u,s,B,r,q,A,x,D,C){if(!v){a.error("simulateKeyEvent(): Invalid target.");
}if(d(z)){z=z.toLowerCase();
switch(z){case"textevent":z="keypress";
break;
case"keyup":case"keydown":case"keypress":break;
default:a.error("simulateKeyEvent(): Event type '"+z+"' not supported.");
}}else{a.error("simulateKeyEvent(): Event type must be a string.");
}if(!g(u)){u=true;
}if(!g(s)){s=true;
}if(!o(B)){B=window;
}if(!g(r)){r=false;
}if(!g(q)){q=false;
}if(!g(A)){A=false;
}if(!g(x)){x=false;
}if(!n(D)){D=0;
}if(!n(C)){C=0;
}var y=null;
if(f(m.createEvent)){try{y=m.createEvent("KeyEvents");
y.initKeyEvent(z,u,s,B,r,q,A,x,D,C);
}catch(w){try{y=m.createEvent("Events");
}catch(t){y=m.createEvent("UIEvents");
}finally{y.initEvent(z,u,s);
y.view=B;
y.altKey=q;
y.ctrlKey=r;
y.shiftKey=A;
y.metaKey=x;
y.keyCode=D;
y.charCode=C;
}}v.dispatchEvent(y);
}else{if(o(m.createEventObject)){y=m.createEventObject();
y.bubbles=u;
y.cancelable=s;
y.view=B;
y.ctrlKey=r;
y.altKey=q;
y.shiftKey=A;
y.metaKey=x;
y.keyCode=(C>0)?C:D;
v.fireEvent("on"+z,y);
}else{a.error("simulateKeyEvent(): No event simulation framework present.");
}}}function b(A,F,x,u,G,z,w,v,t,r,s,q,E,C,y,B){if(!A){a.error("simulateMouseEvent(): Invalid target.");
}if(d(F)){F=F.toLowerCase();
if(!p[F]){a.error("simulateMouseEvent(): Event type '"+F+"' not supported.");
}}else{a.error("simulateMouseEvent(): Event type must be a string.");
}if(!g(x)){x=true;
}if(!g(u)){u=(F!="mousemove");
}if(!o(G)){G=window;
}if(!n(z)){z=1;
}if(!n(w)){w=0;
}if(!n(v)){v=0;
}if(!n(t)){t=0;
}if(!n(r)){r=0;
}if(!g(s)){s=false;
}if(!g(q)){q=false;
}if(!g(E)){E=false;
}if(!g(C)){C=false;
}if(!n(y)){y=0;
}B=B||null;
var D=null;
if(f(m.createEvent)){D=m.createEvent("MouseEvents");
if(D.initMouseEvent){D.initMouseEvent(F,x,u,G,z,w,v,t,r,s,q,E,C,y,B);
}else{D=m.createEvent("UIEvents");
D.initEvent(F,x,u);
D.view=G;
D.detail=z;
D.screenX=w;
D.screenY=v;
D.clientX=t;
D.clientY=r;
D.ctrlKey=s;
D.altKey=q;
D.metaKey=C;
D.shiftKey=E;
D.button=y;
D.relatedTarget=B;
}if(B&&!D.relatedTarget){if(F=="mouseout"){D.toElement=B;
}else{if(F=="mouseover"){D.fromElement=B;
}}}A.dispatchEvent(D);
}else{if(o(m.createEventObject)){D=m.createEventObject();
D.bubbles=x;
D.cancelable=u;
D.view=G;
D.detail=z;
D.screenX=w;
D.screenY=v;
D.clientX=t;
D.clientY=r;
D.ctrlKey=s;
D.altKey=q;
D.metaKey=C;
D.shiftKey=E;
switch(y){case 0:D.button=1;
break;
case 1:D.button=4;
break;
case 2:break;
default:D.button=0;
}D.relatedTarget=B;
A.fireEvent("on"+F,D);
}else{a.error("simulateMouseEvent(): No event simulation framework present.");
}}}function h(w,v,s,r,q,u){if(!w){a.error("simulateUIEvent(): Invalid target.");
}if(d(v)){v=v.toLowerCase();
if(!c[v]){a.error("simulateUIEvent(): Event type '"+v+"' not supported.");
}}else{a.error("simulateUIEvent(): Event type must be a string.");
}var t=null;
if(!g(s)){s=(v in e);
}if(!g(r)){r=(v=="submit");
}if(!o(q)){q=window;
}if(!n(u)){u=1;
}if(f(m.createEvent)){t=m.createEvent("UIEvents");
t.initUIEvent(v,s,r,q,u);
w.dispatchEvent(t);
}else{if(o(m.createEventObject)){t=m.createEventObject();
t.bubbles=s;
t.cancelable=r;
t.view=q;
t.detail=u;
w.fireEvent("on"+v,t);
}else{a.error("simulateUIEvent(): No event simulation framework present.");
}}}a.Event.simulate=function(s,r,q){q=q||{};
if(p[r]){b(s,r,q.bubbles,q.cancelable,q.view,q.detail,q.screenX,q.screenY,q.clientX,q.clientY,q.ctrlKey,q.altKey,q.shiftKey,q.metaKey,q.button,q.relatedTarget);
}else{if(l[r]){i(s,r,q.bubbles,q.cancelable,q.view,q.ctrlKey,q.altKey,q.shiftKey,q.metaKey,q.keyCode,q.charCode);
}else{if(c[r]){h(s,r,q.bubbles,q.cancelable,q.view,q.detail);
}else{a.error("simulate(): Event '"+r+"' can't be simulated.");
}}}};
})();
},"3.4.1",{requires:["event-base"]});
YUI.add("node-event-simulate",function(a){a.Node.prototype.simulate=function(c,b){a.Event.simulate(a.Node.getDOMNode(this),c,b);
};
},"3.4.1",{requires:["node-base","event-simulate"]});
YUI.add("node-event-delegate",function(a){a.Node.prototype.delegate=function(d){var c=a.Array(arguments,0,true),b=(a.Lang.isObject(d)&&!a.Lang.isArray(d))?1:2;
c.splice(b,0,this._node);
return a.delegate.apply(a,c);
};
},"3.4.1",{requires:["node-base","event-delegate"]});
YUI.add("attribute-base",function(c){c.State=function(){this.data={};
};
c.State.prototype={add:function(B,C,E){var D=this.data;
D[C]=D[C]||{};
D[C][B]=E;
},addAll:function(B,D){var C;
for(C in D){if(D.hasOwnProperty(C)){this.add(B,C,D[C]);
}}},remove:function(B,C){var D=this.data;
if(D[C]&&(B in D[C])){delete D[C][B];
}},removeAll:function(B,D){var C=this.data;
c.each(D||C,function(F,E){if(c.Lang.isString(E)){this.remove(B,E);
}else{this.remove(B,F);
}},this);
},get:function(B,C){var D=this.data;
return(D[C]&&B in D[C])?D[C][B]:undefined;
},getAll:function(B){var D=this.data,C;
c.each(D,function(F,E){if(B in D[E]){C=C||{};
C[E]=F[B];
}},this);
return C;
}};
var k=c.Object,f=c.Lang,l=c.EventTarget,w=".",t="Change",n="getter",m="setter",o="readOnly",x="writeOnce",u="initOnly",A="validator",h="value",p="valueFn",e="broadcast",r="lazyAdd",j="_bypassProxy",z="added",b="initializing",i="initValue",v="published",s="defaultValue",a="lazy",q="isLazyAdd",g,y={};
y[o]=1;
y[x]=1;
y[n]=1;
y[e]=1;
function d(C,B,D){var E=this;
E._ATTR_E_FACADE={};
l.call(E,{emitFacade:true});
E._conf=E._state=new c.State();
E._stateProxy=E._stateProxy||null;
E._requireAddAttr=E._requireAddAttr||false;
this._initAttrs(C,B,D);
}d.INVALID_VALUE={};
g=d.INVALID_VALUE;
d._ATTR_CFG=[m,n,A,h,p,x,o,r,e,j];
d.prototype={addAttr:function(C,B,E){var F=this,H=F._state,G,D;
E=(r in B)?B[r]:E;
if(E&&!F.attrAdded(C)){H.add(C,a,B||{});
H.add(C,z,true);
}else{if(!F.attrAdded(C)||H.get(C,q)){B=B||{};
D=(h in B);
if(D){G=B.value;
delete B.value;
}B.added=true;
B.initializing=true;
H.addAll(C,B);
if(D){F.set(C,G);
}H.remove(C,b);
}}return F;
},attrAdded:function(B){return !!this._state.get(B,z);
},modifyAttr:function(C,B){var D=this,F,E;
if(D.attrAdded(C)){if(D._isLazyAttr(C)){D._addLazyAttr(C);
}E=D._state;
for(F in B){if(y[F]&&B.hasOwnProperty(F)){E.add(C,F,B[F]);
if(F===e){E.remove(C,v);
}}}}},removeAttr:function(B){this._state.removeAll(B);
},get:function(B){return this._getAttr(B);
},_isLazyAttr:function(B){return this._state.get(B,a);
},_addLazyAttr:function(C){var D=this._state,B=D.get(C,a);
D.add(C,q,true);
D.remove(C,a);
this.addAttr(C,B);
},set:function(B,D,C){return this._setAttr(B,D,C);
},reset:function(B){var D=this,C;
if(B){if(D._isLazyAttr(B)){D._addLazyAttr(B);
}D.set(B,D._state.get(B,i));
}else{C=D._state.data.added;
c.each(C,function(E,F){D.reset(F);
},D);
}return D;
},_set:function(B,D,C){return this._setAttr(B,D,C,true);
},_getAttr:function(D){var E=this,I=D,F=E._state,G,B,H,C;
if(D.indexOf(w)!==-1){G=D.split(w);
D=G.shift();
}if(E._tCfgs&&E._tCfgs[D]){C={};
C[D]=E._tCfgs[D];
delete E._tCfgs[D];
E._addAttrs(C,E._tVals);
}if(E._isLazyAttr(D)){E._addLazyAttr(D);
}H=E._getStateVal(D);
B=F.get(D,n);
if(B&&!B.call){B=this[B];
}H=(B)?B.call(E,H,I):H;
H=(G)?k.getValue(H,G):H;
return H;
},_setAttr:function(D,G,B,E){var K=true,C=this._state,H=this._stateProxy,M=C.data,J,N,O,F,I,L;
if(D.indexOf(w)!==-1){N=D;
O=D.split(w);
D=O.shift();
}if(this._isLazyAttr(D)){this._addLazyAttr(D);
}J=(!M.value||!(D in M.value));
if(H&&D in H&&!this._state.get(D,j)){J=false;
}if(this._requireAddAttr&&!this.attrAdded(D)){}else{I=C.get(D,x);
L=C.get(D,b);
if(!J&&!E){if(I){K=false;
}if(C.get(D,o)){K=false;
}}if(!L&&!E&&I===u){K=false;
}if(K){if(!J){F=this.get(D);
}if(O){G=k.setValue(c.clone(F),O,G);
if(G===undefined){K=false;
}}if(K){if(L){this._setAttrVal(D,N,F,G);
}else{this._fireAttrChange(D,N,F,G,B);
}}}}return this;
},_fireAttrChange:function(H,G,E,D,B){var J=this,F=H+t,C=J._state,I;
if(!C.get(H,v)){J.publish(F,{queuable:false,defaultTargetOnly:true,defaultFn:J._defAttrChangeFn,silent:true,broadcast:C.get(H,e)});
C.add(H,v,true);
}I=(B)?c.merge(B):J._ATTR_E_FACADE;
I.attrName=H;
I.subAttrName=G;
I.prevVal=E;
I.newVal=D;
J.fire(F,I);
},_defAttrChangeFn:function(B){if(!this._setAttrVal(B.attrName,B.subAttrName,B.prevVal,B.newVal)){B.stopImmediatePropagation();
}else{B.newVal=this.get(B.attrName);
}},_getStateVal:function(B){var C=this._stateProxy;
return C&&(B in C)&&!this._state.get(B,j)?C[B]:this._state.get(B,h);
},_setStateVal:function(B,D){var C=this._stateProxy;
if(C&&(B in C)&&!this._state.get(B,j)){C[B]=D;
}else{this._state.add(B,h,D);
}},_setAttrVal:function(M,L,I,G){var O=this,J=true,D=O._state,E=D.get(M,A),H=D.get(M,m),K=D.get(M,b),N=this._getStateVal(M),C=L||M,F,B;
if(E){if(!E.call){E=this[E];
}if(E){B=E.call(O,G,C);
if(!B&&K){G=D.get(M,s);
B=true;
}}}if(!E||B){if(H){if(!H.call){H=this[H];
}if(H){F=H.call(O,G,C);
if(F===g){J=false;
}else{if(F!==undefined){G=F;
}}}}if(J){if(!L&&(G===N)&&!f.isObject(G)){J=false;
}else{if(D.get(M,i)===undefined){D.add(M,i,G);
}O._setStateVal(M,G);
}}}else{J=false;
}return J;
},setAttrs:function(B,C){return this._setAttrs(B,C);
},_setAttrs:function(C,D){for(var B in C){if(C.hasOwnProperty(B)){this.set(B,C[B]);
}}return this;
},getAttrs:function(B){return this._getAttrs(B);
},_getAttrs:function(E){var G=this,I={},F,C,B,H,D=(E===true);
E=(E&&!D)?E:k.keys(G._state.data.added);
for(F=0,C=E.length;
F<C;
F++){B=E[F];
H=G.get(B);
if(!D||G._getStateVal(B)!=G._state.get(B,i)){I[B]=G.get(B);
}}return I;
},addAttrs:function(B,C,D){var E=this;
if(B){E._tCfgs=B;
E._tVals=E._normAttrVals(C);
E._addAttrs(B,E._tVals,D);
E._tCfgs=E._tVals=null;
}return E;
},_addAttrs:function(C,D,E){var G=this,B,F,H;
for(B in C){if(C.hasOwnProperty(B)){F=C[B];
F.defaultValue=F.value;
H=G._getAttrInitVal(B,F,G._tVals);
if(H!==undefined){F.value=H;
}if(G._tCfgs[B]){delete G._tCfgs[B];
}G.addAttr(B,F,E);
}}},_protectAttrs:function(C){if(C){C=c.merge(C);
for(var B in C){if(C.hasOwnProperty(B)){C[B]=c.merge(C[B]);
}}}return C;
},_normAttrVals:function(B){return(B)?c.merge(B):null;
},_getAttrInitVal:function(B,C,E){var F,D;
if(!C[o]&&E&&E.hasOwnProperty(B)){F=E[B];
}else{F=C[h];
D=C[p];
if(D){if(!D.call){D=this[D];
}if(D){F=D.call(this);
}}}return F;
},_getAttrCfg:function(B){var D,C=this._state.data;
if(C){D={};
c.each(C,function(E,F){if(B){if(B in E){D[F]=E[B];
}}else{c.each(E,function(H,G){D[G]=D[G]||{};
D[G][F]=H;
});
}});
}return D;
},_initAttrs:function(C,B,E){C=C||this.constructor.ATTRS;
var D=c.Base;
if(C&&!(D&&c.instanceOf(this,D))){this.addAttrs(this._protectAttrs(C),B,E);
}}};
c.mix(d,l,false,null,1);
c.Attribute=d;
},"3.4.1",{requires:["event-custom"]});
YUI.add("pluginhost-base",function(c){var a=c.Lang;
function b(){this._plugins={};
}b.prototype={plug:function(g,d){var e,h,f;
if(a.isArray(g)){for(e=0,h=g.length;
e<h;
e++){this.plug(g[e]);
}}else{if(g&&!a.isFunction(g)){d=g.cfg;
g=g.fn;
}if(g&&g.NS){f=g.NS;
d=d||{};
d.host=this;
if(this.hasPlugin(f)){this[f].setAttrs(d);
}else{this[f]=new g(d);
this._plugins[f]=g;
}}}return this;
},unplug:function(f){var e=f,d=this._plugins;
if(f){if(a.isFunction(f)){e=f.NS;
if(e&&(!d[e]||d[e]!==f)){e=null;
}}if(e){if(this[e]){this[e].destroy();
delete this[e];
}if(d[e]){delete d[e];
}}}else{for(e in this._plugins){if(this._plugins.hasOwnProperty(e)){this.unplug(e);
}}}return this;
},hasPlugin:function(d){return(this._plugins[d]&&this[d]);
},_initPlugins:function(d){this._plugins=this._plugins||{};
if(this._initConfigPlugins){this._initConfigPlugins(d);
}},_destroyPlugins:function(){this.unplug();
}};
c.namespace("Plugin").Host=b;
},"3.4.1",{requires:["yui-base"]});
YUI.add("pluginhost-config",function(c){var b=c.Plugin.Host,a=c.Lang;
b.prototype._initConfigPlugins=function(e){var g=(this._getClasses)?this._getClasses():[this.constructor],d=[],h={},f,j,l,m,k;
for(j=g.length-1;
j>=0;
j--){f=g[j];
m=f._UNPLUG;
if(m){c.mix(h,m,true);
}l=f._PLUG;
if(l){c.mix(d,l,true);
}}for(k in d){if(d.hasOwnProperty(k)){if(!h[k]){this.plug(d[k]);
}}}if(e&&e.plugins){this.plug(e.plugins);
}};
b.plug=function(e,j,g){var k,h,d,f;
if(e!==c.Base){e._PLUG=e._PLUG||{};
if(!a.isArray(j)){if(g){j={fn:j,cfg:g};
}j=[j];
}for(h=0,d=j.length;
h<d;
h++){k=j[h];
f=k.NAME||k.fn.NAME;
e._PLUG[f]=k;
}}};
b.unplug=function(e,h){var j,g,d,f;
if(e!==c.Base){e._UNPLUG=e._UNPLUG||{};
if(!a.isArray(h)){h=[h];
}for(g=0,d=h.length;
g<d;
g++){j=h[g];
f=j.NAME;
if(!e._PLUG[f]){e._UNPLUG[f]=j;
}else{delete e._PLUG[f];
}}}};
},"3.4.1",{requires:["pluginhost-base"]});
YUI.add("base-base",function(d){var g=d.Object,h=d.Lang,o=".",q="destroy",b="init",r="initialized",m="destroyed",n="initializer",j="bubbleTargets",e="_bubbleTargets",a=Object.prototype.constructor,c="deep",p="shallow",k="destructor",f=d.Attribute,l=function(v,u,t){var w;
for(w in u){if(t[w]){v[w]=u[w];
}}return v;
};
function i(){d.stamp(this);
f.call(this);
var s=d.Plugin&&d.Plugin.Host;
if(this._initPlugins&&s){s.call(this);
}if(this._lazyAddAttrs!==false){this._lazyAddAttrs=true;
}this.name=this.constructor.NAME;
this._eventPrefix=this.constructor.EVENT_PREFIX||this.constructor.NAME;
this.init.apply(this,arguments);
}i._ATTR_CFG=f._ATTR_CFG.concat("cloneDefaultValue");
i._ATTR_CFG_HASH=d.Array.hash(i._ATTR_CFG);
i.NAME="base";
i.ATTRS={initialized:{readOnly:true,value:false},destroyed:{readOnly:true,value:false}};
i.prototype={init:function(s){this._yuievt.config.prefix=this._eventPrefix;
this.publish(b,{queuable:false,fireOnce:true,defaultTargetOnly:true,defaultFn:this._defInitFn});
this._preInitEventCfg(s);
this.fire(b,{cfg:s});
return this;
},_preInitEventCfg:function(t){if(t){if(t.on){this.on(t.on);
}if(t.after){this.after(t.after);
}}var u,s,w,v=(t&&j in t);
if(v||e in this){w=v?(t&&t.bubbleTargets):this._bubbleTargets;
if(h.isArray(w)){for(u=0,s=w.length;
u<s;
u++){this.addTarget(w[u]);
}}else{if(w){this.addTarget(w);
}}}},destroy:function(){this.publish(q,{queuable:false,fireOnce:true,defaultTargetOnly:true,defaultFn:this._defDestroyFn});
this.fire(q);
this.detachAll();
return this;
},_defInitFn:function(s){this._initHierarchy(s.cfg);
if(this._initPlugins){this._initPlugins(s.cfg);
}this._set(r,true);
},_defDestroyFn:function(s){if(this._destroyPlugins){this._destroyPlugins();
}this._destroyHierarchy();
this._set(m,true);
},_getClasses:function(){if(!this._classes){this._initHierarchyData();
}return this._classes;
},_getAttrCfgs:function(){if(!this._attrs){this._initHierarchyData();
}return this._attrs;
},_filterAttrCfgs:function(w,t){var u=null,s,v=w.ATTRS;
if(v){for(s in v){if(t[s]){u=u||{};
u[s]=t[s];
t[s]=null;
}}}return u;
},_initHierarchyData:function(){var u=this.constructor,t=[],s=[];
while(u){t[t.length]=u;
if(u.ATTRS){s[s.length]=u.ATTRS;
}u=u.superclass?u.superclass.constructor:null;
}this._classes=t;
this._attrs=this._aggregateAttrs(s);
},_aggregateAttrs:function(z){var v,A,u,s,B,t,y,x=i._ATTR_CFG_HASH,w={};
if(z){for(t=z.length-1;
t>=0;
--t){A=z[t];
for(v in A){if(A.hasOwnProperty(v)){u=l({},A[v],x);
s=u.value;
y=u.cloneDefaultValue;
if(s){if((y===undefined&&(a===s.constructor||h.isArray(s)))||y===c||y===true){u.value=d.clone(s);
}else{if(y===p){u.value=d.merge(s);
}}}B=null;
if(v.indexOf(o)!==-1){B=v.split(o);
v=B.shift();
}if(B&&w[v]&&w[v].value){g.setValue(w[v].value,B,s);
}else{if(!B){if(!w[v]){w[v]=u;
}else{l(w[v],u,x);
}}}}}}}return w;
},_initHierarchy:function(y){var u=this._lazyAddAttrs,z,A,C,w,t,B,x,v=this._getClasses(),s=this._getAttrCfgs();
for(C=v.length-1;
C>=0;
C--){z=v[C];
A=z.prototype;
x=z._yuibuild&&z._yuibuild.exts;
if(x){for(w=0,t=x.length;
w<t;
w++){x[w].apply(this,arguments);
}}this.addAttrs(this._filterAttrCfgs(z,s),y,u);
if(A.hasOwnProperty(n)){A.initializer.apply(this,arguments);
}if(x){for(w=0;
w<t;
w++){B=x[w].prototype;
if(B.hasOwnProperty(n)){B.initializer.apply(this,arguments);
}}}}},_destroyHierarchy:function(){var w,x,A,y,u,s,v,z,t=this._getClasses();
for(A=0,y=t.length;
A<y;
A++){w=t[A];
x=w.prototype;
v=w._yuibuild&&w._yuibuild.exts;
if(v){for(u=0,s=v.length;
u<s;
u++){z=v[u].prototype;
if(z.hasOwnProperty(k)){z.destructor.apply(this,arguments);
}}}if(x.hasOwnProperty(k)){x.destructor.apply(this,arguments);
}}},toString:function(){return this.name+"["+d.stamp(this,true)+"]";
}};
d.mix(i,f,false,null,1);
i.prototype.constructor=i;
d.Base=i;
},"3.4.1",{requires:["attribute-base"]});
YUI.add("base-pluginhost",function(c){var a=c.Base,b=c.Plugin.Host;
c.mix(a,b,false,null,1);
a.plug=b.plug;
a.unplug=b.unplug;
},"3.4.1",{requires:["base-base","pluginhost"]});
YUI.add("base-build",function(f){var c=f.Base,a=f.Lang,b="initializer",d="destructor",e;
c._build=function(B,p,z,s,t,o){var u=c._build,x=u._ctor(p,o),q=u._cfg(p,o),h=u._mixCust,m=q.aggregates,g=q.custom,k=x._yuibuild.dynamic,w,v,A,j,n,y,r;
if(k&&m){for(w=0,v=m.length;
w<v;
++w){A=m[w];
if(p.hasOwnProperty(A)){x[A]=a.isArray(p[A])?[]:{};
}}}for(w=0,v=z.length;
w<v;
w++){j=z[w];
n=j.prototype;
y=n[b];
r=n[d];
delete n[b];
delete n[d];
f.mix(x,j,true,null,1);
h(x,j,m,g);
if(y){n[b]=y;
}if(r){n[d]=r;
}x._yuibuild.exts.push(j);
}if(s){f.mix(x.prototype,s,true);
}if(t){f.mix(x,u._clean(t,m,g),true);
h(x,t,m,g);
}x.prototype.hasImpl=u._impl;
if(k){x.NAME=B;
x.prototype.constructor=x;
}return x;
};
e=c._build;
f.mix(e,{_mixCust:function(i,h,l,k){if(l){f.aggregate(i,h,true,l);
}if(k){for(var g in k){if(k.hasOwnProperty(g)){k[g](g,i,h);
}}}},_tmpl:function(g){function h(){h.superclass.constructor.apply(this,arguments);
}f.extend(h,g);
return h;
},_impl:function(m){var p=this._getClasses(),o,h,g,n,q,k;
for(o=0,h=p.length;
o<h;
o++){g=p[o];
if(g._yuibuild){n=g._yuibuild.exts;
q=n.length;
for(k=0;
k<q;
k++){if(n[k]===m){return true;
}}}}return false;
},_ctor:function(g,h){var j=(h&&false===h.dynamic)?false:true,k=(j)?e._tmpl(g):g,i=k._yuibuild;
if(!i){i=k._yuibuild={};
}i.id=i.id||null;
i.exts=i.exts||[];
i.dynamic=j;
return k;
},_cfg:function(g,h){var i=[],l={},k,j=(h&&h.aggregates),n=(h&&h.custom),m=g;
while(m&&m.prototype){k=m._buildCfg;
if(k){if(k.aggregates){i=i.concat(k.aggregates);
}if(k.custom){f.mix(l,k.custom,true);
}}m=m.superclass?m.superclass.constructor:null;
}if(j){i=i.concat(j);
}if(n){f.mix(l,h.cfgBuild,true);
}return{aggregates:i,custom:l};
},_clean:function(o,n,j){var m,h,g,k=f.merge(o);
for(m in j){if(k.hasOwnProperty(m)){delete k[m];
}}for(h=0,g=n.length;
h<g;
h++){m=n[h];
if(k.hasOwnProperty(m)){delete k[m];
}}return k;
}});
c.build=function(i,g,j,h){return e(i,g,j,null,null,h);
};
c.create=function(g,j,i,h,k){return e(g,j,i,h,k);
};
c.mix=function(g,h){return e(null,g,h,null,null,{dynamic:false});
};
c._buildCfg={custom:{ATTRS:function(l,j,h){j.ATTRS=j.ATTRS||{};
if(h.ATTRS){var i=h.ATTRS,k=j.ATTRS,g;
for(g in i){if(i.hasOwnProperty(g)){k[g]=k[g]||{};
f.mix(k[g],i[g],true);
}}}}},aggregates:["_PLUG","_UNPLUG"]};
},"3.4.1",{requires:["base-base"]});
YUI.add("querystring-stringify-simple",function(c){var b=c.namespace("QueryString"),a=encodeURIComponent;
b.stringify=function(j,k){var d=[],h=k&&k.arrayKey?true:false,g,f,e;
for(g in j){if(j.hasOwnProperty(g)){if(c.Lang.isArray(j[g])){for(f=0,e=j[g].length;
f<e;
f++){d.push(a(h?g+"[]":g)+"="+a(j[g][f]));
}}else{d.push(a(g)+"="+a(j[g]));
}}}return d.join("&");
};
},"3.4.1",{requires:["yui-base"]});
YUI.add("queue-promote",function(a){a.mix(a.Queue.prototype,{indexOf:function(b){return a.Array.indexOf(this._q,b);
},promote:function(c){var b=this.indexOf(c);
if(b>-1){this._q.unshift(this._q.splice(b,1)[0]);
}},remove:function(c){var b=this.indexOf(c);
if(b>-1){this._q.splice(b,1);
}}});
},"3.4.1",{requires:["yui-base"]});
YUI.add("io-base",function(a){var i=a.Lang.isNumber,j=a.Lang.isObject,g=["start","complete","end","success","failure"],b=["status","statusText","responseText","responseXML"],f=a.config.win,d=f.XMLHttpRequest,h=f.XDomainRequest,e=0;
function c(k){var l=this;
l._uid="io:"+e++;
l._init(k);
a.io._map[l._uid]=l;
}c.prototype={_id:0,_headers:{"X-Requested-With":"XMLHttpRequest"},_timeout:{},_init:function(k){var m=this,l;
m.cfg=k||{};
a.augment(m,a.EventTarget);
for(l=0;
l<5;
l++){m.publish("io:"+g[l],a.merge({broadcast:1},k));
m.publish("io-trn:"+g[l],k);
}},_create:function(l,r){var q=this,o={id:i(r)?r:q._id++,uid:q._uid},m=l.xdr,k=m&&m.use,n=(m&&m.use==="native"&&h),p=q._transport;
if(!k){k=(l.form&&l.form.upload)?"iframe":"xhr";
}switch(k){case"native":case"xhr":o.c=n?new h():d?new d():new ActiveXObject("Microsoft.XMLHTTP");
o.t=n?true:false;
break;
default:o.c=(p&&p[k])||{};
o.t=true;
}return o;
},_destroy:function(k){if(f&&!k.t){if(d){k.c.onreadystatechange=null;
}else{if(a.UA.ie&&!k.e){k.c.abort();
}}}k=k.c=null;
},_evt:function(o,l,k){var q=this,m,r=k["arguments"],s=q.cfg.emitFacade,n="io:"+o,p="io-trn:"+o;
if(l.e){l.c={status:0,statusText:l.e};
}m=[(s)?{id:l.id,data:l.c,cfg:k,"arguments":r}:l.id];
if(!s){if(o===g[0]||o===g[2]){if(r){m.push(r);
}}else{m.push(l.c);
if(r){m.push(r);
}}}m.unshift(n);
q.fire.apply(q,m);
if(k.on){m[0]=p;
q.once(p,k.on[o],k.context||a);
q.fire.apply(q,m);
}},start:function(l,k){this._evt(g[0],l,k);
},complete:function(l,k){this._evt(g[1],l,k);
},end:function(l,k){this._evt(g[2],l,k);
this._destroy(l);
},success:function(l,k){this._evt(g[3],l,k);
this.end(l,k);
},failure:function(l,k){this._evt(g[4],l,k);
this.end(l,k);
},_retry:function(m,l,k){this._destroy(m);
k.xdr.use="flash";
return this.send(l,k,m.id);
},_concat:function(k,l){k+=(k.indexOf("?")===-1?"?":"&")+l;
return k;
},setHeader:function(k,l){if(l){this._headers[k]=l;
}else{delete this._headers[k];
}},_setHeaders:function(l,k){k=a.merge(this._headers,k);
a.Object.each(k,function(n,m){if(n!=="disable"){l.setRequestHeader(m,k[m]);
}});
},_startTimeout:function(l,k){var m=this;
m._timeout[l.id]=f.setTimeout(function(){m._abort(l,"timeout");
},k);
},_clearTimeout:function(k){f.clearTimeout(this._timeout[k]);
delete this._timeout[k];
},_result:function(n,l){var k;
try{k=n.c.status;
}catch(m){k=0;
}if(k>=200&&k<300||k===304||k===1223){this.success(n,l);
}else{this.failure(n,l);
}},_rS:function(l,k){var m=this;
if(l.c.readyState===4){if(k.timeout){m._clearTimeout(l.id);
}f.setTimeout(function(){m.complete(l,k);
m._result(l,k);
},0);
}},_abort:function(l,k){if(l&&l.c){l.e=k;
l.c.abort();
}},send:function(m,n,l){var o,k,r,s,w,q,v=this,x=m,p={};
n=n?a.Object(n):{};
o=v._create(n,l);
k=n.method?n.method.toUpperCase():"GET";
w=n.sync;
q=n.data;
if(j(q)){q=a.QueryString.stringify(q);
}if(n.form){if(n.form.upload){return v.upload(o,m,n);
}else{q=v._serialize(n.form,q);
}}if(q){switch(k){case"GET":case"HEAD":case"DELETE":x=v._concat(x,q);
q="";
break;
case"POST":case"PUT":n.headers=a.merge({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},n.headers);
break;
}}if(o.t){return v.xdr(x,o,n);
}if(!w){o.c.onreadystatechange=function(){v._rS(o,n);
};
}try{o.c.open(k,x,!w,n.username||null,n.password||null);
v._setHeaders(o.c,n.headers||{});
v.start(o,n);
if(n.xdr&&n.xdr.credentials){if(!a.UA.ie){o.c.withCredentials=true;
}}o.c.send(q);
if(w){for(r=0,s=b.length;
r<s;
++r){p[b[r]]=o.c[b[r]];
}p.getAllResponseHeaders=function(){return o.c.getAllResponseHeaders();
};
p.getResponseHeader=function(u){return o.c.getResponseHeader(u);
};
v.complete(o,n);
v._result(o,n);
return p;
}}catch(t){if(o.t){return v._retry(o,m,n);
}else{v.complete(o,n);
v._result(o,n);
}}if(n.timeout){v._startTimeout(o,n.timeout);
}return{id:o.id,abort:function(){return o.c?v._abort(o,"abort"):false;
},isInProgress:function(){return o.c?(o.c.readyState%4):false;
},io:v};
}};
a.io=function(l,k){var m=a.io._map["io:0"]||new c();
return m.send.apply(m,[l,k]);
};
a.io.header=function(k,l){var m=a.io._map["io:0"]||new c();
m.setHeader(k,l);
};
a.IO=c;
a.io._map={};
},"3.4.1",{requires:["event-custom-base","querystring-stringify-simple"]});
YUI.add("io-queue",function(b){var c=b.io._map["io:0"]||new b.IO();
b.mix(b.IO.prototype,{_q:new b.Queue(),_qActiveId:null,_qInit:false,_qState:1,_qShift:function(){var e=this,d=e._q.next();
e._qActiveId=d.id;
e._qState=0;
e.send(d.uri,d.cfg,d.id);
},queue:function(d,g){var f=this,e={uri:d,cfg:g,id:this._id++};
if(!f._qInit){b.on("io:complete",function(i,h){f._qNext(i);
},f);
f._qInit=true;
}f._q.add(e);
if(f._qState===1){f._qShift();
}return e;
},_qNext:function(e){var d=this;
d._qState=1;
if(d._qActiveId===e&&d._q.size()>0){d._qShift();
}},qPromote:function(d){this._q.promote(d);
},qRemove:function(d){this._q.remove(d);
},qStart:function(){var d=this;
d._qState=1;
if(d._q.size()>0){d._qShift();
}},qStop:function(){this._qState=0;
},qSize:function(){return this._q.size();
}},true);
function a(d,e){return c.queue.apply(c,[d,e]);
}a.start=function(){c.qStart();
};
a.stop=function(){c.qStop();
};
a.promote=function(d){c.qPromote(d);
};
a.remove=function(d){c.qRemove(d);
};
a.size=function(){c.qSize();
};
b.io.queue=a;
},"3.4.1",{requires:["io-base","queue-promote"]});
YUI.add("io-upload-iframe",function(g){var b=g.config.win,f=g.config.doc,c=(f.documentMode&&f.documentMode>=8),a=decodeURIComponent;
function h(j,l,k){var d=g.Node.create('<iframe id="io_iframe'+j.id+'" name="io_iframe'+j.id+'" />');
d._node.style.position="absolute";
d._node.style.top="-1000px";
d._node.style.left="-1000px";
g.one("body").appendChild(d);
g.on("load",function(){k._uploadComplete(j,l);
},"#io_iframe"+j.id);
}function e(d){g.Event.purgeElement("#io_iframe"+d,false);
g.one("body").removeChild(g.one("#io_iframe"+d));
}g.mix(g.IO.prototype,{_addData:function(p,n){if(g.Lang.isObject(n)){n=g.QueryString.stringify(n);
}var q=[],d=n.split("="),k,j;
for(k=0,j=d.length-1;
k<j;
k++){q[k]=f.createElement("input");
q[k].type="hidden";
q[k].name=a(d[k].substring(d[k].lastIndexOf("&")+1));
q[k].value=(k+1===j)?a(d[k+1]):a(d[k+1].substring(0,(d[k+1].lastIndexOf("&"))));
p.appendChild(q[k]);
}return q;
},_removeData:function(k,m){var j,d;
for(j=0,d=m.length;
j<d;
j++){k.removeChild(m[j]);
}},_setAttrs:function(i,j,d){i.setAttribute("action",d);
i.setAttribute("method","POST");
i.setAttribute("target","io_iframe"+j);
i.setAttribute(g.UA.ie&&!c?"encoding":"enctype","multipart/form-data");
},_resetAttrs:function(i,d){g.Object.each(d,function(j,k){if(j){i.setAttribute(k,j);
}else{i.removeAttribute(k);
}});
},_startTimeout:function(d,j){var i=this;
i._timeout[d.id]=b.setTimeout(function(){d.status=0;
d.statusText="timeout";
i.complete(d,j);
i.end(d,j);
},j.timeout);
},_clearTimeout:function(i){var d=this;
b.clearTimeout(d._timeout[i]);
delete d._timeout[i];
},_uploadComplete:function(m,q){var n=this,l=g.one("#io_iframe"+m.id).get("contentWindow.document"),i=l.one("body"),k;
if(q.timeout){n._clearTimeout(m.id);
}try{if(i){k=i.one("pre:first-child");
m.c.responseText=k?k.get("text"):i.get("text");
}else{m.c.responseXML=l._node;
}}catch(j){m.e="upload failure";
}n.complete(m,q);
n.end(m,q);
b.setTimeout(function(){e(m.id);
},0);
},_upload:function(l,j,n){var m=this,k=(typeof n.form.id==="string")?f.getElementById(n.form.id):n.form.id,i={action:k.getAttribute("action"),target:k.getAttribute("target")},d;
m._setAttrs(k,l.id,j);
if(n.data){d=m._addData(k,n.data);
}if(n.timeout){m._startTimeout(l,n);
}k.submit();
m.start(l,n);
if(n.data){m._removeData(k,d);
}m._resetAttrs(k,i);
return{id:l.id,abort:function(){l.status=0;
l.statusText="abort";
if(g.one("#io_iframe"+l.id)){e(l.id);
m.complete(l,n);
m.end(l,n);
}else{return false;
}},isInProgress:function(){return g.one("#io_iframe"+l.id)?true:false;
},io:m};
},upload:function(i,d,j){h(i,j,this);
return this._upload(i,d,j);
}});
},"3.4.1",{requires:["io-base","node-base"]});
YUI.add("json-parse",function(Y){function fromGlobal(ref){return(Y.config.win||this||{})[ref];
}var _JSON=fromGlobal("JSON"),Native=(Object.prototype.toString.call(_JSON)==="[object JSON]"&&_JSON),useNative=!!Native,_UNICODE_EXCEPTIONS=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_ESCAPES=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,_VALUES=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,_BRACKETS=/(?:^|:|,)(?:\s*\[)+/g,_UNSAFE=/[^\],:{}\s]/,_escapeException=function(c){return"\\u"+("0000"+(+(c.charCodeAt(0))).toString(16)).slice(-4);
},_revive=function(data,reviver){var walk=function(o,key){var k,v,value=o[key];
if(value&&typeof value==="object"){for(k in value){if(value.hasOwnProperty(k)){v=walk(value,k);
if(v===undefined){delete value[k];
}else{value[k]=v;
}}}}return reviver.call(o,key,value);
};
return typeof reviver==="function"?walk({"":data},""):data;
},_parse=function(s,reviver){s=s.replace(_UNICODE_EXCEPTIONS,_escapeException);
if(!_UNSAFE.test(s.replace(_ESCAPES,"@").replace(_VALUES,"]").replace(_BRACKETS,""))){return _revive(eval("("+s+")"),reviver);
}throw new SyntaxError("JSON.parse");
};
Y.namespace("JSON").parse=function(s,reviver){if(typeof s!=="string"){s+="";
}return Native&&Y.JSON.useNativeParse?Native.parse(s,reviver):_parse(s,reviver);
};
function workingNative(k,v){return k==="ok"?true:v;
}if(Native){try{useNative=(Native.parse('{"ok":false}',workingNative)).ok;
}catch(e){useNative=false;
}}Y.JSON.useNativeParse=useNative;
},"3.4.1",{requires:["yui-base"]});
YUI.add("json-stringify",function(b){var j=(b.config.win||{}).JSON,N=b.Lang,p=N.isFunction,I=N.isObject,v=N.isArray,k=Object.prototype.toString,C=(k.call(j)==="[object JSON]"&&j),F=!!C,D="undefined",r="object",A="null",L="string",B="number",x="boolean",l="date",E={"undefined":D,string:L,"[object String]":L,number:B,"[object Number]":B,"boolean":x,"[object Boolean]":x,"[object Date]":l,"[object RegExp]":r},g="",q="{",a="}",y="[",i="]",s=",",c=",\n",m="\n",G=":",h=": ",u='"',d=/[\x00-\x07\x0b\x0e-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n=[[/\\/g,"\\\\"],[/\"/g,'\\"'],[/\x08/g,"\\b"],[/\x09/g,"\\t"],[/\x0a/g,"\\n"],[/\x0c/g,"\\f"],[/\x0d/g,"\\r"]],t=n.length,f={},o,H;
function O(P){var e=typeof P;
return E[e]||E[k.call(P)]||(e===r?(P?r:A):D);
}function K(e){if(!f[e]){f[e]="\\u"+("0000"+(+(e.charCodeAt(0))).toString(16)).slice(-4);
o[e]=0;
}if(++o[e]===H){n.push([new RegExp(e,"g"),f[e]]);
t=n.length;
}return f[e];
}function w(Q){var e,P;
for(e=0;
e<t;
e++){P=n[e];
Q=Q.replace(P[0],P[1]);
}return u+Q.replace(d,K)+u;
}function z(e,P){return e.replace(/^/gm,P);
}function J(P,X,e){if(P===undefined){return undefined;
}var R=p(X)?X:null,W=k.call(e).match(/String|Number/)||[],Z=b.JSON.dateToString,V=[],T,S,U;
o={};
H=b.JSON.charCacheThreshold;
if(R||!v(X)){X=undefined;
}if(X){T={};
for(S=0,U=X.length;
S<U;
++S){T[X[S]]=true;
}X=T;
}e=W[0]==="Number"?new Array(Math.min(Math.max(0,e),10)+1).join(" "):(e||g).slice(0,10);
function Q(ac,ai){var ag=ac[ai],ak=O(ag),af=[],ae=e?h:G,ad,ab,aj,aa,ah;
if(I(ag)&&p(ag.toJSON)){ag=ag.toJSON(ai);
}else{if(ak===l){ag=Z(ag);
}}if(p(R)){ag=R.call(ac,ai,ag);
}if(ag!==ac[ai]){ak=O(ag);
}switch(ak){case l:case r:break;
case L:return w(ag);
case B:return isFinite(ag)?ag+g:A;
case x:return ag+g;
case A:return A;
default:return undefined;
}for(ab=V.length-1;
ab>=0;
--ab){if(V[ab]===ag){throw new Error("JSON.stringify. Cyclical reference");
}}ad=v(ag);
V.push(ag);
if(ad){for(ab=ag.length-1;
ab>=0;
--ab){af[ab]=Q(ag,ab)||A;
}}else{aj=X||ag;
ab=0;
for(aa in aj){if(aj.hasOwnProperty(aa)){ah=Q(ag,aa);
if(ah){af[ab++]=w(aa)+ae+ah;
}}}}V.pop();
if(e&&af.length){return ad?y+m+z(af.join(c),e)+m+i:q+m+z(af.join(c),e)+m+a;
}else{return ad?y+af.join(s)+i:q+af.join(s)+a;
}}return Q({"":P},"");
}if(C){try{F=("0"===C.stringify(0));
}catch(M){F=false;
}}b.mix(b.namespace("JSON"),{useNativeStringify:F,dateToString:function(P){function e(Q){return Q<10?"0"+Q:Q;
}return P.getUTCFullYear()+"-"+e(P.getUTCMonth()+1)+"-"+e(P.getUTCDate())+"T"+e(P.getUTCHours())+G+e(P.getUTCMinutes())+G+e(P.getUTCSeconds())+"Z";
},stringify:function(Q,e,P){return C&&b.JSON.useNativeStringify?C.stringify(Q,e,P):J(Q,e,P);
},charCacheThreshold:100});
},"3.4.1",{requires:["yui-base"]});
YUI.add("cookie",function(c){var k=c.Lang,i=c.Object,g=null,d=k.isString,n=k.isObject,f=k.isUndefined,e=k.isFunction,h=encodeURIComponent,b=decodeURIComponent,m=c.config.doc;
function j(o){throw new TypeError(o);
}function l(o){if(!d(o)||o===""){j("Cookie name must be a non-empty string.");
}}function a(o){if(!d(o)||o===""){j("Subcookie name must be a non-empty string.");
}}c.Cookie={_createCookieString:function(q,t,r,p){p=p||{};
var v=h(q)+"="+(r?h(t):t),o=p.expires,u=p.path,s=p.domain;
if(n(p)){if(o instanceof Date){v+="; expires="+o.toUTCString();
}if(d(u)&&u!==""){v+="; path="+u;
}if(d(s)&&s!==""){v+="; domain="+s;
}if(p.secure===true){v+="; secure";
}}return v;
},_createCookieHashString:function(o){if(!n(o)){j("Cookie._createCookieHashString(): Argument must be an object.");
}var p=[];
i.each(o,function(r,q){if(!e(r)&&!f(r)){p.push(h(q)+"="+h(String(r)));
}});
return p.join("&");
},_parseCookieHash:function(s){var r=s.split("&"),t=g,q={};
if(s.length){for(var p=0,o=r.length;
p<o;
p++){t=r[p].split("=");
q[b(t[0])]=b(t[1]);
}}return q;
},_parseCookieString:function(w,y){var x={};
if(d(w)&&w.length>0){var o=(y===false?function(z){return z;
}:b),u=w.split(/;\s/g),v=g,p=g,r=g;
for(var q=0,s=u.length;
q<s;
q++){r=u[q].match(/([^=]+)=/i);
if(r instanceof Array){try{v=b(r[1]);
p=o(u[q].substring(r[1].length+1));
}catch(t){}}else{v=b(u[q]);
p="";
}x[v]=p;
}}return x;
},_setDoc:function(o){m=o;
},exists:function(o){l(o);
var p=this._parseCookieString(m.cookie,true);
return p.hasOwnProperty(o);
},get:function(p,o){l(p);
var s,q,r;
if(e(o)){r=o;
o={};
}else{if(n(o)){r=o.converter;
}else{o={};
}}s=this._parseCookieString(m.cookie,!o.raw);
q=s[p];
if(f(q)){return g;
}if(!e(r)){return q;
}else{return r(q);
}},getSub:function(o,q,p){var r=this.getSubs(o);
if(r!==g){a(q);
if(f(r[q])){return g;
}if(!e(p)){return r[q];
}else{return p(r[q]);
}}else{return g;
}},getSubs:function(o){l(o);
var p=this._parseCookieString(m.cookie,false);
if(d(p[o])){return this._parseCookieHash(p[o]);
}return g;
},remove:function(p,o){l(p);
o=c.merge(o||{},{expires:new Date(0)});
return this.set(p,"",o);
},removeSub:function(p,s,o){l(p);
a(s);
o=o||{};
var r=this.getSubs(p);
if(n(r)&&r.hasOwnProperty(s)){delete r[s];
if(!o.removeIfEmpty){return this.setSubs(p,r,o);
}else{for(var q in r){if(r.hasOwnProperty(q)&&!e(r[q])&&!f(r[q])){return this.setSubs(p,r,o);
}}return this.remove(p,o);
}}else{return"";
}},set:function(p,q,o){l(p);
if(f(q)){j("Cookie.set(): Value cannot be undefined.");
}o=o||{};
var r=this._createCookieString(p,q,!o.raw,o);
m.cookie=r;
return r;
},setSub:function(p,r,q,o){l(p);
a(r);
if(f(q)){j("Cookie.setSub(): Subcookie value cannot be undefined.");
}var s=this.getSubs(p);
if(!n(s)){s={};
}s[r]=q;
return this.setSubs(p,s,o);
},setSubs:function(p,q,o){l(p);
if(!n(q)){j("Cookie.setSubs(): Cookie value must be an object.");
}var r=this._createCookieString(p,this._createCookieHashString(q),false,o);
m.cookie=r;
return r;
}};
},"3.4.1",{requires:["yui-base"]});
YUI.add("array-extras",function(d){var b=d.Lang,c=Array.prototype,a=d.Array;
a.lastIndexOf=c.lastIndexOf?function(e,g,f){return f||f===0?e.lastIndexOf(g,f):e.lastIndexOf(g);
}:function(f,j,h){var e=f.length,g=e-1;
if(h||h===0){g=Math.min(h<0?e+h:h,e);
}if(g>-1&&e>0){for(;
g>-1;
--g){if(g in f&&f[g]===j){return g;
}}}return -1;
};
a.unique=function(f,l){var k=0,e=f.length,h=[],m,g;
for(;
k<e;
++k){m=f[k];
for(g=h.length;
g>-1;
--g){if(m===h[g]){break;
}}if(g===-1){h.push(m);
}}if(l){if(b.isNumber(h[0])){h.sort(a.numericSort);
}else{h.sort();
}}return h;
};
a.filter=c.filter?function(e,g,h){return e.filter(g,h);
}:function(g,l,m){var j=0,e=g.length,h=[],k;
for(;
j<e;
++j){if(j in g){k=g[j];
if(l.call(m,k,j,g)){h.push(k);
}}}return h;
};
a.reject=function(e,g,h){return a.filter(e,function(k,j,f){return !g.call(h,k,j,f);
});
};
a.every=c.every?function(e,g,h){return e.every(g,h);
}:function(g,j,k){for(var h=0,e=g.length;
h<e;
++h){if(h in g&&!j.call(k,g[h],h,g)){return false;
}}return true;
};
a.map=c.map?function(e,g,h){return e.map(g,h);
}:function(g,k,l){var j=0,e=g.length,h=g.concat();
for(;
j<e;
++j){if(j in g){h[j]=k.call(l,g[j],j,g);
}}return h;
};
a.reduce=c.reduce?function(e,i,g,h){return e.reduce(function(l,k,j,f){return g.call(h,l,k,j,f);
},i);
}:function(h,m,k,l){var j=0,g=h.length,e=m;
for(;
j<g;
++j){if(j in h){e=k.call(l,e,h[j],j,h);
}}return e;
};
a.find=function(g,j,k){for(var h=0,e=g.length;
h<e;
h++){if(h in g&&j.call(k,g[h],h,g)){return g[h];
}}return null;
};
a.grep=function(e,f){return a.filter(e,function(h,g){return f.test(h);
});
};
a.partition=function(e,h,i){var g={matches:[],rejects:[]};
a.each(e,function(j,f){var k=h.call(i,j,f,e)?g.matches:g.rejects;
k.push(j);
});
return g;
};
a.zip=function(f,e){var g=[];
a.each(f,function(i,h){g.push([i,e[h]]);
});
return g;
};
},"3.4.1",{requires:["yui-base"]});
YUI.add("node-style",function(a){(function(c){var b=["getStyle","getComputedStyle","setStyle","setStyles"];
c.Node.importMethod(c.DOM,b);
c.NodeList.importMethod(c.Node.prototype,b);
})(a);
},"3.4.1",{requires:["dom-style","node-base"]});
YUI.add("anim-base",function(b){var c="running",n="startTime",l="elapsedTime",j="start",i="tween",m="end",d="node",k="paused",o="reverse",h="iterationCount",a=Number;
var f={},e;
b.Anim=function(){b.Anim.superclass.constructor.apply(this,arguments);
b.Anim._instances[b.stamp(this)]=this;
};
b.Anim.NAME="anim";
b.Anim._instances={};
b.Anim.RE_DEFAULT_UNIT=/^width|height|top|right|bottom|left|margin.*|padding.*|border.*$/i;
b.Anim.DEFAULT_UNIT="px";
b.Anim.DEFAULT_EASING=function(q,p,s,r){return s*q/r+p;
};
b.Anim._intervalTime=20;
b.Anim.behaviors={left:{get:function(q,p){return q._getOffset(p);
}}};
b.Anim.behaviors.top=b.Anim.behaviors.left;
b.Anim.DEFAULT_SETTER=function(s,t,v,w,y,r,u,x){var q=s._node,p=u(y,a(v),a(w)-a(v),r);
if(t in q._node.style||t in b.DOM.CUSTOM_STYLES){x=x||"";
q.setStyle(t,p+x);
}else{if(q._node.attributes[t]){q.setAttribute(t,p);
}else{q.set(t,p);
}}};
b.Anim.DEFAULT_GETTER=function(r,p){var q=r._node,s="";
if(p in q._node.style||p in b.DOM.CUSTOM_STYLES){s=q.getComputedStyle(p);
}else{if(q._node.attributes[p]){s=q.getAttribute(p);
}else{s=q.get(p);
}}return s;
};
b.Anim.ATTRS={node:{setter:function(p){if(p){if(typeof p=="string"||p.nodeType){p=b.one(p);
}}this._node=p;
if(!p){}return p;
}},duration:{value:1},easing:{value:b.Anim.DEFAULT_EASING,setter:function(p){if(typeof p==="string"&&b.Easing){return b.Easing[p];
}}},from:{},to:{},startTime:{value:0,readOnly:true},elapsedTime:{value:0,readOnly:true},running:{getter:function(){return !!f[b.stamp(this)];
},value:false,readOnly:true},iterations:{value:1},iterationCount:{value:0,readOnly:true},direction:{value:"normal"},paused:{readOnly:true,value:false},reverse:{value:false}};
b.Anim.run=function(){var q=b.Anim._instances;
for(var p in q){if(q[p].run){q[p].run();
}}};
b.Anim.pause=function(){for(var p in f){if(f[p].pause){f[p].pause();
}}b.Anim._stopTimer();
};
b.Anim.stop=function(){for(var p in f){if(f[p].stop){f[p].stop();
}}b.Anim._stopTimer();
};
b.Anim._startTimer=function(){if(!e){e=setInterval(b.Anim._runFrame,b.Anim._intervalTime);
}};
b.Anim._stopTimer=function(){clearInterval(e);
e=0;
};
b.Anim._runFrame=function(){var p=true;
for(var q in f){if(f[q]._runFrame){p=false;
f[q]._runFrame();
}}if(p){b.Anim._stopTimer();
}};
b.Anim.RE_UNITS=/^(-?\d*\.?\d*){1}(em|ex|px|in|cm|mm|pt|pc|%)*$/;
var g={run:function(){if(this.get(k)){this._resume();
}else{if(!this.get(c)){this._start();
}}return this;
},pause:function(){if(this.get(c)){this._pause();
}return this;
},stop:function(p){if(this.get(c)||this.get(k)){this._end(p);
}return this;
},_added:false,_start:function(){this._set(n,new Date()-this.get(l));
this._actualFrames=0;
if(!this.get(k)){this._initAnimAttr();
}f[b.stamp(this)]=this;
b.Anim._startTimer();
this.fire(j);
},_pause:function(){this._set(n,null);
this._set(k,true);
delete f[b.stamp(this)];
this.fire("pause");
},_resume:function(){this._set(k,false);
f[b.stamp(this)]=this;
this._set(n,new Date()-this.get(l));
b.Anim._startTimer();
this.fire("resume");
},_end:function(p){var q=this.get("duration")*1000;
if(p){this._runAttrs(q,q,this.get(o));
}this._set(n,null);
this._set(l,0);
this._set(k,false);
delete f[b.stamp(this)];
this.fire(m,{elapsed:this.get(l)});
},_runFrame:function(){var u=this._runtimeAttr.duration,r=new Date()-this.get(n),q=this.get(o),p=(r>=u),s,v;
this._runAttrs(r,u,q);
this._actualFrames+=1;
this._set(l,r);
this.fire(i);
if(p){this._lastFrame();
}},_runAttrs:function(A,z,w){var x=this._runtimeAttr,r=b.Anim.behaviors,y=x.easing,p=z,u=false,q,s,v;
if(A>=z){u=true;
}if(w){A=z-A;
p=0;
}for(v in x){if(x[v].to){q=x[v];
s=(v in r&&"set" in r[v])?r[v].set:b.Anim.DEFAULT_SETTER;
if(!u){s(this,v,q.from,q.to,A,z,y,q.unit);
}else{s(this,v,q.from,q.to,p,z,y,q.unit);
}}}},_lastFrame:function(){var p=this.get("iterations"),q=this.get(h);
q+=1;
if(p==="infinite"||q<p){if(this.get("direction")==="alternate"){this.set(o,!this.get(o));
}this.fire("iteration");
}else{q=0;
this._end();
}this._set(n,new Date());
this._set(h,q);
},_initAnimAttr:function(){var w=this.get("from")||{},v=this.get("to")||{},p={duration:this.get("duration")*1000,easing:this.get("easing")},r=b.Anim.behaviors,u=this.get(d),t,s,q;
b.each(v,function(A,y){if(typeof A==="function"){A=A.call(this,u);
}s=w[y];
if(s===undefined){s=(y in r&&"get" in r[y])?r[y].get(this,y):b.Anim.DEFAULT_GETTER(this,y);
}else{if(typeof s==="function"){s=s.call(this,u);
}}var x=b.Anim.RE_UNITS.exec(s);
var z=b.Anim.RE_UNITS.exec(A);
s=x?x[1]:s;
q=z?z[1]:A;
t=z?z[2]:x?x[2]:"";
if(!t&&b.Anim.RE_DEFAULT_UNIT.test(y)){t=b.Anim.DEFAULT_UNIT;
}if(!s||!q){b.error('invalid "from" or "to" for "'+y+'"',"Anim");
return;
}p[y]={from:s,to:q,unit:t};
},this);
this._runtimeAttr=p;
},_getOffset:function(q){var s=this._node,t=s.getComputedStyle(q),r=(q==="left")?"getX":"getY",u=(q==="left")?"setX":"setY";
if(t==="auto"){var p=s.getStyle("position");
if(p==="absolute"||p==="fixed"){t=s[r]();
s[u](t);
}else{t=0;
}}return t;
},destructor:function(){delete b.Anim._instances[b.stamp(this)];
}};
b.extend(b.Anim,b.Base,g);
},"3.4.1",{requires:["base-base","node-style"]});
YUI.add("anim-color",function(b){var a=Number;
b.Anim.behaviors.color={set:function(f,d,i,h,c,g,e){i=b.Color.re_RGB.exec(b.Color.toRGB(i));
h=b.Color.re_RGB.exec(b.Color.toRGB(h));
if(!i||i.length<3||!h||h.length<3){b.error("invalid from or to passed to color behavior");
}f._node.setStyle(d,"rgb("+[Math.floor(e(c,a(i[1]),a(h[1])-a(i[1]),g)),Math.floor(e(c,a(i[2]),a(h[2])-a(i[2]),g)),Math.floor(e(c,a(i[3]),a(h[3])-a(i[3]),g))].join(", ")+")");
},get:function(d,c){var e=d._node.getComputedStyle(c);
e=(e==="transparent")?"rgb(255, 255, 255)":e;
return e;
}};
b.each(["backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],function(c,d){b.Anim.behaviors[c]=b.Anim.behaviors.color;
});
},"3.4.1",{requires:["anim-base"]});
YUI.add("dom-screen",function(a){(function(f){var d="documentElement",q="compatMode",o="position",c="fixed",m="relative",g="left",h="top",i="BackCompat",p="medium",e="borderLeftWidth",b="borderTopWidth",r="getBoundingClientRect",k="getComputedStyle",l=f.DOM,n=/^t(?:able|d|h)$/i,j;
if(f.UA.ie){if(f.config.doc[q]!=="BackCompat"){j=d;
}else{j="body";
}}f.mix(l,{winHeight:function(t){var s=l._getWinSize(t).height;
return s;
},winWidth:function(t){var s=l._getWinSize(t).width;
return s;
},docHeight:function(t){var s=l._getDocSize(t).height;
return Math.max(s,l._getWinSize(t).height);
},docWidth:function(t){var s=l._getDocSize(t).width;
return Math.max(s,l._getWinSize(t).width);
},docScrollX:function(u,v){v=v||(u)?l._getDoc(u):f.config.doc;
var t=v.defaultView,s=(t)?t.pageXOffset:0;
return Math.max(v[d].scrollLeft,v.body.scrollLeft,s);
},docScrollY:function(u,v){v=v||(u)?l._getDoc(u):f.config.doc;
var t=v.defaultView,s=(t)?t.pageYOffset:0;
return Math.max(v[d].scrollTop,v.body.scrollTop,s);
},getXY:function(){if(f.config.doc[d][r]){return function(x){var E=null,y,u,z,C,B,t,w,A,D,s,v;
if(x&&x.tagName){D=x.ownerDocument;
v=D[d];
if(v.contains){s=v.contains(x);
}else{s=f.DOM.contains(v,x);
}if(s){y=(j)?D[j].scrollLeft:l.docScrollX(x,D);
u=(j)?D[j].scrollTop:l.docScrollY(x,D);
z=x[r]();
E=[z.left,z.top];
if(f.UA.ie){C=2;
B=2;
A=D[q];
t=l[k](D[d],e);
w=l[k](D[d],b);
if(f.UA.ie===6){if(A!==i){C=0;
B=0;
}}if((A==i)){if(t!==p){C=parseInt(t,10);
}if(w!==p){B=parseInt(w,10);
}}E[0]-=C;
E[1]-=B;
}if((u||y)){if(!f.UA.ios||(f.UA.ios>=4.2)){E[0]+=y;
E[1]+=u;
}}}else{E=l._getOffset(x);
}}return E;
};
}else{return function(t){var w=null,v,s,y,u,x;
if(t){if(l.inDoc(t)){w=[t.offsetLeft,t.offsetTop];
v=t.ownerDocument;
s=t;
y=((f.UA.gecko||f.UA.webkit>519)?true:false);
while((s=s.offsetParent)){w[0]+=s.offsetLeft;
w[1]+=s.offsetTop;
if(y){w=l._calcBorders(s,w);
}}if(l.getStyle(t,o)!=c){s=t;
while((s=s.parentNode)){u=s.scrollTop;
x=s.scrollLeft;
if(f.UA.gecko&&(l.getStyle(s,"overflow")!=="visible")){w=l._calcBorders(s,w);
}if(u||x){w[0]-=x;
w[1]-=u;
}}w[0]+=l.docScrollX(t,v);
w[1]+=l.docScrollY(t,v);
}else{w[0]+=l.docScrollX(t,v);
w[1]+=l.docScrollY(t,v);
}}else{w=l._getOffset(t);
}}return w;
};
}}(),getX:function(s){return l.getXY(s)[0];
},getY:function(s){return l.getXY(s)[1];
},setXY:function(t,w,z){var u=l.setStyle,y,x,s,v;
if(t&&w){y=l.getStyle(t,o);
x=l._getOffset(t);
if(y=="static"){y=m;
u(t,o,y);
}v=l.getXY(t);
if(w[0]!==null){u(t,g,w[0]-v[0]+x[0]+"px");
}if(w[1]!==null){u(t,h,w[1]-v[1]+x[1]+"px");
}if(!z){s=l.getXY(t);
if(s[0]!==w[0]||s[1]!==w[1]){l.setXY(t,w,true);
}}}else{}},setX:function(t,s){return l.setXY(t,[s,null]);
},setY:function(s,t){return l.setXY(s,[null,t]);
},swapXY:function(t,s){var u=l.getXY(t);
l.setXY(t,l.getXY(s));
l.setXY(s,u);
},_calcBorders:function(v,w){var u=parseInt(l[k](v,b),10)||0,s=parseInt(l[k](v,e),10)||0;
if(f.UA.gecko){if(n.test(v.tagName)){u=0;
s=0;
}}w[0]+=s;
w[1]+=u;
return w;
},_getWinSize:function(v,y){y=y||(v)?l._getDoc(v):f.config.doc;
var x=y.defaultView||y.parentWindow,z=y[q],u=x.innerHeight,t=x.innerWidth,s=y[d];
if(z&&!f.UA.opera){if(z!="CSS1Compat"){s=y.body;
}u=s.clientHeight;
t=s.clientWidth;
}return{height:u,width:t};
},_getDocSize:function(t){var u=(t)?l._getDoc(t):f.config.doc,s=u[d];
if(u[q]!="CSS1Compat"){s=u.body;
}return{height:s.scrollHeight,width:s.scrollWidth};
}});
})(a);
(function(g){var d="top",c="right",h="bottom",b="left",f=function(m,k){var o=Math.max(m[d],k[d]),p=Math.min(m[c],k[c]),i=Math.min(m[h],k[h]),j=Math.max(m[b],k[b]),n={};
n[d]=o;
n[c]=p;
n[h]=i;
n[b]=j;
return n;
},e=g.DOM;
g.mix(e,{region:function(j){var k=e.getXY(j),i=false;
if(j&&k){i=e._getRegion(k[1],k[0]+j.offsetWidth,k[1]+j.offsetHeight,k[0]);
}return i;
},intersect:function(k,i,m){var j=m||e.region(k),l={},p=i,o;
if(p.tagName){l=e.region(p);
}else{if(g.Lang.isObject(i)){l=i;
}else{return false;
}}o=f(l,j);
return{top:o[d],right:o[c],bottom:o[h],left:o[b],area:((o[h]-o[d])*(o[c]-o[b])),yoff:((o[h]-o[d])),xoff:(o[c]-o[b]),inRegion:e.inRegion(k,i,false,m)};
},inRegion:function(l,i,j,o){var m={},k=o||e.region(l),q=i,p;
if(q.tagName){m=e.region(q);
}else{if(g.Lang.isObject(i)){m=i;
}else{return false;
}}if(j){return(k[b]>=m[b]&&k[c]<=m[c]&&k[d]>=m[d]&&k[h]<=m[h]);
}else{p=f(m,k);
if(p[h]>=p[d]&&p[c]>=p[b]){return true;
}else{return false;
}}},inViewportRegion:function(j,i,k){return e.inRegion(j,e.viewportRegion(j),i,k);
},_getRegion:function(k,m,i,j){var n={};
n[d]=n[1]=k;
n[b]=n[0]=j;
n[h]=i;
n[c]=m;
n.width=n[c]-n[b];
n.height=n[h]-n[d];
return n;
},viewportRegion:function(j){j=j||g.config.doc.documentElement;
var i=false,l,k;
if(j){l=e.docScrollX(j);
k=e.docScrollY(j);
i=e._getRegion(k,e.winWidth(j)+l,k+e.winHeight(j),l);
}return i;
}});
})(a);
},"3.4.1",{requires:["dom-base","dom-style"]});
YUI.add("node-screen",function(a){a.each(["winWidth","winHeight","docWidth","docHeight","docScrollX","docScrollY"],function(b){a.Node.ATTRS[b]={getter:function(){var c=Array.prototype.slice.call(arguments);
c.unshift(a.Node.getDOMNode(this));
return a.DOM[b].apply(this,c);
}};
});
a.Node.ATTRS.scrollLeft={getter:function(){var b=a.Node.getDOMNode(this);
return("scrollLeft" in b)?b.scrollLeft:a.DOM.docScrollX(b);
},setter:function(c){var b=a.Node.getDOMNode(this);
if(b){if("scrollLeft" in b){b.scrollLeft=c;
}else{if(b.document||b.nodeType===9){a.DOM._getWin(b).scrollTo(c,a.DOM.docScrollY(b));
}}}else{}}};
a.Node.ATTRS.scrollTop={getter:function(){var b=a.Node.getDOMNode(this);
return("scrollTop" in b)?b.scrollTop:a.DOM.docScrollY(b);
},setter:function(c){var b=a.Node.getDOMNode(this);
if(b){if("scrollTop" in b){b.scrollTop=c;
}else{if(b.document||b.nodeType===9){a.DOM._getWin(b).scrollTo(a.DOM.docScrollX(b),c);
}}}else{}}};
a.Node.importMethod(a.DOM,["getXY","setXY","getX","setX","getY","setY","swapXY"]);
a.Node.ATTRS.region={getter:function(){var b=this.getDOMNode(),c;
if(b&&!b.tagName){if(b.nodeType===9){b=b.documentElement;
}}if(a.DOM.isWindow(b)){c=a.DOM.viewportRegion(b);
}else{c=a.DOM.region(b);
}return c;
}};
a.Node.ATTRS.viewportRegion={getter:function(){return a.DOM.viewportRegion(a.Node.getDOMNode(this));
}};
a.Node.importMethod(a.DOM,"inViewportRegion");
a.Node.prototype.intersect=function(b,d){var c=a.Node.getDOMNode(this);
if(a.instanceOf(b,a.Node)){b=a.Node.getDOMNode(b);
}return a.DOM.intersect(c,b,d);
};
a.Node.prototype.inRegion=function(b,d,e){var c=a.Node.getDOMNode(this);
if(a.instanceOf(b,a.Node)){b=a.Node.getDOMNode(b);
}return a.DOM.inRegion(c,b,d,e);
};
},"3.4.1",{requires:["node-base","dom-screen"]});
YUI.add("anim-xy",function(b){var a=Number;
b.Anim.behaviors.xy={set:function(f,d,i,h,c,g,e){f._node.setXY([e(c,a(i[0]),a(h[0])-a(i[0]),g),e(c,a(i[1]),a(h[1])-a(i[1]),g)]);
},get:function(c){return c._node.getXY();
}};
},"3.4.1",{requires:["anim-base","node-screen"]});
YUI.add("anim-curve",function(a){a.Anim.behaviors.curve={set:function(f,c,i,h,b,g,e){i=i.slice.call(i);
h=h.slice.call(h);
var d=e(b,0,100,g)/100;
h.unshift(i);
f._node.setXY(a.Anim.getBezier(h,d));
},get:function(c,b){return c._node.getXY();
}};
a.Anim.getBezier=function(f,e){var g=f.length;
var d=[];
for(var c=0;
c<g;
++c){d[c]=[f[c][0],f[c][1]];
}for(var b=1;
b<g;
++b){for(c=0;
c<g-b;
++c){d[c][0]=(1-e)*d[c][0]+e*d[parseInt(c+1,10)][0];
d[c][1]=(1-e)*d[c][1]+e*d[parseInt(c+1,10)][1];
}}return[d[0][0],d[0][1]];
};
},"3.4.1",{requires:["anim-xy"]});
YUI.add("anim-easing",function(b){var a={easeNone:function(f,e,h,g){return h*f/g+e;
},easeIn:function(f,e,h,g){return h*(f/=g)*f+e;
},easeOut:function(f,e,h,g){return -h*(f/=g)*(f-2)+e;
},easeBoth:function(f,e,h,g){if((f/=g/2)<1){return h/2*f*f+e;
}return -h/2*((--f)*(f-2)-1)+e;
},easeInStrong:function(f,e,h,g){return h*(f/=g)*f*f*f+e;
},easeOutStrong:function(f,e,h,g){return -h*((f=f/g-1)*f*f*f-1)+e;
},easeBothStrong:function(f,e,h,g){if((f/=g/2)<1){return h/2*f*f*f*f+e;
}return -h/2*((f-=2)*f*f*f-2)+e;
},elasticIn:function(g,e,k,j,f,i){var h;
if(g===0){return e;
}if((g/=j)===1){return e+k;
}if(!i){i=j*0.3;
}if(!f||f<Math.abs(k)){f=k;
h=i/4;
}else{h=i/(2*Math.PI)*Math.asin(k/f);
}return -(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e;
},elasticOut:function(g,e,k,j,f,i){var h;
if(g===0){return e;
}if((g/=j)===1){return e+k;
}if(!i){i=j*0.3;
}if(!f||f<Math.abs(k)){f=k;
h=i/4;
}else{h=i/(2*Math.PI)*Math.asin(k/f);
}return f*Math.pow(2,-10*g)*Math.sin((g*j-h)*(2*Math.PI)/i)+k+e;
},elasticBoth:function(g,e,k,j,f,i){var h;
if(g===0){return e;
}if((g/=j/2)===2){return e+k;
}if(!i){i=j*(0.3*1.5);
}if(!f||f<Math.abs(k)){f=k;
h=i/4;
}else{h=i/(2*Math.PI)*Math.asin(k/f);
}if(g<1){return -0.5*(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e;
}return f*Math.pow(2,-10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i)*0.5+k+e;
},backIn:function(f,e,i,h,g){if(g===undefined){g=1.70158;
}if(f===h){f-=0.001;
}return i*(f/=h)*f*((g+1)*f-g)+e;
},backOut:function(f,e,i,h,g){if(typeof g==="undefined"){g=1.70158;
}return i*((f=f/h-1)*f*((g+1)*f+g)+1)+e;
},backBoth:function(f,e,i,h,g){if(typeof g==="undefined"){g=1.70158;
}if((f/=h/2)<1){return i/2*(f*f*(((g*=(1.525))+1)*f-g))+e;
}return i/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+e;
},bounceIn:function(f,e,h,g){return h-b.Easing.bounceOut(g-f,0,h,g)+e;
},bounceOut:function(f,e,h,g){if((f/=g)<(1/2.75)){return h*(7.5625*f*f)+e;
}else{if(f<(2/2.75)){return h*(7.5625*(f-=(1.5/2.75))*f+0.75)+e;
}else{if(f<(2.5/2.75)){return h*(7.5625*(f-=(2.25/2.75))*f+0.9375)+e;
}}}return h*(7.5625*(f-=(2.625/2.75))*f+0.984375)+e;
},bounceBoth:function(f,e,h,g){if(f<g/2){return b.Easing.bounceIn(f*2,0,h,g)*0.5+e;
}return b.Easing.bounceOut(f*2-g,0,h,g)*0.5+h*0.5+e;
}};
b.Easing=a;
},"3.4.1",{requires:["anim-base"]});
YUI.add("node-pluginhost",function(a){a.Node.plug=function(){var b=a.Array(arguments);
b.unshift(a.Node);
a.Plugin.Host.plug.apply(a.Base,b);
return a.Node;
};
a.Node.unplug=function(){var b=a.Array(arguments);
b.unshift(a.Node);
a.Plugin.Host.unplug.apply(a.Base,b);
return a.Node;
};
a.mix(a.Node,a.Plugin.Host,false,null,1);
a.NodeList.prototype.plug=function(){var b=arguments;
a.NodeList.each(this,function(c){a.Node.prototype.plug.apply(a.one(c),b);
});
};
a.NodeList.prototype.unplug=function(){var b=arguments;
a.NodeList.each(this,function(c){a.Node.prototype.unplug.apply(a.one(c),b);
});
};
},"3.4.1",{requires:["node-base","pluginhost"]});
YUI.add("anim-node-plugin",function(b){var a=function(c){c=(c)?b.merge(c):{};
c.node=c.host;
a.superclass.constructor.apply(this,arguments);
};
a.NAME="nodefx";
a.NS="fx";
b.extend(a,b.Anim);
b.namespace("Plugin");
b.Plugin.NodeFX=a;
},"3.4.1",{requires:["node-pluginhost","anim-base"]});
YUI.add("anim-scroll",function(b){var a=Number;
b.Anim.behaviors.scroll={set:function(f,g,i,j,k,e,h){var d=f._node,c=([h(k,a(i[0]),a(j[0])-a(i[0]),e),h(k,a(i[1]),a(j[1])-a(i[1]),e)]);
if(c[0]){d.set("scrollLeft",c[0]);
}if(c[1]){d.set("scrollTop",c[1]);
}},get:function(d){var c=d._node;
return[c.get("scrollLeft"),c.get("scrollTop")];
}};
},"3.4.1",{requires:["anim-base"]});
YUI.add("intl-base",function(b){var a=/[, ]/;
b.mix(b.namespace("Intl"),{lookupBestLang:function(g,h){var f,j,c,e;
function d(l){var k;
for(k=0;
k<h.length;
k+=1){if(l.toLowerCase()===h[k].toLowerCase()){return h[k];
}}}if(b.Lang.isString(g)){g=g.split(a);
}for(f=0;
f<g.length;
f+=1){j=g[f];
if(!j||j==="*"){continue;
}while(j.length>0){c=d(j);
if(c){return c;
}else{e=j.lastIndexOf("-");
if(e>=0){j=j.substring(0,e);
if(e>=2&&j.charAt(e-2)==="-"){j=j.substring(0,e-2);
}}else{break;
}}}}return"";
}});
},"3.4.1",{requires:["yui-base"]});
YUI.add("intl",function(d){var b={},a="yuiRootLang",e="yuiActiveLang",c=[];
d.mix(d.namespace("Intl"),{_mod:function(f){if(!b[f]){b[f]={};
}return b[f];
},setLang:function(g,j){var i=this._mod(g),f=i[e],h=!!i[j];
if(h&&j!==f){i[e]=j;
this.fire("intl:langChange",{module:g,prevVal:f,newVal:(j===a)?"":j});
}return h;
},getLang:function(f){var g=this._mod(f)[e];
return(g===a)?"":g;
},add:function(g,h,f){h=h||a;
this._mod(g)[h]=f;
this.setLang(g,h);
},get:function(h,g,j){var f=this._mod(h),i;
j=j||f[e];
i=f[j]||{};
return(g)?i[g]:d.merge(i);
},getAvailableLangs:function(h){var f=d.Env._loader,g=f&&f.moduleInfo[h],i=g&&g.lang;
return(i)?i.concat():c;
}});
d.augment(d.Intl,d.EventTarget);
d.Intl.publish("intl:langChange",{emitFacade:true});
},"3.4.1",{requires:["event-custom","intl-base"]});
YUI.add("datatype-number-parse",function(b){var a=b.Lang;
b.mix(b.namespace("DataType.Number"),{parse:function(d){var c=(d===null)?d:+d;
if(a.isNumber(c)){return c;
}else{return null;
}}});
b.namespace("Parsers").number=b.DataType.Number.parse;
},"3.4.1");
YUI.add("datatype-number-format",function(b){var a=b.Lang;
b.mix(b.namespace("DataType.Number"),{format:function(j,e){if(a.isNumber(j)){e=e||{};
var d=(j<0),f=j+"",n=e.decimalPlaces,c=e.decimalSeparator||".",m=e.thousandsSeparator,l,g,k,h;
if(a.isNumber(n)&&(n>=0)&&(n<=20)){f=j.toFixed(n);
}if(c!=="."){f=f.replace(".",c);
}if(m){l=f.lastIndexOf(c);
l=(l>-1)?l:f.length;
g=f.substring(l);
for(k=0,h=l;
h>0;
h--){if((k%3===0)&&(h!==l)&&(!d||(h>1))){g=m+g;
}g=f.charAt(h-1)+g;
k++;
}f=g;
}f=(e.prefix)?e.prefix+f:f;
f=(e.suffix)?f+e.suffix:f;
return f;
}else{return(a.isValue(j)&&j.toString)?j.toString():"";
}}});
},"3.4.1");
YUI.add("datatype-date-parse",function(b){var a=b.Lang;
b.mix(b.namespace("DataType.Date"),{parse:function(d){var c=null;
if(!(a.isDate(d))){c=new Date(d);
}else{return c;
}if(a.isDate(c)&&(c!="Invalid Date")&&!isNaN(c)){return c;
}else{return null;
}}});
b.namespace("Parsers").date=b.DataType.Date.parse;
},"3.4.1");
YUI.add("lang/datatype-date-format_en-US",function(b){b.Intl.add("datatype-date-format","en-US",{a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a, %b %d, %Y %l:%M:%S %p %Z",p:["AM","PM"],P:["am","pm"],x:"%m/%d/%y",X:"%l:%M:%S %p"});
},"3.4.1");
YUI.add("datatype-date-format",function(d){var a=function(e,g,f){if(typeof f==="undefined"){f=10;
}g=g.toString();
for(;
parseInt(e,10)<f&&f>1;
f/=10){e=g+e;
}return e.toString();
};
var c={formats:{a:function(f,e){return e.a[f.getDay()];
},A:function(f,e){return e.A[f.getDay()];
},b:function(f,e){return e.b[f.getMonth()];
},B:function(f,e){return e.B[f.getMonth()];
},C:function(e){return a(parseInt(e.getFullYear()/100,10),0);
},d:["getDate","0"],e:["getDate"," "],g:function(e){return a(parseInt(c.formats.G(e)%100,10),0);
},G:function(g){var h=g.getFullYear();
var f=parseInt(c.formats.V(g),10);
var e=parseInt(c.formats.W(g),10);
if(e>f){h++;
}else{if(e===0&&f>=52){h--;
}}return h;
},H:["getHours","0"],I:function(f){var e=f.getHours()%12;
return a(e===0?12:e,0);
},j:function(i){var h=new Date(""+i.getFullYear()+"/1/1 GMT");
var f=new Date(""+i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate()+" GMT");
var e=f-h;
var g=parseInt(e/60000/60/24,10)+1;
return a(g,0,100);
},k:["getHours"," "],l:function(f){var e=f.getHours()%12;
return a(e===0?12:e," ");
},m:function(e){return a(e.getMonth()+1,0);
},M:["getMinutes","0"],p:function(f,e){return e.p[f.getHours()>=12?1:0];
},P:function(f,e){return e.P[f.getHours()>=12?1:0];
},s:function(f,e){return parseInt(f.getTime()/1000,10);
},S:["getSeconds","0"],u:function(e){var f=e.getDay();
return f===0?7:f;
},U:function(h){var e=parseInt(c.formats.j(h),10);
var g=6-h.getDay();
var f=parseInt((e+g)/7,10);
return a(f,0);
},V:function(h){var g=parseInt(c.formats.W(h),10);
var e=(new Date(""+h.getFullYear()+"/1/1")).getDay();
var f=g+(e>4||e<=1?0:1);
if(f===53&&(new Date(""+h.getFullYear()+"/12/31")).getDay()<4){f=1;
}else{if(f===0){f=c.formats.V(new Date(""+(h.getFullYear()-1)+"/12/31"));
}}return a(f,0);
},w:"getDay",W:function(h){var e=parseInt(c.formats.j(h),10);
var g=7-c.formats.u(h);
var f=parseInt((e+g)/7,10);
return a(f,0,10);
},y:function(e){return a(e.getFullYear()%100,0);
},Y:"getFullYear",z:function(g){var f=g.getTimezoneOffset();
var e=a(parseInt(Math.abs(f/60),10),0);
var h=a(Math.abs(f%60),0);
return(f>0?"-":"+")+e+h;
},Z:function(e){var f=e.toString().replace(/^.*:\d\d( GMT[+-]\d+)? \(?([A-Za-z ]+)\)?\d*$/,"$2").replace(/[a-z ]/g,"");
if(f.length>4){f=c.formats.z(e);
}return f;
},"%":function(e){return"%";
}},aggregates:{c:"locale",D:"%m/%d/%y",F:"%Y-%m-%d",h:"%b",n:"\n",r:"%I:%M:%S %p",R:"%H:%M",t:"\t",T:"%H:%M:%S",x:"locale",X:"locale"},format:function(o,j){j=j||{};
if(!d.Lang.isDate(o)){return d.Lang.isValue(o)?o:"";
}var n,e,i,g,m;
n=j.format||d.config.dateFormat||"%Y-%m-%d";
i=d.Lang.isUndefined(d.config.lang)&&(d.Lang.isValue(j.locale)||d.Lang.isValue(d.config.locale));
if(i){g=j.locale||d.config.locale;
m=d.DataType.Date.Locale;
g=g.replace(/_/g,"-");
if(!m[g]){var h=g.replace(/-[a-zA-Z]+$/,"");
if(h in m){g=h;
}else{if(d.config.locale in m){g=d.config.locale;
}else{g="en";
}}}e=m[g];
}else{e=d.Intl.get("datatype-date-format");
}var k=function(q,p){if(i&&p==="r"){return e[p];
}var r=c.aggregates[p];
return(r==="locale"?e[p]:r);
};
var f=function(q,p){var r=c.formats[p];
switch(d.Lang.type(r)){case"string":return o[r]();
case"function":return r.call(o,o,e);
case"array":if(d.Lang.type(r[0])==="string"){return a(o[r[0]](),r[1]);
}default:return p;
}};
while(n.match(/%[cDFhnrRtTxX]/)){n=n.replace(/%([cDFhnrRtTxX])/g,k);
}var l=n.replace(/%([aAbBCdegGHIjklmMpPsSuUVwWyYzZ%])/g,f);
k=f=undefined;
return l;
}};
d.mix(d.namespace("DataType.Date"),c);
var b={a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a %d %b %Y %T %Z",p:["AM","PM"],P:["am","pm"],r:"%I:%M:%S %p",x:"%d/%m/%y",X:"%T"};
d.namespace("DataType.Date.Locale");
d.DataType.Date.Locale.en=b;
d.DataType.Date.Locale["en-US"]=d.merge(b,{c:"%a %d %b %Y %I:%M:%S %p %Z",x:"%m/%d/%Y",X:"%I:%M:%S %p"});
d.DataType.Date.Locale["en-GB"]=d.merge(b,{r:"%l:%M:%S %P %Z"});
d.DataType.Date.Locale["en-AU"]=d.merge(b);
},"3.4.1",{lang:["ar","ar-JO","ca","ca-ES","da","da-DK","de","de-AT","de-DE","el","el-GR","en","en-AU","en-CA","en-GB","en-IE","en-IN","en-JO","en-MY","en-NZ","en-PH","en-SG","en-US","es","es-AR","es-BO","es-CL","es-CO","es-EC","es-ES","es-MX","es-PE","es-PY","es-US","es-UY","es-VE","fi","fi-FI","fr","fr-BE","fr-CA","fr-FR","hi","hi-IN","id","id-ID","it","it-IT","ja","ja-JP","ko","ko-KR","ms","ms-MY","nb","nb-NO","nl","nl-BE","nl-NL","pl","pl-PL","pt","pt-BR","ro","ro-RO","ru","ru-RU","sv","sv-SE","th","th-TH","tr","tr-TR","vi","vi-VN","zh-Hans","zh-Hans-CN","zh-Hant","zh-Hant-HK","zh-Hant-TW"]});
YUI.add("datatype-xml-parse",function(b){var a=b.Lang;
b.mix(b.namespace("DataType.XML"),{parse:function(f){var d=null;
if(a.isString(f)){try{if(!a.isUndefined(ActiveXObject)){d=new ActiveXObject("Microsoft.XMLDOM");
d.async=false;
d.loadXML(f);
}}catch(c){try{if(!a.isUndefined(DOMParser)){d=new DOMParser().parseFromString(f,"text/xml");
}}catch(g){}}}if((a.isNull(d))||(a.isNull(d.documentElement))||(d.documentElement.nodeName==="parsererror")){}return d;
}});
b.namespace("Parsers").xml=b.DataType.XML.parse;
},"3.4.1");
YUI.add("datatype-xml-format",function(b){var a=b.Lang;
b.mix(b.namespace("DataType.XML"),{format:function(c){try{if(!a.isUndefined(XMLSerializer)){return(new XMLSerializer()).serializeToString(c);
}}catch(d){if(c&&c.xml){return c.xml;
}else{return(a.isValue(c)&&c.toString)?c.toString():"";
}}}});
},"3.4.1");
(function(){var b;
if(typeof IMO==="undefined"){IMO={};
}IMO.Constants=b={SSID_LENGTH:16,STATS_COOKIE:"stats",PROTO_AIM:"prpl-aim",PROTO_ICQ:"icq",PROTO_YAHOO:"prpl-yahoo",PROTO_MSN:"prpl-msn",PROTO_XMPP:"prpl-xmpp",PROTO_GTALK:"prpl-jabber",PROTO_SKYPE:"prpl-skype",PROTO_MYSPACE:"prpl-myspace",PROTO_FACEBOOK:"prpl-newfacebook",PROTO_NEWFACEBOOK:"prpl-newfacebook",PROTO_HYVES:"prpl-hyves",PROTO_VKONTAKTE:"prpl-vkontakte",PROTO_STEAM:"steam",PROTO_IMO_OLD:"prpl-imo",PROTO_IMO:"imo",PROTO_TO_UI:{"prpl-aim":"AIM",icq:"ICQ","prpl-yahoo":"Yahoo","prpl-msn":"MSN","prpl-xmpp":"Jabber","prpl-jabber":"Google Talk","prpl-skype":"Skype","prpl-myspace":"MySpace","prpl-facebook":"Facebook","prpl-newfacebook":"Facebook","prpl-hyves":"Hyves","prpl-vkontakte":"VKontakte",steam:"Steam",imo:"imo","group-chat":"imo Groups",twitter:"Twitter",linkedin:"LinkedIn",google2:"Google+"},PROTO_TO_OAUTH_PROTOCOL:{"prpl-jabber":"google2","prpl-msn":"msn","prpl-newfacebook":"facebook","prpl-yahoo":"yahoo"},OAUTH_PROTOCOL_TO_PROTO:{facebook:"prpl-newfacebook",google2:"prpl-jabber",msn:"prpl-msn",yahoo:"prpl-yahoo"},SOUND_NAME:{imo0:"Whistle",imo1:"Ding",imo2:"Buckle Up",imo3:"Bell",imo4:"Pop",imo5:"Electronic",imo6:"Strings",imo7:"Alien Invasion",imo8:"Hoot",imo9:"Marimba",imo10:"Xylophone",imo11:"Tiny Monster",imo12:"Jake's Beat"},PRIM_OFFLINE:"offline",PRIM_AWAY:"away",PRIM_BUSY:"busy",PRIM_AVAILABLE:"available",PRIM_INVISIBLE:"invisible",PRIM_MOBILE:"mobile",PRIM_PENDING:"pending",PRIM_UNKNOWN:"unknown",PRIMS_IN_MNP:["available","busy"],BID_STATE_PENDING:0,BID_STATE_DONE:1,BID_STATE_ERROR:2,BID_STATE_DOWNLOADING:3,UI_PREF_KIND:"reui",GROUPNAME_MEET:"Meet New People",MIN_WIDTH:775,MIN_HEIGHT:325,AD:"on https://imo.im",IM_STATE_ONLINE:1,IM_STATE_OFFLINE:2,IM_STATE_CONNECTING:4,IM_STATE_DISCONNECTING:8,IMO_HOST:"imo",FACEBOOK_APP_ID:(/imo.im/i.test(location.host)?"140061939345646":"143915628963949"),FACEBOOK_XD_URL:"https://"+location.host+"/facebook_xd_receiver_ssl.html",FACEBOOK_REDIRECT_URI:"https://"+location.host+"/facebook_auth_redirect.html",FACEBOOK_POPUP_OPTIONS:"width="+733+",height="+690+",location=no,status=no,menubar=no, toolbar=no,scrollbars=no, statusbar=no, resizable=yes, titlebar=no",FACEBOOK_JS_URL:"https://connect.facebook.net/en_US/all.js",STRIPE_PAYMENT_METHOD:"stripe",OAUTH_PIN_SIGNUP_CALLBACK:"pin_signup",OAUTH_PIN_LINK_CALLBACK:"pin_profile_link",OAUTH_PIN_POST_CALLBACK:"pin_post",OAUTH_PIN_FF_CALLBACK:"pin_ff",OAUTH_PIN_INVITE_CALLBACK:"pin_invite",OAUTH_LOGIN_CALLBACK:"oauth_login",OAUTH_GET_PHOTO_URL:"https://%s/s/oauth/get_photo?service=%s&ssid=%s&url=%s",RECAPTCHA_JS_URL:"https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",RECAPTCHA_PUBLIC_KEY:"6LfW7sASAAAAAI4Sb5rJrGNZgB9g0Nfde57hlfgi",DEFAULT_BICON:"assets/icn_default.png",DEFAULT_GROUP_BICON:"images/icn_default_group_edit.png",GROUP_TYPE:{DISCUSSION:"discussion",TEMP:"temp",IMOGROUP:"ImoGroup",DEFAULT:"default"},TIME:{MSECOND:1,MSECONDS:1,SECOND:1000,SECONDS:1000,MINUTE:60*1000,MINUTES:60*1000},TEXT:{},WINDOW_MANAGER:{TWM:"TWM",FWM:"FWM"},COUNTRIES_ARRAY:["Afghanistan","Albania","Algeria","Andorra","Angola","Antarctica","Antigua and Barbuda","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burma","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo, Democratic Republic","Congo, Republic of the","Costa Rica","Cote d'Ivoire","Croatia","Cuba","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","East Timor","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Greenland","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Korea, North","Korea, South","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Mongolia","Morocco","Monaco","Mozambique","Namibia","Nauru","Nepal","Netherlands","New Zealand","Nicaragua","Niger","Nigeria","Norway","Oman","Pakistan","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia","Rwanda","Samoa","San Marino"," Sao Tome","Saudi Arabia","Senegal","Serbia and Montenegro","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","Spain","Sri Lanka","Sudan","Suriname","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay","Uzbekistan","Vanuatu","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe"]};
if(/outkast.imo.im/i.test(location.host)){b.IMO_HOST="outkast";
}else{if(/imo.im/i.test(location.host)){b.IMO_HOST="imo";
}else{b.IMO_HOST="localhost";
}}b.PRIMS=[];
for(var a in b){if(b.hasOwnProperty(a)&&a.slice(0,5)==="PRIM_"){b.PRIMS.push(b[a]);
}}b.STRIPE_IFRAME_DOMAIN=(b.IMO_HOST=="imo"?"https://stripe.imo.im":"http://stripe.localhost:8000");
b.STRIPE_IFRAME_URL=b.STRIPE_IFRAME_DOMAIN+"/stripe_iframe"+(b.IMO_HOST=="imo"?"":"?dev");
}());
if(typeof IMO==="undefined"||!IMO){var IMO={};
}if(!window.console){window.console={};
}if(!console.log){console.log=function(){};
}IMO.DEBUG=false;
IMO.init=function(a){IMO.Stats.inittime=new Date();
IMO.Network.get().on_ssid(function(){IMO.Session.get();
IMO.ResizeManager.init();
IMO.BBS=new IMO.BlockedBuddyStats();
IMO.Recaptcha=null;
IMO.Session.get().init();
IMO.Stats.init();
IMO.AVManager.init();
if(window!==top){IMO.Stats.log_event("framed",{referrer:document.referrer||"none",location:document.location.href||"none"});
}Y.log("Load time: "+(IMO.Stats.inittime-IMO.Stats.basetime)+"ms");
if(a){a();
}});
};
var Y;
(function(){var b=IMO.Utils={};
try{document.execCommand("BackgroundImageCache",false,true);
}catch(c){}YUI.config.bootstrap=false;
Y=YUI().use("*");
Y.config.debug=false;
Y.mix(b,{args:function(d,f){var e=Array.prototype.slice.call(d,f||0);
return e;
},bookmark_page:function(e,d){if(Y.UA.gecko){window.sidebar.addPanel(e,d,"");
}else{if(Y.UA.ie){window.external.AddFavorite(d,e);
}}}});
b.can_bookmark_page=function(){return(Y.UA.gecko||Y.UA.ie)?true:false;
};
b.random_string=function(h){h=h||16;
var g=["ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz","0123456789"].join("");
var e=[];
for(var f=0;
f<IMO.Constants.SSID_LENGTH;
f++){var d=Math.floor(Math.random()*g.length);
e.push(g.substring(d,d+1));
}return e.join("");
};
var a=function(d){d=d.toString();
d=d.toLowerCase();
d=d.replace(/\s+/g,"");
return d;
};
b.normalize_buid=a;
b.string_compare=function(e,d){if(e===d){return 0;
}return e<d?-1:+1;
};
b.get_account_id=function(e,f,d){return[e,f,a(d)].join("#");
};
b.normalize_uid=function(d,e){d=a(d);
if(!d){return d;
}if(e===IMO.Constants.PROTO_MSN&&(d.indexOf("@")===-1)){d+="@hotmail.com";
}else{if(e===IMO.Constants.PROTO_GTALK&&(d.indexOf("@")===-1)){d+="@gmail.com";
}else{if(e===IMO.Constants.PROTO_YAHOO&&(d.indexOf("@yahoo.com")!==-1)){d=d.substring(0,d.indexOf("@"));
}}}return d;
};
b.SEARH_TOKEN_RE=/\s+|[\._@,!#\$%\^\?&\*\(\)\-\+=\|\[\]\\\/'":;><~`]+/g;
b.split_for_search=function(d){return(d||"").split(b.SEARH_TOKEN_RE);
};
b.remove_resource=function(e,f){var d=e;
if(f===IMO.Constants.PROTO_GTALK||f===IMO.Constants.PROTO_XMPP||f===IMO.Constants.PROTO_HYVES||f===IMO.Constants.PROTO_VKONTAKTE){var g=e.lastIndexOf("/");
if(g>=0){d=d.substring(0,g);
}}return d;
};
b.is_group_target=function(d){return d.lastIndexOf(";")!==-1;
};
b.is_group_member=function(e){var d=e.split(";");
return d.length===3;
};
b.groups_split=function(e,f){f=f||";";
var d=e.indexOf(f);
if(d===-1){d=e.length;
}return[e.substring(0,d),e.substring(d+1,e.length)];
};
b.get_buddy_icon_from_group=function(e,g,f,d){if(e+";"+g===d){return IMO.AccountManager.get().current_account_icon_url;
}else{var h=IMO.Session.get().get_account("im",e,g);
var i=h&&h.groups.get_group(f);
d=i&&i.buddies[b.create_ubid(e,g,f,d)];
return d?d.get_buddy_icon():IMO.Constants.DEFAULT_BICON;
}};
b.create_ubid=function(){var d=Array.prototype.slice.call(arguments);
var e=d.join("#");
e=e.replace(/[^a-zA-Z0-9_]/g,"_");
return e;
};
b.groups_shorten_buddy_name=function(f,i,h,g){var j=IMO.Session.get().get_account("im",f,i);
var k=j&&j.groups.get_group(h);
var e=k&&k.buddies[b.create_ubid(f,i,h,g)];
var d=e?e.displaylias:b.groups_split(g)[0];
return b.shorten_buddy_name(d);
};
b.log=function(){Y.log(b.sprintf.apply(null,arguments));
};
b.error=function(d){Y.log(d,"error");
if(IMO.DEBUG){console.traceback();
window.throw_an.error();
}};
b.MILLIS=1;
b.SECONDS=1000*b.MILLIS;
b.MINUTES=60*b.SECONDS;
b.HOURS=60*b.MINUTES;
b.DAYS=24*b.HOURS;
b.WEEKS=7*b.DAYS;
b.timestamp_to_delta=function(o,l){var g=new Date();
var d=g.valueOf();
var m=d-o;
if(typeof(l)!="undefined"&&m>l){return null;
}var k=[[b.WEEKS,"1 week ago","[WEEKS] weeks ago","WEEKS"],[b.DAYS,"1 day ago","[DAYS] days ago","DAYS"],[b.HOURS,"1 hour ago","[HOURS] hours ago","HOURS"],[b.MINUTES,"1 minute ago","[MINUTES] minutes ago","MINUTES"]];
var n="just now";
var j=1000;
var f={};
for(var h=0;
h<k.length;
h++){if(m>2*k[h][0]){var e=Math.floor(m/k[h][0]);
n=k[h][2];
f[k[h][3]]=e;
j=(e+1)*k[h][0]-m;
break;
}else{if(m>k[h][0]){n=k[h][1];
j=2*k[h][0]-m;
break;
}}}return{template:n,dict:f,next:j};
};
b.verify_email=function(f){var e=false;
var d=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;
if(f.search(d)===-1){e=false;
}else{e=true;
}return e;
};
b.uid_generator=function(d){this.prefix=d?d:"id";
this.next_id=0;
};
Y.mix(b.uid_generator.prototype,{next:function(){var d=this.prefix+this.next_id;
this.next_id++;
return d;
}});
b.imo_icon=function(e,d){d=b.dfl(d,"100x100");
return"imo/"+e+d;
};
b.goto_main_imo_page=function(){var d=document.location.protocol+"//"+document.location.host;
document.location=d;
};
b.get_all_cookies=function(){var e=document.cookie.split(";");
var d={};
b.foreach(e,function(f){f=f.trim();
if(f.indexOf("=")!=-1){var g=f.split("=");
d[g[0].trim()]=g[1].trim();
}});
return d;
};
b.set_cookie=function(f,g,h){var d;
if(h){var e=new Date();
e.setTime(e.getTime()+(h*24*60*60*1000));
d="; expires="+e.toGMTString();
}else{d="";
}document.cookie=f+"="+g+d;
};
b.get_cookie=function(d){var e=b.get_all_cookies();
return b.dfl(e[d],null);
};
if(typeof(String.prototype.trim)==="undefined"){String.prototype.trim=function(){var e=String(this);
e=e.replace(/^\s+/,"");
for(var d=e.length-1;
d>=0;
d--){if(/\S/.test(e.charAt(d))){e=e.substring(0,d+1);
break;
}}return e;
};
}b.imohash=function(f){var e=0;
for(var d=0;
d<f.length;
++d){e=(e+f.charCodeAt(d))&4294967295;
e=((e<<10)+e)&4294967295;
e^=(e>>6);
}e=((e<<3)+e)&4294967295;
e^=(e>>11);
e=((e<<15)+e)&4294967295;
return Math.abs(e);
};
b.array_difference=function(f,i){var e=[];
for(var d in f){var g=false;
for(var h in i){if(f[d]===i[h]){g=true;
}}if(!g){e.push(f[d]);
}}return e;
};
b.arrays_equal=function(e,f){if(e.length!==f.length){return false;
}for(var d=0;
d<e.length;
++d){if(e[d]!==f[d]){return false;
}}return true;
};
b.array_find=function(f,e){var d=-1;
b.foreach(f,function(h,g){if(h===e){d=g;
}},this);
return d;
};
b.preload_images=function(e){var f=new Image();
for(var d in e){f.src=e[d];
}};
b.refresh_page=function(f){var d=document.location.href;
var g;
if(f){g=document.location.href.split("?")[0];
var e=b.parse_query();
if(e.hasOwnProperty("t")){g+="?t="+e.t;
}}else{g=document.location.href.split("#")[0];
}if(d===g){document.location.reload();
}else{document.location.href=g;
}};
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(f){if(this===null){throw new TypeError();
}var g=Object(this);
var d=g.length>>>0;
if(d===0){return -1;
}var h=0;
if(arguments.length>0){h=Number(arguments[1]);
if((h)!=h){h=0;
}else{if(h!==0&&h!=Infinity&&h!=-Infinity){h=(h>0||-1)*Math.floor(Math.abs(h));
}}}if(h>=d){return -1;
}var e=h>=0?h:Math.max(d-Math.abs(h),0);
for(;
e<d;
e++){if(e in g&&g[e]===f){return e;
}}return -1;
};
}}());
if(!IMO.Utils){IMO.Utils={};
}(function(){IMO.Utils.sprintf=function(c){var a=Array.prototype.slice.call(arguments,1);
if(typeof c!=="string"){IMO.log("sprintf not called with a string as first argument","error");
return"";
}var b=null;
if(a[a.length-1]&&a[a.length-1] instanceof Object){b=a.pop();
}return c.replace(/(%((-?\d+)?(\.\d+)?)?([sdrf%])|(\[\w+\]))/g,function(v,t,q,h,g,k,u){var i,n;
try{var d="";
switch(k){case"%":d=k;
break;
case"s":d=a.shift();
break;
case"r":var o=a.shift();
switch(o){case undefined:d="undefined";
break;
case null:d="null";
break;
default:d=o.toString();
break;
}break;
case"d":d=Math.floor(a.shift());
break;
case"f":d=Number(a.shift());
if(g!==""){d=d.toFixed(Number(g.substr(1)));
}break;
default:if(u&&u.match(/\[\w+\]/)){d=b[u.substring(1,u.length-1)];
}break;
}d=(""+d);
if((h!==undefined)&&(h!=="")){i=Number(h)||0;
n=h[0]==="0"?"0":" ";
}while(d.length<Math.abs(i)){d=i>0?n+d:d+n;
}return d;
}catch(m){IMO.log(["sprint error",m]);
return v;
}});
};
}());
(function(){var a=IMO.Utils;
a.args=function(b,d){var c=Array.prototype.slice.call(b,d||0);
return c;
};
if(Object.create!==undefined){a.object_create=Object.create;
}else{a.object_create=function(b){var c=function(){};
c.prototype=b;
return new c();
};
}if(Function.prototype.bind!==undefined){a.bind=function(c,b){return c.bind(b);
};
}else{a.bind=function(c,b){return function(){c.apply(b,arguments);
};
};
}a.string_compare=function(d,c){if(d===c){return 0;
}return d<c?-1:+1;
};
a.foreach=function(h,g,e){e=e||null;
var b;
if(Y.Array.test(h)===0){for(var d in h){if(h.hasOwnProperty(d)){b=g.call(e,h[d],d);
if(b!==undefined){return b;
}}}}else{for(var c=0;
c<h.length;
++c){b=g.call(e,h[c],c);
if(b!==undefined){return b;
}}}return undefined;
};
a.size=function(b){if(Y.Array.test(b)===0){return Y.Object.values(b).length;
}else{return b.length;
}};
a.remove=function(d,c){if(!d){return false;
}var b=Y.Array.indexOf(d,c);
if(b===-1){return false;
}d.splice(b,1);
return true;
};
a.splice=function(b){var c=Array.prototype.slice.call(arguments,1);
b.splice.apply(b,c);
return b;
};
a.create_uid=(function(){var b=["ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz","0123456789"].join("");
return function(f){f=a.dfl(f,16);
var e=[];
for(var d=0;
d<f;
d++){var c=Math.floor(Math.random()*b.length);
e.push(b.substring(c,c+1));
}return e.join("");
};
}());
a.map=function(b,e,d){var c=[];
a.foreach(b,function(g,f){c.push(e.call(d,g,f));
},d);
return c;
};
a.filter=function(b,e,d){var c=[];
a.foreach(b,function(f){if(e.call(d,f)){c.push(f);
}},d);
return c;
};
a.parse_query=function(d){var h={};
try{var c=document.location.search.substring(1);
var g=document.location.hash.substring(1);
d=d||(c+"&"+g);
Y.log(["parse_query",d]);
var b=d.split("&");
a.foreach(b,function(j){if(!j){return;
}var e=j.replace(/%3[dD]/,"=").split("=");
if(e.length===0){return;
}if(e.length===1){e.push("");
}h[decodeURI(e.shift())]=decodeURI(e.join("="));
});
}catch(f){}return h;
};
a.shiftn=function(b,d){var c;
for(c=d;
c<b.length;
++c){b[c-d]=b[c];
}b.length=b.length-d;
};
a.min=function(b,c){return b<c?b:c;
};
a.max=function(b,c){return b>c?b:c;
};
a.prefix=function(d,c){return d.slice(0,c.length)===c;
};
a.suffix=function(d,c){return d.slice(d.length-c.length)===c;
};
a.cap=function(d,c,b){return d<c?c:d>b?b:d;
};
a.get_text_selection=function(){if(window.getSelection){return window.getSelection().toString();
}else{if(document.selection){return document.selection.createRange().text;
}else{Y.log("could not get selection","warn");
return"";
}}};
a.set_selection=function(c){a.clear_selection();
var b;
if(document.selection){b=document.body.createTextRange();
b.moveToElementText(document.getElementById(c));
b.select();
}else{if(window.getSelection){b=document.createRange();
b.selectNode(document.getElementById(c));
window.getSelection().addRange(b);
}}};
a.clear_selection=function(){var b;
if(window.getSelection){b=window.getSelection();
if(b.removeAllRanges){b.removeAllRanges();
return true;
}}if(document.selection){b=document.selection;
if(b.empty){b.empty();
return true;
}}return false;
};
a.dfl=function(c,b){return c===undefined?b:c;
};
a.is_space=function(b){return b.match(/^\s$/)!==null;
};
a.encodeURL=function(c){var b=[];
a.foreach(c,function(e,d){b.push([escape(d),escape(e)].join("="));
});
return b.join("&");
};
a.decodeURL=function(d){var f={};
var c=d.split("&");
for(var e=0;
e<c.length;
++e){var b=c[e].split("=");
f[unescape(b[0])]=unescape(b[1]);
}return f;
};
a.get_all_cookies=function(){var c=document.cookie.split(";");
var b={};
a.foreach(c,function(d){d=d.trim();
if(d.indexOf("=")!==-1){var e=d.split("=");
b[e[0].trim()]=e[1].trim();
}});
return b;
};
a.array_difference=function(c,d){var b=[];
a.foreach(c,function(e){var f=false;
for(var g in d){if(c[e]===d[g]){f=true;
}}if(!f){b.push(c[e]);
}});
return b;
};
a.arrays_equal=function(c,d){if(c.length!==d.length){return false;
}for(var b=0;
b<c.length;
++b){if(c[b]!==d[b]){return false;
}}return true;
};
a.array_find=function(d,c){var b=-1;
a.foreach(d,function(f,e){if(f===c){b=e;
}},this);
return b;
};
}());
if(!IMO.Utils){IMO.Utils={};
}(function(){var a=IMO.Utils;
a.vadd=function(){var b=[0,0];
a.foreach(arguments,function(c){b[0]+=c[0];
b[1]+=c[1];
});
return b;
};
a.vsub=function(d,c){return[d[0]-c[0],d[1]-c[1]];
};
a.vmul=function(d,c){return[d[0]*c[0],d[1]*c[1]];
};
a.vtimes=function(b,c){return[b[0]*c,b[1]*c];
};
a.vle=function(d,c){return d[0]<=c[0]&&d[1]<=c[1];
};
a.vcap=function(b,d,c){b[0]=IMO.Utils.cap(b[0],d[0],c[0]);
b[1]=IMO.Utils.cap(b[1],d[1],c[1]);
};
a.vdfl=function(d,c){return[!isNaN(d[0])&&d[0]||c[0],!isNaN(d[1])&&d[1]||c[1]];
};
a.vrnd=function(b){return[Math.floor(b[0]+0.5),Math.floor(b[1]+0.5)];
};
}());
(function(){var c=IMO.Utils;
c.HTML=function(i){return document.createTextNode(i);
};
var h=c.HTML;
h.counter=0;
h.dom=function(i){if(Y.Lang.isString(i)){i=document.getElementById(i);
}return i;
};
h.remove=function(i){i=h.dom(i);
if(i.parentNode){i.parentNode.removeChild(i);
}return i;
};
h.destroy_children=function(i){c.foreach(i.childNodes,function(n){h.destroy(n);
});
};
h.destroy=function(n){h.destroy_children(n);
if(n._imo_translate_id!==undefined){c.remove_translation(n._imo_translate_id);
}var i=new Y.Node(n);
i.purge();
i.destroy();
};
h.empty=function(o){o=h.dom(o);
h.destroy_children(o);
if(!Y.UA.ie){o.innerHTML="";
}else{var n=o.firstChild;
var i;
while(n!==null){i=n.nextSibling;
o.removeChild(n);
n=i;
}}return o;
};
h.replace_content=function(n){if(n===null||n===undefined){return;
}var i=Array.prototype.slice.call(arguments,1);
h.empty(n);
c.foreach(i,function(o){if(o){n.appendChild(o);
}});
};
h.show=function(n,i){i=i||"";
h.css(n,{display:i});
};
h.hide=function(i){h.css(i,{display:"none"});
};
h.chide=function(i){h.add_class(i,"hidden");
};
h.cshow=function(i){h.remove_class(i,"hidden");
};
h.visible=function(i){h.css(i,{visibility:"visible"});
};
h.invisible=function(i){h.css(i,{visibility:"hidden"});
};
h.add_class=function(n,i){if(n){Y.DOM.addClass(n,i);
}};
h.has_class=function(n,i){return n.className.match(new RegExp("(\\s|^)"+i+"(\\s|$)"));
};
h.remove_class=function(n,i){if(n){Y.DOM.removeClass(n,i);
}};
h.set_class=function(n,i){n.setAttribute("class",i);
};
h.toggle_class=function(o,i,n){n=(n===undefined)?(!h.has_class(o,i)):n;
h[n?"add_class":"remove_class"](o,i);
};
h.mex_class=function(o,i,n){c.foreach(n,function(p){h.remove_class(o,p);
});
h.add_class(o,i);
};
h.get_class_from=function(o,n){var i=c.foreach(n,function(p){if(Y.DOM.hasClass(o,p)){return p;
}});
return i;
};
h.get_elements_by_class=function(p,i){if(p.getElementsByClassName){return p.getElementsByClassName(i);
}var o=[];
var q=new RegExp("\\b"+i+"\\b");
var n=p.getElementsByTagName("*");
c.foreach(n,function(s){var r=s.className;
if(q.test(r)){o.push(s);
}});
return o;
};
h.has_scroll=function(i){return[i.scrollWidth>i.clientWidth,i.scrollHeight>i.clientHeight];
};
h.scroll_to_child=function(p,t){var o=Y.DOM.getXY(p);
var r=h.get_size(p);
var q=Y.DOM.getXY(t);
var n=h.get_size(t);
var s=q[1]-o[1]+n[1]-r[1];
if(s>0){p.scrollTop+=s;
q=Y.DOM.getXY(t);
}var i=q[1]-o[1];
if(i<0){p.scrollTop+=i;
q=Y.DOM.getXY(t);
}};
h.walk=function(p,o,i){p=h.dom(p);
do{if(!p){break;
}if(p===document){break;
}var n=o.call(i,p);
if(n!==undefined){return n;
}p=p.parentNode;
}while(1);
return false;
};
h.is_child=function(i,n){i=h.dom(i);
if(!i){return false;
}n=h.dom(n);
do{if(!n){return false;
}if(n===i){return true;
}n=n.parentNode;
}while(1);
return false;
};
h.cdiv=function(i){var n=Array.prototype.slice.call(arguments,1);
n.unshift({"class":i});
return h.div.apply(h,n);
};
h.idiv=function(n){var i=Array.prototype.slice.call(arguments,1);
i.unshift({id:n});
return h.div.apply(h,i);
};
h.imo_a=function(){var i=Array.prototype.slice.call(arguments,0);
i.unshift({href:"#"});
return h.a.apply(h,i);
};
h.iiframe=function(n){var i=Array.prototype.slice.call(arguments,1);
i.unshift({id:n});
return h.iframe.apply(h,i);
};
h.cspan=function(i){var n=Array.prototype.slice.call(arguments,1);
n.unshift({"class":i});
return h.span.apply(h,n);
};
h.sprite_size=function(i){i="sprite_"+i+"_";
return[IMO.Constants[i+"width"],IMO.Constants[i+"height"]];
};
h.sprite=function(n){var i=c.args(arguments,1);
i.unshift({"class":"sprite_"+n,src:"/images/blank.gif"});
return h.img.apply(this,i);
};
h.get_unique_id=function(){return this.counter+"";
};
var e=function(r){var i,o;
var q={};
var n={cls:"class"};
var p=function(s,t){return t.toUpperCase();
};
c.foreach(r,function(t,s){s=s.replace(/(?:-|_)(.)/g,p);
if(n.hasOwnProperty(s)){s=n[s];
}q[s]=t;
});
return q;
};
h.css=function(o,n){var i=e(n);
Y.DOM.setStyles(o,i);
if(i.hasOwnProperty("class")){o.className=i["class"];
}};
h.offsetAncestor=function(n,i){return c.vsub(c.vsub(Y.DOM.getXY(n),Y.DOM.getXY(i)),c.map([Y.DOM.getComputedStyle(i,"borderLeftWidth"),Y.DOM.getComputedStyle(i,"borderTopWidth")],function(o){return parseInt(o,10);
}));
};
h.get_size=function(i){return[i.offsetWidth,i.offsetHeight];
};
h.set_size=function(n,i){h.css(n,{width:i[0],height:i[1]});
};
h.get_rect=function(o,i){o=h.dom(o);
if(!i){return{x:o.offsetLeft,y:o.offsetTop,w:o.offsetWidth,h:o.offsetHeight};
}else{var n=h.offsetAncestor(o,h.dom(i));
return{x:n[0],y:n[1],w:o.offsetWidth,h:o.offsetHeight};
}};
h.get_off=function(i){return[i.offsetLeft,i.offsetTop];
};
h.set_off=function(n,i){h.css(n,{left:(i[0]+"px"),top:(i[1]+"px")});
};
h.wait=function(n){var i=n.offsetWidth;
};
h.valign_middle=function(n,i){h.css(n,{top:"50%",margin_top:c.sprintf("-%dpx",i/2)});
};
h.measure=function(o,n){h.add_class(o,"measure");
n.appendChild(o);
var i=[o.offsetWidth,o.offsetHeight];
n.removeChild(o);
h.remove_class(o,"measure");
return i;
};
h.text=function(n,i){h.empty(n);
n.appendChild(h(i));
return n;
};
h.ellipsis=function(s,u,n,w){var A="\u2026";
if(w){A=w;
}var v=parseInt(Y.DOM.getAttribute(s,"data-max-lines"),10);
var z=s.textContent||s.innerText;
s.removeChild(s.firstChild);
var y=h.measure(h.span("sample"),s)[1];
var x=v*y;
var i=h.measure(h.span(z),s)[1];
var t=Math.round(i/y);
var q=z.length;
var r=q;
var o=q;
var B=z;
var p=true;
if(i>x){while(o>1){o=Math.floor(o/2);
q+=i>x?-o:o;
i=h.measure(h.span(z.slice(0,q-A.length)+A),s)[1];
}r=q-A.length-3;
B=z;
}else{p=false;
Y.DOM.setAttribute(s,"data-lines",t);
}if(u){s.appendChild(c.linkify_string(B,n,r));
}else{s.appendChild(h.span(B));
}if(p&&w){s.appendChild(h.a(A,{onclick:function(C){C.stopImmediatePropagation();
h.empty(s);
s.appendChild(c.linkify_string(z,n));
}}));
}};
h.focus=function(n){try{n.focus();
}catch(i){Y.log(["unable to focus",n],"error");
}};
var b=function(n){try{return(n instanceof Node);
}catch(i){return n&&n.nodeType;
}};
var m=["div","span","p","img","a","br","h1","h2","h3","h4","h5","hr","table","tr","td","th","strong","em","input","form","textarea","select","option","canvas","audio","video","ul","ol","li","button","wbr","link","tbody","label","iframe","param","embed","object","source"];
var j=function(i,n,o){this.key=i;
this.fn=n;
this.dom=o;
};
j.prototype.detach=function(){var i=this.key,n=this.fn,o=this.dom;
if(o.removeEventListener){o.removeEventListener(i,n,false);
}else{o.detachEvent("on"+i,n);
}};
var k=function(i){this.list=i;
};
k.prototype.detach=function(){var o=this.list;
for(var n=0;
n<o.length;
n++){o[n].detach();
}};
var d=function(i){this.yev=i;
};
d.prototype.detach=function(){Y.detach(this.yev);
};
var a={cbchange:function(o,p,q,n,i){if(Y.UA.ie){return new k([h.onlist("click",p,q,n,i),h.onlist("keypress",p,q,n,i)]);
}else{return h.onlist("change",p,q,n,i);
}},key:function(o,p,r,n,i){var q=[o,p,r,n].concat(i);
return new d(Y.on.apply(Y,q));
}};
if(!Y.UA.ie){a.mouseenter=function(o,p,r,n,i){function q(s){if(s.target===r){p.call.apply(this,arguments);
}}return h.onlist("mouseover",p,r,n,i);
};
a.mouseleave=function(o,p,r,n,i){function q(s){if(s.target===r){p.call.apply(this,arguments);
}}return h.onlist("mouseout",p,r,n,i);
};
}h.onlist=function(o,p,r,n,i){var q=function(t){var s=Y.Event.getEvent(t,r);
p.apply(n,[s].concat(i));
};
if(o in a){return a[o](o,p,r,n,i);
}if(r.addEventListener){r.addEventListener(o,q,false);
}else{r.attachEvent("on"+o,q);
}return new j(o,q,r);
};
h.on=function(n,o,p,i){if(!p.attachEvent&&!p.addEventListener){i=p;
p=window;
return h.onlist(n,o,p,i,Array.prototype.slice.call(arguments,3));
}else{return h.onlist(n,o,p,i,Array.prototype.slice.call(arguments,4));
}};
h.detach=function(i){i.detach();
};
var g=function(i){return function(){var r=document.createElement(i);
var p=r;
h.counter++;
var o=function(v){var u,t;
if(b(v)){r.appendChild(v);
}else{if(typeof v==="string"){r.appendChild(document.createTextNode(v));
}else{if(v instanceof Array){for(u=0;
u<v.length;
u++){o(v[u]);
}}else{if(v===null||v===undefined){}else{if((typeof v==="object")&&v.hasOwnProperty("context")){p=v.context;
}for(t in v){if(!v.hasOwnProperty(t)){continue;
}var x=v[t];
if(t==="context"){continue;
}else{if(t==="class"||t==="cls"){if(!x){continue;
}r.className+=" "+x;
}else{if(t==="style"){Y.DOM.setStyles(r,e(x));
}else{if(t.slice(0,2)==="on"){var w=x,s=[];
if(typeof x!=="function"){w=x.func;
s=x.args;
}h.onlist(t.slice(2),w,r,p,s);
}else{Y.DOM.setAttribute(r,t,x);
}}}}}}}}}};
for(var n=0;
n<arguments.length;
n++){var q=arguments[n];
o(q);
}return r;
};
};
for(var f=0;
f<m.length;
f++){var l=m[f];
h[l]=g(l);
}}());
(function(){var j=30*1000;
var f=3*1000;
var m=IMO.Utils.HTML;
var g=IMO.Utils;
IMO.Translate={};
IMO.Translate.language={from:"en-US",to:"en-US",list:[],data:{}};
IMO.Translate.Platform={WEB:1,ANDROID:2,BLACKBERRY:4,IPHONE:8,IPAD:16,ALL:31};
IMO.Translate.StringDiscoverer=function(){this.discovered_strings={};
this.pending_strings=[];
this.timer=undefined;
};
Y.mix(IMO.Translate.StringDiscoverer.prototype,{flush:function(){this.timer=null;
if(this.pending_strings.length===0){return;
}var n={strings:this.pending_strings.slice(),lang:IMO.Translate.language.from,hostname:window.location.hostname};
Y.log(["Translate strings",n]);
this.pending_strings=[];
IMO.Translate.backend_call("discover_strings",n,{start:function(){Y.log("Flushing strings...");
}});
},discover:function(o,n){if(window.location.hostname!=="test.imo.im"&&window.location.hostname!=="localhost"&&window.location.hostname!=="facebooktest.com"){return;
}if(!n){n="";
}if(!this.discovered_strings[o]){this.discovered_strings[o]={};
}if(!this.discovered_strings[o][n]){this.discovered_strings[o][n]=true;
this.pending_strings.push({value:o,context:n});
if(!this.timer){this.timer=Y.later(f,this,this.flush,null,false);
}}}});
var h=0;
var d={};
IMO._translate_map=d;
var c={};
var a={};
var b=new IMO.Translate.StringDiscoverer();
IMO._sd=b;
IMO.Translate.backend_call=function(s,q,n){var r=["method="+encodeURIComponent(s),"data="+encodeURIComponent(Y.JSON.stringify(q))].join("&");
if(!n){n={};
}var p={start:n.start,complete:n.complete,success:function(v,u){if(n.success){var t=Y.JSON.parse(u.responseText);
n.success(t);
}},failure:function(){Y.log("Call to "+s+" failed!");
if(n.failure){n.failure();
}},end:n.end};
var o=Y.io("/s/translate/",{method:"POST",data:r,on:p,context:this,timeout:j});
};
IMO.Translate.suggested_languages=function(n,q,o){var p={number:(o?o:3)};
IMO.Translate.backend_call("suggest_languages",p,{success:function(r){q.call(n,r);
}});
};
IMO.Translate.get_languages=function(n,o){IMO.Translate.backend_call("get_languages",{},{success:function(p){IMO.Translate.language.list=[];
IMO.Translate.language.data={};
g.foreach(p,function(t){var r=t.name,q=t["native"];
var s={name:r,orig:q,complete:t.complete*100};
IMO.Translate.language.list.push(t.code);
IMO.Translate.language.data[t.code]=s;
},this);
o.call(n);
}});
};
IMO.Translate.get_strings=function(o){var n=this;
if(o===undefined){o=IMO.Translate.Platform.ALL;
}var p={lang_from:IMO.Translate.language.from,lang_to:IMO.Translate.language.to,tags:o};
if(p.lang_from===p.lang_to){a={};
IMO.Translate.apply_translation();
return;
}IMO.Translate.backend_call("get_strings",p,{success:function(q){a={};
n.filter=o;
g.foreach(q,function(s){var r=s.finalized;
if(r===""){r=s.voted;
}if(r===""){r=s.value;
}if(!a[s.value]){a[s.value]={};
}a[s.value][s.context]=r;
},this);
IMO.Translate.apply_translation();
}});
};
var e=function(o,n){b.discover(o,n);
if(o in a){if(n in a[o]){return a[o][n];
}}return o;
};
var k=function(n){while(n.hasChildNodes()){n.removeChild(n.firstChild);
}};
var i=function(){var n=document.createElement("span");
n.className="translation_span";
return n;
};
var l=function(o,p){if(!p){p={};
}var n=i();
if(!o){return n;
}IMO.Translate.update_dom(n,o,p);
return n;
};
IMO.Translate.update_dom=function(r,x,q){k(r);
var v=0,w=x.concat("[");
for(var u=0;
u<w.length;
++u){var n=w.charAt(u);
if(n!=="["&&n!=="]"){continue;
}var s=w.substr(v,u-v);
if(s!==""){var p=(n==="["?s:q[s]);
if(p===undefined){p="["+s+"]";
}var o="";
if(typeof(p)!=="object"){o=document.createTextNode(p);
}else{o=p;
}r.appendChild(o);
}v=u+1;
}};
IMO.Translate.sprintf=function(p,r){var n=""+p;
for(var o in r){var q=new RegExp("\\["+o+"\\]","g");
n=n.replace(q,r[o]);
}return n;
};
IMO.Translate.apply_translation=function(){g.foreach(d,function(r){var q=e(r.str,r.context);
IMO.Translate.update_dom(r.dom,q,r.dict);
},this);
for(var o in c){for(var n in c[o]){var p=c[o][n];
p.callback.apply(p.context,p.params);
}}};
IMO.Utils.remove_translation=function(n){if(!d[n]){Y.log(["no translation with id",n],"error");
return;
}try{delete d[n].dom._imo_translate_id;
}catch(o){}delete d[n];
};
IMO.Utils.TranslateDom=function(p,r,o){o=(o!==undefined?o:"");
r=(r!==undefined?r:{});
var n=e(p,o);
var q=l(n,r);
q._imo_translate_id=h;
d[h]={str:p,dom:q,dict:r,context:o};
h++;
return q;
};
IMO.Utils.TranslateTxt=function(q,v,n,p,u,r){n=(n!==undefined?n:"");
v=(v!==undefined?v:{});
if(p&&u){if(!c[q]){c[q]={};
}c[q][n]={context:p,callback:u,params:r};
}var o=e(q,n);
return IMO.Translate.sprintf(o,v);
};
}());
(function(){var d=IMO.Constants;
var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
if(!IMO.UIWidgets){IMO.UIWidgets={};
}IMO.UIWidgets.Button=function(n,f){var e=a.dfl(n.truncate_left,false);
var g=n.color||"default";
var m=n.button_size?("_"+n.button_size):"";
var h=Array.prototype.slice.call(arguments,2);
var k=c.div(f,c.span(h),{cls:"button2",style:{visibility:"hidden",position:"absolute",top:"-10000px"}});
document.body.appendChild(k);
var l=k.clientWidth;
document.body.removeChild(k);
c.destroy(k);
l=a.cap(l,55,200);
var j=10;
var i=l+(e?1:2)*j;
this.enabled=true;
this.can_hover=true;
this.btn="btn2_"+g+m;
this.left_sprite="sprite_"+this.btn+"_left";
this.left_disabled_sprite="sprite_btn2_disabled"+m+"_left";
this.right_sprite="sprite_"+this.btn+"_right";
this.right_disabled_sprite="sprite_btn2_disabled"+m+"_right";
IMO.REUI.Button.sizes.unshift(i);
if(IMO.REUI.Button.sizes.length>10){IMO.REUI.Button.sizes.pop();
}this.dom=c.div({cls:"button2 "+g,style:{width:(i)+"px",lineHeight:d[this.left_sprite+"_height"]+"px"},onmouseenter:function(){this.mouse_enter();
},onmouseleave:function(){this.mouse_leave();
},context:this},c.div({cls:"button-right",style:{width:(l+j)+"px"}},this.right=c.cdiv(this.right_sprite+" button-right")),this.left=c.cdiv(this.left_sprite+" button-left"),f,this.inner_span=c.span(h));
if(e){c.replace_content(this.left,c.div());
}this.hovering=false;
return this;
};
Y.mix(IMO.UIWidgets.Button.prototype,{mouse_enter:function(){if(!this.can_hover){return;
}if(this.hovering){return;
}this.hovering=true;
c.remove_class(this.right,this.right_sprite);
c.add_class(this.right,this.right_sprite+"_hover");
c.remove_class(this.left,this.left_sprite);
c.add_class(this.left,this.left_sprite+"_hover");
},mouse_leave:function(){if(!this.can_hover){return;
}if(!this.hovering){return;
}this.hovering=false;
c.remove_class(this.right,this.right_sprite+"_hover");
c.add_class(this.right,this.right_sprite);
c.remove_class(this.left,this.left_sprite+"_hover");
c.add_class(this.left,this.left_sprite);
},set_enabled:function(e){var f=this.hovering;
if(f){this.mouse_leave();
}this.enabled=e;
if(e){c.mex_class(this.left,this.left_sprite,[this.left_sprite,this.left_disabled_sprite]);
c.mex_class(this.right,this.right_sprite,[this.right_sprite,this.right_disabled_sprite]);
c.remove_class(this.inner_span,"disabled");
this.can_hover=true;
}else{c.mex_class(this.left,this.left_disabled_sprite,[this.left_sprite,this.left_disabled_sprite]);
c.mex_class(this.right,this.right_disabled_sprite,[this.right_sprite,this.right_disabled_sprite]);
c.add_class(this.inner_span,"disabled");
this.can_hover=false;
}if(f){this.mouse_enter();
}},destroy:function(){c.destroy(this.dom);
delete this.dom;
}});
IMO.UIWidgets.Button2=function(g,f){this.options=a.dfl(f,{});
this.style=a.dfl(f.style,"");
var e=a.args(arguments,2);
this.enabled=true;
if(typeof g==="string"){g=b(g);
}this.dom=c.a({href:"#",cls:"btn_norm "+this.style,onclick:this.onclick,context:this},g,e);
};
Y.mix(IMO.UIWidgets.Button2.prototype,{enable:function(){this.enabled=true;
c.remove_class(this.dom,"disabled");
},disable:function(){this.enabled=false;
c.add_class(this.dom,"disabled");
},onclick:function(){if(!this.enabled){return;
}if(this.options.onclick){this.options.onclick.call(this.options.context);
}},destroy:function(){c.destroy(this.dom);
}});
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.UIWidgets.DropDown=function(e,d){this.config=e;
var c=a.args(arguments,2);
this.optins=d;
var f=0;
var g=a.map(d,function(i){var h=f;
f++;
return b.div({cls:"option",context:this,onclick:function(j){this.select(h,j);
}},i);
},this);
this.dom=b.span({cls:"dropdown",onclick:function(h){IMO.MouseManager.get().handled(h,"dropdown");
this.toggle();
},context:this},this.main=b.span({cls:"main"}),this.arrow=b.sprite("icn_arrdown_s",{cls:"arrow"}),b.div({cls:"options-container"},this.options=b.div({cls:"options shadow"},g)),c);
IMO.MouseManager.get().register(this.on_mouse,this);
this.visible=false;
b.hide(this.options);
this.select(0);
};
Y.mix(IMO.UIWidgets.DropDown.prototype,{on_mouse:function(){if(!IMO.MouseManager.get().check_handled("dropdown")){this.close();
}},open:function(){b.show(this.options);
this.visible=true;
},close:function(){b.hide(this.options);
this.visible=false;
},toggle:function(){if(this.visible){this.close();
}else{this.open();
}},set_main:function(c){b.replace_content(this.main,c);
},select:function(c,f){var d;
if(this.config.onchange){d=this.config.onchange.call(this.config.context,c);
}if(d===false){IMO.MouseManager.get().handled(f,"dropdown");
if(f){f.stopPropagation();
}}},destroy:function(){IMO.MouseManager.get().unregister(this.on_mouse,this);
}});
}());
IMO.SharedConstants={BuddyGroups:{BUDDIES:"Buddies",IMO_CONTACTS:"Imo Contacts"},ImoProfile:{genders:["Prefer not to say","Female","Male"],max_value_length:10000,value_for_removal:["delete","me","please"]},Preferences:{ALLOW_NON_BUDDIES:"allowNonBuddies",ALLOW_NON_IMO_CONTACTS:"allowNonImoContacts",AUTO_VOICE_IM:"auto_voice_im",COLLAPSE_ACCOUNTS:"collapse_accounts",COLLAPSE_MNP:"collapse_MNP",DESKTOP_NOTIFICATIONS:"desktop_notifications",LANG_SELECTED:"LanguageSelected",MOBILE_MUTE:"mobile_mute",MUTE:"mute",NO_EMOTICONS:"noEmoticons",SAVE_HISTORY:"saveHistory",SHOW_BUDDY_ICONS:"show_buddy_icons",SHOW_PRIMITIVE_TO_NON_CONTACTS:"showPrimitiveToNonContacts",SLEEP_MODE:"sleep_mode"},PremiumAccount:{ALLOW_NON_BUDDIES:"allowNonBuddies",ALLOW_NON_IMO_CONTACTS:"allowNonImoContacts",AUTO_VOICE_IM:"auto_voice_im",COLLAPSE_ACCOUNTS:"collapse_accounts",COLLAPSE_MNP:"collapse_MNP",DESKTOP_NOTIFICATIONS:"desktop_notifications",MOBILE_MUTE:"mobile_mute",MUTE:"mute",NO_EMOTICONS:"noEmoticons",SAVE_HISTORY:"saveHistory",SHOW_BUDDY_ICONS:"show_buddy_icons",SHOW_PRIMITIVE_TO_NON_CONTACTS:"showPrimitiveToNonContacts",SLEEP_MODE:"sleep_mode"}};
Y.mix(IMO.Constants,{sprite_press_usatoday_width:190,sprite_press_usatoday_height:35,sprite_press_usatoday_x:0,sprite_press_usatoday_y:0,sprite_press_usatoday_url:"/assets/press.5a44f1.png",sprite_press_digitaltrends_width:200,sprite_press_digitaltrends_height:38,sprite_press_digitaltrends_x:0,sprite_press_digitaltrends_y:35,sprite_press_digitaltrends_url:"/assets/press.5a44f1.png",sprite_press_bloombergtv_width:200,sprite_press_bloombergtv_height:41,sprite_press_bloombergtv_x:0,sprite_press_bloombergtv_y:73,sprite_press_bloombergtv_url:"/assets/press.5a44f1.png",sprite_press_maclife_width:180,sprite_press_maclife_height:41,sprite_press_maclife_x:0,sprite_press_maclife_y:114,sprite_press_maclife_url:"/assets/press.5a44f1.png",sprite_press_forbes_width:200,sprite_press_forbes_height:50,sprite_press_forbes_x:0,sprite_press_forbes_y:155,sprite_press_forbes_url:"/assets/press.5a44f1.png",sprite_press_allthingsd_width:216,sprite_press_allthingsd_height:52,sprite_press_allthingsd_x:0,sprite_press_allthingsd_y:205,sprite_press_allthingsd_url:"/assets/press.5a44f1.png",sprite_press_venturebeat_width:80,sprite_press_venturebeat_height:58,sprite_press_venturebeat_x:0,sprite_press_venturebeat_y:257,sprite_press_venturebeat_url:"/assets/press.5a44f1.png",sprite_press_fastcompany_width:200,sprite_press_fastcompany_height:60,sprite_press_fastcompany_x:0,sprite_press_fastcompany_y:315,sprite_press_fastcompany_url:"/assets/press.5a44f1.png",sprite_press_geeksugar_width:200,sprite_press_geeksugar_height:60,sprite_press_geeksugar_x:0,sprite_press_geeksugar_y:375,sprite_press_geeksugar_url:"/assets/press.5a44f1.png",sprite_press_gizmodo_width:200,sprite_press_gizmodo_height:60,sprite_press_gizmodo_x:0,sprite_press_gizmodo_y:435,sprite_press_gizmodo_url:"/assets/press.5a44f1.png",sprite_press_lifehacker_width:200,sprite_press_lifehacker_height:60,sprite_press_lifehacker_x:0,sprite_press_lifehacker_y:495,sprite_press_lifehacker_url:"/assets/press.5a44f1.png",sprite_press_makeuseof_width:200,sprite_press_makeuseof_height:60,sprite_press_makeuseof_x:0,sprite_press_makeuseof_y:555,sprite_press_makeuseof_url:"/assets/press.5a44f1.png",sprite_press_pcmag_width:200,sprite_press_pcmag_height:60,sprite_press_pcmag_x:0,sprite_press_pcmag_y:615,sprite_press_pcmag_url:"/assets/press.5a44f1.png",sprite_press_pcworld_width:200,sprite_press_pcworld_height:60,sprite_press_pcworld_x:0,sprite_press_pcworld_y:675,sprite_press_pcworld_url:"/assets/press.5a44f1.png",sprite_press_techcrunch_width:200,sprite_press_techcrunch_height:60,sprite_press_techcrunch_x:0,sprite_press_techcrunch_y:735,sprite_press_techcrunch_url:"/assets/press.5a44f1.png",sprite_press_washingtonpost_width:200,sprite_press_washingtonpost_height:60,sprite_press_washingtonpost_x:0,sprite_press_washingtonpost_y:795,sprite_press_washingtonpost_url:"/assets/press.5a44f1.png",sprite_press_wired_width:200,sprite_press_wired_height:60,sprite_press_wired_x:0,sprite_press_wired_y:855,sprite_press_wired_url:"/assets/press.5a44f1.png",sprite_press_time_width:177,sprite_press_time_height:67,sprite_press_time_x:0,sprite_press_time_y:915,sprite_press_time_url:"/assets/press.5a44f1.png",sprite_press_businessinsider_width:170,sprite_press_businessinsider_height:77,sprite_press_businessinsider_x:0,sprite_press_businessinsider_y:982,sprite_press_businessinsider_url:"/assets/press.5a44f1.png",sprite_press_coolmomtech_width:200,sprite_press_coolmomtech_height:100,sprite_press_coolmomtech_x:0,sprite_press_coolmomtech_y:1059,sprite_press_coolmomtech_url:"/assets/press.5a44f1.png",sprite_polaroid_background_width:171,sprite_polaroid_background_height:150,sprite_polaroid_background_x:0,sprite_polaroid_background_y:0,sprite_polaroid_background_url:"/assets/polaroid.2f75bc.png",sprite_superwide_grey_bar_width:2148,sprite_superwide_grey_bar_height:24,sprite_superwide_grey_bar_x:0,sprite_superwide_grey_bar_y:0,sprite_superwide_grey_bar_url:"/assets/chathistory.f55e5a.png",sprite_icn_comments_width:10,sprite_icn_comments_height:10,sprite_icn_comments_x:0,sprite_icn_comments_y:0,sprite_icn_comments_url:"/assets/photo.d56918.png",sprite_icn_album_width:20,sprite_icn_album_height:20,sprite_icn_album_x:10,sprite_icn_album_y:0,sprite_icn_album_url:"/assets/photo.d56918.png",sprite_icn_album_hover_width:20,sprite_icn_album_hover_height:20,sprite_icn_album_hover_x:0,sprite_icn_album_hover_y:20,sprite_icn_album_hover_url:"/assets/photo.d56918.png",sprite_icn_arr_left_width:20,sprite_icn_arr_left_height:20,sprite_icn_arr_left_x:20,sprite_icn_arr_left_y:20,sprite_icn_arr_left_url:"/assets/photo.d56918.png",sprite_icn_arr_left_hover_width:20,sprite_icn_arr_left_hover_height:20,sprite_icn_arr_left_hover_x:0,sprite_icn_arr_left_hover_y:40,sprite_icn_arr_left_hover_url:"/assets/photo.d56918.png",sprite_icn_arr_right_width:20,sprite_icn_arr_right_height:20,sprite_icn_arr_right_x:20,sprite_icn_arr_right_y:40,sprite_icn_arr_right_url:"/assets/photo.d56918.png",sprite_icn_arr_right_hover_width:20,sprite_icn_arr_right_hover_height:20,sprite_icn_arr_right_hover_x:0,sprite_icn_arr_right_hover_y:60,sprite_icn_arr_right_hover_url:"/assets/photo.d56918.png",sprite_icn_checkbox_width:20,sprite_icn_checkbox_height:20,sprite_icn_checkbox_x:20,sprite_icn_checkbox_y:60,sprite_icn_checkbox_url:"/assets/photo.d56918.png",sprite_icn_checkbox_yes_width:20,sprite_icn_checkbox_yes_height:20,sprite_icn_checkbox_yes_x:0,sprite_icn_checkbox_yes_y:80,sprite_icn_checkbox_yes_url:"/assets/photo.d56918.png",sprite_icn_empty_width:20,sprite_icn_empty_height:20,sprite_icn_empty_x:20,sprite_icn_empty_y:80,sprite_icn_empty_url:"/assets/photo.d56918.png",sprite_icn_fail_width:20,sprite_icn_fail_height:20,sprite_icn_fail_x:0,sprite_icn_fail_y:100,sprite_icn_fail_url:"/assets/photo.d56918.png",sprite_icn_ok_width:20,sprite_icn_ok_height:20,sprite_icn_ok_x:20,sprite_icn_ok_y:100,sprite_icn_ok_url:"/assets/photo.d56918.png",sprite_icn_ph_close_width:20,sprite_icn_ph_close_height:20,sprite_icn_ph_close_x:0,sprite_icn_ph_close_y:120,sprite_icn_ph_close_url:"/assets/photo.d56918.png",sprite_icn_ph_close_hover_width:20,sprite_icn_ph_close_hover_height:20,sprite_icn_ph_close_hover_x:20,sprite_icn_ph_close_hover_y:120,sprite_icn_ph_close_hover_url:"/assets/photo.d56918.png",sprite_icn_ph_trash_width:20,sprite_icn_ph_trash_height:20,sprite_icn_ph_trash_x:0,sprite_icn_ph_trash_y:140,sprite_icn_ph_trash_url:"/assets/photo.d56918.png",sprite_icn_ph_trash_hover_width:20,sprite_icn_ph_trash_hover_height:20,sprite_icn_ph_trash_hover_x:20,sprite_icn_ph_trash_hover_y:140,sprite_icn_ph_trash_hover_url:"/assets/photo.d56918.png",sprite_icn_toggle_width:20,sprite_icn_toggle_height:20,sprite_icn_toggle_x:0,sprite_icn_toggle_y:160,sprite_icn_toggle_url:"/assets/photo.d56918.png",sprite_icn_toggle_hover_width:20,sprite_icn_toggle_hover_height:20,sprite_icn_toggle_hover_x:20,sprite_icn_toggle_hover_y:160,sprite_icn_toggle_hover_url:"/assets/photo.d56918.png",sprite_icn_upload_width:20,sprite_icn_upload_height:20,sprite_icn_upload_x:0,sprite_icn_upload_y:180,sprite_icn_upload_url:"/assets/photo.d56918.png",sprite_icn_upload_hover_width:20,sprite_icn_upload_hover_height:20,sprite_icn_upload_hover_x:20,sprite_icn_upload_hover_y:180,sprite_icn_upload_hover_url:"/assets/photo.d56918.png",sprite_btn_slide_left_width:45,sprite_btn_slide_left_height:80,sprite_btn_slide_left_x:0,sprite_btn_slide_left_y:200,sprite_btn_slide_left_url:"/assets/photo.d56918.png",sprite_btn_slide_left_hover_width:45,sprite_btn_slide_left_hover_height:80,sprite_btn_slide_left_hover_x:0,sprite_btn_slide_left_hover_y:280,sprite_btn_slide_left_hover_url:"/assets/photo.d56918.png",sprite_btn_slide_right_width:45,sprite_btn_slide_right_height:80,sprite_btn_slide_right_x:0,sprite_btn_slide_right_y:360,sprite_btn_slide_right_url:"/assets/photo.d56918.png",sprite_btn_slide_right_hover_width:45,sprite_btn_slide_right_hover_height:80,sprite_btn_slide_right_hover_x:0,sprite_btn_slide_right_hover_y:440,sprite_btn_slide_right_hover_url:"/assets/photo.d56918.png",sprite_mnp_down_arrow_width:11,sprite_mnp_down_arrow_height:7,sprite_mnp_down_arrow_x:0,sprite_mnp_down_arrow_y:0,sprite_mnp_down_arrow_url:"/assets/pin.5e3875.png",sprite_icn_intrst_del_hover_width:8,sprite_icn_intrst_del_hover_height:8,sprite_icn_intrst_del_hover_x:11,sprite_icn_intrst_del_hover_y:0,sprite_icn_intrst_del_hover_url:"/assets/pin.5e3875.png",sprite_icn_intrst_del_normal_width:8,sprite_icn_intrst_del_normal_height:8,sprite_icn_intrst_del_normal_x:19,sprite_icn_intrst_del_normal_y:0,sprite_icn_intrst_del_normal_url:"/assets/pin.5e3875.png",sprite_icn_new_arrow_width:16,sprite_icn_new_arrow_height:13,sprite_icn_new_arrow_x:27,sprite_icn_new_arrow_y:0,sprite_icn_new_arrow_url:"/assets/pin.5e3875.png",sprite_icn_play_width:14,sprite_icn_play_height:14,sprite_icn_play_x:43,sprite_icn_play_y:0,sprite_icn_play_url:"/assets/pin.5e3875.png",sprite_icn_triangle_width:9,sprite_icn_triangle_height:15,sprite_icn_triangle_x:57,sprite_icn_triangle_y:0,sprite_icn_triangle_url:"/assets/pin.5e3875.png",sprite_calendar_small_width:16,sprite_calendar_small_height:16,sprite_calendar_small_x:66,sprite_calendar_small_y:0,sprite_calendar_small_url:"/assets/pin.5e3875.png",sprite_expand_small_width:16,sprite_expand_small_height:16,sprite_expand_small_x:82,sprite_expand_small_y:0,sprite_expand_small_url:"/assets/pin.5e3875.png",sprite_facebook_small_width:16,sprite_facebook_small_height:16,sprite_facebook_small_x:98,sprite_facebook_small_y:0,sprite_facebook_small_url:"/assets/pin.5e3875.png",sprite_google2_small_width:16,sprite_google2_small_height:16,sprite_google2_small_x:114,sprite_google2_small_y:0,sprite_google2_small_url:"/assets/pin.5e3875.png",sprite_googlesearch_small_width:16,sprite_googlesearch_small_height:16,sprite_googlesearch_small_x:130,sprite_googlesearch_small_y:0,sprite_googlesearch_small_url:"/assets/pin.5e3875.png",sprite_linkedin_small_width:16,sprite_linkedin_small_height:16,sprite_linkedin_small_x:146,sprite_linkedin_small_y:0,sprite_linkedin_small_url:"/assets/pin.5e3875.png",sprite_twitter_small_width:16,sprite_twitter_small_height:16,sprite_twitter_small_x:162,sprite_twitter_small_y:0,sprite_twitter_small_url:"/assets/pin.5e3875.png",sprite_icn_clear_width:16,sprite_icn_clear_height:17,sprite_icn_clear_x:178,sprite_icn_clear_y:0,sprite_icn_clear_url:"/assets/pin.5e3875.png",sprite_icn_close_2_width:16,sprite_icn_close_2_height:17,sprite_icn_close_2_x:194,sprite_icn_close_2_y:0,sprite_icn_close_2_url:"/assets/pin.5e3875.png",sprite_icn_reply_width:16,sprite_icn_reply_height:17,sprite_icn_reply_x:210,sprite_icn_reply_y:0,sprite_icn_reply_url:"/assets/pin.5e3875.png",sprite_icn_phonebadge_width:18,sprite_icn_phonebadge_height:18,sprite_icn_phonebadge_x:226,sprite_icn_phonebadge_y:0,sprite_icn_phonebadge_url:"/assets/pin.5e3875.png",sprite_icn_check_blue_width:20,sprite_icn_check_blue_height:20,sprite_icn_check_blue_x:244,sprite_icn_check_blue_y:0,sprite_icn_check_blue_url:"/assets/pin.5e3875.png",sprite_premium_account_width:20,sprite_premium_account_height:20,sprite_premium_account_x:264,sprite_premium_account_y:0,sprite_premium_account_url:"/assets/pin.5e3875.png",sprite_question_mark_width:20,sprite_question_mark_height:20,sprite_question_mark_x:0,sprite_question_mark_y:20,sprite_question_mark_url:"/assets/pin.5e3875.png",sprite_facebook_share_width:94,sprite_facebook_share_height:25,sprite_facebook_share_x:20,sprite_facebook_share_y:20,sprite_facebook_share_url:"/assets/pin.5e3875.png",sprite_btn2_default_small_left_width:30,sprite_btn2_default_small_left_height:26,sprite_btn2_default_small_left_x:114,sprite_btn2_default_small_left_y:20,sprite_btn2_default_small_left_url:"/assets/pin.5e3875.png",sprite_btn2_default_small_left_hover_width:30,sprite_btn2_default_small_left_hover_height:26,sprite_btn2_default_small_left_hover_x:144,sprite_btn2_default_small_left_hover_y:20,sprite_btn2_default_small_left_hover_url:"/assets/pin.5e3875.png",sprite_btn2_default_small_right_width:275,sprite_btn2_default_small_right_height:26,sprite_btn2_default_small_right_x:0,sprite_btn2_default_small_right_y:46,sprite_btn2_default_small_right_url:"/assets/pin.5e3875.png",sprite_btn2_default_small_right_hover_width:275,sprite_btn2_default_small_right_hover_height:26,sprite_btn2_default_small_right_hover_x:0,sprite_btn2_default_small_right_hover_y:72,sprite_btn2_default_small_right_hover_url:"/assets/pin.5e3875.png",sprite_btn2_disabled_small_left_width:30,sprite_btn2_disabled_small_left_height:26,sprite_btn2_disabled_small_left_x:0,sprite_btn2_disabled_small_left_y:98,sprite_btn2_disabled_small_left_url:"/assets/pin.5e3875.png",sprite_btn2_disabled_small_right_width:275,sprite_btn2_disabled_small_right_height:26,sprite_btn2_disabled_small_right_x:0,sprite_btn2_disabled_small_right_y:124,sprite_btn2_disabled_small_right_url:"/assets/pin.5e3875.png",sprite_btn2_small_left_width:30,sprite_btn2_small_left_height:26,sprite_btn2_small_left_x:0,sprite_btn2_small_left_y:150,sprite_btn2_small_left_url:"/assets/pin.5e3875.png",sprite_btn2_small_left_disabled_width:30,sprite_btn2_small_left_disabled_height:26,sprite_btn2_small_left_disabled_x:30,sprite_btn2_small_left_disabled_y:150,sprite_btn2_small_left_disabled_url:"/assets/pin.5e3875.png",sprite_btn2_small_left_hover_width:30,sprite_btn2_small_left_hover_height:26,sprite_btn2_small_left_hover_x:60,sprite_btn2_small_left_hover_y:150,sprite_btn2_small_left_hover_url:"/assets/pin.5e3875.png",sprite_btn2_small_right_width:275,sprite_btn2_small_right_height:26,sprite_btn2_small_right_x:0,sprite_btn2_small_right_y:176,sprite_btn2_small_right_url:"/assets/pin.5e3875.png",sprite_btn2_small_right_disabled_width:275,sprite_btn2_small_right_disabled_height:26,sprite_btn2_small_right_disabled_x:0,sprite_btn2_small_right_disabled_y:202,sprite_btn2_small_right_disabled_url:"/assets/pin.5e3875.png",sprite_btn2_small_right_hover_width:275,sprite_btn2_small_right_hover_height:26,sprite_btn2_small_right_hover_x:0,sprite_btn2_small_right_hover_y:228,sprite_btn2_small_right_hover_url:"/assets/pin.5e3875.png",sprite_btn_fb_off_width:45,sprite_btn_fb_off_height:26,sprite_btn_fb_off_x:0,sprite_btn_fb_off_y:254,sprite_btn_fb_off_url:"/assets/pin.5e3875.png",sprite_btn_fb_on_width:45,sprite_btn_fb_on_height:26,sprite_btn_fb_on_x:45,sprite_btn_fb_on_y:254,sprite_btn_fb_on_url:"/assets/pin.5e3875.png",sprite_btn_in_off_width:45,sprite_btn_in_off_height:26,sprite_btn_in_off_x:90,sprite_btn_in_off_y:254,sprite_btn_in_off_url:"/assets/pin.5e3875.png",sprite_btn_in_on_width:45,sprite_btn_in_on_height:26,sprite_btn_in_on_x:135,sprite_btn_in_on_y:254,sprite_btn_in_on_url:"/assets/pin.5e3875.png",sprite_btn_tw_off_width:45,sprite_btn_tw_off_height:26,sprite_btn_tw_off_x:180,sprite_btn_tw_off_y:254,sprite_btn_tw_off_url:"/assets/pin.5e3875.png",sprite_btn_tw_on_width:45,sprite_btn_tw_on_height:26,sprite_btn_tw_on_x:225,sprite_btn_tw_on_y:254,sprite_btn_tw_on_url:"/assets/pin.5e3875.png",sprite_facebook_big_width:32,sprite_facebook_big_height:32,sprite_facebook_big_x:0,sprite_facebook_big_y:280,sprite_facebook_big_url:"/assets/pin.5e3875.png",sprite_google2_big_width:32,sprite_google2_big_height:32,sprite_google2_big_x:32,sprite_google2_big_y:280,sprite_google2_big_url:"/assets/pin.5e3875.png",sprite_linkedin_big_width:32,sprite_linkedin_big_height:32,sprite_linkedin_big_x:64,sprite_linkedin_big_y:280,sprite_linkedin_big_url:"/assets/pin.5e3875.png",sprite_twitter_big_width:32,sprite_twitter_big_height:32,sprite_twitter_big_x:96,sprite_twitter_big_y:280,sprite_twitter_big_url:"/assets/pin.5e3875.png",sprite_btn2_default_left_width:20,sprite_btn2_default_left_height:34,sprite_btn2_default_left_x:128,sprite_btn2_default_left_y:280,sprite_btn2_default_left_url:"/assets/pin.5e3875.png",sprite_btn2_default_left_hover_width:20,sprite_btn2_default_left_hover_height:34,sprite_btn2_default_left_hover_x:148,sprite_btn2_default_left_hover_y:280,sprite_btn2_default_left_hover_url:"/assets/pin.5e3875.png",sprite_btn2_default_right_width:300,sprite_btn2_default_right_height:34,sprite_btn2_default_right_x:0,sprite_btn2_default_right_y:314,sprite_btn2_default_right_url:"/assets/pin.5e3875.png",sprite_btn2_default_right_hover_width:300,sprite_btn2_default_right_hover_height:34,sprite_btn2_default_right_hover_x:0,sprite_btn2_default_right_hover_y:348,sprite_btn2_default_right_hover_url:"/assets/pin.5e3875.png",sprite_btn2_disabled_left_width:25,sprite_btn2_disabled_left_height:34,sprite_btn2_disabled_left_x:0,sprite_btn2_disabled_left_y:382,sprite_btn2_disabled_left_url:"/assets/pin.5e3875.png",sprite_btn2_disabled_right_width:275,sprite_btn2_disabled_right_height:34,sprite_btn2_disabled_right_x:25,sprite_btn2_disabled_right_y:382,sprite_btn2_disabled_right_url:"/assets/pin.5e3875.png",sprite_info_logo_width:80,sprite_info_logo_height:34,sprite_info_logo_x:0,sprite_info_logo_y:416,sprite_info_logo_url:"/assets/pin.5e3875.png",sprite_facebook_use_width:210,sprite_facebook_use_height:40,sprite_facebook_use_x:80,sprite_facebook_use_y:416,sprite_facebook_use_url:"/assets/pin.5e3875.png",sprite_google2_use_width:210,sprite_google2_use_height:40,sprite_google2_use_x:0,sprite_google2_use_y:456,sprite_google2_use_url:"/assets/pin.5e3875.png",sprite_linkedin_use_width:210,sprite_linkedin_use_height:40,sprite_linkedin_use_x:0,sprite_linkedin_use_y:496,sprite_linkedin_use_url:"/assets/pin.5e3875.png",sprite_sms_use_width:210,sprite_sms_use_height:40,sprite_sms_use_x:0,sprite_sms_use_y:536,sprite_sms_use_url:"/assets/pin.5e3875.png",sprite_twitter_use_width:210,sprite_twitter_use_height:40,sprite_twitter_use_x:0,sprite_twitter_use_y:576,sprite_twitter_use_url:"/assets/pin.5e3875.png",sprite_icn_dotblack_width:10,sprite_icn_dotblack_height:10,sprite_icn_dotblack_x:0,sprite_icn_dotblack_y:0,sprite_icn_dotblack_url:"/assets/splash.86dd0a.png",sprite_icn_dotwhite_width:10,sprite_icn_dotwhite_height:10,sprite_icn_dotwhite_x:10,sprite_icn_dotwhite_y:0,sprite_icn_dotwhite_url:"/assets/splash.86dd0a.png",sprite_icon_facebook_width:16,sprite_icon_facebook_height:16,sprite_icon_facebook_x:20,sprite_icon_facebook_y:0,sprite_icon_facebook_url:"/assets/splash.86dd0a.png",sprite_icon_twitter_width:16,sprite_icon_twitter_height:16,sprite_icon_twitter_x:36,sprite_icon_twitter_y:0,sprite_icon_twitter_url:"/assets/splash.86dd0a.png",sprite_splash_arr_left_width:16,sprite_splash_arr_left_height:22,sprite_splash_arr_left_x:52,sprite_splash_arr_left_y:0,sprite_splash_arr_left_url:"/assets/splash.86dd0a.png",sprite_splash_arr_right_width:16,sprite_splash_arr_right_height:22,sprite_splash_arr_right_x:68,sprite_splash_arr_right_y:0,sprite_splash_arr_right_url:"/assets/splash.86dd0a.png",sprite_error_icn_width:25,sprite_error_icn_height:23,sprite_error_icn_x:84,sprite_error_icn_y:0,sprite_error_icn_url:"/assets/splash.86dd0a.png",sprite_splash_icn_collapse_width:30,sprite_splash_icn_collapse_height:30,sprite_splash_icn_collapse_x:109,sprite_splash_icn_collapse_y:0,sprite_splash_icn_collapse_url:"/assets/splash.86dd0a.png",sprite_splash_icn_expand_width:30,sprite_splash_icn_expand_height:30,sprite_splash_icn_expand_x:139,sprite_splash_icn_expand_y:0,sprite_splash_icn_expand_url:"/assets/splash.86dd0a.png",sprite_icn_audio_width:32,sprite_icn_audio_height:32,sprite_icn_audio_x:169,sprite_icn_audio_y:0,sprite_icn_audio_url:"/assets/splash.86dd0a.png",sprite_icn_group_width:32,sprite_icn_group_height:32,sprite_icn_group_x:201,sprite_icn_group_y:0,sprite_icn_group_url:"/assets/splash.86dd0a.png",sprite_icn_meet_width:32,sprite_icn_meet_height:32,sprite_icn_meet_x:233,sprite_icn_meet_y:0,sprite_icn_meet_url:"/assets/splash.86dd0a.png",sprite_icn_search_width:32,sprite_icn_search_height:32,sprite_icn_search_x:265,sprite_icn_search_y:0,sprite_icn_search_url:"/assets/splash.86dd0a.png",sprite_imo_logo_width:68,sprite_imo_logo_height:32,sprite_imo_logo_x:297,sprite_imo_logo_y:0,sprite_imo_logo_url:"/assets/splash.86dd0a.png",sprite_logo_icq_width:32,sprite_logo_icq_height:32,sprite_logo_icq_x:0,sprite_logo_icq_y:32,sprite_logo_icq_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_aim_width:32,sprite_logo_prpl_aim_height:32,sprite_logo_prpl_aim_x:32,sprite_logo_prpl_aim_y:32,sprite_logo_prpl_aim_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_hyves_width:32,sprite_logo_prpl_hyves_height:32,sprite_logo_prpl_hyves_x:64,sprite_logo_prpl_hyves_y:32,sprite_logo_prpl_hyves_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_jabber_width:32,sprite_logo_prpl_jabber_height:32,sprite_logo_prpl_jabber_x:96,sprite_logo_prpl_jabber_y:32,sprite_logo_prpl_jabber_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_msn_width:32,sprite_logo_prpl_msn_height:32,sprite_logo_prpl_msn_x:128,sprite_logo_prpl_msn_y:32,sprite_logo_prpl_msn_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_myspace_width:32,sprite_logo_prpl_myspace_height:32,sprite_logo_prpl_myspace_x:160,sprite_logo_prpl_myspace_y:32,sprite_logo_prpl_myspace_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_newfacebook_width:32,sprite_logo_prpl_newfacebook_height:32,sprite_logo_prpl_newfacebook_x:192,sprite_logo_prpl_newfacebook_y:32,sprite_logo_prpl_newfacebook_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_skype_width:32,sprite_logo_prpl_skype_height:32,sprite_logo_prpl_skype_x:224,sprite_logo_prpl_skype_y:32,sprite_logo_prpl_skype_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_vkontakte_width:32,sprite_logo_prpl_vkontakte_height:32,sprite_logo_prpl_vkontakte_x:256,sprite_logo_prpl_vkontakte_y:32,sprite_logo_prpl_vkontakte_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_xmpp_width:32,sprite_logo_prpl_xmpp_height:32,sprite_logo_prpl_xmpp_x:288,sprite_logo_prpl_xmpp_y:32,sprite_logo_prpl_xmpp_url:"/assets/splash.86dd0a.png",sprite_logo_prpl_yahoo_width:32,sprite_logo_prpl_yahoo_height:32,sprite_logo_prpl_yahoo_x:320,sprite_logo_prpl_yahoo_y:32,sprite_logo_prpl_yahoo_url:"/assets/splash.86dd0a.png",sprite_logo_steam_width:32,sprite_logo_steam_height:32,sprite_logo_steam_x:352,sprite_logo_steam_y:32,sprite_logo_steam_url:"/assets/splash.86dd0a.png",sprite_mobile_down_width:32,sprite_mobile_down_height:34,sprite_mobile_down_x:0,sprite_mobile_down_y:64,sprite_mobile_down_url:"/assets/splash.86dd0a.png",sprite_imo_signin_width:40,sprite_imo_signin_height:40,sprite_imo_signin_x:32,sprite_imo_signin_y:64,sprite_imo_signin_url:"/assets/splash.86dd0a.png",sprite_m_android_width:40,sprite_m_android_height:40,sprite_m_android_x:72,sprite_m_android_y:64,sprite_m_android_url:"/assets/splash.86dd0a.png",sprite_m_blackberry_width:40,sprite_m_blackberry_height:40,sprite_m_blackberry_x:112,sprite_m_blackberry_y:64,sprite_m_blackberry_url:"/assets/splash.86dd0a.png",sprite_m_ios_width:40,sprite_m_ios_height:40,sprite_m_ios_x:152,sprite_m_ios_y:64,sprite_m_ios_url:"/assets/splash.86dd0a.png",sprite_m_nokia_width:40,sprite_m_nokia_height:40,sprite_m_nokia_x:192,sprite_m_nokia_y:64,sprite_m_nokia_url:"/assets/splash.86dd0a.png",sprite_imo_or_width:44,sprite_imo_or_height:44,sprite_imo_or_x:232,sprite_imo_or_y:64,sprite_imo_or_url:"/assets/splash.86dd0a.png",sprite_fb_login_button_large_width:245,sprite_fb_login_button_large_height:61,sprite_fb_login_button_large_x:0,sprite_fb_login_button_large_y:108,sprite_fb_login_button_large_url:"/assets/splash.86dd0a.png",sprite_google_sign_in_base_width:394,sprite_google_sign_in_base_height:74,sprite_google_sign_in_base_x:0,sprite_google_sign_in_base_y:169,sprite_google_sign_in_base_url:"/assets/splash.86dd0a.png",sprite_google_sign_in_hover_width:394,sprite_google_sign_in_hover_height:74,sprite_google_sign_in_hover_x:0,sprite_google_sign_in_hover_y:243,sprite_google_sign_in_hover_url:"/assets/splash.86dd0a.png",sprite_google_sign_in_press_width:394,sprite_google_sign_in_press_height:74,sprite_google_sign_in_press_x:0,sprite_google_sign_in_press_y:317,sprite_google_sign_in_press_url:"/assets/splash.86dd0a.png",sprite_icn_info_width:14,sprite_icn_info_height:14,sprite_icn_info_x:0,sprite_icn_info_y:0,sprite_icn_info_url:"/assets/pin_signup.3552b6.png",sprite_icn_close_new_width:32,sprite_icn_close_new_height:32,sprite_icn_close_new_x:14,sprite_icn_close_new_y:0,sprite_icn_close_new_url:"/assets/pin_signup.3552b6.png",sprite_btn_upgrade_width:200,sprite_btn_upgrade_height:41,sprite_btn_upgrade_x:46,sprite_btn_upgrade_y:0,sprite_btn_upgrade_url:"/assets/pin_signup.3552b6.png",sprite_btn_upgrade_active_width:200,sprite_btn_upgrade_active_height:41,sprite_btn_upgrade_active_x:246,sprite_btn_upgrade_active_y:0,sprite_btn_upgrade_active_url:"/assets/pin_signup.3552b6.png",sprite_premium_icn_close_width:50,sprite_premium_icn_close_height:50,sprite_premium_icn_close_x:446,sprite_premium_icn_close_y:0,sprite_premium_icn_close_url:"/assets/pin_signup.3552b6.png",sprite_premium_icn_close_hover_width:50,sprite_premium_icn_close_hover_height:50,sprite_premium_icn_close_hover_x:496,sprite_premium_icn_close_hover_y:0,sprite_premium_icn_close_hover_url:"/assets/pin_signup.3552b6.png",sprite_pic_frame_width:130,sprite_pic_frame_height:130,sprite_pic_frame_x:546,sprite_pic_frame_y:0,sprite_pic_frame_url:"/assets/pin_signup.3552b6.png",sprite_go_premium_width:600,sprite_go_premium_height:150,sprite_go_premium_x:0,sprite_go_premium_y:130,sprite_go_premium_url:"/assets/pin_signup.3552b6.png",sprite_card_cvc_width:700,sprite_card_cvc_height:300,sprite_card_cvc_x:0,sprite_card_cvc_y:280,sprite_card_cvc_url:"/assets/pin_signup.3552b6.png",sprite_bgr_signup_width:1200,sprite_bgr_signup_height:440,sprite_bgr_signup_x:0,sprite_bgr_signup_y:580,sprite_bgr_signup_url:"/assets/pin_signup.3552b6.png",sprite_ad_width:22,sprite_ad_height:14,sprite_ad_x:0,sprite_ad_y:0,sprite_ad_url:"/assets/flags.fed2dc.png",sprite_ae_width:22,sprite_ae_height:14,sprite_ae_x:0,sprite_ae_y:14,sprite_ae_url:"/assets/flags.fed2dc.png",sprite_af_width:22,sprite_af_height:14,sprite_af_x:0,sprite_af_y:28,sprite_af_url:"/assets/flags.fed2dc.png",sprite_ag_width:22,sprite_ag_height:14,sprite_ag_x:0,sprite_ag_y:42,sprite_ag_url:"/assets/flags.fed2dc.png",sprite_ai_width:22,sprite_ai_height:14,sprite_ai_x:0,sprite_ai_y:56,sprite_ai_url:"/assets/flags.fed2dc.png",sprite_al_width:22,sprite_al_height:14,sprite_al_x:0,sprite_al_y:70,sprite_al_url:"/assets/flags.fed2dc.png",sprite_am_width:22,sprite_am_height:14,sprite_am_x:0,sprite_am_y:84,sprite_am_url:"/assets/flags.fed2dc.png",sprite_an_width:22,sprite_an_height:14,sprite_an_x:0,sprite_an_y:98,sprite_an_url:"/assets/flags.fed2dc.png",sprite_ao_width:22,sprite_ao_height:14,sprite_ao_x:0,sprite_ao_y:112,sprite_ao_url:"/assets/flags.fed2dc.png",sprite_ar_width:22,sprite_ar_height:14,sprite_ar_x:0,sprite_ar_y:126,sprite_ar_url:"/assets/flags.fed2dc.png",sprite_as_width:22,sprite_as_height:14,sprite_as_x:0,sprite_as_y:140,sprite_as_url:"/assets/flags.fed2dc.png",sprite_at_width:22,sprite_at_height:14,sprite_at_x:0,sprite_at_y:154,sprite_at_url:"/assets/flags.fed2dc.png",sprite_au_width:22,sprite_au_height:14,sprite_au_x:0,sprite_au_y:168,sprite_au_url:"/assets/flags.fed2dc.png",sprite_aw_width:22,sprite_aw_height:14,sprite_aw_x:0,sprite_aw_y:182,sprite_aw_url:"/assets/flags.fed2dc.png",sprite_ax_width:22,sprite_ax_height:14,sprite_ax_x:0,sprite_ax_y:196,sprite_ax_url:"/assets/flags.fed2dc.png",sprite_az_width:22,sprite_az_height:14,sprite_az_x:0,sprite_az_y:210,sprite_az_url:"/assets/flags.fed2dc.png",sprite_ba_width:22,sprite_ba_height:14,sprite_ba_x:0,sprite_ba_y:224,sprite_ba_url:"/assets/flags.fed2dc.png",sprite_bb_width:22,sprite_bb_height:14,sprite_bb_x:0,sprite_bb_y:238,sprite_bb_url:"/assets/flags.fed2dc.png",sprite_bd_width:22,sprite_bd_height:14,sprite_bd_x:0,sprite_bd_y:252,sprite_bd_url:"/assets/flags.fed2dc.png",sprite_be_width:22,sprite_be_height:14,sprite_be_x:0,sprite_be_y:266,sprite_be_url:"/assets/flags.fed2dc.png",sprite_bf_width:22,sprite_bf_height:14,sprite_bf_x:0,sprite_bf_y:280,sprite_bf_url:"/assets/flags.fed2dc.png",sprite_bg_width:22,sprite_bg_height:14,sprite_bg_x:0,sprite_bg_y:294,sprite_bg_url:"/assets/flags.fed2dc.png",sprite_bh_width:22,sprite_bh_height:14,sprite_bh_x:0,sprite_bh_y:308,sprite_bh_url:"/assets/flags.fed2dc.png",sprite_bi_width:22,sprite_bi_height:14,sprite_bi_x:0,sprite_bi_y:322,sprite_bi_url:"/assets/flags.fed2dc.png",sprite_bj_width:22,sprite_bj_height:14,sprite_bj_x:0,sprite_bj_y:336,sprite_bj_url:"/assets/flags.fed2dc.png",sprite_bm_width:22,sprite_bm_height:14,sprite_bm_x:0,sprite_bm_y:350,sprite_bm_url:"/assets/flags.fed2dc.png",sprite_bn_width:22,sprite_bn_height:14,sprite_bn_x:0,sprite_bn_y:364,sprite_bn_url:"/assets/flags.fed2dc.png",sprite_bo_width:22,sprite_bo_height:14,sprite_bo_x:0,sprite_bo_y:378,sprite_bo_url:"/assets/flags.fed2dc.png",sprite_br_width:22,sprite_br_height:14,sprite_br_x:0,sprite_br_y:392,sprite_br_url:"/assets/flags.fed2dc.png",sprite_bs_width:22,sprite_bs_height:14,sprite_bs_x:0,sprite_bs_y:406,sprite_bs_url:"/assets/flags.fed2dc.png",sprite_bt_width:22,sprite_bt_height:14,sprite_bt_x:0,sprite_bt_y:420,sprite_bt_url:"/assets/flags.fed2dc.png",sprite_bv_width:22,sprite_bv_height:14,sprite_bv_x:0,sprite_bv_y:434,sprite_bv_url:"/assets/flags.fed2dc.png",sprite_bw_width:22,sprite_bw_height:14,sprite_bw_x:0,sprite_bw_y:448,sprite_bw_url:"/assets/flags.fed2dc.png",sprite_by_width:22,sprite_by_height:14,sprite_by_x:0,sprite_by_y:462,sprite_by_url:"/assets/flags.fed2dc.png",sprite_bz_width:22,sprite_bz_height:14,sprite_bz_x:0,sprite_bz_y:476,sprite_bz_url:"/assets/flags.fed2dc.png",sprite_ca_width:22,sprite_ca_height:14,sprite_ca_x:0,sprite_ca_y:490,sprite_ca_url:"/assets/flags.fed2dc.png",sprite_catalonia_width:22,sprite_catalonia_height:14,sprite_catalonia_x:0,sprite_catalonia_y:504,sprite_catalonia_url:"/assets/flags.fed2dc.png",sprite_cc_width:22,sprite_cc_height:14,sprite_cc_x:0,sprite_cc_y:518,sprite_cc_url:"/assets/flags.fed2dc.png",sprite_cd_width:22,sprite_cd_height:14,sprite_cd_x:0,sprite_cd_y:532,sprite_cd_url:"/assets/flags.fed2dc.png",sprite_cf_width:22,sprite_cf_height:14,sprite_cf_x:0,sprite_cf_y:546,sprite_cf_url:"/assets/flags.fed2dc.png",sprite_cg_width:22,sprite_cg_height:14,sprite_cg_x:0,sprite_cg_y:560,sprite_cg_url:"/assets/flags.fed2dc.png",sprite_ch_width:22,sprite_ch_height:14,sprite_ch_x:0,sprite_ch_y:574,sprite_ch_url:"/assets/flags.fed2dc.png",sprite_ci_width:22,sprite_ci_height:14,sprite_ci_x:0,sprite_ci_y:588,sprite_ci_url:"/assets/flags.fed2dc.png",sprite_ck_width:22,sprite_ck_height:14,sprite_ck_x:0,sprite_ck_y:602,sprite_ck_url:"/assets/flags.fed2dc.png",sprite_cl_width:22,sprite_cl_height:14,sprite_cl_x:0,sprite_cl_y:616,sprite_cl_url:"/assets/flags.fed2dc.png",sprite_cm_width:22,sprite_cm_height:14,sprite_cm_x:0,sprite_cm_y:630,sprite_cm_url:"/assets/flags.fed2dc.png",sprite_cn_width:22,sprite_cn_height:14,sprite_cn_x:0,sprite_cn_y:644,sprite_cn_url:"/assets/flags.fed2dc.png",sprite_co_width:22,sprite_co_height:14,sprite_co_x:0,sprite_co_y:658,sprite_co_url:"/assets/flags.fed2dc.png",sprite_cr_width:22,sprite_cr_height:14,sprite_cr_x:0,sprite_cr_y:672,sprite_cr_url:"/assets/flags.fed2dc.png",sprite_cs_width:22,sprite_cs_height:14,sprite_cs_x:0,sprite_cs_y:686,sprite_cs_url:"/assets/flags.fed2dc.png",sprite_cu_width:22,sprite_cu_height:14,sprite_cu_x:0,sprite_cu_y:700,sprite_cu_url:"/assets/flags.fed2dc.png",sprite_cv_width:22,sprite_cv_height:14,sprite_cv_x:0,sprite_cv_y:714,sprite_cv_url:"/assets/flags.fed2dc.png",sprite_cx_width:22,sprite_cx_height:14,sprite_cx_x:0,sprite_cx_y:728,sprite_cx_url:"/assets/flags.fed2dc.png",sprite_cy_width:22,sprite_cy_height:14,sprite_cy_x:0,sprite_cy_y:742,sprite_cy_url:"/assets/flags.fed2dc.png",sprite_cz_width:22,sprite_cz_height:14,sprite_cz_x:0,sprite_cz_y:756,sprite_cz_url:"/assets/flags.fed2dc.png",sprite_de_width:22,sprite_de_height:14,sprite_de_x:0,sprite_de_y:770,sprite_de_url:"/assets/flags.fed2dc.png",sprite_dj_width:22,sprite_dj_height:14,sprite_dj_x:0,sprite_dj_y:784,sprite_dj_url:"/assets/flags.fed2dc.png",sprite_dk_width:22,sprite_dk_height:14,sprite_dk_x:0,sprite_dk_y:798,sprite_dk_url:"/assets/flags.fed2dc.png",sprite_dm_width:22,sprite_dm_height:14,sprite_dm_x:0,sprite_dm_y:812,sprite_dm_url:"/assets/flags.fed2dc.png",sprite_do_width:22,sprite_do_height:14,sprite_do_x:0,sprite_do_y:826,sprite_do_url:"/assets/flags.fed2dc.png",sprite_dz_width:22,sprite_dz_height:14,sprite_dz_x:0,sprite_dz_y:840,sprite_dz_url:"/assets/flags.fed2dc.png",sprite_ec_width:22,sprite_ec_height:14,sprite_ec_x:0,sprite_ec_y:854,sprite_ec_url:"/assets/flags.fed2dc.png",sprite_ee_width:22,sprite_ee_height:14,sprite_ee_x:0,sprite_ee_y:868,sprite_ee_url:"/assets/flags.fed2dc.png",sprite_eg_width:22,sprite_eg_height:14,sprite_eg_x:0,sprite_eg_y:882,sprite_eg_url:"/assets/flags.fed2dc.png",sprite_eh_width:22,sprite_eh_height:14,sprite_eh_x:0,sprite_eh_y:896,sprite_eh_url:"/assets/flags.fed2dc.png",sprite_england_width:22,sprite_england_height:14,sprite_england_x:0,sprite_england_y:910,sprite_england_url:"/assets/flags.fed2dc.png",sprite_er_width:22,sprite_er_height:14,sprite_er_x:0,sprite_er_y:924,sprite_er_url:"/assets/flags.fed2dc.png",sprite_es_width:22,sprite_es_height:14,sprite_es_x:0,sprite_es_y:938,sprite_es_url:"/assets/flags.fed2dc.png",sprite_et_width:22,sprite_et_height:14,sprite_et_x:0,sprite_et_y:952,sprite_et_url:"/assets/flags.fed2dc.png",sprite_eu_width:22,sprite_eu_height:14,sprite_eu_x:0,sprite_eu_y:966,sprite_eu_url:"/assets/flags.fed2dc.png",sprite_fi_width:22,sprite_fi_height:14,sprite_fi_x:0,sprite_fi_y:980,sprite_fi_url:"/assets/flags.fed2dc.png",sprite_fj_width:22,sprite_fj_height:14,sprite_fj_x:0,sprite_fj_y:994,sprite_fj_url:"/assets/flags.fed2dc.png",sprite_fk_width:22,sprite_fk_height:14,sprite_fk_x:0,sprite_fk_y:1008,sprite_fk_url:"/assets/flags.fed2dc.png",sprite_fm_width:22,sprite_fm_height:14,sprite_fm_x:0,sprite_fm_y:1022,sprite_fm_url:"/assets/flags.fed2dc.png",sprite_fo_width:22,sprite_fo_height:14,sprite_fo_x:0,sprite_fo_y:1036,sprite_fo_url:"/assets/flags.fed2dc.png",sprite_fr_width:22,sprite_fr_height:14,sprite_fr_x:0,sprite_fr_y:1050,sprite_fr_url:"/assets/flags.fed2dc.png",sprite_ga_width:22,sprite_ga_height:14,sprite_ga_x:0,sprite_ga_y:1064,sprite_ga_url:"/assets/flags.fed2dc.png",sprite_galicia_width:22,sprite_galicia_height:14,sprite_galicia_x:0,sprite_galicia_y:1078,sprite_galicia_url:"/assets/flags.fed2dc.png",sprite_gb_width:22,sprite_gb_height:14,sprite_gb_x:0,sprite_gb_y:1092,sprite_gb_url:"/assets/flags.fed2dc.png",sprite_gd_width:22,sprite_gd_height:14,sprite_gd_x:0,sprite_gd_y:1106,sprite_gd_url:"/assets/flags.fed2dc.png",sprite_ge_width:22,sprite_ge_height:14,sprite_ge_x:0,sprite_ge_y:1120,sprite_ge_url:"/assets/flags.fed2dc.png",sprite_gf_width:22,sprite_gf_height:14,sprite_gf_x:0,sprite_gf_y:1134,sprite_gf_url:"/assets/flags.fed2dc.png",sprite_gg_width:22,sprite_gg_height:14,sprite_gg_x:0,sprite_gg_y:1148,sprite_gg_url:"/assets/flags.fed2dc.png",sprite_gh_width:22,sprite_gh_height:14,sprite_gh_x:0,sprite_gh_y:1162,sprite_gh_url:"/assets/flags.fed2dc.png",sprite_gi_width:22,sprite_gi_height:14,sprite_gi_x:0,sprite_gi_y:1176,sprite_gi_url:"/assets/flags.fed2dc.png",sprite_gl_width:22,sprite_gl_height:14,sprite_gl_x:0,sprite_gl_y:1190,sprite_gl_url:"/assets/flags.fed2dc.png",sprite_gm_width:22,sprite_gm_height:14,sprite_gm_x:0,sprite_gm_y:1204,sprite_gm_url:"/assets/flags.fed2dc.png",sprite_gn_width:22,sprite_gn_height:14,sprite_gn_x:0,sprite_gn_y:1218,sprite_gn_url:"/assets/flags.fed2dc.png",sprite_gp_width:22,sprite_gp_height:14,sprite_gp_x:0,sprite_gp_y:1232,sprite_gp_url:"/assets/flags.fed2dc.png",sprite_gq_width:22,sprite_gq_height:14,sprite_gq_x:0,sprite_gq_y:1246,sprite_gq_url:"/assets/flags.fed2dc.png",sprite_gr_width:22,sprite_gr_height:14,sprite_gr_x:0,sprite_gr_y:1260,sprite_gr_url:"/assets/flags.fed2dc.png",sprite_gs_width:22,sprite_gs_height:14,sprite_gs_x:0,sprite_gs_y:1274,sprite_gs_url:"/assets/flags.fed2dc.png",sprite_gt_width:22,sprite_gt_height:14,sprite_gt_x:0,sprite_gt_y:1288,sprite_gt_url:"/assets/flags.fed2dc.png",sprite_gu_width:22,sprite_gu_height:14,sprite_gu_x:0,sprite_gu_y:1302,sprite_gu_url:"/assets/flags.fed2dc.png",sprite_gw_width:22,sprite_gw_height:14,sprite_gw_x:0,sprite_gw_y:1316,sprite_gw_url:"/assets/flags.fed2dc.png",sprite_gy_width:22,sprite_gy_height:14,sprite_gy_x:0,sprite_gy_y:1330,sprite_gy_url:"/assets/flags.fed2dc.png",sprite_hk_width:22,sprite_hk_height:14,sprite_hk_x:0,sprite_hk_y:1344,sprite_hk_url:"/assets/flags.fed2dc.png",sprite_hm_width:22,sprite_hm_height:14,sprite_hm_x:0,sprite_hm_y:1358,sprite_hm_url:"/assets/flags.fed2dc.png",sprite_hn_width:22,sprite_hn_height:14,sprite_hn_x:0,sprite_hn_y:1372,sprite_hn_url:"/assets/flags.fed2dc.png",sprite_hr_width:22,sprite_hr_height:14,sprite_hr_x:0,sprite_hr_y:1386,sprite_hr_url:"/assets/flags.fed2dc.png",sprite_ht_width:22,sprite_ht_height:14,sprite_ht_x:0,sprite_ht_y:1400,sprite_ht_url:"/assets/flags.fed2dc.png",sprite_hu_width:22,sprite_hu_height:14,sprite_hu_x:0,sprite_hu_y:1414,sprite_hu_url:"/assets/flags.fed2dc.png",sprite_id_width:22,sprite_id_height:14,sprite_id_x:0,sprite_id_y:1428,sprite_id_url:"/assets/flags.fed2dc.png",sprite_ie_width:22,sprite_ie_height:14,sprite_ie_x:0,sprite_ie_y:1442,sprite_ie_url:"/assets/flags.fed2dc.png",sprite_il_width:22,sprite_il_height:14,sprite_il_x:0,sprite_il_y:1456,sprite_il_url:"/assets/flags.fed2dc.png",sprite_im_width:22,sprite_im_height:14,sprite_im_x:0,sprite_im_y:1470,sprite_im_url:"/assets/flags.fed2dc.png",sprite_in_width:22,sprite_in_height:14,sprite_in_x:0,sprite_in_y:1484,sprite_in_url:"/assets/flags.fed2dc.png",sprite_io_width:22,sprite_io_height:14,sprite_io_x:0,sprite_io_y:1498,sprite_io_url:"/assets/flags.fed2dc.png",sprite_iq_width:22,sprite_iq_height:14,sprite_iq_x:0,sprite_iq_y:1512,sprite_iq_url:"/assets/flags.fed2dc.png",sprite_ir_width:22,sprite_ir_height:14,sprite_ir_x:0,sprite_ir_y:1526,sprite_ir_url:"/assets/flags.fed2dc.png",sprite_is_width:22,sprite_is_height:14,sprite_is_x:0,sprite_is_y:1540,sprite_is_url:"/assets/flags.fed2dc.png",sprite_it_width:22,sprite_it_height:14,sprite_it_x:0,sprite_it_y:1554,sprite_it_url:"/assets/flags.fed2dc.png",sprite_je_width:22,sprite_je_height:14,sprite_je_x:0,sprite_je_y:1568,sprite_je_url:"/assets/flags.fed2dc.png",sprite_jm_width:22,sprite_jm_height:14,sprite_jm_x:0,sprite_jm_y:1582,sprite_jm_url:"/assets/flags.fed2dc.png",sprite_jo_width:22,sprite_jo_height:14,sprite_jo_x:0,sprite_jo_y:1596,sprite_jo_url:"/assets/flags.fed2dc.png",sprite_jp_width:22,sprite_jp_height:14,sprite_jp_x:0,sprite_jp_y:1610,sprite_jp_url:"/assets/flags.fed2dc.png",sprite_ke_width:22,sprite_ke_height:14,sprite_ke_x:0,sprite_ke_y:1624,sprite_ke_url:"/assets/flags.fed2dc.png",sprite_kg_width:22,sprite_kg_height:14,sprite_kg_x:0,sprite_kg_y:1638,sprite_kg_url:"/assets/flags.fed2dc.png",sprite_kh_width:22,sprite_kh_height:14,sprite_kh_x:0,sprite_kh_y:1652,sprite_kh_url:"/assets/flags.fed2dc.png",sprite_ki_width:22,sprite_ki_height:14,sprite_ki_x:0,sprite_ki_y:1666,sprite_ki_url:"/assets/flags.fed2dc.png",sprite_km_width:22,sprite_km_height:14,sprite_km_x:0,sprite_km_y:1680,sprite_km_url:"/assets/flags.fed2dc.png",sprite_kn_width:22,sprite_kn_height:14,sprite_kn_x:0,sprite_kn_y:1694,sprite_kn_url:"/assets/flags.fed2dc.png",sprite_kp_width:22,sprite_kp_height:14,sprite_kp_x:0,sprite_kp_y:1708,sprite_kp_url:"/assets/flags.fed2dc.png",sprite_kr_width:22,sprite_kr_height:14,sprite_kr_x:0,sprite_kr_y:1722,sprite_kr_url:"/assets/flags.fed2dc.png",sprite_kw_width:22,sprite_kw_height:14,sprite_kw_x:0,sprite_kw_y:1736,sprite_kw_url:"/assets/flags.fed2dc.png",sprite_ky_width:22,sprite_ky_height:14,sprite_ky_x:0,sprite_ky_y:1750,sprite_ky_url:"/assets/flags.fed2dc.png",sprite_kz_width:22,sprite_kz_height:14,sprite_kz_x:0,sprite_kz_y:1764,sprite_kz_url:"/assets/flags.fed2dc.png",sprite_la_width:22,sprite_la_height:14,sprite_la_x:0,sprite_la_y:1778,sprite_la_url:"/assets/flags.fed2dc.png",sprite_lb_width:22,sprite_lb_height:14,sprite_lb_x:0,sprite_lb_y:1792,sprite_lb_url:"/assets/flags.fed2dc.png",sprite_lc_width:22,sprite_lc_height:14,sprite_lc_x:0,sprite_lc_y:1806,sprite_lc_url:"/assets/flags.fed2dc.png",sprite_li_width:22,sprite_li_height:14,sprite_li_x:0,sprite_li_y:1820,sprite_li_url:"/assets/flags.fed2dc.png",sprite_lk_width:22,sprite_lk_height:14,sprite_lk_x:0,sprite_lk_y:1834,sprite_lk_url:"/assets/flags.fed2dc.png",sprite_lr_width:22,sprite_lr_height:14,sprite_lr_x:0,sprite_lr_y:1848,sprite_lr_url:"/assets/flags.fed2dc.png",sprite_ls_width:22,sprite_ls_height:14,sprite_ls_x:0,sprite_ls_y:1862,sprite_ls_url:"/assets/flags.fed2dc.png",sprite_lt_width:22,sprite_lt_height:14,sprite_lt_x:0,sprite_lt_y:1876,sprite_lt_url:"/assets/flags.fed2dc.png",sprite_lu_width:22,sprite_lu_height:14,sprite_lu_x:0,sprite_lu_y:1890,sprite_lu_url:"/assets/flags.fed2dc.png",sprite_lv_width:22,sprite_lv_height:14,sprite_lv_x:0,sprite_lv_y:1904,sprite_lv_url:"/assets/flags.fed2dc.png",sprite_ly_width:22,sprite_ly_height:14,sprite_ly_x:0,sprite_ly_y:1918,sprite_ly_url:"/assets/flags.fed2dc.png",sprite_ma_width:22,sprite_ma_height:14,sprite_ma_x:0,sprite_ma_y:1932,sprite_ma_url:"/assets/flags.fed2dc.png",sprite_mc_width:22,sprite_mc_height:14,sprite_mc_x:0,sprite_mc_y:1946,sprite_mc_url:"/assets/flags.fed2dc.png",sprite_md_width:22,sprite_md_height:14,sprite_md_x:0,sprite_md_y:1960,sprite_md_url:"/assets/flags.fed2dc.png",sprite_me_width:22,sprite_me_height:14,sprite_me_x:0,sprite_me_y:1974,sprite_me_url:"/assets/flags.fed2dc.png",sprite_mf_width:22,sprite_mf_height:14,sprite_mf_x:0,sprite_mf_y:1988,sprite_mf_url:"/assets/flags.fed2dc.png",sprite_mg_width:22,sprite_mg_height:14,sprite_mg_x:0,sprite_mg_y:2002,sprite_mg_url:"/assets/flags.fed2dc.png",sprite_mh_width:22,sprite_mh_height:14,sprite_mh_x:0,sprite_mh_y:2016,sprite_mh_url:"/assets/flags.fed2dc.png",sprite_mk_width:22,sprite_mk_height:14,sprite_mk_x:0,sprite_mk_y:2030,sprite_mk_url:"/assets/flags.fed2dc.png",sprite_ml_width:22,sprite_ml_height:14,sprite_ml_x:0,sprite_ml_y:2044,sprite_ml_url:"/assets/flags.fed2dc.png",sprite_mm_width:22,sprite_mm_height:14,sprite_mm_x:0,sprite_mm_y:2058,sprite_mm_url:"/assets/flags.fed2dc.png",sprite_mn_width:22,sprite_mn_height:14,sprite_mn_x:0,sprite_mn_y:2072,sprite_mn_url:"/assets/flags.fed2dc.png",sprite_mo_width:22,sprite_mo_height:14,sprite_mo_x:0,sprite_mo_y:2086,sprite_mo_url:"/assets/flags.fed2dc.png",sprite_mp_width:22,sprite_mp_height:14,sprite_mp_x:0,sprite_mp_y:2100,sprite_mp_url:"/assets/flags.fed2dc.png",sprite_mq_width:22,sprite_mq_height:14,sprite_mq_x:0,sprite_mq_y:2114,sprite_mq_url:"/assets/flags.fed2dc.png",sprite_mr_width:22,sprite_mr_height:14,sprite_mr_x:0,sprite_mr_y:2128,sprite_mr_url:"/assets/flags.fed2dc.png",sprite_ms_width:22,sprite_ms_height:14,sprite_ms_x:0,sprite_ms_y:2142,sprite_ms_url:"/assets/flags.fed2dc.png",sprite_mt_width:22,sprite_mt_height:14,sprite_mt_x:0,sprite_mt_y:2156,sprite_mt_url:"/assets/flags.fed2dc.png",sprite_mu_width:22,sprite_mu_height:14,sprite_mu_x:0,sprite_mu_y:2170,sprite_mu_url:"/assets/flags.fed2dc.png",sprite_mv_width:22,sprite_mv_height:14,sprite_mv_x:0,sprite_mv_y:2184,sprite_mv_url:"/assets/flags.fed2dc.png",sprite_mw_width:22,sprite_mw_height:14,sprite_mw_x:0,sprite_mw_y:2198,sprite_mw_url:"/assets/flags.fed2dc.png",sprite_mx_width:22,sprite_mx_height:14,sprite_mx_x:0,sprite_mx_y:2212,sprite_mx_url:"/assets/flags.fed2dc.png",sprite_my_width:22,sprite_my_height:14,sprite_my_x:0,sprite_my_y:2226,sprite_my_url:"/assets/flags.fed2dc.png",sprite_mz_width:22,sprite_mz_height:14,sprite_mz_x:0,sprite_mz_y:2240,sprite_mz_url:"/assets/flags.fed2dc.png",sprite_na_width:22,sprite_na_height:14,sprite_na_x:0,sprite_na_y:2254,sprite_na_url:"/assets/flags.fed2dc.png",sprite_nc_width:22,sprite_nc_height:14,sprite_nc_x:0,sprite_nc_y:2268,sprite_nc_url:"/assets/flags.fed2dc.png",sprite_nc2_width:22,sprite_nc2_height:14,sprite_nc2_x:0,sprite_nc2_y:2282,sprite_nc2_url:"/assets/flags.fed2dc.png",sprite_ne_width:22,sprite_ne_height:14,sprite_ne_x:0,sprite_ne_y:2296,sprite_ne_url:"/assets/flags.fed2dc.png",sprite_nf_width:22,sprite_nf_height:14,sprite_nf_x:0,sprite_nf_y:2310,sprite_nf_url:"/assets/flags.fed2dc.png",sprite_ng_width:22,sprite_ng_height:14,sprite_ng_x:0,sprite_ng_y:2324,sprite_ng_url:"/assets/flags.fed2dc.png",sprite_ni_width:22,sprite_ni_height:14,sprite_ni_x:0,sprite_ni_y:2338,sprite_ni_url:"/assets/flags.fed2dc.png",sprite_nl_width:22,sprite_nl_height:14,sprite_nl_x:0,sprite_nl_y:2352,sprite_nl_url:"/assets/flags.fed2dc.png",sprite_no_width:22,sprite_no_height:14,sprite_no_x:0,sprite_no_y:2366,sprite_no_url:"/assets/flags.fed2dc.png",sprite_np_width:22,sprite_np_height:14,sprite_np_x:0,sprite_np_y:2380,sprite_np_url:"/assets/flags.fed2dc.png",sprite_nr_width:22,sprite_nr_height:14,sprite_nr_x:0,sprite_nr_y:2394,sprite_nr_url:"/assets/flags.fed2dc.png",sprite_nu_width:22,sprite_nu_height:14,sprite_nu_x:0,sprite_nu_y:2408,sprite_nu_url:"/assets/flags.fed2dc.png",sprite_nz_width:22,sprite_nz_height:14,sprite_nz_x:0,sprite_nz_y:2422,sprite_nz_url:"/assets/flags.fed2dc.png",sprite_om_width:22,sprite_om_height:14,sprite_om_x:0,sprite_om_y:2436,sprite_om_url:"/assets/flags.fed2dc.png",sprite_pa_width:22,sprite_pa_height:14,sprite_pa_x:0,sprite_pa_y:2450,sprite_pa_url:"/assets/flags.fed2dc.png",sprite_pe_width:22,sprite_pe_height:14,sprite_pe_x:0,sprite_pe_y:2464,sprite_pe_url:"/assets/flags.fed2dc.png",sprite_pf_width:22,sprite_pf_height:14,sprite_pf_x:0,sprite_pf_y:2478,sprite_pf_url:"/assets/flags.fed2dc.png",sprite_pg_width:22,sprite_pg_height:14,sprite_pg_x:0,sprite_pg_y:2492,sprite_pg_url:"/assets/flags.fed2dc.png",sprite_ph_width:22,sprite_ph_height:14,sprite_ph_x:0,sprite_ph_y:2506,sprite_ph_url:"/assets/flags.fed2dc.png",sprite_pk_width:22,sprite_pk_height:14,sprite_pk_x:0,sprite_pk_y:2520,sprite_pk_url:"/assets/flags.fed2dc.png",sprite_pl_width:22,sprite_pl_height:14,sprite_pl_x:0,sprite_pl_y:2534,sprite_pl_url:"/assets/flags.fed2dc.png",sprite_pm_width:22,sprite_pm_height:14,sprite_pm_x:0,sprite_pm_y:2548,sprite_pm_url:"/assets/flags.fed2dc.png",sprite_pn_width:22,sprite_pn_height:14,sprite_pn_x:0,sprite_pn_y:2562,sprite_pn_url:"/assets/flags.fed2dc.png",sprite_pr_width:22,sprite_pr_height:14,sprite_pr_x:0,sprite_pr_y:2576,sprite_pr_url:"/assets/flags.fed2dc.png",sprite_ps_width:22,sprite_ps_height:14,sprite_ps_x:0,sprite_ps_y:2590,sprite_ps_url:"/assets/flags.fed2dc.png",sprite_pt_width:22,sprite_pt_height:14,sprite_pt_x:0,sprite_pt_y:2604,sprite_pt_url:"/assets/flags.fed2dc.png",sprite_pw_width:22,sprite_pw_height:14,sprite_pw_x:0,sprite_pw_y:2618,sprite_pw_url:"/assets/flags.fed2dc.png",sprite_py_width:22,sprite_py_height:14,sprite_py_x:0,sprite_py_y:2632,sprite_py_url:"/assets/flags.fed2dc.png",sprite_qa_width:22,sprite_qa_height:14,sprite_qa_x:0,sprite_qa_y:2646,sprite_qa_url:"/assets/flags.fed2dc.png",sprite_re_width:22,sprite_re_height:14,sprite_re_x:0,sprite_re_y:2660,sprite_re_url:"/assets/flags.fed2dc.png",sprite_ro_width:22,sprite_ro_height:14,sprite_ro_x:0,sprite_ro_y:2674,sprite_ro_url:"/assets/flags.fed2dc.png",sprite_rs_width:22,sprite_rs_height:14,sprite_rs_x:0,sprite_rs_y:2688,sprite_rs_url:"/assets/flags.fed2dc.png",sprite_ru_width:22,sprite_ru_height:14,sprite_ru_x:0,sprite_ru_y:2702,sprite_ru_url:"/assets/flags.fed2dc.png",sprite_rw_width:22,sprite_rw_height:14,sprite_rw_x:0,sprite_rw_y:2716,sprite_rw_url:"/assets/flags.fed2dc.png",sprite_sa_width:22,sprite_sa_height:14,sprite_sa_x:0,sprite_sa_y:2730,sprite_sa_url:"/assets/flags.fed2dc.png",sprite_sb_width:22,sprite_sb_height:14,sprite_sb_x:0,sprite_sb_y:2744,sprite_sb_url:"/assets/flags.fed2dc.png",sprite_sc_width:22,sprite_sc_height:14,sprite_sc_x:0,sprite_sc_y:2758,sprite_sc_url:"/assets/flags.fed2dc.png",sprite_scotland_width:22,sprite_scotland_height:14,sprite_scotland_x:0,sprite_scotland_y:2772,sprite_scotland_url:"/assets/flags.fed2dc.png",sprite_sd_width:22,sprite_sd_height:14,sprite_sd_x:0,sprite_sd_y:2786,sprite_sd_url:"/assets/flags.fed2dc.png",sprite_se_width:22,sprite_se_height:14,sprite_se_x:0,sprite_se_y:2800,sprite_se_url:"/assets/flags.fed2dc.png",sprite_sg_width:22,sprite_sg_height:14,sprite_sg_x:0,sprite_sg_y:2814,sprite_sg_url:"/assets/flags.fed2dc.png",sprite_sh_width:22,sprite_sh_height:14,sprite_sh_x:0,sprite_sh_y:2828,sprite_sh_url:"/assets/flags.fed2dc.png",sprite_si_width:22,sprite_si_height:14,sprite_si_x:0,sprite_si_y:2842,sprite_si_url:"/assets/flags.fed2dc.png",sprite_sj_width:22,sprite_sj_height:14,sprite_sj_x:0,sprite_sj_y:2856,sprite_sj_url:"/assets/flags.fed2dc.png",sprite_sk_width:22,sprite_sk_height:14,sprite_sk_x:0,sprite_sk_y:2870,sprite_sk_url:"/assets/flags.fed2dc.png",sprite_sl_width:22,sprite_sl_height:14,sprite_sl_x:0,sprite_sl_y:2884,sprite_sl_url:"/assets/flags.fed2dc.png",sprite_sm_width:22,sprite_sm_height:14,sprite_sm_x:0,sprite_sm_y:2898,sprite_sm_url:"/assets/flags.fed2dc.png",sprite_sn_width:22,sprite_sn_height:14,sprite_sn_x:0,sprite_sn_y:2912,sprite_sn_url:"/assets/flags.fed2dc.png",sprite_so_width:22,sprite_so_height:14,sprite_so_x:0,sprite_so_y:2926,sprite_so_url:"/assets/flags.fed2dc.png",sprite_sr_width:22,sprite_sr_height:14,sprite_sr_x:0,sprite_sr_y:2940,sprite_sr_url:"/assets/flags.fed2dc.png",sprite_st_width:22,sprite_st_height:14,sprite_st_x:0,sprite_st_y:2954,sprite_st_url:"/assets/flags.fed2dc.png",sprite_sv_width:22,sprite_sv_height:14,sprite_sv_x:0,sprite_sv_y:2968,sprite_sv_url:"/assets/flags.fed2dc.png",sprite_sy_width:22,sprite_sy_height:14,sprite_sy_x:0,sprite_sy_y:2982,sprite_sy_url:"/assets/flags.fed2dc.png",sprite_sz_width:22,sprite_sz_height:14,sprite_sz_x:0,sprite_sz_y:2996,sprite_sz_url:"/assets/flags.fed2dc.png",sprite_tc_width:22,sprite_tc_height:14,sprite_tc_x:0,sprite_tc_y:3010,sprite_tc_url:"/assets/flags.fed2dc.png",sprite_td_width:22,sprite_td_height:14,sprite_td_x:0,sprite_td_y:3024,sprite_td_url:"/assets/flags.fed2dc.png",sprite_tf_width:22,sprite_tf_height:14,sprite_tf_x:0,sprite_tf_y:3038,sprite_tf_url:"/assets/flags.fed2dc.png",sprite_tg_width:22,sprite_tg_height:14,sprite_tg_x:0,sprite_tg_y:3052,sprite_tg_url:"/assets/flags.fed2dc.png",sprite_th_width:22,sprite_th_height:14,sprite_th_x:0,sprite_th_y:3066,sprite_th_url:"/assets/flags.fed2dc.png",sprite_tj_width:22,sprite_tj_height:14,sprite_tj_x:0,sprite_tj_y:3080,sprite_tj_url:"/assets/flags.fed2dc.png",sprite_tk_width:22,sprite_tk_height:14,sprite_tk_x:0,sprite_tk_y:3094,sprite_tk_url:"/assets/flags.fed2dc.png",sprite_tl_width:22,sprite_tl_height:14,sprite_tl_x:0,sprite_tl_y:3108,sprite_tl_url:"/assets/flags.fed2dc.png",sprite_tm_width:22,sprite_tm_height:14,sprite_tm_x:0,sprite_tm_y:3122,sprite_tm_url:"/assets/flags.fed2dc.png",sprite_tn_width:22,sprite_tn_height:14,sprite_tn_x:0,sprite_tn_y:3136,sprite_tn_url:"/assets/flags.fed2dc.png",sprite_to_width:22,sprite_to_height:14,sprite_to_x:0,sprite_to_y:3150,sprite_to_url:"/assets/flags.fed2dc.png",sprite_tr_width:22,sprite_tr_height:14,sprite_tr_x:0,sprite_tr_y:3164,sprite_tr_url:"/assets/flags.fed2dc.png",sprite_tt_width:22,sprite_tt_height:14,sprite_tt_x:0,sprite_tt_y:3178,sprite_tt_url:"/assets/flags.fed2dc.png",sprite_tv_width:22,sprite_tv_height:14,sprite_tv_x:0,sprite_tv_y:3192,sprite_tv_url:"/assets/flags.fed2dc.png",sprite_tw_width:22,sprite_tw_height:14,sprite_tw_x:0,sprite_tw_y:3206,sprite_tw_url:"/assets/flags.fed2dc.png",sprite_tz_width:22,sprite_tz_height:14,sprite_tz_x:0,sprite_tz_y:3220,sprite_tz_url:"/assets/flags.fed2dc.png",sprite_ua_width:22,sprite_ua_height:14,sprite_ua_x:0,sprite_ua_y:3234,sprite_ua_url:"/assets/flags.fed2dc.png",sprite_ug_width:22,sprite_ug_height:14,sprite_ug_x:0,sprite_ug_y:3248,sprite_ug_url:"/assets/flags.fed2dc.png",sprite_uk_width:22,sprite_uk_height:14,sprite_uk_x:0,sprite_uk_y:3262,sprite_uk_url:"/assets/flags.fed2dc.png",sprite_um_width:22,sprite_um_height:14,sprite_um_x:0,sprite_um_y:3276,sprite_um_url:"/assets/flags.fed2dc.png",sprite_us_width:22,sprite_us_height:14,sprite_us_x:0,sprite_us_y:3290,sprite_us_url:"/assets/flags.fed2dc.png",sprite_uy_width:22,sprite_uy_height:14,sprite_uy_x:0,sprite_uy_y:3304,sprite_uy_url:"/assets/flags.fed2dc.png",sprite_uz_width:22,sprite_uz_height:14,sprite_uz_x:0,sprite_uz_y:3318,sprite_uz_url:"/assets/flags.fed2dc.png",sprite_va_width:22,sprite_va_height:14,sprite_va_x:0,sprite_va_y:3332,sprite_va_url:"/assets/flags.fed2dc.png",sprite_vc_width:22,sprite_vc_height:14,sprite_vc_x:0,sprite_vc_y:3346,sprite_vc_url:"/assets/flags.fed2dc.png",sprite_ve_width:22,sprite_ve_height:14,sprite_ve_x:0,sprite_ve_y:3360,sprite_ve_url:"/assets/flags.fed2dc.png",sprite_vg_width:22,sprite_vg_height:14,sprite_vg_x:0,sprite_vg_y:3374,sprite_vg_url:"/assets/flags.fed2dc.png",sprite_vi_width:22,sprite_vi_height:14,sprite_vi_x:0,sprite_vi_y:3388,sprite_vi_url:"/assets/flags.fed2dc.png",sprite_vn_width:22,sprite_vn_height:14,sprite_vn_x:0,sprite_vn_y:3402,sprite_vn_url:"/assets/flags.fed2dc.png",sprite_vu_width:22,sprite_vu_height:14,sprite_vu_x:0,sprite_vu_y:3416,sprite_vu_url:"/assets/flags.fed2dc.png",sprite_wales_width:22,sprite_wales_height:14,sprite_wales_x:0,sprite_wales_y:3430,sprite_wales_url:"/assets/flags.fed2dc.png",sprite_wf_width:22,sprite_wf_height:14,sprite_wf_x:0,sprite_wf_y:3444,sprite_wf_url:"/assets/flags.fed2dc.png",sprite_ws_width:22,sprite_ws_height:14,sprite_ws_x:0,sprite_ws_y:3458,sprite_ws_url:"/assets/flags.fed2dc.png",sprite_ye_width:22,sprite_ye_height:14,sprite_ye_x:0,sprite_ye_y:3472,sprite_ye_url:"/assets/flags.fed2dc.png",sprite_yt_width:22,sprite_yt_height:14,sprite_yt_x:0,sprite_yt_y:3486,sprite_yt_url:"/assets/flags.fed2dc.png",sprite_za_width:22,sprite_za_height:14,sprite_za_x:0,sprite_za_y:3500,sprite_za_url:"/assets/flags.fed2dc.png",sprite_zm_width:22,sprite_zm_height:14,sprite_zm_x:0,sprite_zm_y:3514,sprite_zm_url:"/assets/flags.fed2dc.png",sprite_zw_width:22,sprite_zw_height:14,sprite_zw_x:0,sprite_zw_y:3528,sprite_zw_url:"/assets/flags.fed2dc.png",sprite_icn_buddy_more_width:14,sprite_icn_buddy_more_height:14,sprite_icn_buddy_more_x:0,sprite_icn_buddy_more_y:0,sprite_icn_buddy_more_url:"/assets/buddylist.5e139f.png",sprite_icn_add_width:16,sprite_icn_add_height:16,sprite_icn_add_x:0,sprite_icn_add_y:14,sprite_icn_add_url:"/assets/buddylist.5e139f.png",sprite_icn_edit_width:12,sprite_icn_edit_height:12,sprite_icn_edit_x:23,sprite_icn_edit_y:19,sprite_icn_edit_url:"/assets/main.57633a.png",sprite_icn_invite_width:16,sprite_icn_invite_height:16,sprite_icn_invite_x:0,sprite_icn_invite_y:46,sprite_icn_invite_url:"/assets/buddylist.5e139f.png",sprite_icn_kick_width:16,sprite_icn_kick_height:16,sprite_icn_kick_x:0,sprite_icn_kick_y:62,sprite_icn_kick_url:"/assets/buddylist.5e139f.png",sprite_icn_mute_width:16,sprite_icn_mute_height:16,sprite_icn_mute_x:0,sprite_icn_mute_y:78,sprite_icn_mute_url:"/assets/buddylist.5e139f.png",sprite_icn_muted_width:16,sprite_icn_muted_height:16,sprite_icn_muted_x:0,sprite_icn_muted_y:94,sprite_icn_muted_url:"/assets/buddylist.5e139f.png",sprite_icn_history_width:17,sprite_icn_history_height:17,sprite_icn_history_x:0,sprite_icn_history_y:110,sprite_icn_history_url:"/assets/buddylist.5e139f.png",sprite_aim_available_width:14,sprite_aim_available_height:14,sprite_aim_available_x:0,sprite_aim_available_y:0,sprite_aim_available_url:"/assets/icons.90ac55.png",sprite_aim_away_width:14,sprite_aim_away_height:14,sprite_aim_away_x:0,sprite_aim_away_y:14,sprite_aim_away_url:"/assets/icons.90ac55.png",sprite_aim_busy_width:14,sprite_aim_busy_height:14,sprite_aim_busy_x:0,sprite_aim_busy_y:28,sprite_aim_busy_url:"/assets/icons.90ac55.png",sprite_aim_mobile_width:14,sprite_aim_mobile_height:14,sprite_aim_mobile_x:0,sprite_aim_mobile_y:42,sprite_aim_mobile_url:"/assets/icons.90ac55.png",sprite_aim_offline_width:14,sprite_aim_offline_height:14,sprite_aim_offline_x:0,sprite_aim_offline_y:56,sprite_aim_offline_url:"/assets/icons.90ac55.png",sprite_groups_available_width:14,sprite_groups_available_height:14,sprite_groups_available_x:0,sprite_groups_available_y:70,sprite_groups_available_url:"/assets/icons.90ac55.png",sprite_groups_away_width:14,sprite_groups_away_height:14,sprite_groups_away_x:0,sprite_groups_away_y:84,sprite_groups_away_url:"/assets/icons.90ac55.png",sprite_groups_pending_width:14,sprite_groups_pending_height:14,sprite_groups_pending_x:0,sprite_groups_pending_y:98,sprite_groups_pending_url:"/assets/icons.90ac55.png",sprite_imo_available_width:14,sprite_imo_available_height:14,sprite_imo_available_x:0,sprite_imo_available_y:112,sprite_imo_available_url:"/assets/icons.90ac55.png",sprite_imo_away_width:14,sprite_imo_away_height:14,sprite_imo_away_x:0,sprite_imo_away_y:126,sprite_imo_away_url:"/assets/icons.90ac55.png",sprite_imo_busy_width:14,sprite_imo_busy_height:14,sprite_imo_busy_x:0,sprite_imo_busy_y:140,sprite_imo_busy_url:"/assets/icons.90ac55.png",sprite_imo_mobile_width:14,sprite_imo_mobile_height:14,sprite_imo_mobile_x:0,sprite_imo_mobile_y:154,sprite_imo_mobile_url:"/assets/icons.90ac55.png",sprite_imo_offline_width:14,sprite_imo_offline_height:14,sprite_imo_offline_x:0,sprite_imo_offline_y:168,sprite_imo_offline_url:"/assets/icons.90ac55.png",sprite_imo_unknown_width:14,sprite_imo_unknown_height:14,sprite_imo_unknown_x:0,sprite_imo_unknown_y:182,sprite_imo_unknown_url:"/assets/icons.90ac55.png",sprite_jabber_available_width:14,sprite_jabber_available_height:14,sprite_jabber_available_x:0,sprite_jabber_available_y:196,sprite_jabber_available_url:"/assets/icons.90ac55.png",sprite_jabber_away_width:14,sprite_jabber_away_height:14,sprite_jabber_away_x:0,sprite_jabber_away_y:210,sprite_jabber_away_url:"/assets/icons.90ac55.png",sprite_jabber_busy_width:14,sprite_jabber_busy_height:14,sprite_jabber_busy_x:0,sprite_jabber_busy_y:224,sprite_jabber_busy_url:"/assets/icons.90ac55.png",sprite_jabber_mobile_width:14,sprite_jabber_mobile_height:14,sprite_jabber_mobile_x:0,sprite_jabber_mobile_y:238,sprite_jabber_mobile_url:"/assets/icons.90ac55.png",sprite_jabber_offline_width:14,sprite_jabber_offline_height:14,sprite_jabber_offline_x:0,sprite_jabber_offline_y:252,sprite_jabber_offline_url:"/assets/icons.90ac55.png",sprite_newfacebook_available_width:14,sprite_newfacebook_available_height:14,sprite_newfacebook_available_x:0,sprite_newfacebook_available_y:266,sprite_newfacebook_available_url:"/assets/icons.90ac55.png",sprite_newfacebook_away_width:14,sprite_newfacebook_away_height:14,sprite_newfacebook_away_x:0,sprite_newfacebook_away_y:280,sprite_newfacebook_away_url:"/assets/icons.90ac55.png",sprite_newfacebook_busy_width:14,sprite_newfacebook_busy_height:14,sprite_newfacebook_busy_x:0,sprite_newfacebook_busy_y:294,sprite_newfacebook_busy_url:"/assets/icons.90ac55.png",sprite_newfacebook_offline_width:14,sprite_newfacebook_offline_height:14,sprite_newfacebook_offline_x:0,sprite_newfacebook_offline_y:308,sprite_newfacebook_offline_url:"/assets/icons.90ac55.png",sprite_skype_available_width:14,sprite_skype_available_height:14,sprite_skype_available_x:0,sprite_skype_available_y:322,sprite_skype_available_url:"/assets/icons.90ac55.png",sprite_skype_away_width:14,sprite_skype_away_height:14,sprite_skype_away_x:0,sprite_skype_away_y:336,sprite_skype_away_url:"/assets/icons.90ac55.png",sprite_skype_busy_width:14,sprite_skype_busy_height:14,sprite_skype_busy_x:0,sprite_skype_busy_y:350,sprite_skype_busy_url:"/assets/icons.90ac55.png",sprite_skype_mobile_width:14,sprite_skype_mobile_height:14,sprite_skype_mobile_x:0,sprite_skype_mobile_y:364,sprite_skype_mobile_url:"/assets/icons.90ac55.png",sprite_skype_offline_width:14,sprite_skype_offline_height:14,sprite_skype_offline_x:0,sprite_skype_offline_y:378,sprite_skype_offline_url:"/assets/icons.90ac55.png",sprite_steam_available_width:14,sprite_steam_available_height:14,sprite_steam_available_x:0,sprite_steam_available_y:392,sprite_steam_available_url:"/assets/icons.90ac55.png",sprite_steam_away_width:14,sprite_steam_away_height:14,sprite_steam_away_x:0,sprite_steam_away_y:406,sprite_steam_away_url:"/assets/icons.90ac55.png",sprite_steam_busy_width:14,sprite_steam_busy_height:14,sprite_steam_busy_x:0,sprite_steam_busy_y:420,sprite_steam_busy_url:"/assets/icons.90ac55.png",sprite_steam_offline_width:14,sprite_steam_offline_height:14,sprite_steam_offline_x:0,sprite_steam_offline_y:434,sprite_steam_offline_url:"/assets/icons.90ac55.png",sprite_vkontakte_available_width:14,sprite_vkontakte_available_height:14,sprite_vkontakte_available_x:0,sprite_vkontakte_available_y:448,sprite_vkontakte_available_url:"/assets/icons.90ac55.png",sprite_vkontakte_away_width:14,sprite_vkontakte_away_height:14,sprite_vkontakte_away_x:0,sprite_vkontakte_away_y:462,sprite_vkontakte_away_url:"/assets/icons.90ac55.png",sprite_vkontakte_busy_width:14,sprite_vkontakte_busy_height:14,sprite_vkontakte_busy_x:0,sprite_vkontakte_busy_y:476,sprite_vkontakte_busy_url:"/assets/icons.90ac55.png",sprite_vkontakte_mobile_width:14,sprite_vkontakte_mobile_height:14,sprite_vkontakte_mobile_x:0,sprite_vkontakte_mobile_y:490,sprite_vkontakte_mobile_url:"/assets/icons.90ac55.png",sprite_vkontakte_offline_width:14,sprite_vkontakte_offline_height:14,sprite_vkontakte_offline_x:0,sprite_vkontakte_offline_y:504,sprite_vkontakte_offline_url:"/assets/icons.90ac55.png",sprite_xmpp_available_width:14,sprite_xmpp_available_height:14,sprite_xmpp_available_x:0,sprite_xmpp_available_y:518,sprite_xmpp_available_url:"/assets/icons.90ac55.png",sprite_xmpp_away_width:14,sprite_xmpp_away_height:14,sprite_xmpp_away_x:0,sprite_xmpp_away_y:532,sprite_xmpp_away_url:"/assets/icons.90ac55.png",sprite_xmpp_busy_width:14,sprite_xmpp_busy_height:14,sprite_xmpp_busy_x:0,sprite_xmpp_busy_y:546,sprite_xmpp_busy_url:"/assets/icons.90ac55.png",sprite_xmpp_mobile_width:14,sprite_xmpp_mobile_height:14,sprite_xmpp_mobile_x:0,sprite_xmpp_mobile_y:560,sprite_xmpp_mobile_url:"/assets/icons.90ac55.png",sprite_xmpp_offline_width:14,sprite_xmpp_offline_height:14,sprite_xmpp_offline_x:0,sprite_xmpp_offline_y:574,sprite_xmpp_offline_url:"/assets/icons.90ac55.png",sprite_yahoo_available_width:14,sprite_yahoo_available_height:14,sprite_yahoo_available_x:0,sprite_yahoo_available_y:588,sprite_yahoo_available_url:"/assets/icons.90ac55.png",sprite_yahoo_away_width:14,sprite_yahoo_away_height:14,sprite_yahoo_away_x:0,sprite_yahoo_away_y:602,sprite_yahoo_away_url:"/assets/icons.90ac55.png",sprite_yahoo_busy_width:14,sprite_yahoo_busy_height:14,sprite_yahoo_busy_x:0,sprite_yahoo_busy_y:616,sprite_yahoo_busy_url:"/assets/icons.90ac55.png",sprite_yahoo_mobile_width:14,sprite_yahoo_mobile_height:14,sprite_yahoo_mobile_x:0,sprite_yahoo_mobile_y:630,sprite_yahoo_mobile_url:"/assets/icons.90ac55.png",sprite_yahoo_offline_width:14,sprite_yahoo_offline_height:14,sprite_yahoo_offline_x:0,sprite_yahoo_offline_y:644,sprite_yahoo_offline_url:"/assets/icons.90ac55.png",sprite_msn_available_width:15,sprite_msn_available_height:15,sprite_msn_available_x:0,sprite_msn_available_y:658,sprite_msn_available_url:"/assets/icons.90ac55.png",sprite_msn_away_width:16,sprite_msn_away_height:15,sprite_msn_away_x:0,sprite_msn_away_y:673,sprite_msn_away_url:"/assets/icons.90ac55.png",sprite_msn_busy_width:15,sprite_msn_busy_height:15,sprite_msn_busy_x:0,sprite_msn_busy_y:688,sprite_msn_busy_url:"/assets/icons.90ac55.png",sprite_msn_mobile_width:15,sprite_msn_mobile_height:15,sprite_msn_mobile_x:0,sprite_msn_mobile_y:703,sprite_msn_mobile_url:"/assets/icons.90ac55.png",sprite_msn_offline_width:15,sprite_msn_offline_height:15,sprite_msn_offline_x:0,sprite_msn_offline_y:718,sprite_msn_offline_url:"/assets/icons.90ac55.png",sprite_groups_skype_width:16,sprite_groups_skype_height:16,sprite_groups_skype_x:0,sprite_groups_skype_y:733,sprite_groups_skype_url:"/assets/icons.90ac55.png",sprite_aim_width:20,sprite_aim_height:20,sprite_aim_x:0,sprite_aim_y:749,sprite_aim_url:"/assets/icons.90ac55.png",sprite_hyves_width:20,sprite_hyves_height:20,sprite_hyves_x:0,sprite_hyves_y:769,sprite_hyves_url:"/assets/icons.90ac55.png",sprite_icq_width:20,sprite_icq_height:20,sprite_icq_x:0,sprite_icq_y:789,sprite_icq_url:"/assets/icons.90ac55.png",sprite_imo_width:20,sprite_imo_height:20,sprite_imo_x:0,sprite_imo_y:809,sprite_imo_url:"/assets/icons.90ac55.png",sprite_jabber_width:20,sprite_jabber_height:20,sprite_jabber_x:0,sprite_jabber_y:829,sprite_jabber_url:"/assets/icons.90ac55.png",sprite_msn_width:20,sprite_msn_height:20,sprite_msn_x:0,sprite_msn_y:849,sprite_msn_url:"/assets/icons.90ac55.png",sprite_myspace_width:20,sprite_myspace_height:20,sprite_myspace_x:0,sprite_myspace_y:869,sprite_myspace_url:"/assets/icons.90ac55.png",sprite_newfacebook_width:20,sprite_newfacebook_height:20,sprite_newfacebook_x:0,sprite_newfacebook_y:889,sprite_newfacebook_url:"/assets/icons.90ac55.png",sprite_skype_width:20,sprite_skype_height:20,sprite_skype_x:0,sprite_skype_y:909,sprite_skype_url:"/assets/icons.90ac55.png",sprite_steam_width:20,sprite_steam_height:20,sprite_steam_x:0,sprite_steam_y:929,sprite_steam_url:"/assets/icons.90ac55.png",sprite_vkontakte_width:20,sprite_vkontakte_height:20,sprite_vkontakte_x:0,sprite_vkontakte_y:949,sprite_vkontakte_url:"/assets/icons.90ac55.png",sprite_xmpp_width:20,sprite_xmpp_height:20,sprite_xmpp_x:0,sprite_xmpp_y:969,sprite_xmpp_url:"/assets/icons.90ac55.png",sprite_yahoo_width:20,sprite_yahoo_height:20,sprite_yahoo_x:0,sprite_yahoo_y:989,sprite_yahoo_url:"/assets/icons.90ac55.png",sprite_groups_skype_20_width:20,sprite_groups_skype_20_height:22,sprite_groups_skype_20_x:0,sprite_groups_skype_20_y:1009,sprite_groups_skype_20_url:"/assets/icons.90ac55.png",sprite_hyves_available_width:22,sprite_hyves_available_height:22,sprite_hyves_available_x:0,sprite_hyves_available_y:1031,sprite_hyves_available_url:"/assets/icons.90ac55.png",sprite_hyves_away_width:22,sprite_hyves_away_height:22,sprite_hyves_away_x:0,sprite_hyves_away_y:1053,sprite_hyves_away_url:"/assets/icons.90ac55.png",sprite_hyves_busy_width:22,sprite_hyves_busy_height:22,sprite_hyves_busy_x:0,sprite_hyves_busy_y:1075,sprite_hyves_busy_url:"/assets/icons.90ac55.png",sprite_hyves_mobile_width:22,sprite_hyves_mobile_height:22,sprite_hyves_mobile_x:0,sprite_hyves_mobile_y:1097,sprite_hyves_mobile_url:"/assets/icons.90ac55.png",sprite_hyves_offline_width:22,sprite_hyves_offline_height:22,sprite_hyves_offline_x:0,sprite_hyves_offline_y:1119,sprite_hyves_offline_url:"/assets/icons.90ac55.png",sprite_icn_fullscreen_width:14,sprite_icn_fullscreen_height:14,sprite_icn_fullscreen_x:0,sprite_icn_fullscreen_y:0,sprite_icn_fullscreen_url:"/assets/smartbar.b00811.png",sprite_icn_fullscreen_hover_width:14,sprite_icn_fullscreen_hover_height:14,sprite_icn_fullscreen_hover_x:0,sprite_icn_fullscreen_hover_y:14,sprite_icn_fullscreen_hover_url:"/assets/smartbar.b00811.png",sprite_icn_normalscreen_width:14,sprite_icn_normalscreen_height:14,sprite_icn_normalscreen_x:0,sprite_icn_normalscreen_y:28,sprite_icn_normalscreen_url:"/assets/smartbar.b00811.png",sprite_icn_normalscreen_hover_width:14,sprite_icn_normalscreen_hover_height:14,sprite_icn_normalscreen_hover_x:0,sprite_icn_normalscreen_hover_y:42,sprite_icn_normalscreen_hover_url:"/assets/smartbar.b00811.png",sprite_arr_down_width:20,sprite_arr_down_height:20,sprite_arr_down_x:0,sprite_arr_down_y:56,sprite_arr_down_url:"/assets/smartbar.b00811.png",sprite_arr_down_hover_width:20,sprite_arr_down_hover_height:20,sprite_arr_down_hover_x:0,sprite_arr_down_hover_y:76,sprite_arr_down_hover_url:"/assets/smartbar.b00811.png",sprite_arr_left_width:20,sprite_arr_left_height:20,sprite_arr_left_x:0,sprite_arr_left_y:96,sprite_arr_left_url:"/assets/smartbar.b00811.png",sprite_arr_left_hover_width:20,sprite_arr_left_hover_height:20,sprite_arr_left_hover_x:0,sprite_arr_left_hover_y:116,sprite_arr_left_hover_url:"/assets/smartbar.b00811.png",sprite_arr_right_width:20,sprite_arr_right_height:20,sprite_arr_right_x:0,sprite_arr_right_y:136,sprite_arr_right_url:"/assets/smartbar.b00811.png",sprite_arr_right_hover_width:20,sprite_arr_right_hover_height:20,sprite_arr_right_hover_x:0,sprite_arr_right_hover_y:156,sprite_arr_right_hover_url:"/assets/smartbar.b00811.png",sprite_arr_up_width:20,sprite_arr_up_height:20,sprite_arr_up_x:0,sprite_arr_up_y:176,sprite_arr_up_url:"/assets/smartbar.b00811.png",sprite_arr_up_hover_width:20,sprite_arr_up_hover_height:20,sprite_arr_up_hover_x:0,sprite_arr_up_hover_y:196,sprite_arr_up_hover_url:"/assets/smartbar.b00811.png",sprite_btn_play_width:53,sprite_btn_play_height:25,sprite_btn_play_x:0,sprite_btn_play_y:0,sprite_btn_play_url:"/assets/games.97ef35.png",sprite_game_backgammon_width:64,sprite_game_backgammon_height:64,sprite_game_backgammon_x:0,sprite_game_backgammon_y:25,sprite_game_backgammon_url:"/assets/games.97ef35.png",sprite_game_go_width:64,sprite_game_go_height:64,sprite_game_go_x:0,sprite_game_go_y:89,sprite_game_go_url:"/assets/games.97ef35.png",sprite_game_hangman_width:64,sprite_game_hangman_height:64,sprite_game_hangman_x:0,sprite_game_hangman_y:153,sprite_game_hangman_url:"/assets/games.97ef35.png",sprite_icn_typewithme_width:64,sprite_icn_typewithme_height:64,sprite_icn_typewithme_x:0,sprite_icn_typewithme_y:217,sprite_icn_typewithme_url:"/assets/games.97ef35.png",sprite_lichess_org2_width:64,sprite_lichess_org2_height:64,sprite_lichess_org2_x:0,sprite_lichess_org2_y:281,sprite_lichess_org2_url:"/assets/games.97ef35.png",sprite_white_board_width:64,sprite_white_board_height:64,sprite_white_board_x:0,sprite_white_board_y:345,sprite_white_board_url:"/assets/games.97ef35.png",sprite_scroll_back_width:19,sprite_scroll_back_height:1,sprite_scroll_back_x:0,sprite_scroll_back_y:0,sprite_scroll_back_url:"/assets/main.57633a.png",sprite_icn_expand_horiz_width:17,sprite_icn_expand_horiz_height:3,sprite_icn_expand_horiz_x:19,sprite_icn_expand_horiz_y:0,sprite_icn_expand_horiz_url:"/assets/main.57633a.png",sprite_icn_arrdown_s_width:7,sprite_icn_arrdown_s_height:4,sprite_icn_arrdown_s_x:36,sprite_icn_arrdown_s_y:0,sprite_icn_arrdown_s_url:"/assets/main.57633a.png",sprite_rail_classic_x_width:250,sprite_rail_classic_x_height:4,sprite_rail_classic_x_x:43,sprite_rail_classic_x_y:0,sprite_rail_classic_x_url:"/assets/main.57633a.png",sprite_btn_voice_im_stop_width:7,sprite_btn_voice_im_stop_height:7,sprite_btn_voice_im_stop_x:293,sprite_btn_voice_im_stop_y:0,sprite_btn_voice_im_stop_url:"/assets/main.57633a.png",sprite_vol_ind_background_down_width:53,sprite_vol_ind_background_down_height:7,sprite_vol_ind_background_down_x:300,sprite_vol_ind_background_down_y:0,sprite_vol_ind_background_down_url:"/assets/main.57633a.png",sprite_vol_ind_background_up_width:53,sprite_vol_ind_background_up_height:7,sprite_vol_ind_background_up_x:353,sprite_vol_ind_background_up_y:0,sprite_vol_ind_background_up_url:"/assets/main.57633a.png",sprite_vol_ind_foreground_down_width:53,sprite_vol_ind_foreground_down_height:7,sprite_vol_ind_foreground_down_x:406,sprite_vol_ind_foreground_down_y:0,sprite_vol_ind_foreground_down_url:"/assets/main.57633a.png",sprite_vol_ind_foreground_up_width:53,sprite_vol_ind_foreground_up_height:7,sprite_vol_ind_foreground_up_x:459,sprite_vol_ind_foreground_up_y:0,sprite_vol_ind_foreground_up_url:"/assets/main.57633a.png",sprite_icn_window_expand_width:8,sprite_icn_window_expand_height:8,sprite_icn_window_expand_x:512,sprite_icn_window_expand_y:0,sprite_icn_window_expand_url:"/assets/main.57633a.png",sprite_tooltip2_1_width:8,sprite_tooltip2_1_height:8,sprite_tooltip2_1_x:520,sprite_tooltip2_1_y:0,sprite_tooltip2_1_url:"/assets/main.57633a.png",sprite_tooltip2_2_width:250,sprite_tooltip2_2_height:8,sprite_tooltip2_2_x:0,sprite_tooltip2_2_y:8,sprite_tooltip2_2_url:"/assets/main.57633a.png",sprite_tooltip2_3_width:8,sprite_tooltip2_3_height:8,sprite_tooltip2_3_x:250,sprite_tooltip2_3_y:8,sprite_tooltip2_3_url:"/assets/main.57633a.png",sprite_tooltip2_7_width:8,sprite_tooltip2_7_height:8,sprite_tooltip2_7_x:258,sprite_tooltip2_7_y:8,sprite_tooltip2_7_url:"/assets/main.57633a.png",sprite_tooltip2_8_width:250,sprite_tooltip2_8_height:8,sprite_tooltip2_8_x:266,sprite_tooltip2_8_y:8,sprite_tooltip2_8_url:"/assets/main.57633a.png",sprite_tooltip2_9_width:8,sprite_tooltip2_9_height:8,sprite_tooltip2_9_x:516,sprite_tooltip2_9_y:8,sprite_tooltip2_9_url:"/assets/main.57633a.png",sprite_icn_apps_width:14,sprite_icn_apps_height:10,sprite_icn_apps_x:524,sprite_icn_apps_y:8,sprite_icn_apps_url:"/assets/main.57633a.png",sprite_icn_cal_next_width:6,sprite_icn_cal_next_height:10,sprite_icn_cal_next_x:538,sprite_icn_cal_next_y:8,sprite_icn_cal_next_url:"/assets/main.57633a.png",sprite_icn_chat_small_width:12,sprite_icn_chat_small_height:10,sprite_icn_chat_small_x:544,sprite_icn_chat_small_y:8,sprite_icn_chat_small_url:"/assets/main.57633a.png",sprite_icn_less_width:10,sprite_icn_less_height:10,sprite_icn_less_x:556,sprite_icn_less_y:8,sprite_icn_less_url:"/assets/main.57633a.png",sprite_icn_more_width:10,sprite_icn_more_height:10,sprite_icn_more_x:566,sprite_icn_more_y:8,sprite_icn_more_url:"/assets/main.57633a.png",sprite_icn_next_width:7,sprite_icn_next_height:10,sprite_icn_next_x:576,sprite_icn_next_y:8,sprite_icn_next_url:"/assets/main.57633a.png",sprite_icn_previous_width:7,sprite_icn_previous_height:10,sprite_icn_previous_x:583,sprite_icn_previous_y:8,sprite_icn_previous_url:"/assets/main.57633a.png",sprite_icn_tabview_width:10,sprite_icn_tabview_height:10,sprite_icn_tabview_x:590,sprite_icn_tabview_y:8,sprite_icn_tabview_url:"/assets/main.57633a.png",sprite_icn_windowview_width:10,sprite_icn_windowview_height:10,sprite_icn_windowview_x:600,sprite_icn_windowview_y:8,sprite_icn_windowview_url:"/assets/main.57633a.png",sprite_btn_voice_im_play_width:7,sprite_btn_voice_im_play_height:11,sprite_btn_voice_im_play_x:610,sprite_btn_voice_im_play_y:8,sprite_btn_voice_im_play_url:"/assets/main.57633a.png",sprite_icn_detach_width:10,sprite_icn_detach_height:11,sprite_icn_detach_x:617,sprite_icn_detach_y:8,sprite_icn_detach_url:"/assets/main.57633a.png",sprite_icn_link_smaller_width:11,sprite_icn_link_smaller_height:11,sprite_icn_link_smaller_x:627,sprite_icn_link_smaller_y:8,sprite_icn_link_smaller_url:"/assets/main.57633a.png",sprite_icn_profile_small_width:11,sprite_icn_profile_small_height:11,sprite_icn_profile_small_x:638,sprite_icn_profile_small_y:8,sprite_icn_profile_small_url:"/assets/main.57633a.png",sprite_icn_redcheck_width:11,sprite_icn_redcheck_height:11,sprite_icn_redcheck_x:649,sprite_icn_redcheck_y:8,sprite_icn_redcheck_url:"/assets/main.57633a.png",sprite_icn_trash_width:8,sprite_icn_trash_height:11,sprite_icn_trash_x:660,sprite_icn_trash_y:8,sprite_icn_trash_url:"/assets/main.57633a.png",sprite_sm_pointer_width:29,sprite_sm_pointer_height:11,sprite_sm_pointer_x:668,sprite_sm_pointer_y:8,sprite_sm_pointer_url:"/assets/main.57633a.png",sprite_icn_add_buddy_width:12,sprite_icn_add_buddy_height:12,sprite_icn_add_buddy_x:0,sprite_icn_add_buddy_y:19,sprite_icn_add_buddy_url:"/assets/main.57633a.png",sprite_icn_block_width:11,sprite_icn_block_height:12,sprite_icn_block_x:12,sprite_icn_block_y:19,sprite_icn_block_url:"/assets/main.57633a.png",sprite_icn_expand_up_width:16,sprite_icn_expand_up_height:12,sprite_icn_expand_up_x:35,sprite_icn_expand_up_y:19,sprite_icn_expand_up_url:"/assets/main.57633a.png",sprite_icn_search_12_width:12,sprite_icn_search_12_height:12,sprite_icn_search_12_x:51,sprite_icn_search_12_y:19,sprite_icn_search_12_url:"/assets/main.57633a.png",sprite_icn_chathistory_clock_width:13,sprite_icn_chathistory_clock_height:13,sprite_icn_chathistory_clock_x:63,sprite_icn_chathistory_clock_y:19,sprite_icn_chathistory_clock_url:"/assets/main.57633a.png",sprite_icn_dir_width:13,sprite_icn_dir_height:13,sprite_icn_dir_x:76,sprite_icn_dir_y:19,sprite_icn_dir_url:"/assets/main.57633a.png",sprite_icn_favorite_width:13,sprite_icn_favorite_height:13,sprite_icn_favorite_x:89,sprite_icn_favorite_y:19,sprite_icn_favorite_url:"/assets/main.57633a.png",sprite_icn_invite_plus_width:13,sprite_icn_invite_plus_height:13,sprite_icn_invite_plus_x:102,sprite_icn_invite_plus_y:19,sprite_icn_invite_plus_url:"/assets/main.57633a.png",sprite_icn_voice_width:14,sprite_icn_voice_height:13,sprite_icn_voice_x:115,sprite_icn_voice_y:19,sprite_icn_voice_url:"/assets/main.57633a.png",sprite_sm_icn_next_width:8,sprite_sm_icn_next_height:13,sprite_sm_icn_next_x:129,sprite_sm_icn_next_y:19,sprite_sm_icn_next_url:"/assets/main.57633a.png",sprite_sm_icn_prev_width:9,sprite_sm_icn_prev_height:13,sprite_sm_icn_prev_x:137,sprite_sm_icn_prev_y:19,sprite_sm_icn_prev_url:"/assets/main.57633a.png",sprite_vol_ind_background_width:53,sprite_vol_ind_background_height:13,sprite_vol_ind_background_x:146,sprite_vol_ind_background_y:19,sprite_vol_ind_background_url:"/assets/main.57633a.png",sprite_vol_ind_foreground_width:53,sprite_vol_ind_foreground_height:13,sprite_vol_ind_foreground_x:199,sprite_vol_ind_foreground_y:19,sprite_vol_ind_foreground_url:"/assets/main.57633a.png",sprite_icn_collapse_width:14,sprite_icn_collapse_height:14,sprite_icn_collapse_x:252,sprite_icn_collapse_y:19,sprite_icn_collapse_url:"/assets/main.57633a.png",sprite_icn_expand_width:14,sprite_icn_expand_height:14,sprite_icn_expand_x:266,sprite_icn_expand_y:19,sprite_icn_expand_url:"/assets/main.57633a.png",sprite_icn_greenstatus_width:14,sprite_icn_greenstatus_height:14,sprite_icn_greenstatus_x:280,sprite_icn_greenstatus_y:19,sprite_icn_greenstatus_url:"/assets/main.57633a.png",sprite_icn_invisiblestatus_width:14,sprite_icn_invisiblestatus_height:14,sprite_icn_invisiblestatus_x:294,sprite_icn_invisiblestatus_y:19,sprite_icn_invisiblestatus_url:"/assets/main.57633a.png",sprite_icn_orangestatus_width:14,sprite_icn_orangestatus_height:14,sprite_icn_orangestatus_x:308,sprite_icn_orangestatus_y:19,sprite_icn_orangestatus_url:"/assets/main.57633a.png",sprite_icn_redstatus_width:14,sprite_icn_redstatus_height:14,sprite_icn_redstatus_x:322,sprite_icn_redstatus_y:19,sprite_icn_redstatus_url:"/assets/main.57633a.png",sprite_scroll_scroller_width:19,sprite_scroll_scroller_height:14,sprite_scroll_scroller_x:336,sprite_scroll_scroller_y:19,sprite_scroll_scroller_url:"/assets/main.57633a.png",sprite_icn_add_large_width:16,sprite_icn_add_large_height:15,sprite_icn_add_large_x:355,sprite_icn_add_large_y:19,sprite_icn_add_large_url:"/assets/main.57633a.png",sprite_icn_add_large_blue_width:16,sprite_icn_add_large_blue_height:15,sprite_icn_add_large_blue_x:371,sprite_icn_add_large_blue_y:19,sprite_icn_add_large_blue_url:"/assets/main.57633a.png",sprite_icn_addbuddy_width:20,sprite_icn_addbuddy_height:15,sprite_icn_addbuddy_x:387,sprite_icn_addbuddy_y:19,sprite_icn_addbuddy_url:"/assets/main.57633a.png",sprite_icn_addgroup_width:29,sprite_icn_addgroup_height:15,sprite_icn_addgroup_x:407,sprite_icn_addgroup_y:19,sprite_icn_addgroup_url:"/assets/main.57633a.png",sprite_icn_addsharedgroup_width:29,sprite_icn_addsharedgroup_height:15,sprite_icn_addsharedgroup_x:436,sprite_icn_addsharedgroup_y:19,sprite_icn_addsharedgroup_url:"/assets/main.57633a.png",sprite_icn_greencheck_width:16,sprite_icn_greencheck_height:15,sprite_icn_greencheck_x:465,sprite_icn_greencheck_y:19,sprite_icn_greencheck_url:"/assets/main.57633a.png",sprite_icn_sendfile_width:12,sprite_icn_sendfile_height:15,sprite_icn_sendfile_x:481,sprite_icn_sendfile_y:19,sprite_icn_sendfile_url:"/assets/main.57633a.png",sprite_icn_signout_large_width:16,sprite_icn_signout_large_height:15,sprite_icn_signout_large_x:493,sprite_icn_signout_large_y:19,sprite_icn_signout_large_url:"/assets/main.57633a.png",sprite_thumb_classic_y_width:19,sprite_thumb_classic_y_height:15,sprite_thumb_classic_y_x:509,sprite_thumb_classic_y_y:19,sprite_thumb_classic_y_url:"/assets/main.57633a.png",sprite_arrow_up_width:20,sprite_arrow_up_height:16,sprite_arrow_up_x:528,sprite_arrow_up_y:19,sprite_arrow_up_url:"/assets/main.57633a.png",sprite_icn_buddies_width:18,sprite_icn_buddies_height:16,sprite_icn_buddies_x:548,sprite_icn_buddies_y:19,sprite_icn_buddies_url:"/assets/main.57633a.png",sprite_icn_cog_width:16,sprite_icn_cog_height:16,sprite_icn_cog_x:566,sprite_icn_cog_y:19,sprite_icn_cog_url:"/assets/main.57633a.png",sprite_icn_cog_inv_width:16,sprite_icn_cog_inv_height:16,sprite_icn_cog_inv_x:582,sprite_icn_cog_inv_y:19,sprite_icn_cog_inv_url:"/assets/main.57633a.png",sprite_icn_delete_width:16,sprite_icn_delete_height:16,sprite_icn_delete_x:598,sprite_icn_delete_y:19,sprite_icn_delete_url:"/assets/main.57633a.png",sprite_icn_directory_16_width:16,sprite_icn_directory_16_height:16,sprite_icn_directory_16_x:614,sprite_icn_directory_16_y:19,sprite_icn_directory_16_url:"/assets/main.57633a.png",sprite_icn_full_screen_width:16,sprite_icn_full_screen_height:16,sprite_icn_full_screen_x:630,sprite_icn_full_screen_y:19,sprite_icn_full_screen_url:"/assets/main.57633a.png",sprite_icn_games_dice_width:16,sprite_icn_games_dice_height:16,sprite_icn_games_dice_x:646,sprite_icn_games_dice_y:19,sprite_icn_games_dice_url:"/assets/main.57633a.png",sprite_icn_games_grey_width:16,sprite_icn_games_grey_height:16,sprite_icn_games_grey_x:662,sprite_icn_games_grey_y:19,sprite_icn_games_grey_url:"/assets/main.57633a.png",sprite_icn_popout_width:16,sprite_icn_popout_height:16,sprite_icn_popout_x:678,sprite_icn_popout_y:19,sprite_icn_popout_url:"/assets/main.57633a.png",sprite_icn_profile_width:15,sprite_icn_profile_height:16,sprite_icn_profile_x:0,sprite_icn_profile_y:35,sprite_icn_profile_url:"/assets/main.57633a.png",sprite_icn_search_white_width:16,sprite_icn_search_white_height:16,sprite_icn_search_white_x:15,sprite_icn_search_white_y:35,sprite_icn_search_white_url:"/assets/main.57633a.png",sprite_icn_show_chat_width:16,sprite_icn_show_chat_height:16,sprite_icn_show_chat_x:31,sprite_icn_show_chat_y:35,sprite_icn_show_chat_url:"/assets/main.57633a.png",sprite_profile_popover_arrow_up_width:20,sprite_profile_popover_arrow_up_height:16,sprite_profile_popover_arrow_up_x:47,sprite_profile_popover_arrow_up_y:35,sprite_profile_popover_arrow_up_url:"/assets/main.57633a.png",sprite_tooltip2_arrow_width:22,sprite_tooltip2_arrow_height:16,sprite_tooltip2_arrow_x:67,sprite_tooltip2_arrow_y:35,sprite_tooltip2_arrow_url:"/assets/main.57633a.png",sprite_btn_close_width:17,sprite_btn_close_height:17,sprite_btn_close_x:89,sprite_btn_close_y:35,sprite_btn_close_url:"/assets/main.57633a.png",sprite_btn_close_small_width:17,sprite_btn_close_small_height:17,sprite_btn_close_small_x:106,sprite_btn_close_small_y:35,sprite_btn_close_small_url:"/assets/main.57633a.png",sprite_btn_maximize_width:17,sprite_btn_maximize_height:17,sprite_btn_maximize_x:123,sprite_btn_maximize_y:35,sprite_btn_maximize_url:"/assets/main.57633a.png",sprite_btn_minimize_width:17,sprite_btn_minimize_height:17,sprite_btn_minimize_x:140,sprite_btn_minimize_y:35,sprite_btn_minimize_url:"/assets/main.57633a.png",sprite_btn_modal_close_width:17,sprite_btn_modal_close_height:17,sprite_btn_modal_close_x:157,sprite_btn_modal_close_y:35,sprite_btn_modal_close_url:"/assets/main.57633a.png",sprite_icn_attach_width:16,sprite_icn_attach_height:17,sprite_icn_attach_x:174,sprite_icn_attach_y:35,sprite_icn_attach_url:"/assets/main.57633a.png",sprite_icn_expand_vert_width:3,sprite_icn_expand_vert_height:17,sprite_icn_expand_vert_x:190,sprite_icn_expand_vert_y:35,sprite_icn_expand_vert_url:"/assets/main.57633a.png",sprite_icn_question_width:17,sprite_icn_question_height:17,sprite_icn_question_x:193,sprite_icn_question_y:35,sprite_icn_question_url:"/assets/main.57633a.png",sprite_icn_search_2_width:16,sprite_icn_search_2_height:17,sprite_icn_search_2_x:210,sprite_icn_search_2_y:35,sprite_icn_search_2_url:"/assets/main.57633a.png",sprite_frm_calendar_width:19,sprite_frm_calendar_height:18,sprite_frm_calendar_x:226,sprite_frm_calendar_y:35,sprite_frm_calendar_url:"/assets/main.57633a.png",sprite_frm_dropdown_small_width:19,sprite_frm_dropdown_small_height:18,sprite_frm_dropdown_small_x:245,sprite_frm_dropdown_small_y:35,sprite_frm_dropdown_small_url:"/assets/main.57633a.png",sprite_icn_close_width:17,sprite_icn_close_height:18,sprite_icn_close_x:264,sprite_icn_close_y:35,sprite_icn_close_url:"/assets/main.57633a.png",sprite_icn_popin_width:18,sprite_icn_popin_height:18,sprite_icn_popin_x:281,sprite_icn_popin_y:35,sprite_icn_popin_url:"/assets/main.57633a.png",sprite_imot_frown_width:18,sprite_imot_frown_height:18,sprite_imot_frown_x:299,sprite_imot_frown_y:35,sprite_imot_frown_url:"/assets/main.57633a.png",sprite_imot_smile_width:18,sprite_imot_smile_height:18,sprite_imot_smile_x:317,sprite_imot_smile_y:35,sprite_imot_smile_url:"/assets/main.57633a.png",sprite_imot_tongue_width:18,sprite_imot_tongue_height:18,sprite_imot_tongue_x:335,sprite_imot_tongue_y:35,sprite_imot_tongue_url:"/assets/main.57633a.png",sprite_imot_wink_width:18,sprite_imot_wink_height:18,sprite_imot_wink_x:353,sprite_imot_wink_y:35,sprite_imot_wink_url:"/assets/main.57633a.png",sprite_thumb_classic_x_width:15,sprite_thumb_classic_x_height:19,sprite_thumb_classic_x_x:371,sprite_thumb_classic_x_y:35,sprite_thumb_classic_x_url:"/assets/main.57633a.png",sprite_blue_bubble_left_width:7,sprite_blue_bubble_left_height:20,sprite_blue_bubble_left_x:386,sprite_blue_bubble_left_y:35,sprite_blue_bubble_left_url:"/assets/main.57633a.png",sprite_blue_bubble_middle_width:246,sprite_blue_bubble_middle_height:20,sprite_blue_bubble_middle_x:393,sprite_blue_bubble_middle_y:35,sprite_blue_bubble_middle_url:"/assets/main.57633a.png",sprite_blue_bubble_right_width:7,sprite_blue_bubble_right_height:20,sprite_blue_bubble_right_x:639,sprite_blue_bubble_right_y:35,sprite_blue_bubble_right_url:"/assets/main.57633a.png",sprite_btn_blue_expand_width:1,sprite_btn_blue_expand_height:20,sprite_btn_blue_expand_x:646,sprite_btn_blue_expand_y:35,sprite_btn_blue_expand_url:"/assets/main.57633a.png",sprite_btn_blue_left_width:6,sprite_btn_blue_left_height:20,sprite_btn_blue_left_x:647,sprite_btn_blue_left_y:35,sprite_btn_blue_left_url:"/assets/main.57633a.png",sprite_btn_blue_right_width:6,sprite_btn_blue_right_height:20,sprite_btn_blue_right_x:653,sprite_btn_blue_right_y:35,sprite_btn_blue_right_url:"/assets/main.57633a.png",sprite_btn_blue_small_left_width:8,sprite_btn_blue_small_left_height:20,sprite_btn_blue_small_left_x:659,sprite_btn_blue_small_left_y:35,sprite_btn_blue_small_left_url:"/assets/main.57633a.png",sprite_btn_blue_small_middle_width:300,sprite_btn_blue_small_middle_height:20,sprite_btn_blue_small_middle_x:0,sprite_btn_blue_small_middle_y:55,sprite_btn_blue_small_middle_url:"/assets/main.57633a.png",sprite_btn_blue_small_right_width:8,sprite_btn_blue_small_right_height:20,sprite_btn_blue_small_right_x:300,sprite_btn_blue_small_right_y:55,sprite_btn_blue_small_right_url:"/assets/main.57633a.png",sprite_btn_chat_toggle_width:20,sprite_btn_chat_toggle_height:20,sprite_btn_chat_toggle_x:308,sprite_btn_chat_toggle_y:55,sprite_btn_chat_toggle_url:"/assets/main.57633a.png",sprite_btn_default_expand_width:1,sprite_btn_default_expand_height:20,sprite_btn_default_expand_x:328,sprite_btn_default_expand_y:55,sprite_btn_default_expand_url:"/assets/main.57633a.png",sprite_btn_default_left_width:3,sprite_btn_default_left_height:20,sprite_btn_default_left_x:329,sprite_btn_default_left_y:55,sprite_btn_default_left_url:"/assets/main.57633a.png",sprite_btn_default_right_width:3,sprite_btn_default_right_height:20,sprite_btn_default_right_x:332,sprite_btn_default_right_y:55,sprite_btn_default_right_url:"/assets/main.57633a.png",sprite_btn_grey_small_left_width:8,sprite_btn_grey_small_left_height:20,sprite_btn_grey_small_left_x:335,sprite_btn_grey_small_left_y:55,sprite_btn_grey_small_left_url:"/assets/main.57633a.png",sprite_btn_grey_small_middle_width:300,sprite_btn_grey_small_middle_height:20,sprite_btn_grey_small_middle_x:343,sprite_btn_grey_small_middle_y:55,sprite_btn_grey_small_middle_url:"/assets/main.57633a.png",sprite_btn_grey_small_right_width:8,sprite_btn_grey_small_right_height:20,sprite_btn_grey_small_right_x:643,sprite_btn_grey_small_right_y:55,sprite_btn_grey_small_right_url:"/assets/main.57633a.png",sprite_btn_videochat_audio_disabled_width:20,sprite_btn_videochat_audio_disabled_height:20,sprite_btn_videochat_audio_disabled_x:651,sprite_btn_videochat_audio_disabled_y:55,sprite_btn_videochat_audio_disabled_url:"/assets/main.57633a.png",sprite_btn_videochat_audio_enabled_width:20,sprite_btn_videochat_audio_enabled_height:20,sprite_btn_videochat_audio_enabled_x:671,sprite_btn_videochat_audio_enabled_y:55,sprite_btn_videochat_audio_enabled_url:"/assets/main.57633a.png",sprite_btn_videochat_expand_width:20,sprite_btn_videochat_expand_height:20,sprite_btn_videochat_expand_x:0,sprite_btn_videochat_expand_y:75,sprite_btn_videochat_expand_url:"/assets/main.57633a.png",sprite_btn_videochat_shrink_width:20,sprite_btn_videochat_shrink_height:20,sprite_btn_videochat_shrink_x:20,sprite_btn_videochat_shrink_y:75,sprite_btn_videochat_shrink_url:"/assets/main.57633a.png",sprite_btn_videochat_speaker_disabled_width:20,sprite_btn_videochat_speaker_disabled_height:20,sprite_btn_videochat_speaker_disabled_x:40,sprite_btn_videochat_speaker_disabled_y:75,sprite_btn_videochat_speaker_disabled_url:"/assets/main.57633a.png",sprite_btn_videochat_speaker_enabled_width:20,sprite_btn_videochat_speaker_enabled_height:20,sprite_btn_videochat_speaker_enabled_x:60,sprite_btn_videochat_speaker_enabled_y:75,sprite_btn_videochat_speaker_enabled_url:"/assets/main.57633a.png",sprite_btn_videochat_video_disabled_width:20,sprite_btn_videochat_video_disabled_height:20,sprite_btn_videochat_video_disabled_x:80,sprite_btn_videochat_video_disabled_y:75,sprite_btn_videochat_video_disabled_url:"/assets/main.57633a.png",sprite_btn_videochat_video_enabled_width:20,sprite_btn_videochat_video_enabled_height:20,sprite_btn_videochat_video_enabled_x:100,sprite_btn_videochat_video_enabled_y:75,sprite_btn_videochat_video_enabled_url:"/assets/main.57633a.png",sprite_btn_voiceim_toggle_width:20,sprite_btn_voiceim_toggle_height:20,sprite_btn_voiceim_toggle_x:120,sprite_btn_voiceim_toggle_y:75,sprite_btn_voiceim_toggle_url:"/assets/main.57633a.png",sprite_icn_accept_width:20,sprite_icn_accept_height:20,sprite_icn_accept_x:140,sprite_icn_accept_y:75,sprite_icn_accept_url:"/assets/main.57633a.png",sprite_icn_deny_width:20,sprite_icn_deny_height:20,sprite_icn_deny_x:160,sprite_icn_deny_y:75,sprite_icn_deny_url:"/assets/main.57633a.png",sprite_icn_hangup_width:20,sprite_icn_hangup_height:20,sprite_icn_hangup_x:180,sprite_icn_hangup_y:75,sprite_icn_hangup_url:"/assets/main.57633a.png",sprite_icn_link_small_width:20,sprite_icn_link_small_height:20,sprite_icn_link_small_x:200,sprite_icn_link_small_y:75,sprite_icn_link_small_url:"/assets/main.57633a.png",sprite_icn_microphone_width:20,sprite_icn_microphone_height:20,sprite_icn_microphone_x:220,sprite_icn_microphone_y:75,sprite_icn_microphone_url:"/assets/main.57633a.png",sprite_icn_pause_width:20,sprite_icn_pause_height:20,sprite_icn_pause_x:240,sprite_icn_pause_y:75,sprite_icn_pause_url:"/assets/main.57633a.png",sprite_icn_settings_width:20,sprite_icn_settings_height:20,sprite_icn_settings_x:260,sprite_icn_settings_y:75,sprite_icn_settings_url:"/assets/main.57633a.png",sprite_icn_video_width:20,sprite_icn_video_height:20,sprite_icn_video_x:280,sprite_icn_video_y:75,sprite_icn_video_url:"/assets/main.57633a.png",sprite_profile_popover_arrow_width:16,sprite_profile_popover_arrow_height:20,sprite_profile_popover_arrow_x:300,sprite_profile_popover_arrow_y:75,sprite_profile_popover_arrow_url:"/assets/main.57633a.png",sprite_profile_popover_arrow_left_width:16,sprite_profile_popover_arrow_left_height:20,sprite_profile_popover_arrow_left_x:316,sprite_profile_popover_arrow_left_y:75,sprite_profile_popover_arrow_left_url:"/assets/main.57633a.png",sprite_btn_close_popovers_width:21,sprite_btn_close_popovers_height:21,sprite_btn_close_popovers_x:332,sprite_btn_close_popovers_y:75,sprite_btn_close_popovers_url:"/assets/main.57633a.png",sprite_frm_search_dropdown_width:22,sprite_frm_search_dropdown_height:21,sprite_frm_search_dropdown_x:353,sprite_frm_search_dropdown_y:75,sprite_frm_search_dropdown_url:"/assets/main.57633a.png",sprite_icn_twitter_width:17,sprite_icn_twitter_height:21,sprite_icn_twitter_x:375,sprite_icn_twitter_y:75,sprite_icn_twitter_url:"/assets/main.57633a.png",sprite_meter_voicechat_width:207,sprite_meter_voicechat_height:21,sprite_meter_voicechat_x:392,sprite_meter_voicechat_y:75,sprite_meter_voicechat_url:"/assets/main.57633a.png",sprite_switcher_off_width:42,sprite_switcher_off_height:21,sprite_switcher_off_x:599,sprite_switcher_off_y:75,sprite_switcher_off_url:"/assets/main.57633a.png",sprite_switcher_on_width:42,sprite_switcher_on_height:21,sprite_switcher_on_x:641,sprite_switcher_on_y:75,sprite_switcher_on_url:"/assets/main.57633a.png",sprite_conference_header_width:266,sprite_conference_header_height:22,sprite_conference_header_x:0,sprite_conference_header_y:96,sprite_conference_header_url:"/assets/main.57633a.png",sprite_discussion_header_width:266,sprite_discussion_header_height:22,sprite_discussion_header_x:266,sprite_discussion_header_y:96,sprite_discussion_header_url:"/assets/main.57633a.png",sprite_frm_dropdown_width:22,sprite_frm_dropdown_height:22,sprite_frm_dropdown_x:532,sprite_frm_dropdown_y:96,sprite_frm_dropdown_url:"/assets/main.57633a.png",sprite_group_header_width:266,sprite_group_header_height:22,sprite_group_header_x:0,sprite_group_header_y:118,sprite_group_header_url:"/assets/main.57633a.png",sprite_icn_group_muted_width:20,sprite_icn_group_muted_height:22,sprite_icn_group_muted_x:266,sprite_icn_group_muted_y:118,sprite_icn_group_muted_url:"/assets/main.57633a.png",sprite_icn_group_unmuted_width:20,sprite_icn_group_unmuted_height:22,sprite_icn_group_unmuted_x:286,sprite_icn_group_unmuted_y:118,sprite_icn_group_unmuted_url:"/assets/main.57633a.png",sprite_icn_whiteboard_width:26,sprite_icn_whiteboard_height:22,sprite_icn_whiteboard_x:306,sprite_icn_whiteboard_y:118,sprite_icn_whiteboard_url:"/assets/main.57633a.png",sprite_sharedgroup_header_width:266,sprite_sharedgroup_header_height:22,sprite_sharedgroup_header_x:332,sprite_sharedgroup_header_y:118,sprite_sharedgroup_header_url:"/assets/main.57633a.png",sprite_tooltip_left_arrow_width:16,sprite_tooltip_left_arrow_height:22,sprite_tooltip_left_arrow_x:598,sprite_tooltip_left_arrow_y:118,sprite_tooltip_left_arrow_url:"/assets/main.57633a.png",sprite_tooltip_right_arrow_width:16,sprite_tooltip_right_arrow_height:22,sprite_tooltip_right_arrow_x:614,sprite_tooltip_right_arrow_y:118,sprite_tooltip_right_arrow_url:"/assets/main.57633a.png",sprite_badge_width:23,sprite_badge_height:23,sprite_badge_x:630,sprite_badge_y:118,sprite_badge_url:"/assets/main.57633a.png",sprite_icn_calendar_next_width:23,sprite_icn_calendar_next_height:23,sprite_icn_calendar_next_x:653,sprite_icn_calendar_next_y:118,sprite_icn_calendar_next_url:"/assets/main.57633a.png",sprite_icn_calendar_prev_width:23,sprite_icn_calendar_prev_height:23,sprite_icn_calendar_prev_x:0,sprite_icn_calendar_prev_y:141,sprite_icn_calendar_prev_url:"/assets/main.57633a.png",sprite_badge_expand_width:29,sprite_badge_expand_height:24,sprite_badge_expand_x:23,sprite_badge_expand_y:141,sprite_badge_expand_url:"/assets/main.57633a.png",sprite_btn_mp3_player_pause_width:24,sprite_btn_mp3_player_pause_height:24,sprite_btn_mp3_player_pause_x:52,sprite_btn_mp3_player_pause_y:141,sprite_btn_mp3_player_pause_url:"/assets/main.57633a.png",sprite_btn_mp3_player_play_width:24,sprite_btn_mp3_player_play_height:24,sprite_btn_mp3_player_play_x:76,sprite_btn_mp3_player_play_y:141,sprite_btn_mp3_player_play_url:"/assets/main.57633a.png",sprite_btn_mp3_player_resume_width:24,sprite_btn_mp3_player_resume_height:24,sprite_btn_mp3_player_resume_x:100,sprite_btn_mp3_player_resume_y:141,sprite_btn_mp3_player_resume_url:"/assets/main.57633a.png",sprite_btn_mp3_player_stop_width:24,sprite_btn_mp3_player_stop_height:24,sprite_btn_mp3_player_stop_x:124,sprite_btn_mp3_player_stop_y:141,sprite_btn_mp3_player_stop_url:"/assets/main.57633a.png",sprite_icn_calendar_bar_width:280,sprite_icn_calendar_bar_height:24,sprite_icn_calendar_bar_x:148,sprite_icn_calendar_bar_y:141,sprite_icn_calendar_bar_url:"/assets/main.57633a.png",sprite_icn_next_large_width:15,sprite_icn_next_large_height:24,sprite_icn_next_large_x:428,sprite_icn_next_large_y:141,sprite_icn_next_large_url:"/assets/main.57633a.png",sprite_icn_previous_large_width:16,sprite_icn_previous_large_height:24,sprite_icn_previous_large_x:443,sprite_icn_previous_large_y:141,sprite_icn_previous_large_url:"/assets/main.57633a.png",sprite_popout_header_width:500,sprite_popout_header_height:24,sprite_popout_header_x:0,sprite_popout_header_y:165,sprite_popout_header_url:"/assets/main.57633a.png",sprite_badge_cam_width:25,sprite_badge_cam_height:26,sprite_badge_cam_x:500,sprite_badge_cam_y:165,sprite_badge_cam_url:"/assets/main.57633a.png",sprite_badge_mic_width:25,sprite_badge_mic_height:26,sprite_badge_mic_x:525,sprite_badge_mic_y:165,sprite_badge_mic_url:"/assets/main.57633a.png",sprite_icn_dropdown_small_width:27,sprite_icn_dropdown_small_height:26,sprite_icn_dropdown_small_x:550,sprite_icn_dropdown_small_y:165,sprite_icn_dropdown_small_url:"/assets/main.57633a.png",sprite_icn_photos_width:30,sprite_icn_photos_height:26,sprite_icn_photos_x:577,sprite_icn_photos_y:165,sprite_icn_photos_url:"/assets/main.57633a.png",sprite_imo_simple_corners_width:4,sprite_imo_simple_corners_height:26,sprite_imo_simple_corners_x:607,sprite_imo_simple_corners_y:165,sprite_imo_simple_corners_url:"/assets/main.57633a.png",sprite_tooltip_expand_width:1,sprite_tooltip_expand_height:27,sprite_tooltip_expand_x:611,sprite_tooltip_expand_y:165,sprite_tooltip_expand_url:"/assets/main.57633a.png",sprite_tooltip_left_width:7,sprite_tooltip_left_height:27,sprite_tooltip_left_x:612,sprite_tooltip_left_y:165,sprite_tooltip_left_url:"/assets/main.57633a.png",sprite_accounts_width:164,sprite_accounts_height:30,sprite_accounts_x:0,sprite_accounts_y:192,sprite_accounts_url:"/assets/main.57633a.png",sprite_add_accounts_button_width:164,sprite_add_accounts_button_height:30,sprite_add_accounts_button_x:164,sprite_add_accounts_button_y:192,sprite_add_accounts_button_url:"/assets/main.57633a.png",sprite_buddies_header_width:266,sprite_buddies_header_height:30,sprite_buddies_header_x:328,sprite_buddies_header_y:192,sprite_buddies_header_url:"/assets/main.57633a.png",sprite_logo_small_2_width:56,sprite_logo_small_2_height:30,sprite_logo_small_2_x:594,sprite_logo_small_2_y:192,sprite_logo_small_2_url:"/assets/main.57633a.png",sprite_signout_all_width:164,sprite_signout_all_height:30,sprite_signout_all_x:0,sprite_signout_all_y:222,sprite_signout_all_url:"/assets/main.57633a.png",sprite_signout_all_wide_width:266,sprite_signout_all_wide_height:30,sprite_signout_all_wide_x:164,sprite_signout_all_wide_y:222,sprite_signout_all_wide_url:"/assets/main.57633a.png",sprite_tooltip_right_width:19,sprite_tooltip_right_height:31,sprite_tooltip_right_x:430,sprite_tooltip_right_y:222,sprite_tooltip_right_url:"/assets/main.57633a.png",sprite_scroll_bottom_width:19,sprite_scroll_bottom_height:32,sprite_scroll_bottom_x:449,sprite_scroll_bottom_y:222,sprite_scroll_bottom_url:"/assets/main.57633a.png",sprite_scroll_top_width:19,sprite_scroll_top_height:32,sprite_scroll_top_x:468,sprite_scroll_top_y:222,sprite_scroll_top_url:"/assets/main.57633a.png",sprite_sm_btn_blue_expand_width:1,sprite_sm_btn_blue_expand_height:35,sprite_sm_btn_blue_expand_x:487,sprite_sm_btn_blue_expand_y:222,sprite_sm_btn_blue_expand_url:"/assets/main.57633a.png",sprite_sm_btn_blue_left_width:14,sprite_sm_btn_blue_left_height:35,sprite_sm_btn_blue_left_x:488,sprite_sm_btn_blue_left_y:222,sprite_sm_btn_blue_left_url:"/assets/main.57633a.png",sprite_sm_btn_blue_middle_width:200,sprite_sm_btn_blue_middle_height:35,sprite_sm_btn_blue_middle_x:0,sprite_sm_btn_blue_middle_y:257,sprite_sm_btn_blue_middle_url:"/assets/main.57633a.png",sprite_sm_btn_blue_right_width:14,sprite_sm_btn_blue_right_height:35,sprite_sm_btn_blue_right_x:200,sprite_sm_btn_blue_right_y:257,sprite_sm_btn_blue_right_url:"/assets/main.57633a.png",sprite_sm_btn_grey_expand_width:1,sprite_sm_btn_grey_expand_height:35,sprite_sm_btn_grey_expand_x:214,sprite_sm_btn_grey_expand_y:257,sprite_sm_btn_grey_expand_url:"/assets/main.57633a.png",sprite_sm_btn_grey_left_width:14,sprite_sm_btn_grey_left_height:35,sprite_sm_btn_grey_left_x:215,sprite_sm_btn_grey_left_y:257,sprite_sm_btn_grey_left_url:"/assets/main.57633a.png",sprite_sm_btn_grey_right_width:14,sprite_sm_btn_grey_right_height:35,sprite_sm_btn_grey_right_x:229,sprite_sm_btn_grey_right_y:257,sprite_sm_btn_grey_right_url:"/assets/main.57633a.png",sprite_pop_in_width:36,sprite_pop_in_height:37,sprite_pop_in_x:243,sprite_pop_in_y:257,sprite_pop_in_url:"/assets/main.57633a.png",sprite_btn_record_width:140,sprite_btn_record_height:40,sprite_btn_record_x:279,sprite_btn_record_y:257,sprite_btn_record_url:"/assets/main.57633a.png",sprite_btn_record_green_width:140,sprite_btn_record_green_height:40,sprite_btn_record_green_x:419,sprite_btn_record_green_y:257,sprite_btn_record_green_url:"/assets/main.57633a.png",sprite_btn_record_grey_width:140,sprite_btn_record_grey_height:40,sprite_btn_record_grey_x:0,sprite_btn_record_grey_y:297,sprite_btn_record_grey_url:"/assets/main.57633a.png",sprite_btn_record_red_width:140,sprite_btn_record_red_height:40,sprite_btn_record_red_x:140,sprite_btn_record_red_y:297,sprite_btn_record_red_url:"/assets/main.57633a.png",sprite_btn_send_width:53,sprite_btn_send_height:40,sprite_btn_send_x:280,sprite_btn_send_y:297,sprite_btn_send_url:"/assets/main.57633a.png",sprite_imo_simple_chat_logo_width:150,sprite_imo_simple_chat_logo_height:40,sprite_imo_simple_chat_logo_x:333,sprite_imo_simple_chat_logo_y:297,sprite_imo_simple_chat_logo_url:"/assets/main.57633a.png",sprite_logo_small_width:78,sprite_logo_small_height:40,sprite_logo_small_x:483,sprite_logo_small_y:297,sprite_logo_small_url:"/assets/main.57633a.png",sprite_btn_blue_lg_expand_width:1,sprite_btn_blue_lg_expand_height:44,sprite_btn_blue_lg_expand_x:561,sprite_btn_blue_lg_expand_y:297,sprite_btn_blue_lg_expand_url:"/assets/main.57633a.png",sprite_btn_blue_lg_left_width:11,sprite_btn_blue_lg_left_height:44,sprite_btn_blue_lg_left_x:562,sprite_btn_blue_lg_left_y:297,sprite_btn_blue_lg_left_url:"/assets/main.57633a.png",sprite_btn_blue_lg_right_width:11,sprite_btn_blue_lg_right_height:44,sprite_btn_blue_lg_right_x:573,sprite_btn_blue_lg_right_y:297,sprite_btn_blue_lg_right_url:"/assets/main.57633a.png",sprite_btn_grey_lg_expand_width:1,sprite_btn_grey_lg_expand_height:44,sprite_btn_grey_lg_expand_x:584,sprite_btn_grey_lg_expand_y:297,sprite_btn_grey_lg_expand_url:"/assets/main.57633a.png",sprite_btn_grey_lg_left_width:11,sprite_btn_grey_lg_left_height:44,sprite_btn_grey_lg_left_x:585,sprite_btn_grey_lg_left_y:297,sprite_btn_grey_lg_left_url:"/assets/main.57633a.png",sprite_btn_grey_lg_right_width:11,sprite_btn_grey_lg_right_height:44,sprite_btn_grey_lg_right_x:596,sprite_btn_grey_lg_right_y:297,sprite_btn_grey_lg_right_url:"/assets/main.57633a.png",sprite_btn_signin_expand_width:1,sprite_btn_signin_expand_height:44,sprite_btn_signin_expand_x:607,sprite_btn_signin_expand_y:297,sprite_btn_signin_expand_url:"/assets/main.57633a.png",sprite_btn_signin_left_width:15,sprite_btn_signin_left_height:44,sprite_btn_signin_left_x:608,sprite_btn_signin_left_y:297,sprite_btn_signin_left_url:"/assets/main.57633a.png",sprite_btn_signin_right_width:15,sprite_btn_signin_right_height:44,sprite_btn_signin_right_x:623,sprite_btn_signin_right_y:297,sprite_btn_signin_right_url:"/assets/main.57633a.png",sprite_history_view_all_left_width:8,sprite_history_view_all_left_height:44,sprite_history_view_all_left_x:638,sprite_history_view_all_left_y:297,sprite_history_view_all_left_url:"/assets/main.57633a.png",sprite_history_view_all_right_width:8,sprite_history_view_all_right_height:44,sprite_history_view_all_right_x:646,sprite_history_view_all_right_y:297,sprite_history_view_all_right_url:"/assets/main.57633a.png",sprite_logo_aim_big_width:62,sprite_logo_aim_big_height:53,sprite_logo_aim_big_x:0,sprite_logo_aim_big_y:341,sprite_logo_aim_big_url:"/assets/main.57633a.png",sprite_logo_hyves_big_width:53,sprite_logo_hyves_big_height:53,sprite_logo_hyves_big_x:62,sprite_logo_hyves_big_y:341,sprite_logo_hyves_big_url:"/assets/main.57633a.png",sprite_logo_icq_big_width:62,sprite_logo_icq_big_height:53,sprite_logo_icq_big_x:115,sprite_logo_icq_big_y:341,sprite_logo_icq_big_url:"/assets/main.57633a.png",sprite_logo_imo_big_width:53,sprite_logo_imo_big_height:53,sprite_logo_imo_big_x:177,sprite_logo_imo_big_y:341,sprite_logo_imo_big_url:"/assets/main.57633a.png",sprite_logo_jabber_big_width:53,sprite_logo_jabber_big_height:53,sprite_logo_jabber_big_x:230,sprite_logo_jabber_big_y:341,sprite_logo_jabber_big_url:"/assets/main.57633a.png",sprite_logo_msn_big_width:53,sprite_logo_msn_big_height:53,sprite_logo_msn_big_x:283,sprite_logo_msn_big_y:341,sprite_logo_msn_big_url:"/assets/main.57633a.png",sprite_logo_myspace_big_width:62,sprite_logo_myspace_big_height:53,sprite_logo_myspace_big_x:336,sprite_logo_myspace_big_y:341,sprite_logo_myspace_big_url:"/assets/main.57633a.png",sprite_logo_newfacebook_big_width:53,sprite_logo_newfacebook_big_height:53,sprite_logo_newfacebook_big_x:398,sprite_logo_newfacebook_big_y:341,sprite_logo_newfacebook_big_url:"/assets/main.57633a.png",sprite_logo_skype_big_width:53,sprite_logo_skype_big_height:53,sprite_logo_skype_big_x:451,sprite_logo_skype_big_y:341,sprite_logo_skype_big_url:"/assets/main.57633a.png",sprite_logo_steam_big_width:53,sprite_logo_steam_big_height:53,sprite_logo_steam_big_x:504,sprite_logo_steam_big_y:341,sprite_logo_steam_big_url:"/assets/main.57633a.png",sprite_logo_vkontakte_big_width:53,sprite_logo_vkontakte_big_height:53,sprite_logo_vkontakte_big_x:557,sprite_logo_vkontakte_big_y:341,sprite_logo_vkontakte_big_url:"/assets/main.57633a.png",sprite_logo_xmpp_big_width:53,sprite_logo_xmpp_big_height:53,sprite_logo_xmpp_big_x:610,sprite_logo_xmpp_big_y:341,sprite_logo_xmpp_big_url:"/assets/main.57633a.png",sprite_logo_yahoo_big_width:53,sprite_logo_yahoo_big_height:53,sprite_logo_yahoo_big_x:0,sprite_logo_yahoo_big_y:394,sprite_logo_yahoo_big_url:"/assets/main.57633a.png",sprite_icn_link_width:75,sprite_icn_link_height:67,sprite_icn_link_x:53,sprite_icn_link_y:394,sprite_icn_link_url:"/assets/main.57633a.png",sprite_glow_width:697,sprite_glow_height:70,sprite_glow_x:0,sprite_glow_y:461,sprite_glow_url:"/assets/main.57633a.png",sprite_tag_expand_width:1,sprite_tag_expand_height:84,sprite_tag_expand_x:0,sprite_tag_expand_y:531,sprite_tag_expand_url:"/assets/main.57633a.png",sprite_tag_left_width:19,sprite_tag_left_height:84,sprite_tag_left_x:1,sprite_tag_left_y:531,sprite_tag_left_url:"/assets/main.57633a.png",sprite_tag_right_width:9,sprite_tag_right_height:84,sprite_tag_right_x:20,sprite_tag_right_y:531,sprite_tag_right_url:"/assets/main.57633a.png",sprite_imo_message_width:261,sprite_imo_message_height:86,sprite_imo_message_x:29,sprite_imo_message_y:531,sprite_imo_message_url:"/assets/main.57633a.png",sprite_txtpop_expand_width:1,sprite_txtpop_expand_height:92,sprite_txtpop_expand_x:290,sprite_txtpop_expand_y:531,sprite_txtpop_expand_url:"/assets/main.57633a.png",sprite_txtpop_left_width:21,sprite_txtpop_left_height:92,sprite_txtpop_left_x:291,sprite_txtpop_left_y:531,sprite_txtpop_left_url:"/assets/main.57633a.png",sprite_txtpop_right_width:7,sprite_txtpop_right_height:92,sprite_txtpop_right_x:312,sprite_txtpop_right_y:531,sprite_txtpop_right_url:"/assets/main.57633a.png",sprite_rail_classic_y_width:4,sprite_rail_classic_y_height:250,sprite_rail_classic_y_x:319,sprite_rail_classic_y_y:531,sprite_rail_classic_y_url:"/assets/main.57633a.png",sprite_tooltip2_4_width:8,sprite_tooltip2_4_height:250,sprite_tooltip2_4_x:323,sprite_tooltip2_4_y:531,sprite_tooltip2_4_url:"/assets/main.57633a.png",sprite_tooltip2_6_width:8,sprite_tooltip2_6_height:250,sprite_tooltip2_6_x:331,sprite_tooltip2_6_y:531,sprite_tooltip2_6_url:"/assets/main.57633a.png",hbf_header_height:75,hbf_footer_height:75,pin_form_border:10,pin_form_width:685,profile_edit_height:600,news_upload_width:640,news_upload_height:349,modal_popup_title_height:40,reui_header_height:40,reui_footer_height:25,reui_accountconsole_width:164,reui_mnp_panel_width:300,reui_mnp_panel_margin:0,reui_mnp_panel_footer_height:45,reui_invites_height:60,reui_buddylist_width:300,reui_buddylist_dialog_padding:10,reui_buddylist_button_margin:10,reui_buddyitem_big_height:40,reui_bar_large_height:30,reui_bar_small_height:22,reui_modal_popup_button_width:65,reui_modal_popup_button_height:20,reui_account_icon_upload_container_size:100,reui_profile_picture_upload_container_size:320,reui_conv_games_height:280,dropdown_box_h:20,glow_w:697,glow_h:70,glow_center_x:252,glow_center_y:70,reui_splash_protolist_padding:24,titlebar_height:22,titlebar_width:120,reui_conv_buttons_height:26,reui_convbottom_height:58,reui_av_button_margin:10,button_margin:10,horiz_slider_bar_click_area_height:19,horiz_slider_bar_height:5,horiz_tick_height:5,horiz_tick_width:3,vert_slider_bar_click_area_width:19,vert_slider_bar_width:5,reui_buddyhover_buttons_h:20,preference_popup_width:376,reui_buddyhover_zindex:25000,reui_infobox_zindex:16100,padding_left_right:2,av_controls_bottom_margin:3,reui_av_button_side_margin:4,imo_profile_picture_height:100,imo_profile_picture_width:100,num_protos:9});
IMO.Constants.JS_VERSION=1379387166.17;
(function(){IMO.make_singleton=function(d){var b=IMO.Utils,a=null,c=b.args(arguments,1);
d.get=function(){if(a===null){a=b.object_create(d.prototype);
d.apply(a,c);
}return a;
};
};
}());
(function(){var a=IMO.Utils;
IMO.EventTarget={on_event:function(){var b=Array.prototype.slice.call(arguments);
var c=b.shift();
var d=this[c];
if(typeof d!=="function"){return;
}d.apply(this,b);
},on:function(d,c){c=c||this;
var b=d.ev.subscribe(this.on_event,c);
if(!this.__listening){this.__listening=[];
}this.__listening.push(d);
return b;
},unsubscribe:function(d,c){c=c||this;
var b=d.ev.unsubscribe(this.on_event,c);
if(a.remove(this.__listening,d)===false){throw"not subscribed";
}return b;
},unsubscribe_all:function(){if(!this.__listening){return;
}a.foreach(this.__listening,function(b){b.ev.unsubscribe(this.on_event,this);
},this);
delete this.__listening;
}};
}());
(function(){var a=IMO.Utils;
var b=IMO.Utils.TranslateDom;
var c=IMO.Constants;
IMO.Account=function(d,e){this.account_type="im";
this.uid=d;
this.proto=e;
this.id=IMO.Utils.get_account_id(this.account_type,e,d);
this.ev=new IMO.Event();
IMO.EventDispatcher.get().subscribe(this,this.account_type,"session",this.uid,this.proto);
IMO.EventDispatcher.get().subscribe(this,this.account_type,"account",this.uid,this.proto);
IMO.EventDispatcher.get().subscribe(this,this.account_type,"blist",this.uid,this.proto);
IMO.EventDispatcher.get().subscribe(this,this.account_type,"conv",this.uid,this.proto);
return this;
};
Y.mix(IMO.Account.prototype,{get_display_text:function(){return this.alias||this.uid;
},get_display_text_with_proto:function(){return(this.proto===c.PROTO_IMO?this.get_display_text():this.uid)+" ("+c.PROTO_TO_UI[this.proto]+")";
},send:function(h,f,e,g,d){f=a.dfl(f,{});
f.uid=this.uid;
f.proto=this.proto;
IMO.Network.get().send(e||this.account_type,h,f,true,g,d);
},update_buddy:function(k,g){for(var f=0;
f<k.edata.length;
f++){var j=k.edata[f];
var h=j.buid;
var d=this.get_buddy(h,true,j.is_native);
if(d){d.update(j);
if(g){a.foreach(IMO.Session.get().accounts,function(e){a.foreach(e.groups.groups,function(i){a.foreach(i.buddies,function(l){if(l.fake_buid===d.buid&&l.fake_bproto===this.proto){l.update(j);
}},this);
},this);
},this);
}}}},buddy_added:function(d){this.update_buddy(d);
},buddy_icon:function(d){this.update_buddy(d);
},buddy_status:function(d){this.update_buddy(d);
},buddy_request:function(d){Y.log("in account.buddy_request");
this.ev.fire("on_buddy_request",this,d.edata);
},group_invitation:function(d){Y.log("in account.group_invite");
this.ev.fire("on_group_invitation",this,d.edata);
},buddy_removed:function(e){var d=this.get_buddy(e.edata.buid);
if(!d){return;
}this.do_remove_buddy(d);
},online_ssids:function(d){},reflect:function(d){if(d.edata.r_name==="send_im"){this.prep_conversation(d.edata.buid,false,true);
}else{if(d.edata.r_name==="set_display_name"){this.ev.fire("on_change_alias",d.edata.display_name);
}}},prep_conversation:function(f,e,g){var d=this.get_buddy(f,true);
if(d){d.get_im_conversation(e,g);
}},add_buddy:function(d,e){Y.log("in account.add_buddy");
d=IMO.Utils.normalize_uid(d,this.proto);
if(!d){return false;
}this.send("add_buddy",{buid:d,group:e});
return true;
},destroy:function(){IMO.EventDispatcher.get().unsubscribe(this,this.account_type,"session",this.uid,this.proto);
IMO.EventDispatcher.get().unsubscribe(this,this.account_type,"account",this.uid,this.proto);
IMO.EventDispatcher.get().unsubscribe(this,this.account_type,"blist",this.uid,this.proto);
IMO.EventDispatcher.get().unsubscribe(this,this.account_type,"conv",this.uid,this.proto);
}});
}());
(function(){IMO.AccountManager=function(){this.on(IMO.Session.get());
this.ev=new IMO.Event();
this.current_account_icon_url="assets/icn_default.png";
};
Y.mix(IMO.AccountManager.prototype,IMO.EventTarget);
Y.mix(IMO.AccountManager.prototype,{on_create_account:function(a){this.on(a);
},on_remove_account:function(a){this.unsubscribe(a);
},on_account_icon:function(b){var a=b.edata.oid;
this.current_account_icon_url=this.build_icon_url(a);
this.ev.fire("on_set_account_icon",this.current_account_icon_url);
},build_icon_url:function(a){return"/i/"+a;
}});
IMO.make_singleton(IMO.AccountManager);
}());
(function(){var a=IMO.Utils;
var d=30*1000;
var c=3*60*1000;
var b=function(f,g,e){var j=0;
var h=function(){IMO.IMBox.get().report_activity();
var k=(new Date()).getTime();
if(k-j>f){j=k;
this.last_time=j;
e.apply(g,arguments);
}};
var i=function(){j=0;
};
return{filter:h,reset:i};
};
IMO.ActivityMonitor=function(){this.filter_object=null;
this.last_time=(new Date()).getTime();
this.last_key_press=(new Date()).getTime();
this.last_mouse_click=(new Date()).getTime();
};
Y.mix(IMO.ActivityMonitor.prototype,{is_active:function(){return this.sc_uid!==undefined;
},user_is_active:function(){return this.is_active()&&((new Date()).getTime()-this.last_time)<c;
},has_activity:function(e){e=a.dfl(e,c);
var f=Math.max(this.last_key_press,this.last_mouse_click);
return f+e>(new Date()).getTime();
},activate:function(){if(this.is_active()){return;
}Y.log("IMO.ActivityMonitor.get().activate");
this.filter_object=b(d,null,function(){Y.log("report activity to backend");
IMO.Network.get().send("session","observed_user_activity",{});
});
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{any:{cb:function(g,f){if(!f.match(/ctrl|alt|meta|shift|tab$/)){this.filter_object.filter();
this.key_press();
}}}},context:this,weight:IMO.KeyboardManager.exec_weight.activity_monitor});
IMO.MouseManager.get().register(this.filter_object.filter,this);
IMO.MouseManager.get().register(this.mouse_click,this);
},key_press:function(){this.last_key_press=(new Date()).getTime();
},mouse_click:function(){this.last_mouse_click=(new Date()).getTime();
},deactivate:function(){if(!this.is_active()){return;
}Y.log("IMO.ActivityMonitor.get().deactivate");
IMO.KeyboardManager.get().pop(this.sc_uid);
IMO.MouseManager.get().unregister(this.filter_object.filter,this);
IMO.MouseManager.get().unregister(this.mouse_click,this);
delete this.sc_uid;
delete this.mouse_evt_id;
this.filter_object=null;
},report_activity:function(e){Y.log("report_activity");
if(!this.is_active()){this.activate();
}this.filter_object.reset();
if(e===true){this.filter_object.filter();
}},destroy:function(){if(this.is_active()){this.deactivate();
}}});
IMO.make_singleton(IMO.ActivityMonitor);
}());
(function(){var b=IMO.Utils;
var d=10;
var c=60;
var a=function(){return(new Date()).getTime()/1000;
};
IMO.AggregateLoggerClass=function(f,e){this.max_pending_events=f;
this.max_pending_time=e;
this.pending_events=[];
this.last_sending_time=a();
this._check_queue();
};
Y.mix(IMO.AggregateLoggerClass.prototype,{broadcast_link_clicked:function(f,e,g){var h=IMO.Session.get().get_imo_account();
if(!h){return;
}h.send("broadcast_link_clicked",{bid:f,broadcaster_uid:e,link:g},"imo_aggregatelogger");
},log_event:function(e,f){Y.log(["log event",e,f]);
this.pending_events.push({namespace:e,timestamp:a(),data:f});
},_send_queue:function(e){var h=IMO.Session.get().get_imo_account();
if(!h){return;
}var g=a();
var f={};
b.foreach(e,function(i){if(f[i.namespace]===undefined){f[i.namespace]=[];
}i.data.time_delta=i.timestamp-g;
f[i.namespace].push(i.data);
});
Y.log(["sending log events",f]);
h.send("log_event",f,"imo_aggregatelogger");
},_check_queue:function(){if(this.pending_events.length!==0){if(this.pending_events.length>this.max_pending_events||a()-this.last_sending_time>this.max_pending_time){this._send_queue(this.pending_events);
this.pending_events=[];
this.last_sending_time=a();
}}Y.later(5*1000,this,this._check_queue);
}});
IMO.AggregateLogger=new IMO.AggregateLoggerClass(d,c);
}());
(function(){var a=IMO.Utils;
var c=a.sprintf;
var e=IMO.Constants;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
IMO.Alpha=function(){this.ev=new IMO.Event();
this.features={};
IMO.EventDispatcher.get().subscribe(this,"alpha","alpha");
};
Y.mix(IMO.Alpha.prototype,{add_users:function(f){},check_for_alpha:function(h){var f=h.uid;
var g=h.proto;
Y.log("Checking for alpha features for "+f+" "+g);
IMO.Network.get().send("alpha","get_alpha_for_user",{uid:h.uid,proto:h.proto,ssid:IMO.Network.get().ssid});
},get_alpha_for_user:function(j){var h=j.features;
for(var g=0;
g<h.length;
g++){var f=h[g];
if(this.features[f]){continue;
}this.features[f]=true;
this.add_users(f);
this.ev.fire("on_alpha_"+f);
}},has_feature:function(f){return this.features.hasOwnProperty(f);
}});
IMO.make_singleton(IMO.Alpha);
}());
(function(){var o=IMO.Utils.HTML;
var n=function n(q){if(q.type==="av"){return"imo#"+q.edata.pipe.conv;
}if(q.type==="call"){return"skype#"+q.edata.chat_id;
}Y.log("unknown call type ...");
return"nasty...";
};
var b={};
var l=function l(r,q){b[r]=q;
};
var a=function a(q){delete b[q];
};
var f=function f(q){return b[q];
};
var p=function p(q){return q.split("#")[0];
};
IMO.AVConv=function j(r,q,s){this.account=r;
this.buddy=q;
this.conv=s;
this.state=IMO.AVConv.state_idle;
this.conv_id=undefined;
this.call_options=undefined;
this.incoming_action=IMO.AVConv.incoming_action_ring;
delete this.ui;
this.ev=new IMO.Event();
IMO.EventDispatcher.get().subscribe(this,"av","av",r.uid,r.proto,q.buid);
IMO.EventDispatcher.get().subscribe(this,"im","call",r.uid,r.proto,q.buid);
};
var d="av_chat_";
IMO.AVConv.flash_set_cookie=function h(s,q,r){Y.Cookie.set(d+q,r,{secure:true,expires:new Date(2199023255551)});
};
IMO.AVConv.flash_get_cookie=function i(r,q){Y.Cookie.get(d+q);
};
IMO.AVConv.flash_rm_cookie=function e(r,q){Y.Cookie.remove(q);
};
IMO.AVConv.state_idle="idle";
IMO.AVConv.state_init="initiating";
IMO.AVConv.state_ringing="ringing";
IMO.AVConv.state_ringing_buddy="ringing buddy";
IMO.AVConv.state_active="talking";
IMO.AVConv.state_noflash="no flash";
IMO.AVConv.VIDEO_CHAT="video_chat";
IMO.AVConv.AUDIO_CHAT="audio_chat";
IMO.AVConv.RINGING_TIME=20*1000;
IMO.AVConv.incoming_action_ring="ring";
IMO.AVConv.incoming_action_ignore="ignore";
IMO.AVConv.incoming_action_refuse="refuse";
IMO.AVConv.incoming_action_accept="accept";
IMO.AVConv.incoming_action_missed="missed";
Y.mix(IMO.AVConv.prototype,{set_conv_id:function(q){this.conv_id=q;
IMO.EventDispatcher.get().subscribe(this,"av","avconv",q);
},change_state:function g(q){this.state=q;
this.ev.fire("on_av_conv_state_change",q);
},stop_avmanager_timeout_timer:function(){if(this.stream_timer){this.stream_timer.cancel();
delete this.stream_timer;
}},start_avmanager_timeout_timer:function(){this.stream_timer=Y.later(30000,this,function(){this.close_conv("network",true);
},null,false);
},initiate_from_url:function(q){IMO.Network.get().send("av","get_streams_info_for_url_id",{url_id:q});
this.incoming_action=IMO.AVConv.incoming_action_accept;
this.start_avmanager_timeout_timer();
this.url_conv=true;
},initiate_anon_chat:function(q){IMO.Network.get().send("av","start_anon_chat",{chat_type:q});
this.change_state(IMO.AVConv.state_init);
this.start_avmanager_timeout_timer();
},initiate_call:function k(q){if(this.state!==IMO.AVConv.state_idle){Y.log("State is currently "+this.state+" instead of "+IMO.AVConv.state_idle+". Cannot initiate call");
return;
}IMO.Network.get().send("av","start_chat",{uid:this.account.uid,proto:this.account.proto,buid:this.buddy.buid,chat_type:q});
this.change_state(IMO.AVConv.state_init);
this.start_avmanager_timeout_timer();
},answer_call:function(){l(this.conv_id,this);
this.change_state(IMO.AVConv.state_active);
IMO.Network.get().send("av","answer_call",{kind:this.call_type,remote_ci:this.remote_ci,conv_id:this.conv_id});
},ringing_response:function c(q){if(this.state!==IMO.AVConv.state_ringing){return;
}switch(q){case IMO.AVConv.incoming_action_accept+" audio_only":this.call_options.flashvars.disable_cam_on_start=true;
this.answer_call();
break;
case IMO.AVConv.incoming_action_accept:this.answer_call();
break;
case IMO.AVConv.incoming_action_refuse+" all":this.incoming_action=IMO.AVConv.incoming_action_refuse;
this.close_conv("rejected",false,true);
break;
case IMO.AVConv.incoming_action_refuse:this.close_conv("rejected",false,true);
break;
case IMO.AVConv.incoming_action_missed:this.close_conv("missed",true,false);
break;
case IMO.AVConv.incoming_action_ignore+" all":this.incoming_action=IMO.AVConv.incoming_action_ignore;
this.close_conv("rejected",false,false);
break;
case IMO.AVConv.incoming_action_ignore:this.close_conv("rejected",false,false);
break;
default:break;
}},generate_termination_message:function(r){var q={text:IMO.AVConv.terminate_message[r].remote_message,message:{type:"terminate_call",reason:r}};
return q;
},close_conv:function(t,s,q,r){if(q===undefined||q){this.close_remote_conv(t);
}if(s){var u=IMO.AVConv.terminate_message[t].local_message;
if(IMO.NM){IMO.NM.add_notification(o.div(u));
}}this.close_local_conv(r);
},close_remote_conv:function(q){if(this.state===IMO.AVConv.state_idle){return;
}if(typeof(this.conv_id)!=="undefined"){this.send_message_to_buddy(this.generate_termination_message(q));
}},close_local_conv:function(q){var r=q?q:IMO.AVConv.state_idle;
this.change_state(r);
if(typeof(this.conv_id)!=="undefined"){a(this.conv_id);
}},send_message_to_buddy:function(q,r){IMO.Network.get().send("av","send_message",{remote_ci:this.remote_ci,conv_id:r||this.conv_id,msg:q});
},call_answered:function(q){Y.log(["--------------------------------------- call answered",q]);
if(this.state!==IMO.AVConv.state_ringing_buddy){return;
}switch(p(this.conv_id)){case"imo":this.remote_ci=q.remote_ci;
break;
case"skype":this.remote_ci={type:"skype",uid:this.account.uid,proto:this.account.proto,buid:this.buddy.buid};
Y.log(this.remote_ci);
break;
default:Y.log("Error: Unknown conv type");
break;
}this.change_state(IMO.AVConv.state_active);
this.swf_object.connect();
},receive_av_message:function(q){if(q.msg.type==="terminate_call"){if(this.state===IMO.AVConv.state_idle){return;
}var r=q.msg.reason;
var s=IMO.AVConv.terminate_message[r].remote_message;
if(IMO.NM){IMO.NM.add_notification(o.div(s));
}this.close_local_conv();
}},set_disable_camera:function(q){this.swf_object.setOptions("input",{pause:q});
},set_mic_mute:function(q){this.swf_object.setOptions("input",{mute:q});
},set_speaker_mute:function(q){this.swf_object.setOptions("output",{mute:q});
},set_speaker_volume:function(q){this.swf_object.setOptions("output",{av:q});
},failed:function(q){this.stop_avmanager_timeout_timer();
this.close_conv(q.reason,true);
},streams_info:function(q){this.stop_avmanager_timeout_timer();
if(q.type==="call"){q.edata.buddy={type:"skype",uid:q.uid,proto:q.proto,buid:q.edata.buid};
}this.remote_ci=q.edata.buddy;
var r=q.edata;
if(r.is_initiator){this.call_type="native";
if(q.edata.start_type==="anon"){this.call_type="anon";
}else{if(q.edata.buddy.type==="im"){this.call_type="link";
}}if(this.state!==IMO.AVConv.state_init){return;
}this.set_conv_id(n(q));
this.call_options=this.build_call_options(q);
l(this.conv_id,this);
this.change_state(IMO.AVConv.state_ringing_buddy);
if(q.proto==="fake"){this.ev.fire("on_av_remote_url_received",this,q.edata.buddy_url);
}return;
}if(this.buddy.blocked){return;
}if(this.state!==IMO.AVConv.state_idle){IMO.Network.get().send("av","report_busy_state",{state:this.state});
this.send_message_to_buddy(this.generate_termination_message("busy"),n(q));
}this.call_type="native";
if(q.edata.start_type==="anon"){this.call_type="anon";
}else{if(this.url_conv){this.call_type="link";
}}switch(this.incoming_action){case IMO.AVConv.incoming_action_ignore:break;
case IMO.AVConv.incoming_action_refuse:this.send_message_to_buddy(this.generate_termination_message("rejected"));
break;
case IMO.AVConv.incoming_action_ring:this.set_conv_id(n(q));
this.call_options=this.build_call_options(q);
this.change_state(IMO.AVConv.state_ringing);
break;
case IMO.AVConv.incoming_action_accept:this.set_conv_id(n(q));
this.call_options=this.build_call_options(q);
this.answer_call();
break;
default:Y.log("Unknown action set for incoming calls : "+this.incoming_action+". Ignoring call");
break;
}},ended:function(q){if(this.state!==IMO.AVConv.state_ringing&&this.state!==IMO.AVConv.state_active){return;
}this.change_state(IMO.AVConv.state_idle);
a(this.conv_id);
},build_call_options:function m(u){var v=u.edata;
var t=true;
var r={};
switch(u.type){case"av":r={type:"imo",connect_on_start:v.is_initiator?"false":"true",conv:v.pipe.conv,role:v.pipe.role,host:v.pipe.ip};
t=v.chat_type===IMO.AVConv.AUDIO_CHAT;
break;
case"call":var q;
switch(IMO.Constants.IMO_HOST){case"localhost":case"outkast":q=window.location.host;
break;
case"imo":default:q="video0.imo.im";
break;
}r={type:"skype",connect_on_start:"true",send_stream:v.send_stream,recv_stream:v.recv_stream,host:q};
break;
default:Y.log("unknown call type ...");
break;
}Y.mix(r,{debug:"conv net",audio_only:t,id:this.conv_id,buddy_icon:this.buddy.get_buddy_icon(),setCookie:"IMO.AVConv.flash_set_cookie",getCookie:"IMO.AVConv.flash_get_cookie",removeCookie:"IMO.AVConv.flash_rm_cookie"});
var w=this;
var s={callbacks:{init_cb:function(){w.ev.fire("on_av_flash_init",w);
},video_options_changed_cb:function(y,x){w.ev.fire("on_av_video_options_change",w,y,x);
},options_changed_cb:function(y,x){w.ev.fire("on_av_options_change",w,y,x);
},mic_changed_cb:function(x){w.ev.fire("on_av_mic_change",w,x);
},cam_changed_cb:function(x){w.ev.fire("on_av_cam_change",w,x);
},connection_status_cb:function(x){w.ev.fire("on_av_connection_status_change",w,x);
}}};
return{flashvars:r,flashparams:{allowscriptaccess:"always",wmode:"opaque"},imo_params:s,audio_only:t};
}});
IMO.AVConv.terminate_message={flash:{local_message:"You need Flash for AV chat",remote_message:"Your buddy needs to install the Flash plugin in order for the imo audio/video chat to work"},hangup:{local_message:"You hung up",remote_message:"Your buddy hung up"},rejected:{local_message:"You did not answer the call",remote_message:"Your buddy did not answer the call"},buddy_missed:{local_message:"Your buddy missed the call",remote_message:"You missed the call"},missed:{local_message:"You missed the call",remote_message:"You buddy missed the call"},busy:{local_message:"You missed a call because you were busy",remote_message:"Your buddy is busy"},network:{local_message:"Could not connect to AV server",remote_message:"Internal error"},nowowza:{local_message:"None of our streaming servers are available. Please try again later.",remote_message:"None of our streaming servers are available."},nopoints:{local_message:"You need more communication points to call this user.",remote_message:"Not enough communication points."}};
}());
(function(){var e=IMO.Constants;
var a={};
var d=function d(g,f){return[g.id,g.proto,f.buid].join("#");
};
IMO.AVManager={init:function c(){var f=IMO.AVManager;
IMO.EventDispatcher.get().subscribe(f,"av","av");
IMO.EventDispatcher.get().subscribe(f,"im","call");
},get_conv:function b(g,f,h){var i=d(g,f);
if(a[i]===undefined){a[i]=new IMO.AVConv(g,f,h);
}return a[i];
},streams_info:function(i){if(IMO.AVManager.av_chat_only){i.proto="fake";
i.uid="fake";
i.edata.buid="fake";
}if(i.proto==="fake"){return;
}var h=IMO.Session.get().get_account("im",i.uid,i.proto);
var f;
if(i.proto===e.PROTO_IMO){f=h.get_buddy(i.edata.buid,false);
if(!f){f=h.get_buddy(i.edata.buid,true);
var g={group:e.GROUPNAME_MEET,primitive:e.PRIM_UNKNOWN};
f.update(g,true);
f.nonbuddy=true;
}if(f&&!f.alias&&i.edata.buddy_alias){f.update({alias:i.edata.buddy_alias},true);
}}else{f=h.get_buddy(i.edata.buid,true);
}if(f.blocked){return;
}var j=f.get_im_conversation();
},terminate_call:function(f){this.streams_info(f);
}};
}());
(function(){var b=IMO.Utils.TranslateTxt;
IMO.BuddyGroup=function a(d,c,e){this.name=d;
this.display_name=e?b(d):d;
this.guide=[c,d].join("#");
this.normal=c==="5";
this.buddies={};
this.ev=new IMO.Event();
};
Y.mix(IMO.BuddyGroup.prototype,{get_buddies:function(){var c=[];
IMO.Utils.foreach(this.buddies,function(d){if(d instanceof IMO.IMBuddy&&!d.primitive_arrived){return;
}c.push(d);
});
c.sort(IMO.IMBuddy.buddyComparator);
return c;
},add:function(c){if(!this.buddies[c.ubid]){this.buddies[c.ubid]=c;
}this.update();
return this.buddies[c.ubid];
},remove:function(c){delete this.buddies[c.ubid];
this.update();
},update:function(){}});
}());
if(!IMO.Utils){IMO.Utils={};
}(function(){var a=IMO.Utils;
a.mix=((typeof Y!=="undefined")&&Y.mix)||IMO.miniY.mix;
a.later=((typeof Y!=="undefined")&&Y.later)||IMO.miniY.later;
a.dfl=function(c,b){return c===undefined?b:c;
};
a.trim=function(b){return b.replace(/^\s+|\s+$/g,"");
};
a.forprop=function(d,b,c){for(var e in d){if(d.hasOwnProperty(e)){b.call(c,e,d[e]);
}}};
}());
if(!IMO.Utils){IMO.Utils={};
}(function(){var a=IMO.Utils;
a.Trie=function(){this.trie={};
};
a.mix(a.Trie.prototype,{insert:function(d,e){var f=this.trie;
for(var c=1;
c<=d.length;
c++){var b=d.substring(0,c);
if(!f.hasOwnProperty(b)){f[b]={};
}f[b][e]=e;
}},remove:function(d,e){var f=this.trie;
for(var c=1;
c<=d.length;
c++){var b=d.substring(0,c);
delete f[b][e];
}},search:function(c){var b={};
if(this.trie[c]){a.mix(b,this.trie[c]);
}return b;
},and_search:function(g){if(!g||g.length===0){return[];
}var e=this.search(g[0]);
for(var d=1;
d<g.length;
d++){if(!g[d]){continue;
}var f=this.search(g[d]);
var h=Y.Object.keys(e);
for(var c=0;
c<h.length;
c++){var b=h[c];
if(!f.hasOwnProperty(b)){delete e[b];
}}}return e;
},insert_set:function(b,c){a.foreach(b,function(d){this.insert(d,c);
},this);
},remove_set:function(b,c){a.foreach(b,function(d){this.remove(d,c);
},this);
}});
}());
(function(){var b=IMO.Utils;
var d=IMO.Constants;
var c=IMO.Utils.TranslateTxt;
IMO.BuddyList=function a(){this.buddies={};
this.trie=new IMO.Utils.Trie();
this.groups={};
this.ev=new IMO.Event();
this.OFFLINE_GROUP=this.get_group("Offline","9",true);
this.FAVORITES_GROUP=this.get_group("Favorites","0",true);
this.BLOCKED_GROUP=this.get_group("Blocked","8",true);
this.CHAT_GROUPS_GROUP=this.get_group("Chat groups","2",true);
this.DISCUSSIONS_GROUP=this.get_group("Discussions","3",true);
this.day=(new Date()).getDate();
Y.later(60000,this,this.check_for_new_day);
};
Y.mix(IMO.BuddyList.prototype,{get_buddy_search_tokens:function(e){var f=[];
if(!(e instanceof IMO.SharedGroup)){f=f.concat(b.split_for_search(e.buid));
}f=f.concat(b.split_for_search(e.alias));
f=f.concat(b.split_for_search(e.display));
f=b.map(f,function(g){return g.toLowerCase();
});
return f;
},search:function(g,h,e){g=b.map(g,function(j){return j.toLowerCase();
});
var f=this.trie.and_search(g);
f=b.map(f,function(j){return this.buddies[j]||this.groups[j];
},this);
f=b.filter(f,function(j){return j.type!==d.GROUP_TYPE.DISCUSSION;
},this);
if(e||h){f.sort(function(k,j){var l=k.blist_group?k.blist_group.guide:"";
var m=j.blist_group?j.blist_group.guide:"";
return IMO.Utils.string_compare(l,m)||IMO.IMBuddy.buddyComparator(k,j);
});
}if(h){var i=[];
b.foreach(f,function(k){var n=(i.length===0);
if(!n){var j=i[i.length-1];
var l=(k.fake_buid||k.buid)+(k.fake_bproto||k.account.proto);
var m=(j.fake_buid||j.buid)+(j.fake_bproto||j.account.proto);
n=(l!==m);
}if(n){i.push(k);
}});
f=i;
}if(!e){f.sort(function(k,j){var l=k.blist_group?k.blist_group.guide:"";
var m=j.blist_group?j.blist_group.guide:"";
return IMO.Utils.string_compare(l,m)||b.string_compare(k.guide,j.guide);
});
}return f;
},blist_begin:function(e){this.ev.fire("on_blist_begin",e);
},blist_end:function(e){this.ev.fire("on_blist_end",e);
},update_buddy:function(g,i,e){if(b.is_group_member(g.buid)||(g instanceof IMO.IMBuddy&&g.gid)){if(!this.buddies[g.ubid]){this.buddies[g.ubid]=g;
}if(!g.blist_group){g.blist_group=g.account.groups.get_group(g.gid);
g.blist_group.add(g);
}this.ev.fire("on_buddy_update",g.blist_group);
return;
}if(!this.buddies[g.ubid]){this.buddies[g.ubid]=g;
g.blist_group=this.get_buddy_group(g);
g.blist_group.add(g);
this.ev.fire("on_blist_add",g);
}else{this.trie.remove_set(g.searchtokens,g.ubid);
this.ev.fire("on_buddy_update",g,e);
}g.searchtokens=this.get_buddy_search_tokens(g);
this.trie.insert_set(g.searchtokens,g.ubid);
if(g.fake_buid){return;
}var h=this.get_buddy_group(g);
if(g.blist_group&&(h!==g.blist_group)){var f=g.blist_group;
g.blist_group.remove(g);
g.blist_group=h;
g.blist_group.add(g);
this.ev.fire("on_blist_group_changed",g,f);
this._remove_empty_group(f);
}},_remove_empty_group:function(e){if(e&&(e!==this.FAVORITES_GROUP)&&(e!==this.BLOCKED_GROUP)&&(e!==this.OFFLINE_GROUP)&&(e!==this.CHAT_GROUPS_GROUP)){if(Y.Object.values(e.buddies).length===0){delete this.groups[e.name];
this.ev.fire("on_blist_remove_group",e);
}}},remove_buddy:function(e){this.ev.fire("on_blist_remove",e);
this.trie.remove_set(e.searchtokens,e.ubid);
var f=e.blist_group;
if(f){f.remove(e);
e.blist_group=null;
this._remove_empty_group(f);
}delete this.buddies[e.ubid];
},get_buddy_group:function(e){if(e instanceof IMO.SharedGroup){if(e.favorite===true){return this.get_group("Favorites","0",true);
}if(e.type===d.GROUP_TYPE.DISCUSSION){return this.get_group("Discussions","3",true);
}return this.get_group("Chat groups","2",true);
}else{if(e.blocked){return this.get_group("Blocked","8",true);
}if(e.primitive==="offline"){return this.get_group("Offline","9",true);
}if(e.favorite===true){return this.get_group("Favorites","0",true);
}return this.get_group(e.group);
}},set_group:function(e,f){},get_group:function(f,e,h){var g;
if(!this.groups[f]){if(f===IMO.SharedConstants.BuddyGroups.IMO_CONTACTS){e=1;
}g=new IMO.BuddyGroup(f,e||"5",h);
this.groups[f]=g;
this.ev.fire("on_blist_create_group",g);
}return this.groups[f];
},get_groups:function(){var e=Y.Object.values(this.groups);
e.sort(function(g,f){return IMO.Utils.string_compare(g.guide,f.guide);
});
return e;
},get_buddies:function(){var f=[];
var e=this.get_groups();
b.foreach(e,function(g){if(g===IMO.BuddyList.get().DISCUSSIONS_GROUP){return;
}f.push.apply(f,g.get_buddies());
});
return f;
},get_buddy:function(f,e){return f.get_buddy(e);
},get_message_target:function(e){return this.buddies[e]||this.groups[e];
},check_for_new_day:function(){Y.later(60000,this,this.check_for_new_day);
var i=new Date();
var f=i.getDate();
if(f===this.day){return;
}this.day=f;
var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var g=c("Day changed to ")+i.getDate()+" "+c(e[i.getMonth()])+" "+i.getFullYear();
var h=function(j){if((j instanceof IMO.MessageTarget)&&j.conversation){j.conversation.ev.fire("on_date_changed",g);
}};
b.foreach(this.buddies,h);
b.foreach(this.groups,h);
}});
IMO.make_singleton(IMO.BuddyList);
}());
(function(){IMO.Conversation=function a(){this.users={};
this.ev=new IMO.Event();
};
Y.mix(IMO.Conversation.prototype,{});
}());
(function(){var b=IMO.Utils;
var e=IMO.Constants;
var d=function(j,i){if(i){return[j,i];
}var k=60*60*24;
var h=new Date(j*1000);
h.setHours(0);
h.setMinutes(0);
h.setSeconds(0);
var f=h.getTime()/1000;
var g=f+k-1;
return[f,g];
};
var c=function(g,f){return[g,f];
};
IMO.ConvHistory=function a(){IMO.EventDispatcher.get().subscribe(this,"convhistory","convhistory");
this.ev=new IMO.Event();
this.cur_accts=[];
IMO.EventDispatcher.get().subscribe(this,"im","account");
this.on(IMO.Session.get());
};
Y.mix(IMO.ConvHistory.prototype,IMO.EventTarget);
Y.mix(IMO.ConvHistory.prototype,{on_set_prefs:function(m){for(var l=0;
l<m.length;
l++){var g=m[l];
var j=g.kind;
var q=g.pref;
var n=g.value;
if(j==="impref"&&q==="saveHistory"){Y.log("changing save history pref");
var f=n?"allowSavedHistory":"blockSavedHistory";
var h=IMO.Session.get().get_accounts();
var o=b.map(h,function(i){return{uid:i.uid,proto:i.proto};
});
var k={accounts:o};
this.send(f,k);
}}},signed_on:function(f){var g={uid:f.uid,proto:f.proto};
this.cur_accts.push(g);
},disconnect:function(f){this.signed_off(f);
},signed_off:function(h){var f=[];
for(var g=0;
g<this.cur_accts.length;
g++){var j=this.cur_accts[g];
if(j.uid!==h.uid||j.proto!==h.proto){f.push(this.cur_accts[g]);
}}this.cur_accts=f;
},send:function(g,f){IMO.Network.get().send("convhistory",g,f);
},get_suggestion:function(j,g,i){var k="getSuggestionList";
var f=b.map(g,function(l){return{uid:l.uid,proto:l.proto};
});
var h={fId:1,query:j,accounts:f,buddy:i};
this.send(k,h);
},get_recent_message_suggestions:function(f,g,i){var j="getRecentMessagesSuggest";
var h={buddyid:i,uid:f,proto:g};
this.send(j,h);
},get_messages:function(h,i,m,l,g,n){var k=1;
if(n){k=0;
}var f="getMessagesList";
var o=b.map(h,function(p){return{uid:p.uid,proto:p.proto};
});
var j={fId:k,messageText:i,accounts:o,startTime:l,endTime:g,buddy:m};
this.send(f,j);
},get_conversation:function(k,j,n,g,l,i){var f="getConversation";
var m=d(l,i);
var h={fId:1,uid:k,proto:j,start:m[0],end:m[1],buddyid:n,msgid:g};
this.send(f,h);
},get_conversation_previews:function(m,k,o,l,g,i,h){var f="getConversationPreviews";
var n=c(l,g);
var j={fId:1,uid:m,proto:k,start:n[0],end:n[1],buddyid:o,limit:i,isEnd:h};
this.send(f,j);
},delete_conversation:function(h,j,l,i,g){var m="deleteMessages";
var f=d(i,g);
var k={uid:h,proto:j,buddyid:l,start:f[0],end:f[1]};
this.send(m,k);
},clear_history:function(g){Y.log("Deleting all chat history!!!!!!!");
var i="clearHistory";
var f=b.map(g,function(j){return{uid:j.uid,proto:j.proto};
});
var h={accounts:f};
this.send(i,h);
},prepare_for_query:function(){var k="enableSearch";
var g=[];
for(var f=0;
f<this.cur_accts.length;
f++){var j=this.cur_accts[f];
g.push({uid:j.uid,proto:j.proto});
}if(g.length>0){var h={accounts:g};
this.send(k,h);
}},getSuggestionList:function(f){this.ev.fire("on_get_suggestion_list",f);
},getRecentMessagesSuggest:function(f){this.ev.fire("on_get_suggestion_list",f);
},getMessagesList:function(f){this.ev.fire("on_get_messages",f);
},getConversation:function(f){this.ev.fire("on_get_conversation",f);
},getConversationPreviews:function(f){this.ev.fire("on_get_previews",f);
}});
IMO.make_singleton(IMO.ConvHistory);
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
a.DomAllocator=function(c,d){this.classes=d;
this.docpool=[];
this.doc=document.createDocumentFragment();
this.doc.appendChild(c);
this.size=1;
this.resize(64);
};
Y.mix(a.DomAllocator.prototype,{get:function(){if(this.docpool.length===0){this.alloc();
}return this.docpool.shift();
},alloc:function(){var m=document.createElement("div");
m.appendChild(this.doc.cloneNode(true));
var g=[];
var f={};
a.foreach(this.classes,function(d){f[d]=m.getElementsByClassName(d);
},this);
var i=m.childNodes;
for(var h=0;
h<this.size;
h++){var l={dom:i[h]};
for(var e=0;
e<this.classes.length;
e++){var n=this.classes[e];
l[n]=f[n][h];
}g.push(l);
}this.docpool=g;
},resize:function(c){while(this.size<c){this.doc.appendChild(this.doc.cloneNode(true));
this.size*=2;
}}});
}());
(function(){var a=IMO.Utils;
IMO.Event=function(){this.listeners=[];
this.firing=false;
};
Y.mix(IMO.Event.prototype,{subscribe:function(d,c,b){if(this.is_subscribed(d,c)){Y.log(["already subscribed",c,d],"error");
return false;
}this.listeners.push({fn:d,context:c,later:this.firing&&b});
return true;
},_get_index:function(c,b){return a.foreach(this.listeners,function(d,e){if(d.fn===c&&d.context===b){return e;
}});
},is_subscribed:function(c,b){return(this._get_index(c,b)!==undefined);
},unsubscribe:function(d,c){var b=this._get_index(d,c);
if(b==undefined){Y.log(["subscriber does not exist",c,d],"error");
return false;
}if(!this.firing){this.listeners.splice(b,1);
}else{this.listeners[b].deleted=true;
}return true;
},fire:function(){var b=Array.prototype.slice.call(arguments,0);
this.firing=true;
a.foreach(this.listeners,function(c){if((c.deleted!==true)&&(c.later!==true)){c.fn.apply(c.context,b);
}});
this.listeners=a.filter(this.listeners,function(c){delete c.later;
return c.deleted!==true;
});
this.firing=false;
}});
}());
(function(){var a;
IMO.EventTargetClass=a=function(){};
a.prototype=IMO.Utils.object_create(IMO.EventTarget);
}());
(function(){IMO.EventDispatcher=function(){this.subscribers={};
this.network_event_target=new IMO.EventTargetClass();
this.network_event_target.on_network_message=IMO.Utils.bind(function(a){this.process_incoming_message(a);
},this);
this.network_event_target.on(IMO.Network.get());
};
Y.mix(IMO.EventDispatcher.prototype,{subscribe:function(e,d,c){var a=Array.prototype.slice.call(arguments);
var b=[d,c].concat(a.slice(3)).join("#");
if(!this.subscribers[b]){this.subscribers[b]=[];
}this.subscribers[b].push(e);
},unsubscribe:function(e,d,c){var a=Array.prototype.slice.call(arguments);
var b=[d,c].concat(a.slice(3)).join("#");
return IMO.Utils.remove(this.subscribers[b],e);
},dispatch_messages:function(c,f){var d=this.subscribers[c.join("#")]||[];
var b=f.name;
for(var a=0;
a<d.length;
a++){var e=d[a];
var g=e[b];
if(typeof g!=="function"){Y.log(["unhandled msg",f,e],"warn");
continue;
}g.call(e,f);
}},process_incoming_message:function(d){var g=d.from.system;
var f=d.to;
var e=d.data;
var c=e.type;
var b=[g,c];
if(f.ssid!==IMO.Network.get().ssid){IMO.Stats.log_event("ssid_mismatch",{expected_ssid:IMO.Network.get().ssid,recvd_ssid:f.ssid},null,null,true);
return;
}this.dispatch_messages(b,e);
switch(c){case"session":if(e.proto==="prpl-imo"){break;
}switch(e.name){case"not_authenticated":break;
default:break;
}break;
case"account":if(e.proto==="prpl-imo"){break;
}b.push(e.uid);
b.push(e.proto);
this.dispatch_messages(b,e);
break;
case"blist":if(e.proto==="prpl-imo"){break;
}IMO.BuddyList.get().blist_begin(e.edata.length);
b.push(e.uid);
b.push(e.proto);
for(var a=0;
a<e.edata.length;
a++){e.edata[a].buid=IMO.Utils.normalize_buid(e.edata[a].buid);
}this.dispatch_messages(b,e);
switch(e.name){case"buddy_added":case"buddy_icon":case"buddy_status":b.push(null);
for(a=0;
a<e.edata.length;
a++){b[b.length-1]=e.edata[a].buid;
this.dispatch_messages(b,e);
}break;
default:break;
}IMO.BuddyList.get().blist_end(e);
break;
case"call":case"av":if(e.proto==="prpl-imo"){break;
}e.edata.buid=IMO.Utils.normalize_buid(e.edata.buid);
this.dispatch_messages(b,e);
b.push(e.uid);
b.push(e.proto);
b.push(e.edata.buid);
this.dispatch_messages(b,e);
break;
case"vim":break;
case"avconv":b.push(e.conv_id);
this.dispatch_messages(b,e);
break;
case"conv":if(e.proto==="prpl-imo"){break;
}b.push(e.uid);
b.push(e.proto);
if(e.edata.buid){e.edata.buid=IMO.Utils.remove_resource(IMO.Utils.normalize_buid(e.edata.buid),e.proto);
}this.dispatch_messages(b,e);
if(e.edata.buid){b.push(e.edata.buid);
this.dispatch_messages(b,e);
}break;
case"convhistory":b.push(e.name);
switch(e.name){case"getConversation":b.push(e.fId);
break;
default:break;
}this.dispatch_messages(b,e);
break;
case"preference":if(e.proto==="prpl-imo"){break;
}b.push(e.uid);
b.push(e.proto);
this.dispatch_messages(b,e);
break;
case"geoip_city_suggestion":b.push(e.query);
this.dispatch_messages(b,e);
break;
case"imo_profile_reply":b.push(e.request_id);
this.dispatch_messages(b,e);
break;
case"web_rpc_reply":b.push(e.request_id);
this.dispatch_messages(b,e);
break;
case"alpha":b.push(e.uid);
b.push(e.proto);
this.dispatch_messages(b,e);
break;
case"pin_account":b.push(e.uid);
this.dispatch_messages(b,e);
break;
case"pin_conv":b.push(e.uid);
b.push(e.buid);
this.dispatch_messages(b,e);
break;
case"photo":Y.log(["Photo response",e]);
b.push(e.edata.uid);
b.push(e.edata.proto);
this.dispatch_messages(b,e);
break;
case"photo_comments":Y.log(["Photo response",e]);
b.push(e.edata.uid);
b.push(e.edata.proto);
this.dispatch_messages(b,e);
break;
case"imo_account_request_password_reset_reply":b.push(e.email);
this.dispatch_messages(b,e);
break;
case"discussion":b.push(e.edata.gid);
this.dispatch_messages(b,e);
break;
case"filetransfer":case"games":case"history_import":case"imo_account":case"imo_account_reset_password_reply":case"imo_directory":case"invite":case"oauthmanager":case"profile":case"pin":case"promo":case"purchases":case"reply":break;
default:Y.log(["unhandled message from backend",d],"info");
break;
}}});
IMO.make_singleton(IMO.EventDispatcher);
}());
(function(){IMO.EventGateway=function(){this.ev=new IMO.Event();
};
IMO.make_singleton(IMO.EventGateway);
}());
(function(){var c={picassimo:{title:"Picassimo",desc:"Play this fun drawing and guessing game with your friends",broadcast_text:"Play Picassimo with me",label:"Play",on_mobile:true,img:"https://apps.imoapi.com/imo.im/picassimo/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},reversimo:{title:"Reversimo",desc:"Play this classic board game with your friend",broadcast_text:"Play Reversimo with me",label:"Play",on_mobile:true,img:"https://apps.imoapi.com/imo.im/reversimo/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},connectmore:{title:"ConnectMore",desc:"Play this strategic board game with your friend",broadcast_text:"Play ConnectMore with me",label:"Play",on_mobile:true,img:"https://apps.imoapi.com/imo.im/connectmore/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},suduoku:{title:"Su-duo-ku",desc:"Compete with your friends in a race to solve Sudoku puzzles",broadcast_text:"Play Su-duo-ku with me",label:"Play",on_mobile:false,img:"https://apps.imoapi.com/imo.im/suduoku/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},hangman:{title:"Hangman",desc:"Play this fun guessing game with your friend",broadcast_text:"Play Hangman with me",label:"Play",on_mobile:false,img:"https://apps.imoapi.com/imo.im/hangman/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},go:{title:"Go",desc:"Play this ancient board game with your friend",broadcast_text:"Play Go with me",label:"Play",on_mobile:false,img:"https://apps.imoapi.com/imo.im/go/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},backgammon:{title:"Backgammon",desc:"Play this classic board game with your friend",broadcast_text:"Play Backgammon with me",label:"Play",on_mobile:false,img:"https://apps.imoapi.com/imo.im/backgammon/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},rps:{title:"Rock, Paper, Scissors",desc:"Play this quick and simple game with your friend",broadcast_text:"Play Rock, Paper, Scissors with me",label:"Play",on_mobile:false,img:"https://apps.imoapi.com/imo.im/rps/icon.png",visibility:{conv:true}},whiteboard:{title:"Whiteboard",desc:"Draw on a whiteboard with your friends",broadcast_text:"Draw with me",label:"Draw",on_mobile:false,img:"https://apps.imoapi.com/imo.im/whiteboard/icon.png",visibility:{group_conv:true,conv:true,broadcast:true}},chess:{title:"Chess",desc:"Play this classic board game with your friend, courtesy of lichess.org",broadcast_text:"Play Chess with me",label:"Play",img:"https://apps.imoapi.com/imo.im/chess/icon.png",on_mobile:false,sprite_hack:false,visibility:{group_conv:true,conv:true,broadcast:true}}};
var a=["picassimo","reversimo","connectmore","suduoku","hangman","go","backgammon","rps","whiteboard","chess"];
IMO.Games=function b(){this.evs={};
IMO.EventDispatcher.get().subscribe(this,"games","games");
};
Y.mix(IMO.Games.prototype,IMO.EventTarget);
Y.mix(IMO.Games.prototype,{send:function(e,d){IMO.Network.get().send("games",e,d);
},start_game:function(e,d,i){var h=e.account;
var j="start_game";
var f=[h.uid,h.proto,e.buid,d];
this.evs[f]=i;
var g={uid:h.uid,proto:h.proto,buid:e.buid,game:d};
this.send(j,g);
},game_created:function(k){var i=k.edata;
var f=k.uid;
var g=k.proto;
var h=k.buid;
var e=[f,g,h,i.game];
var j=this.evs[e];
if(j){Y.log(["conv",j]);
var d;
if(i.game==="whiteboard"||i.game==="typewithme"){d=i.game_name+" created, click to open: "+i.url;
}else{d=i.game_name+" game created, click to play: "+i.url;
}j.add_system_msg(d);
}},get_game_info:function(d){return c[d];
},get_game_list:function(e){var f=[];
for(var d=0;
d<a.length;
d++){if(c[a[d]].visibility[e]){f.push(a[d]);
}}return f;
}});
IMO.make_singleton(IMO.Games);
}());
(function(){var d=IMO.Constants;
var a=IMO.Utils;
var b=IMO.Utils.TranslateDom;
var c=IMO.Utils.TranslateTxt;
IMO.GroupManager=function(e){this.account=e;
this.groups={};
this.groups_list=[];
this.pending_to_open_groups={};
this.on(IMO.Session.get());
return this;
};
Y.mix(IMO.GroupManager.prototype,IMO.EventTarget);
Y.mix(IMO.GroupManager.prototype,{create_group:function(e,f){var g={name:e,is_native:f};
this.account.send("create_shared_group",g);
},get_target:function(i,j,h,g){if(j){var k=this.get_group(i,true,g);
if(!k){return null;
}j=IMO.Utils.normalize_buid(j);
var f=a.create_ubid(this.account.uid,this.account.proto,i,j);
if(!k.buddies[f]&&h){var e=new IMO.IMBuddy(this.account,i+";"+j);
k.add(e);
}return k.buddies[f];
}else{return this.get_group(i,h,g);
}},get_group:function(h,f,e){if(f&&!this.groups[h]){e=e||(h.length!==16);
var i=new IMO.SharedGroup(this.account,h,e);
this.groups[h]=i;
this.groups_list.push(i);
IMO.BuddyList.get().update_buddy(i);
}return this.groups[h];
},del_target:function(e){if(e instanceof IMO.IMBuddy){Y.log("ERROR: delete of member is not supported");
return;
}this.account.send("leave_group",{gid:e.gid});
this.do_remove_target(e);
if(e.type!==d.GROUP_TYPE.DISCUSSION){IMO.NM.add_notification(b("left [GROUP]",{GROUP:e.displaylias}),IMO.REUI.Notification.types.info);
}},do_remove_target:function(e){if(e instanceof IMO.SharedGroup){this.account.ev.fire("on_buddy_removed",e);
a.foreach(e.buddies,IMO.BuddyList.get().remove_buddy,IMO.BuddyList.get());
IMO.BuddyList.get().remove_buddy(e);
delete this.groups[e.gid];
a.remove(this.groups_list,e);
e.destroy();
}else{this.account.ev.fire("on_buddy_removed",e);
IMO.BuddyList.get().remove_buddy(e);
e.destroy();
}},kick_member:function(e){if(!e instanceof IMO.IMBuddy){Y.log("ERROR: delete of non-member is not supported");
return;
}this.account.send("kick_member",{buid:e.buid});
IMO.NM.add_notification(b("Removed [MEMBER]",{MEMBER:e.displaylias}),IMO.REUI.Notification.types.info);
},ban_member:function(e){if(!e instanceof IMO.IMBuddy){Y.log("ERROR: delete of non-member is not supported");
return;
}this.account.send("ban_member",{buid:e.buid});
IMO.NM.add_notification(b("Banned [MEMBER]",{MEMBER:e.displaylias}),IMO.REUI.Notification.types.info);
},auth_group:function(e,g){var f={gid:e,accepted:g==="add"};
this.account.send("invitation_response",f);
},invitation_response_from_iid:function(e,f,g){IMO.Network.get().send("imogroups","invitation_response_from_iid",{uid:this.account.uid,proto:this.account.proto,gid:e,iid:g,accepted:f==="add"});
},offline_cleanup:function(){for(var g=0;
g<this.groups_list.length;
g++){var h=this.groups_list[g];
for(var e in h.buddies){var f=h.buddies[e];
IMO.BuddyList.get().remove_buddy(f);
f.handle_account_offline();
}IMO.BuddyList.get().remove_buddy(h);
h.handle_account_offline();
}},signed_on:function(){for(var g=0;
g<this.groups_list.length;
g++){var h=this.groups_list[g];
for(var e in h.buddies){var f=h.buddies[e];
f.handle_account_online();
}h.handle_account_online();
}},recv_im:function(g){var e=this.account.get_buddy(g.edata.buid,true);
if(e&&(!e.muted)){var f=g.edata.mode==="notify";
this.account.prep_conversation(g.edata.buid,true,f);
}},on_recv_pref:function(f,e,g){if(f==="impref"&&e==="groupmutes"){a.foreach(this.groups,function(h){h.set_muted();
},this);
}}},true);
IMO.GroupInvitation=function(e){this.iid=e;
this.gid=null;
this.uid=null;
this.buid_queue=[];
this.ev=new IMO.Event();
this.account=null;
IMO.EventDispatcher.get().subscribe(this,"imogroups","invitation");
IMO.EventDispatcher.get().subscribe(this,"im","blist","group_invitation");
IMO.Network.get().send("imogroups","check_iid",{iid:e});
return this;
};
Y.mix(IMO.GroupInvitation.prototype,IMO.EventTarget);
Y.mix(IMO.GroupInvitation.prototype,{iid_success:function(f){this.ev.fire("on_iid_success");
if(!this.account){this.success_msg=f;
return;
}if(!f){f=this.success_msg;
this.success_msg=null;
if(!f){return;
}}this.gid=f.gid;
for(var e in this.buid_queue){if(this.process_buddy_request(e)){return;
}}IMO.Session.get().ev.fire("on_group_invitation",this.account,{gid:this.gid,from:f.from,iid:this.iid});
},iid_fail:function(e){this.ev.fire("on_iid_fail",{msg:e.msg});
IMO.NM.add_notification(b(e.msg),IMO.REUI.Notification.types.error);
this.destroy();
},buddy_request:function(e){if(this.gid){this.process_buddy_request(e.edata.buid);
}else{this.buid_queue.push(e.edata.buid);
}},process_buddy_request:function(e){if(e!==this.gid){return false;
}return true;
},destroy:function(){IMO.Session.get().group_invitation=null;
IMO.EventDispatcher.get().unsubscribe(this,"imogroups","invitation");
IMO.EventDispatcher.get().unsubscribe(this,"im","blist","group_invitation");
}},true);
}());
(function(){if(!IMO.HTTPRPC){IMO.HTTPRPC={};
}var b=IMO.Utils;
var d=b.HTML;
var c=30*1000;
var f=60*1000;
function e(k,h,l){for(var g=0;
g<k.length;
g++){if(k[g].name==h){k[g].value=l;
return;
}}var j=d.input({type:"hidden",name:h,value:l});
k.appendChild(j);
}function a(q,h,g,o,m,n,r,j){n=b.dfl(n,{});
var l;
var k={method:"POST",on:{complete:function(w,v,t){if(v.status>=400){j();
return;
}var s;
l.io.detachAll();
l=null;
try{s=JSON.parse(v.responseText);
}catch(u){j();
return;
}r(s);
},failure:function(u,t,s){if(l){l.io.detachAll();
l=null;
j();
}}}};
if(n.form){var i=n.form;
k.form={id:i,upload:true};
e(i,"system",h);
e(i,"method",g);
e(i,"data",Y.JSON.stringify(o));
if(IMO.Network.get().ssid){e(i,"ssid",IMO.Network.get().ssid);
}else{e(i,"token",Y.JSON.stringify(m));
}}else{var p=["system="+encodeURIComponent(h),"method="+encodeURIComponent(g),"data="+encodeURIComponent(Y.JSON.stringify(o))];
if(IMO.Network.get().ssid){p.push("ssid="+encodeURIComponent(IMO.Network.get().ssid));
}else{p.push("token="+encodeURIComponent(Y.JSON.stringify(m)));
}k.data=p.join("&");
k.timeout=c;
}l=Y.io("/s/"+q+"/",k);
}IMO.HttpDispatcher=function(g){this.service=g;
this._fetching_token=false;
this.token=null;
this.token_expiry=null;
this._token_queue=[];
};
Y.mix(IMO.HttpDispatcher.prototype,{received_token:function(g){var k,h,l;
this._fetching_token=false;
if(g.error){this.token=null;
this.token_expiry=new Date()+f;
k=this._token_queue;
this._token_queue=[];
for(h=0;
h<k.length;
h++){l=k[h];
l.callback.call(l.context,g);
}}else{if(g.result){var j=g.result["timeout"]*1000;
this.token=g.result["token"];
this.token_expiry=new Date()+j;
Y.later(j-c,this,this.get_token);
k=this._token_queue;
this._token_queue=[];
for(h=0;
h<k.length;
h++){l=k[h];
this.call(l.system,l.method,l.data,l.callback,l.context,l.extras);
}}}},get_token:function(){this.token=null;
this._fetching_token=true;
var i=this;
var h=250;
var g;
function j(){setTimeout(g,h);
h*=2;
}function k(l){i.received_token(l);
}g=function(){a(i.service,"httprpc","get_token",{},null,{},k,j);
};
g();
},call:function(i,h,n,k,j,l){var p=this;
var o=250;
var g;
function m(){setTimeout(g,o);
o*=2;
}function q(r){if(k){k.call(j,r);
}}g=function(){if(!IMO.Network.get().ssid){if(p.token===null||p.token_expiry-new Date()<0){p._token_queue.push({system:i,method:h,data:n,context:j,callback:k,extras:l});
if(!p._fetching_token){p.get_token();
}return;
}}a(p.service,i,h,n,p.token,l,q,m);
};
g();
},upload:function(i,l,k,j,g,h){this.call(i,l,k,g,h,{form:j});
}});
IMO.HTTPRPC=new IMO.HttpDispatcher("httprpc");
}());
(function(){var c=IMO.Constants;
var a=IMO.Utils;
var b=IMO.Utils.TranslateDom;
IMO.IMAccount=function(d,e){this.alias="";
IMO.IMAccount.superclass.constructor.call(this,d,e);
this.prefs={};
this.state=0;
this.link_group=new IMO.LinkGroup();
this.link_group.add(this,true);
this.groups=new IMO.GroupManager(this);
this.buddies={};
this.buddies_list=[];
this.authorized=false;
this.signed_on_yet=false;
this.state=c.IM_STATE_OFFLINE;
this.protoicon=IMO.Utils.sprintf("%s_%s",this.get_proto_icon(),c.PRIM_AVAILABLE);
this.queued_messages=[];
this.on(IMO.Session.get());
return this;
};
Y.extend(IMO.IMAccount,IMO.Account);
Y.mix(IMO.IMAccount.prototype,IMO.EventTarget);
Y.mix(IMO.IMAccount.prototype,{send:function(d){if(!this.signed_on_yet&&d!=="account_login"&&d!=="account_relogin"){Y.log(["attempt to send account level message before account is authorized",arguments]);
IMO.Stats.log_event("queued_account_method",{ssid:IMO.Network.get().ssid,method:d,uid:this.uid,proto:this.proto});
this.queued_messages.push(arguments);
return;
}IMO.IMAccount.superclass.send.apply(this,arguments);
},send_queued_messages:function(){while(this.queued_messages.length>0){var d=this.queued_messages.shift();
IMO.IMAccount.superclass.send.apply(this,d);
}},set_pref:function(d,e){this.prefs[d]=e;
},get_pref:function(d){return this.prefs[d];
},toString:function(){return"IMAccount("+this.id+")";
},set_state:function(d){this.state=d;
this.ev.fire("on_state_change",this,this.state);
},destroy:function(){IMO.IMAccount.superclass.destroy.call(this);
},offline_cleanup:function(){this.groups.offline_cleanup();
for(var e=0;
e<this.buddies_list.length;
e++){var d=this.buddies_list[e];
IMO.BuddyList.get().remove_buddy(d);
d.handle_account_offline();
}},disconnect:function(f){Y.log(["disconnect",f]);
var e=f.edata["reason"];
if(this.state===c.IM_STATE_CONNECTING){if(e==="lapw"){this.link_group.remove(this);
this.authorized=false;
this.lapw=true;
}this.ev.fire("on_login_fail",this,f);
}this.ev.fire("on_disconnect",this,f);
this.offline_cleanup();
if(f.edata.delete_account){IMO.Session.get().remove(this);
}this.set_state(c.IM_STATE_OFFLINE);
if(e==="uidpassword"||e==="lapw"){var d=f.edata.details;
if(!d){d="Other error";
}if(IMO.OAuth.get().proto_has_oauth(f.proto)){this.oauth_reauthentication(d);
}else{this.no_details_reaunthentication(f);
}}},signed_on:function(f){this.signed_on_time=(new Date()).getTime();
Y.log(["signed_on",this.id]);
if(!this.signed_on_yet){IMO.Alpha.get().check_for_alpha(this);
this.signed_on_yet=true;
this.send_queued_messages();
if(IMO.Session.get().group_invitation){IMO.Session.get().group_invitation.account=this;
IMO.Session.get().group_invitation.iid_success();
}}this.authorized=true;
this.set_state(c.IM_STATE_ONLINE);
this.alias=f.edata.alias;
var g=f.edata.username;
Y.log(["username",g]);
if(g){var e=IMO.Session.get().get_account("im",g,this.proto);
Y.log(["Account: ",e]);
if(e){IMO.Session.get().remove(e);
}}IMO.ActivityMonitor.get().activate();
IMO.ActivityMonitor.get().report_activity(true);
IMO.Stats.report_signed_on();
for(var d=0;
d<this.buddies_list.length;
d++){this.buddies_list[d].handle_account_online();
}this.ev.fire("on_signed_on",this,f);
this.groups.signed_on(f);
IMO.IMBox.get().get_unread_msgs(this);
Y.later(3000,this,function(){if(window!==top){if(IMO.Alpha.get().has_feature("break_frame")){top.location=window.location;
}}});
},no_account:function(d){this.authorized=false;
},not_signing_on:function(d){Y.log(["not_signing_on",this.id]);
this.authorized=true;
this.signed_on_yet=true;
this.send_queued_messages();
this.set_state(c.IM_STATE_OFFLINE);
this.alias=d.display_name||d.uid;
this.ev.fire("on_not_signing_on",this,d);
},not_authenticated:function(d){},signed_off:function(d){this.ev.fire("on_signed_off",this,d);
this.set_state(c.IM_STATE_OFFLINE);
this.offline_cleanup();
},reflect:function(d){if(d.edata.r_name==="leave_group"){}else{if(d.edata.r_name==="invitation_response"||d.edata.r_name==="auth_add"||d.edata.r_name==="auth_deny"||d.edata.r_name==="auth_block"){this.ev.fire("on_auth_done_reflect",d.edata.buid||d.edata.gid);
}else{IMO.IMAccount.superclass.reflect.call(this,d);
}}},account_icon:function(d){this.ev.fire("on_account_icon",d);
},buddy_icon:function(d){this.update_buddy(d,true);
},del_buddy:function(d){if(d.gid){this.groups.del_target(d);
return;
}this.send("del_buddy",{buid:d.buid,group:d.group});
this.do_remove_buddy(d);
IMO.NM.add_notification(b("[BUDDY] has been deleted.",{BUDDY:d.displaylias}),IMO.REUI.Notification.types.info);
},do_remove_buddy:function(d){if(d.gid){this.groups.do_remove_target(d);
return;
}this.ev.fire("on_buddy_removed",d);
IMO.BuddyList.get().remove_buddy(d);
delete this.buddies[d.buid];
IMO.Utils.remove(this.buddies_list,d);
d.destroy();
},typing:function(){},typed:function(){},not_typing:function(){},prep_buddy:function(e,f){var d=this.get_buddy(e,true);
if(!d.alias&&f.alias){d.update({alias:f.alias},true);
}return d;
},allow_non_buddies:function(){return IMO.Session.get().get_pref("impref","allowNonBuddies",false);
},recv_im:function(e){var d=this.prep_buddy(e.edata.buid,e.edata);
if(IMO.Utils.is_group_target(e.edata.buid)){this.groups.recv_im(e);
return;
}if(d.nonbuddy&&!this.allow_non_buddies()){d.msg_queue.push(e);
}else{this.prep_conversation(e.edata.buid);
}},get_proto_icon:function(){return this.proto.replace(/prpl-/,"");
},login:function(d,e,f){if(this.state!==c.IM_STATE_ONLINE){this.send("account_login",{passwd:d,captcha:e,edata:f});
this.set_state(c.IM_STATE_CONNECTING);
return true;
}return false;
},relogin:function(){if(this.authorized&&(this.state===c.IM_STATE_OFFLINE)){this.send("account_relogin",{});
this.set_state(c.IM_STATE_CONNECTING);
return true;
}else{if(!this.authorized){IMO.REUI.Accounts.show_account_login(false,this);
}}return false;
},logout:function(){if(this.state===c.IM_STATE_ONLINE){this.send("account_logout",{});
this.set_state(c.IM_STATE_DISCONNECTING);
return true;
}return false;
},auth_buddy:function(g,f,h,d){var e={buid:g};
if(f==="add"){e.group=h;
e.alias=d;
}this.send("auth_"+f,e);
},get_buddies:function(){return this.buddies;
},get_buddy:function(g,f,e){if(IMO.Utils.is_group_target(g)){var h=a.groups_split(g);
return this.groups.get_target(h[0],h[1],f,e);
}g=IMO.Utils.normalize_buid(g);
if(f&&!this.buddies[g]){var d=new IMO.IMBuddy(this,g);
this.buddies[g]=d;
this.buddies_list.push(d);
}return this.buddies[g];
},set_display_name:function(d){this.send("set_display_name",{name:d});
this.alias=d;
this.ev.fire("on_change_alias",d);
},set_display_picture:function(d){},get_display_name:function(){return this.alias||this.uid;
},pretty_display:function(){var d=this.get_display_name();
return(d?d:this.uid)+" ("+c.PROTO_TO_UI[this.proto]+")";
},pretty_proto:function(){return c.PROTO_TO_UI[this.proto];
},on_recv_pref:function(e,d,f){if(e==="impref"&&d==="allowNonBuddies"&&f===true){a.foreach(this.buddies_list,function(g){g.deliver_msg_queue();
});
}},oauth_reauthentication:function(e){var d;
if(IMO.UserFriendlyReason.reauth_reasons[this.proto]){d=IMO.UserFriendlyReason.reauth_reasons[this.proto][e];
if(!d){d=IMO.UserFriendlyReason.reauth_reasons[this.proto]["Other error"];
}}else{d=IMO.UserFriendlyReason.reauth_reasons[this.proto]["oauth"];
}this.authorized=false;
if(!IMO.on_main_imo_page){IMO.REUI.Accounts.show_account_login(true,null,this.proto);
if(this.proto!==IMO.Constants.PROTO_FACEBOOK){IMO.REUI.Accounts.show_oauth_failure_reason(d);
}}},no_details_reaunthentication:function(d){if(d=="uidpassword"&&!IMO.on_main_imo_page){IMO.REUI.Accounts.show_account_login(true,null,this.proto);
}}},true);
}());
(function(){var b=IMO.Utils;
var c=20*1000;
IMO.IMBox=function a(){this.evs={};
this._recv_unread_msgs_queue=[];
this.on(IMO.Session.get());
IMO.EventDispatcher.get().subscribe(this,"im","conv");
this.read_event_queue=[];
};
Y.mix(IMO.IMBox.prototype,IMO.EventTarget);
Y.mix(IMO.IMBox.prototype,{get_unread_msgs:function(d){var e="get_unread_msgs";
d.send(e);
},report_activity:function(){for(var d=0;
d<this.read_event_queue.length;
d++){this.do_mark_msgs_as_read(this.read_event_queue[d]);
}this.read_event_queue=[];
},do_mark_msgs_as_read:function(g){if(g.last_recv_index===g.last_mark_index){Y.log("imbox no things to mark");
return;
}Y.log("imbox marking a thing as read");
var e=g.buddy.buid;
var f=g.last_recv_index;
g.last_mark_index=f;
var h="mark_msgs_as_read";
var d={buid:e,last_index:f};
g.account.send(h,d);
},mark_msgs_as_read:function(d){if(d.last_recv_index===d.last_queue_index){Y.log("imbox no things to queue");
return;
}Y.log("imbox queueing a thing");
d.last_queue_index=d.last_recv_index;
this.read_event_queue.push(d);
},recv_unread_msgs:function(d){this._recv_unread_msgs_queue.push(d);
if(!IMO.Session.get().have_prefs_arrived()){Y.later(c,this,this._process_queued_recv_unread_msgs);
return;
}this._process_queued_recv_unread_msgs();
},beep:function(d){IMO.Sound.get().play("beep");
},on_prefs_loaded:function(){this._process_queued_recv_unread_msgs();
},_process_queued_recv_unread_msgs:function(){b.foreach(this._recv_unread_msgs_queue,function(j){var h=j.edata;
for(var g in h){var i=h[g];
var f=this._extract_alias(i.msgs);
var d=this._are_only_notifications(i.msgs);
this.prep_conversation(j.uid,j.proto,g,f,d);
var e=[j.uid,j.proto,g];
this.evs[e].fire("on_recv_unread_msgs",i.num_unsent_msgs,i.msgs);
}},this);
this._recv_unread_msgs_queue=[];
},subscribe:function(g,i,j,h,f,d){var e=[g,i,j];
if(!this.evs[e]){this.evs[e]=new IMO.Event();
}this.evs[e].subscribe(h,f,d);
},unsubscribe:function(f,h,i,g,e){var d=[f,h,i];
if(this.evs[d]){this.evs[d].unsubscribe(g,e);
}},prep_conversation:function(g,h,j,f,e){var i=IMO.Session.get().get_account("im",g,h);
var d=i.get_buddy(j,true);
var k=d.muted||e;
i.prep_conversation(j,true,k);
if(f){d.update({alias:f},true);
}},_extract_alias:function(d){if(d&&d.length>0&&d[0].alias){return d[0].alias;
}return null;
},_are_only_notifications:function(e){for(var d=0;
d<e.length;
d++){if(e[d].mode!=="notify"){return false;
}}return true;
}},true);
IMO.make_singleton(IMO.IMBox);
}());
(function(){var b=IMO.Utils;
var c=IMO.Utils.TranslateDom;
var d=IMO.Constants;
IMO.MessageTarget=function a(f,e){this.account=f;
this.proto=f.proto;
this.buid=e;
this.icon=null;
this.default_icon=IMO.Constants.DEFAULT_BICON;
this.ev=new IMO.Event();
this.ubid=IMO.Utils.create_ubid(f.uid,f.proto,IMO.Utils.normalize_buid(e),b.create_uid(16));
this.alias=null;
this.conversation=null;
this.guide="";
this.displaylias=null;
};
Y.mix(IMO.MessageTarget.prototype,{destroy:function(){this.ev.fire("on_buddy_destroy",this);
this.account=null;
this.ev=null;
},get_displaylias:function(){return this.displaylias;
},get_buddy_icon_url:function(){return"/b/"+this.icon;
},get_buddy_icon:function(){return this.icon?this.get_buddy_icon_url():this.default_icon;
},get_icon:function(){return this.icon&&this.get_buddy_icon_url();
},request_buddy_icon:function(){return IMO.BuddyIconDownloader.get().load(this.ubid)?this.get_icon():this.default_icon;
},handle_account_online:function(){this.ev.fire("on_account_online",this);
},handle_account_offline:function(){this.primitive=d.PRIM_OFFLINE;
this.status="";
this.ev.fire("on_account_offline",this);
},get_status:function(){return this.status||this.primitive;
},is_imo_discussion:function(){return(this instanceof IMO.SharedGroup&&this.type===d.GROUP_TYPE.DISCUSSION);
}});
}());
(function(){var b=IMO.Utils;
var c=IMO.Utils.TranslateDom;
var e=IMO.Constants;
var a={"prpl-myspace":"jabber"};
IMO.IMBuddy=function d(g,f){IMO.IMBuddy.superclass.constructor.call(this,g,f);
this.primitive=e.PRIM_OFFLINE;
this.status="";
this.guide="";
this.alias=null;
this.display=null;
this.displaylias=null;
this.protoicon="";
this.blocked=false;
this.favorite=false;
this.nonbuddy=true;
this.msg_queue=[];
this.conversation=null;
this.group=null;
this.blist_group=null;
this.primitive_arrived=false;
var h=b.groups_split(f);
if(h[1]){this.gid=h[0];
this.ubid=b.create_ubid(g.uid,g.proto,this.buid);
this.group=this.gid;
h=b.groups_split(h[1]);
this.fake_buid=h[0];
this.fake_bproto=h[1]||g.proto;
this.admin=false;
b.foreach(IMO.Session.get().accounts,function(j){if(j.proto!==this.fake_bproto){return;
}var i=j.buddies[this.fake_buid];
if(i){this.icon=i.icon;
}},this);
}this.update();
};
Y.extend(IMO.IMBuddy,IMO.MessageTarget);
Y.mix(IMO.IMBuddy.prototype,{__append_display_proto:function(f){return f+" ("+e.PROTO_TO_UI[this.get_proto()]+")";
},should_hide_buid:function(){var f=this.get_proto();
return f===e.PROTO_IMO||f===e.PROTO_NEWFACEBOOK;
},get_proto:function(){return this.fake_bproto||this.proto;
},get_buid:function(){return this.fake_buid||this.buid;
},get_display_buid:function(){return this.should_hide_buid()?this.get_display_text():this.get_buid();
},get_display_buid_with_proto:function(){return this.__append_display_proto(this.get_display_buid());
},get_display_text:function(){return this.alias||this.display||this.get_buid();
},get_display_text_with_proto:function(){return this.__append_display_proto(this.get_display_text());
},get_full_display_text:function(){var g=this.get_buid();
var f=this.get_display_text_with_proto();
if(!(this.should_hide_buid())&&g!==this.get_display_text()){f=f+" - "+g;
}return f;
},update:(function(){var g={},f=[e.PRIM_AVAILABLE,e.PRIM_INVISIBLE,e.PRIM_BUSY,e.PRIM_AWAY,e.PRIM_OFFLINE],h;
for(h=0;
h<f.length;
++h){g[f[h]]=h.toString(10);
}return function(m,l){var i={guide:this.guide,status:this.status,primitive:this.primitive,icon:this.icon,displaylias:this.displaylias,admin:this.admin};
b.foreach(m,function(p,o){if(o==="buid"){return;
}this[o]=p;
if(o==="primitive"){this.primitive_arrived=true;
}},this);
this.displaylias=this.alias||this.display||this.fake_buid||this.buid;
var k=this.primitive;
if(this.primitive===e.PRIM_INVISIBLE){k=e.PRIM_OFFLINE;
}if(this.primitive===e.PRIM_PENDING){this.protoicon="groups_pending";
}else{var j=this.fake_bproto||this.proto;
j=a[j]||j.replace(/prpl-/,"");
this.protoicon=IMO.Utils.sprintf("%s_%s",j,k);
}var n=g[this.primitive]||"E";
this.status=this.status||"";
this.guide=[n,this.displaylias.toLowerCase(),this.buid,this.account.uid,this.account.proto].join("#");
if(!l){this.nonbuddy=false;
}this.deliver_msg_queue();
this.ev.fire("on_buddy_update",this,m,i);
IMO.BuddyList.get().update_buddy(this);
if(this.primitive!==e.PRIM_OFFLINE){this.has_been_online=true;
}};
}()),get_im_conversation:function(h){var f=this;
var j=this.fake_buid;
var i=this.fake_bproto;
if(this.gid&&!h){b.foreach(IMO.Session.get().accounts,function(k){f=(k.proto===i&&k.buddies[j])||f;
});
var g=this.account.buddies[j];
if(i===e.PROTO_IMO&&!g&&this.account.proto===e.PROTO_IMO){g=IMO.REUI.APP.MeetUtils.get_buddy_for_buid(this.account,j,this.displaylias,this.icon);
}f=g||f;
}if(!f.conversation){f.conversation=new IMO.IMConversation(f.account,f);
f.account.ev.fire("on_new_im_conversation",f.conversation);
if(f.group===e.GROUPNAME_MEET){Y.later(0,this,function(){f.ev.fire("on_new_mnp_conv",this);
});
}}IMO.EventGateway.get().ev.fire("on_get_conversation",f.conversation);
return f.conversation;
},handle_account_offline:function(){this.status="";
this.ev.fire("on_account_offline",this);
},deliver_msg_queue:function(){if(this.msg_queue.length>0){var f=this.get_im_conversation();
b.foreach(this.msg_queue,function(g){f.recv_im(g);
});
}},set_favorite:function(f){if(this.gid||this.favorite===f){return;
}this.favorite=f;
this.update();
var i=f?"favorite_buddy":"unfavorite_buddy";
var g={buid:this.buid,proto:this.account.proto,uid:this.account.uid};
IMO.Network.get().send("preference",i,g);
var h=f?"[BUDDY] has been marked as a favorite.":"[BUDDY] is no longer marked as a favorite.";
IMO.NM.add_notification(c(h,{BUDDY:this.displaylias}),IMO.REUI.Notification.types.info);
},set_blocked:function(f){if(this.gid){return;
}this.blocked=f;
this.update();
var g=f?"block_buddy":"unblock_buddy";
this.account.send(g,{buid:this.buid});
IMO.NM.add_notification(c("[BUDDY] has been "+(f?"blocked.":"unblocked."),{BUDDY:this.displaylias}),IMO.REUI.Notification.types.info);
},add_to_group:function(f){},remove_from_group:function(f){},set_group:function(g){Y.log("in set_group new_group: "+g);
if(g===this.blist_group||g===IMO.BuddyList.get().OFFLINE_GROUP){return;
}if(g.shared_group){g.invite_buddy(this);
return;
}if(this.blist_group.shared_group){return;
}if(this.blist_group===IMO.BuddyList.get().FAVORITES_GROUP){Y.log("unstar buddy");
this.set_favorite(false);
}else{if(this.blist_group===IMO.BuddyList.get().BLOCKED_GROUP){Y.log("unblock buddy");
this.set_blocked(false);
}}if(g===IMO.BuddyList.get().FAVORITES_GROUP){Y.log("add to favorites");
this.set_favorite(true);
}else{if(g===IMO.BuddyList.get().BLOCKED_GROUP){Y.log("block buddy");
this.set_blocked(true);
}else{var h={};
h[e.PROTO_HYVES]=true;
h[e.PROTO_NEWFACEBOOK]=true;
if(this.proto in h){var f=e.PROTO_TO_UI[this.proto];
IMO.NM.add_notification(c(f+" buddies can not be moved to another group."),IMO.REUI.Notification.types.error);
return;
}Y.log("normal backend move");
this.account.send("group_buddy",{buid:this.buid,old_group:this.group,new_group:g.name});
this.group=g.name;
}}this.update();
},add_to_conversation:function(f,g){var h={uid:this.account.uid,proto:this.account.proto,is_native:g,members:[{iproto:f.account.proto,iuid:f.account.uid,ibuid:f.buid},{iproto:this.account.proto,iuid:this.account.uid,ibuid:this.buid}]};
IMO.NM.add_notification(c("Adding [BUDDY] to conversation",{BUDDY:f.displaylias}));
IMO.Network.get().send("im","create_shared_group",h,true,this.add_to_conversation_cb,this,[]);
},add_to_conversation_cb:function(g,f){b.foreach(f,function(j){var k={uid:this.account.uid,proto:this.account.proto,gid:g,iproto:j.account.proto,iuid:j.account.uid,ibuid:j.buid};
IMO.Network.get().send("im","invite_to_group",k);
},this);
var h=this.account.groups.get_group(g);
if(h===undefined){this.account.groups.pending_to_open_groups[g]=true;
return;
}var i=h.get_im_conversation();
if(i.ui){i.ui.focus();
}},get_voice_chat:function(){},get_video_chat:function(){},send_file:function(){},set_alias:function(f){if(f===this.displaylias||this.gid){return;
}var g=this.displaylias;
this.alias=f;
this.update();
this.account.send("change_buddy_alias",{buid:this.buid,alias:f});
IMO.NM.add_notification(c("[BUDDY] has been renamed to [NAME].",{BUDDY:g,NAME:this.displaylias}),IMO.REUI.Notification.types.info);
}},true);
IMO.IMBuddy.buddyComparator=function(i,h){var g=b.string_compare(i.blist_group.guide,h.blist_group.guide);
if(g===0){var f=b.string_compare(i.displaylias.toLowerCase(),h.displaylias.toLowerCase());
if(f===0){return b.string_compare(i.guide,h.guide);
}else{return f;
}}else{return g;
}};
}());
(function(){var c=IMO.Constants;
var b=IMO.Utils;
IMO.IMConversation=function a(e,d){IMO.IMConversation.superclass.constructor.call(this);
this.account=e;
this.buddy=d;
this.typing_state="not_typing";
this.history=[];
IMO.EventDispatcher.get().subscribe(this,this.account.account_type,"conv",e.uid,e.proto,d.buid);
IMO.IMBox.get().subscribe(e.uid,e.proto,d.buid,this.recv_unread_msgs,this);
if(d instanceof IMO.IMBuddy&&e.proto===c.PROTO_IMO&&!d.gid){this.is_imo_user=true;
IMO.EventDispatcher.get().subscribe(this,"pin","pin_conv",e.uid,d.buid);
}else{this.is_imo_user=false;
}if(d instanceof IMO.SharedGroup){IMO.EventDispatcher.get().subscribe(this,"im","conv",e.uid,d.buid);
IMO.EventDispatcher.get().subscribe(this,"pin","pin_conv",e.uid,d.buid);
}Y.log(d);
if(d.gid){IMO.EventDispatcher.get().subscribe(this,"im","discussion",d.gid);
}if(d.bid){IMO.Network.get().send("imo_broadcasts","get_discussion_history",{bid:d.bid,uid:e.uid},true,function(f){this.history_loaded({edata:f});
},this);
}this.av_conv=IMO.AVManager.get_conv(this.account,this.buddy,this);
this.last_recv_index=-1;
this.last_mark_index=-1;
};
Y.extend(IMO.IMConversation,IMO.Conversation);
Y.mix(IMO.IMConversation.prototype,{not_enough_comm_points:function(d){Y.log(["not_enough_comm_points",d]);
this.ev.fire("on_not_enough_comm_points",this,d.edata);
},needs_comm_point2:function(d){Y.log(["needs_comm_point2",d]);
this.ev.fire("on_needs_comm_point",this,d.edata);
},comm_point_missing:function(d){Y.log(["comm_point_missing",d]);
this.ev.fire("on_comm_point_missing",this,d.edata);
},recv_im:function(e){if(e.edata.index>this.last_recv_index||true){if(e.edata.index<=this.last_recv_index){IMO.Stats.log_event("recv_im_dropped",{buid:e.edata.buid,uid:e.uid,proto:e.proto,ssid:IMO.Network.get().ssid,index:e.edata.index,last_index:this.last_recv_index},null,null,true);
}this.ev.fire("on_recv_im",this,e.edata);
var d=[null,null];
if(e.edata.author){d=b.groups_split(e.edata.author);
}this._push_to_history("buddy",e.edata.msg,new Date(e.edata.timestamp*1000),d[0],e.edata.author_alias,d[1],e.edata.mode);
this.last_recv_index=e.edata.index;
}},recv_unread_msgs:function(d,g,h){if(h.length===0){return;
}Y.log("got the unread msgs");
if(g){this.ev.fire("on_exist_unsent_msgs",this,g);
}for(var e=0;
e<h.length;
e++){var j=h[e];
if(j.index>this.last_recv_index){this.ev.fire("on_recv_unread_msg",this,j);
var f=[null,null];
if(j.author){f=b.groups_split(j.author);
}this._push_to_history("buddy",j.msg,new Date(j.timestamp*1000),f[0],j.author_alias,f[1]);
this.last_recv_index=j.index;
}}this.ev.fire("on_have_unread_msgs",this);
},marked_msgs_as_read:function(d){Y.log("MARK READ MESSAGES!!!");
this.ev.fire("on_marked_msgs_as_read",this,d.edata);
},typing:function(d){this.ev.fire("on_typing",this,d.edata);
},typed:function(d){this.ev.fire("on_typed",this,d.edata);
},not_typing:function(d){this.ev.fire("on_not_typing",this,d.edata);
},reflect:function(d){switch(d.edata.r_name){case"send_im":this.ev.fire("on_reflect_send_im",this,d.edata);
this.history.push({who:"me",msg:d.edata.msg,mode:d.edata.mode,timestamp:new Date(d.edata.timestamp*1000)});
break;
default:break;
}},send_im:function(g,f){var d={buid:this.buddy.buid,msg:g};
if(f!==undefined&&f!==null){d.imdata=f;
}var e={who:"me",msg:g,timestamp:null,id:b.random_string()};
this.history.push(e);
this.account.send("send_im",d,null,function(h){e.timestamp=new Date(h.timestamp*1000);
h.id=e.id;
this.ev.fire("on_send_im_confirm",this,h);
},this);
this.ev.fire("on_send_im",this,g,f,e.id);
IMO.IMBox.get().mark_msgs_as_read(this);
},send_typing_state:function(d){if(d!==this.typing_state){this.typing_state=d;
this.account.send("im_typing",{buid:this.buddy.buid,typing_state:d});
}},add_system_msg:function(d){this.ev.fire("on_system_im",this,d);
this.history.push({who:"system",msg:d,timestamp:new Date()});
},history_loaded:function(e){this.history=[];
var d=e.edata.history;
b.foreach(d,function(k){var h=k[0];
var j=k[1];
var g=k[2];
var m=k[3];
var l=k[4];
var f=new Date(k[5]*1000);
var i=null;
if(l==="notify"||l==="notify_important"){i="system";
}else{i=(h===this.account.uid)?"me":"buddy";
}this._push_to_history(i,m,f,h,g,j,l);
},this);
this.ev.fire("populate_from_history");
},is_group_admin:function(){if(this.buddy instanceof IMO.SharedGroup&&this.buddy.admin){return true;
}return false;
},ban_member:function(g,f){var e=this.buddy.gid;
var i=g+";"+f;
var d=this.buddy.account.groups;
var h=d.get_target(e,i);
Y.log(["Ban member",e,h]);
if(h){d.ban_member(h);
}},off_topic:function(d){this.account.off_topic(this.buddy.gid,d);
},_push_to_history:function(g,k,i,f,e,h,j){var d={who:g,msg:k,timestamp:i,author:f,author_alias:e,proto:h,mode:j};
this.history.push(d);
},destroy:function(){if(this.account){IMO.EventDispatcher.get().unsubscribe(this,"im","conv",this.account.uid,this.account.proto,this.buddy.buid);
if(this.is_imo_user){IMO.EventDispatcher.get().unsubscribe(this,"pin","pin_conv",this.account.uid,this.buddy.buid);
}IMO.IMBox.get().unsubscribe(this.account.uid,this.account.proto,this.buddy.buid,this.recv_unread_msgs,this);
if(this.buddy instanceof IMO.SharedGroup){IMO.EventDispatcher.get().unsubscribe(this,"im","conv",this.account.uid,this.buddy.buid);
IMO.EventDispatcher.get().unsubscribe(this,"pin","pin_conv",this.account.uid,this.buddy.buid);
}if(this.buddy.gid){IMO.EventDispatcher.get().unsubscribe(this,"im","discussion",this.buddy.gid);
}this.buddy.conversation=null;
this.account=null;
}}});
}());
(function(){var a=3;
var f=30;
var d=3;
var c=1;
var e=function(g){return((g>="a"&&g<="z")||(g>="A"&&g<="Z")||(g>="0"&&g<="9")||("._".indexOf(g)!==-1));
};
var b=function(g){return g===1?"":"s";
};
if(!IMO.ImoProfile){IMO.ImoProfile={};
}IMO.ImoProfile.username_rule_violation=function(l){if(l.length<a){return"Username must have at least "+a+" characters";
}if(l.length>f){return"Username must have at most "+f+" characters";
}var h=0;
var g=0;
for(var j=0;
j<l.length;
++j){var k=l.charAt(j);
if(!e(k)){return"Username can only contain letters, digits, '.' and '_' (not '"+k+"')";
}if("._".indexOf(k)===-1){if(k<"0"||k>"9"){g+=1;
}h+=1;
}}if(h<d){return"Username must contain at least "+d+" alphanumeric (letters or digits) character"+b(d);
}if(g<c){return"Username must contain at least "+c+" letter"+b(c);
}return null;
};
IMO.ImoProfile.username_valid=function(g){return IMO.ImoProfile.username_rule_violation(g)===null;
};
}());
(function(){if(!IMO.ImoProfile){IMO.ImoProfile={};
}var a='?!:;_()[]{}"/\\,*@#$%^&<>|=+~`';
IMO.ImoProfile.name_rule_violation=function(b){if(b.length===0){return"Name cannot be empty";
}if(b.match(/[0-9]/)){return"Name cannot contain digits";
}for(var c=0;
c<a.length;
++c){if(b.indexOf(a[c])!==-1){return"The following characters are not allowed in names: "+a;
}}return null;
};
IMO.ImoProfile.name_valid=function(b){return IMO.ImoProfile.name_rule_violation(b)===null;
};
}());
(function(){var a=6;
var b=function(c){return c===1?"":"s";
};
if(!IMO.ImoProfile){IMO.ImoProfile={};
}IMO.ImoProfile.password_rule_violation=function(c){if(c.length<a){return"Password must have at least "+a+" character"+b(a);
}return null;
};
IMO.ImoProfile.password_valid=function(c){return IMO.ImoProfile.password_rule_violation(c)===null;
};
}());
(function(){var a=IMO.Utils;
var d=IMO.Constants;
var b=new a.uid_generator("urid");
var c={};
Y.mix(c,IMO.ImoProfile||{});
IMO.ImoProfile=function(e){this.uid=e;
this.requests={};
this.ev=new IMO.Event();
};
Y.mix(IMO.ImoProfile,c);
Y.mix(IMO.ImoProfile.prototype,IMO.EventTarget);
Y.mix(IMO.ImoProfile.prototype,{profile_call:function(g,h,f,e,j){var i=b.next();
h.request_id=i;
IMO.EventDispatcher.get().subscribe(this,"imoprofile","imo_profile_reply",i);
IMO.Network.get().send("imoprofile","web_"+g,h);
this.requests[i]={context:f,cb:e,plus:j};
return i;
},profile_uid_call:function(g,h,f,e,i){h.uid=this.uid;
return this.profile_call(g,h,f,e,i);
},update_profile:function(g,f,e,h){this.profile_uid_call("update_profile",{profile:g},f,e,h);
},upload_picture:function(e){IMO.UploadManager.get().upload("imoprofile","webup_set_profile_picture",{uid:this.uid,uploader:"web_file"},e,this,function(f){Y.log(["Received ",f]);
if(f.error){this.ev.fire("on_picture_upload_fail");
}else{this.ev.fire("on_picture_upload_success",f.result);
}});
},cancel_callback:function(e){delete this.requests[e];
},server_reply:function(f){var g=f.request_id;
IMO.EventDispatcher.get().unsubscribe(this,"imoprofile","imo_profile_reply",g);
var e=this.requests[g];
delete this.requests[g];
if(e){e.cb.call(e.context,f,e.plus);
}},username_available:function(h,f,e,g){this.profile_call("username_available",{username:h},f,e,g);
},set_username:function(h,f,e,g){this.profile_uid_call("set_username_for_uid",{username:h},f,e,g);
},get_picture_stream_id:function(f,e,g){this.profile_uid_call("get_imo_pic_stream_id",{},f,e,g);
}});
IMO.ImoProfile.parse_typed_items=function(e,f){var l=[];
if(e in {university:1,highschool:1,employer:1}){l.push(f);
}else{var h="";
var j=false;
for(var g=0;
g<f.length;
++g){var k=f.charAt(g);
if(k==='"'){j^=true;
h+=k;
}else{if(k===","&&!j){l.push(h);
h="";
}else{h+=k;
}}}l.push(h);
}Y.log(["names",l]);
l=a.map(l,function(i){return IMO.ImoProfile.canonical_typed_item(e,i);
});
return a.filter(l,function(i){return i.length;
});
};
}());
(function(){var e=IMO.Constants;
var a=IMO.Utils;
var b=IMO.Utils.TranslateDom;
var d=4000;
var c=24*60*60*1000;
IMO.IMOAccount=function(f){IMO.IMOAccount.superclass.constructor.call(this,f,e.PROTO_IMO);
IMO.EventDispatcher.get().subscribe(this,"imo_account","imo_account");
IMO.EventDispatcher.get().subscribe(this,"im","pin");
IMO.EventDispatcher.get().subscribe(this,"im","discussion");
IMO.EventDispatcher.get().subscribe(this,"pin","pin_account",f);
IMO.EventDispatcher.get().subscribe(this,"friends_finder_accwidget","pin");
this.account_activated=false;
this.account_limited=false;
this.cnt_comm_points_left=0;
this.cnt_max_comm_points=0;
this.premium=false;
this.premium_subscribed=false;
this.premium_exp_date=null;
this.profile=new IMO.ImoProfile(f);
return this;
};
Y.extend(IMO.IMOAccount,IMO.IMAccount);
Y.mix(IMO.IMOAccount.prototype,IMO.EventTarget);
Y.mix(IMO.IMOAccount.prototype,{account_verified:function(f){this.account_activated=true;
IMO.Network.get().send("pin","get_account_data",{uid:this.uid,proto:e.PROTO_IMO});
},prep_buddy:function(h,i){var f=this.get_buddy(h,false);
if(!f){f=this.get_buddy(h,true);
var g={group:e.GROUPNAME_MEET,primitive:e.PRIM_UNKNOWN};
f.update(g,true);
f.nonbuddy=true;
}return IMO.IMOAccount.superclass.prep_buddy.call(this,h,i);
},allow_non_buddies:function(){return true;
},change_password_reply:function(f){this.ev.fire("on_change_password_reply",f.edata);
},add_buddy:function(g,h,f){return this.add_buddies([g],h,f);
},add_buddies:function(f,m,g){if(this.account_limited){this.ev.fire("on_name_change_required");
return false;
}if(!this.account_activated){this.ev.fire("on_imo_account_not_verified",this);
return false;
}if(f.length===0){return true;
}var l=true;
if(g){l=false;
}else{for(var k=0;
k<this.buddies_list.length;
k++){if(!this.buddies_list[k].nonbuddy){l=false;
break;
}}}if(l){this.ev.fire("on_adding_first_buddy",this,f,m);
return false;
}for(var h=0;
h<f.length;
h++){if(!IMO.IMOAccount.superclass.add_buddy.call(this,f[h],m)){return false;
}}return true;
},report_account_data:function(f){this.__update_account_data(f);
},__try_to_display_profile_popup:function(){if(!this.need_to_display_profile_popup||!this.fully_signon){return;
}if(this.profile_popup_displayed){return;
}this.profile_popup_displayed=true;
IMO.REUI.PIN.ProfileEdit.show(true);
IMO.Promo.get().suppress(c);
},__update_account_data:function(g){var f=g.edata;
Y.log(["__update_account_data",f]);
this.email=f.email;
if(!a.dfl(f.is_email_verified,true)){this.ev.fire("on_unverified_email",this);
}else{this.ev.fire("on_verified_email",this);
}if(a.dfl(f.profile_created,1)===0){this.ev.fire("on_show_mnp",true);
this.need_to_display_profile_popup=true;
this.__try_to_display_profile_popup();
}if(a.dfl(f.show_meet_new_people,false)){this.ev.fire("on_show_mnp",true);
}if(f.is_activated!==undefined){this.account_activated=f.is_activated;
}if(f.is_limited!==undefined){this.account_limited=f.is_limited;
}if(a.dfl(f.show_pin_tutorial,false)){Y.later(d,this,this.show_pin_tutorial);
}if(f.premium!==undefined){this.premium=f.premium;
this.ev.fire("on_premium",f.premium);
}if(f.premium_subscribed!==undefined){this.premium_subscribed=f.premium_subscribed;
}if(f.premium_exp_date!==undefined){this.premium_exp_date=f.premium_exp_date;
}this.update_communication_points(g);
},resend_verification_code:function(){IMO.Network.get().send("imo_account","resend_verification_code",{uid:this.uid});
},update_communication_points:function(f){if(f.edata.points!==undefined){this.cnt_comm_points_left=f.edata.points;
this.cnt_max_comm_points=f.edata.max_points;
this.ev.fire("on_comm_points_left_changed",this.cnt_comm_points_left,this.cnt_max_comm_points);
}},premium_expired:function(f){this.premium=false;
this.ev.fire("on_premium",false);
},toString:function(){return"IMOAccount("+this.id+")";
},subscribe:function(){if(this.uid){Y.log("IMO Account subscribe");
IMO.IMOAccount.superclass.subscribe.call(this);
}},show_pin_tutorial:function(){this.ev.fire("on_show_pin_tutorial");
},signed_on:function(j){IMO.IMOAccount.superclass.signed_on.call(this,j);
this.__update_account_data(j);
var i=a.parse_query();
if(i.hasOwnProperty("t")){IMO.Network.get().send("imo_account","handle_track_id",{uid:this.uid,proto:this.proto,track_id:i.t});
}if(j.edata.points===undefined||j.edata.is_activated===undefined){IMO.Network.get().send("pin","get_account_data",{ssid:IMO.Network.get().ssid,uid:this.uid,proto:this.proto});
}if(IMO.REUI.PIN.show_wizard){this.ev.fire("on_imo_account_signup",this);
Y.log("imo_edit_profile called");
IMO.REUI.PIN.ProfileEdit.show(true);
IMO.REUI.PIN.show_wizard=false;
IMO.Promo.get().suppress(c);
}else{this.fully_signon=true;
this.__try_to_display_profile_popup();
}var h=a.parse_query();
if(h.action=="add_contact"){var f=String(h.uid);
var g=String(h.buid);
if(this.uid===f){this.add_buddy(g,IMO.SharedConstants.BuddyGroups.IMO_CONTACTS,true);
this.pending_add_buddy=g;
}}if(j.edata.premium!==undefined){this.premium=j.edata.premium;
}IMO.Network.get().send("friendsfinder","get_number_of_suggested_friends",{ssid:IMO.Network.get().ssid,uid:this.uid,proto:this.proto},true,this.set_number_of_suggested_friends,this);
if(h.hasOwnProperty("premium")||h.hasOwnProperty("donotrenew")){IMO.REUI.PremiumAccount.show();
}},buddy_added:function(h){IMO.IMOAccount.superclass.buddy_added.call(this,h);
for(var f=0;
f<h.edata.length;
f++){if(h.edata[f].buid===this.pending_add_buddy){var g=b("[BUDDY] was added to contacts.",{BUDDY:h.edata[f].alias});
IMO.NM.add_notification(g,IMO.REUI.Notification.types.info);
this.pending_add_buddy=null;
document.location.hash="";
}}},destroy:function(){Y.log("IMO Account destroy");
IMO.EventDispatcher.get().unsubscribe(this,"imo_account","imo_account");
IMO.EventDispatcher.get().unsubscribe(this,"im","pin");
IMO.EventDispatcher.get().unsubscribe(this,"im","discussion");
IMO.EventDispatcher.get().unsubscribe(this,"pin","pin_account",this.uid);
IMO.EventDispatcher.get().unsubscribe(this,"friends_finder_accwidget","pin");
if(this.uid){IMO.IMOAccount.superclass.destroy.call(this);
}},send_invite:function(f){IMO.Network.get().send("imo_account","send_invite",{ssid:IMO.Network.get().ssid,uid:this.uid,to_email:f});
},set_wants_to_meet:function(g,h){this.show_mnp=g;
if(h){var f=(IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im")?"pin":"imo_directory";
this.send("set_wants_to_meet",{ssid:IMO.Network.get().ssid,uid:this.uid,proto:this.proto,wants_to_meet:g},f);
}},account_login_result:function(g){Y.log(["account_login_result",g]);
var f=g.edata.result;
var h=g.edata.username;
Y.log(["result",f]);
if(f==="signed_on"&&this.uid===h){Y.log("removing account");
IMO.Session.get().remove(this);
}else{this.ev.fire("on_login_fail",this,g);
}},send_invite_result:function(g){Y.log(["send_invite_result",g]);
if(g.edata&&g.edata.error){IMO.NM.add_notification(b("The invite could not be sent"),IMO.REUI.Notification.types.error);
return;
}var f=g.edata.emails_sent;
IMO.NM.add_notification(b("Invite sent to [NUMBER] emails",{NUMBER:f}));
},delete_account:function(){IMO.Network.get().send("imo_account","delete_account",{uid:this.uid});
},added_as_contact:function(f){Y.log(["added_as_contact",f]);
this.ev.fire("on_added_as_contact",this,f.edata);
},set_number_of_suggested_friends:function(f){Y.log(["set_number_of_suggested_friends",f]);
this.ev.fire("update_friends_finder_number",f);
},history_loaded:function(h){var f=h.edata.gid;
var g=this.groups.get_group(f,true);
g.update({type:e.GROUP_TYPE.DISCUSSION});
g.get_im_conversation(true,true);
},off_topic:function(f,g){IMO.Network.get().send("pin","off_topic",{uid:this.uid,gid:f,buid:g});
}},true);
}());
(function(){var a=IMO.Utils;
var b;
IMO.LinkGroup=b=function(c){this.id=(c===undefined)?a.create_uid():c;
this.accounts={};
this.synced=true;
};
Y.mix(IMO.LinkGroup.prototype,{size:function(){return Y.Object.values(this.accounts).length;
},add:function(c,d){if(c.id===undefined){throw 2;
}if(c.link_group){c.link_group.remove(c,this);
}this.accounts[c.id]=c;
c.link_group=this;
IMO.Session.get().ev.fire("on_linked_account",c,this);
this.synced=d||false;
},remove:function(d,c){delete this.accounts[d.id];
if(!c){d.link_group=new b();
d.link_group.add(d,true);
}this.synced=false;
},link_on_backend:function(){var c=[];
a.foreach(this.accounts,function(d){c.push({uid:d.uid,proto:d.proto,account_type:d.account_type});
},this);
if(c.length<1){return;
}this.synced=false;
}});
}());
(function(){var a=IMO.Utils;
var b=IMO.Utils.HTML;
IMO.Login=function(c){this.ev=new IMO.Event();
this.opts=c;
IMO.EventTarget.on(this,c);
};
Y.mix(IMO.Login.prototype,{login:function(j){var q=this;
var f=this.opts;
var d=IMO.Constants;
if(!f){f={};
}var m;
var g=function(){if(f.username){f.username.disabled=true;
}if(f.password){f.password.disabled=true;
}if(f.remember){f.remember.disabled=true;
}if(f.steamguard){f.remember.disabled=true;
}if(f.signin){if(!b.dom("spinner")){f.signin.appendChild(f.loading=b.img({src:"/assets/loader_16.gif",id:"spinner"}));
}}q.ev.fire("on_login_begin",m);
};
var h=function(r,s,o){if(f.username){f.username.disabled=false;
}if(f.password){f.password.disabled=false;
}if(f.remember){f.remember.disabled=false;
}if(f.steamguard){f.remember.disabled=false;
}if(f.loading){b.remove(f.loading);
f.loading=null;
}if(s==="uid"){if(f.username){f.username.focus();
}}else{if(f.password){f.password.focus();
}}if(s==="captcha"||IMO.Captcha.shown){if(f.captcha){b.show(f.captcha);
b.wait(f.captcha);
IMO.Captcha.show_captcha(f.captcha.getAttribute("id"));
}q.ev.fire("show_captcha");
}else{if(s==="steamguard"){q.ev.fire("show_steamguard");
}}if(f.msg){b.empty(f.msg);
b.show(f.msg);
f.msg.appendChild(b.div(b.sprite("error_icn"),o));
}IMO.Stats.report_user_flow("page_login_nok",{proto:r.proto});
q.ev.fire("on_login_fail",r,s,o);
};
j=j||{};
var i=j.is_oauth;
var k=j.proto||f.proto;
if(k==d.PROTO_ICQ){k=d.PROTO_AIM;
}var l=j.uid;
var e=j.passwd;
if(!i){l=l||f.username.value;
e=e||f.password.value;
}var p=j.captcha||IMO.Captcha.get_data();
var n=j.edata||{};
if(f.steamguard){n.steamauthtoken=f.steamguard.value;
}if(!i){if(!l||(f.username&&b.has_class(f.username,"auto"))){h(null,"uid",IMO.UserFriendlyReason.reasons.uid);
return;
}if(!e||(f.password&&b.has_class(f.password,"auto"))){h(null,"passwd",IMO.UserFriendlyReason.reasons.passwd);
return;
}}m=IMO.Session.get().add("im",l,k);
m.is_oauth=i;
var c={on_login_fail:function(o,u){IMO.EventTarget.unsubscribe(m,c);
IMO.Session.get().remove(m);
var t=u.edata.reason;
var r=u.edata.details||t;
var s=IMO.UserFriendlyReason(r,m);
h(m,t,s);
},on_signed_on:function(){q.ev.fire("on_login_succeed");
}};
IMO.EventTarget.on(m,c);
if(i){if(!m.authorized&&(m.state===d.IM_STATE_OFFLINE)){m.set_state(d.IM_STATE_CONNECTING);
}}else{m.login(e,p,n);
}g();
}});
}());
(function(){var a=IMO.Utils;
var e=function(f){return Math.floor((f-1)/2);
};
var c=function(f){return 2*f+1;
};
var d=function(f){return 2*f+2;
};
IMO.Utils.BinHeap=function b(f){if(!f){f=function(g){return g;
};
}this.key_fn=f;
this.arr=[];
};
a.mix(IMO.Utils.BinHeap.prototype,{push:function(g){var f=this.arr.length;
var j=this.key_fn(g);
var h=e(f);
while((f>0)&&(j<this.heap_val(h))){this.arr[f]=this.arr[h];
f=h;
h=e(f);
}this.arr[f]=g;
},pop:function(){if(this.arr.length===0){return null;
}var f=this.arr[0];
this.arr[0]=this.arr[this.arr.length-1];
this.arr.length--;
this.heapify(0);
return f;
},is_empty:function(){return this.arr.length===0;
},root:function(){if(this.arr.length===0){return null;
}return this.arr[0];
},heapify:function(j){var f=c(j);
var k=d(j);
var m=this.arr.length;
var h;
if((f<m)&&(this.heap_val(f)<this.heap_val(j))){h=f;
}else{h=j;
}if((k<m)&&(this.heap_val(k)<this.heap_val(h))){h=k;
}if(h!==j){var g=this.arr[j];
this.arr[j]=this.arr[h];
this.arr[h]=g;
this.heapify(h);
}},heap_val:function(f){return this.key_fn(this.arr[f]);
}});
}());
(function(){var e=IMO.Utils;
var k=e.HTML;
var h=30*1000;
var j=10*1000;
var b=5*1000;
var c=3*1000;
var d=500;
var f=10*1000;
var a=100;
var i=function(m){this.message=m;
this.number_transmissions=0;
this.timestamp=0;
};
var g=function(m,n){this.connection=m;
this.timestamp=n;
};
Y.mix(g.prototype,{destroy:function(m){m=e.dfl(m,true);
if(m){this.connection.abort();
}this.connection.io.detachAll();
delete this.connection;
}});
var l;
IMO.Network=l=function(){this.outgoing_queue=[];
this.incoming_queue=new IMO.Utils.BinHeap(function(m){return m.seq;
});
this.seq=0;
this.highest_seq_sent=-1;
this.processed_incoming_seq=-1;
this.ack_recv=0;
this.request_id=0;
this.request_map={};
this.route_counter=0;
this.route_map={};
this.consecutive_failures=0;
this.consecutive_invalid_ack_recv=0;
this.ev=new IMO.Event();
k.on("unload",this.handle_unload,window,this);
k.on("beforeunload",this.handle_beforeunload,window,this);
this.timers={};
this.register_timer("retransmit",c,this.retransmit_messages);
this.register_timer("check_routes",j,this.close_long_lived_routes);
this.register_timer("single_connection",f,this.keep_one_connection_open);
this.register_timer("check_sleep",d,this.check_sleep);
this.ssid=null;
this.ssid_cb=null;
this.get_ssid();
this.backoff_timer=null;
};
Y.mix(l.prototype,{on_ssid:function(m){if(this.ssid!==null){m(this.ssid);
}else{this.ssid_cb=m;
}},get_ssid:function(){var u=0;
var m=e.random_string(IMO.Constants.SSID_LENGTH);
var r=e.parse_query();
var t=r.session_shard;
Y.log(["get_ssid",m]);
var p={ack:0,ssid:m,messages:[{seq:0,from:{system:"client",ssid:m},to:{system:"session"},data:{method:"get_cookie_and_ssid",data:{ssid:m,kind:"reui",version:IMO.Constants.JS_VERSION,session_shard:t}}}]};
var q=["method="+encodeURIComponent("rest_rpc"),"data="+encodeURIComponent(Y.JSON.stringify(p))].join("&");
var n=function(w,v){u++;
Y.log("Failed to get an ssid - retrying");
if(u>20){alert("Could not connect to IMO servers!");
return;
}Y.later(1000,this,this.get_ssid);
};
var s=function(y,w){if(typeof w==="undefined"){Y.log("ssid success callback was called with undefined","error");
n.apply(this);
return;
}if(w.responseText===""){Y.log("ssid success callback was called with empty string","error");
n.apply(this);
return;
}var x=Y.JSON.parse(w.responseText);
Y.log(x);
var v;
v=x.data.messages[0].message.data.edata.new_ssid;
this.cookie_login=x.data.messages[0].message.data.edata.do_cookie_login;
if(!v){Y.log(["new_ssid is false!",v,x]);
n.apply(this);
return;
}this.reset(v);
Y.log("got a new ssid!! "+this.ssid);
if(this.ssid_cb){this.ssid_cb();
this.ssid_cb=null;
}else{if(!this.cookie_login){e.refresh_page();
}}};
var o=function(){this.ssid_conn.io.detachAll();
};
this.ssid_conn=Y.io("/imo",{method:"POST",data:q,context:this,timeout:h,on:{success:s,failure:n,end:o}});
},send:function(o,t,q,r,s,n,m){q.ssid=this.ssid;
var p={data:q,method:t};
if(s){this.request_map[this.request_id]={callback:s,context:n,plus_obj:m};
p.request_id=this.request_id;
++this.request_id;
}this.forward_to_server({to:{system:o},from:{system:"client",ssid:this.ssid},data:p},r);
},reset:function(o){Y.log(["RESET new_ssid",o]);
this.ssid=o||e.random_string(IMO.Constants.SSID_LENGTH);
this.destroy();
var q=this.outgoing_queue;
this.outgoing_queue=[];
this.seq=0;
for(var p=0;
p<q.length;
p++){var r=q[p];
var n=r.message;
if(n.from&&n.from.ssid){n.from.ssid=this.ssid;
}if(n.data&&n.data.ssid){n.data.ssid=this.ssid;
}this.add_to_outgoing_queue(n);
}this.incoming_queue=new IMO.Utils.BinHeap(function(m){return m.seq;
});
this.highest_seq_sent=-1;
this.processed_incoming_seq=-1;
this.ack_recv=0;
this.route_counter=0;
this.route_map={};
this.consecutive_failures=0;
this.consecutive_invalid_ack_recv=0;
this.start_all_timers();
this.ev.fire("on_network_pre_cookie_login");
this.send("session","cookie_login",{});
},add_to_outgoing_queue:function(m){m.seq=this.seq;
var n=new i(m);
this.outgoing_queue.push(n);
this.seq++;
},get_next_outgoing_messages:function(){var m=[];
var n=(new Date()).getTime();
for(var o=0;
o<this.outgoing_queue.length;
o++){var p=this.outgoing_queue[o];
if(p.number_transmissions===0||(n-p.timestamp)>b){m.push(p);
}}return m;
},add_to_incoming_queue:function(o){var n;
if(o.flags){for(n=0;
n<o.flags.length;
n++){if(o.flags[n]==="RST"){this.process_reset();
return;
}}}if(this.processed_incoming_seq>o.seq){Y.log("duplicate message:  processed incoming seq:"+this.processed_incoming_seq+" message.seq:"+o.seq,"warn");
return;
}for(n=0;
n<this.incoming_queue.arr.length;
n++){var m=this.incoming_queue.arr[n];
if(m.seq===o.seq){Y.log("don't queue duplicate message seq:"+o.seq,"warn");
return;
}}this.incoming_queue.push(o);
},check_sleep:function(){if(this.last_sleep_check&&((new Date())-this.last_sleep_check)>10000){this.abort_all_connections();
this.ev.fire("on_network_unsleep");
if((new Date())-this.last_sleep_check>60*1000*4){this.get_ssid();
}this.keep_one_connection_open();
}this.last_sleep_check=new Date();
},check_and_truncate_oversized_incoming_queue:function(){if(this.incoming_queue.arr.length>a){Y.log("incoming queue is full. emptying the queue","warn");
this.incoming_queue.arr=[];
}},get_next_incoming_messages:function(){var n=this.processed_incoming_seq;
var m=[];
while(!this.incoming_queue.is_empty()){var o=this.incoming_queue.root();
if(o.seq<n+1){this.incoming_queue.pop();
}else{if(o.seq===n+1){this.incoming_queue.pop();
m.push(o);
n+=1;
}else{break;
}}}if(n!==this.processed_incoming_seq){}this.processed_incoming_seq=n;
return m;
},process_incoming_message:function(m){if(m.from["system"]==="internal"){this.process_response(m.data);
return;
}if(m.data.type==="reset"){this.get_ssid();
return;
}this.ev.fire("on_network_message",m);
},process_response:function(o){var p=o.request_id;
var m=o.response;
var n=this.request_map[p];
if(n===undefined){Y.log("Error! Unknown request");
return;
}delete this.request_map[p];
n.callback.call(n.context,m,n.plus_obj);
},process_reset:function(){this.destroy();
this.consecutive_invalid_ack_recv=0;
var n={type:"reset",name:"reset",edata:{}};
var m={data:n,from:{system:"reset"},to:{system:"client",ssid:this.ssid}};
this.process_incoming_message(m);
},execute_rpc:function(n,o){var m=Y.io("/imo",{method:"POST",data:n,on:{success:this.success_cb,failure:this.failure_cb},"arguments":{id:o},context:this,timeout:h});
return m;
},send_messages_to_web_server:function(m){var r;
m=(typeof m==="undefined")?false:m;
var s=this.get_next_outgoing_messages();
if(s.length===0&&!m){return;
}var p=[];
for(r=0;
r<s.length;
r++){p.push(s[r].message);
}var q={ack:this.processed_incoming_seq+1,ssid:this.ssid,messages:p};
var t=["method="+encodeURIComponent("forward_to_server"),"data="+encodeURIComponent(Y.JSON.stringify(q))].join("&");
var o=this.execute_rpc(t,this.route_counter);
if(!o){return;
}var n=(new Date()).getTime();
this.route_map[this.route_counter]=new g(o,n);
this.route_counter++;
for(r=0;
r<s.length;
r++){var u=s[r].message.seq;
if(u>this.highest_seq_sent){this.highest_seq_sent=u;
}s[r].number_transmissions++;
s[r].timestamp=n;
}},retransmit_messages:function(){this.send_messages_to_web_server(false);
},close_long_lived_routes:function(){var m=[];
var n=(new Date()).getTime();
e.foreach(this.route_map,function(p,q){if((n-p.timestamp)>h){p.destroy(true);
m.push(q);
}},this);
for(var o=0;
o<m.length;
o++){delete this.route_map[m[o]];
}this.keep_one_connection_open();
},num_routes:function(){var m=0;
e.foreach(this.route_map,function(n){m++;
},this);
return m;
},keep_one_connection_open:function(){var m=this.num_routes();
if(m>0){return;
}this.send_messages_to_web_server(true);
},update_ack_recv:function(m){if(m===this.ack_recv){this.consecutive_invalid_ack_recv=0;
return;
}if(m<this.ack_recv){this.consecutive_invalid_ack_recv+=1;
Y.log("ack_recv: "+m+" expected ack_recv: "+this.ack_recv+" consec invalid ack recv: "+this.consecutive_invalid_ack_recv);
if(this.consecutive_invalid_ack_recv>10){this.process_reset();
}if(m===0&&this.ack_recv>5){this.get_ssid();
this.ev.fire("on_network_problems");
}return;
}if((m<this.ack_recv+1)||(m>this.highest_seq_sent+1)){Y.log("duplicate or out of range ack_recv:"+m+" must be in range "+(this.ack_recv+1)+":"+(this.highest_seq_sent+1));
this.consecutive_invalid_ack_recv+=1;
if(this.consecutive_invalid_ack_recv>10){this.process_reset();
}return;
}this.consecutive_invalid_ack_recv=0;
this.ack_recv=m;
while(this.outgoing_queue.length>0&&this.outgoing_queue[0].message.seq<this.ack_recv){this.outgoing_queue.shift();
}},forward_to_server:function(m,n){this.add_to_outgoing_queue(m);
if(n!==false){this.send_messages_to_web_server(false);
}},forward_to_client:function(p,o){this.update_ack_recv(p);
var n;
for(n=0;
n<o.length;
n++){this.add_to_incoming_queue(o[n]);
}var m=this.get_next_incoming_messages();
for(n=0;
n<m.length;
n++){this.process_incoming_message(m[n]);
}this.check_and_truncate_oversized_incoming_queue();
this.keep_one_connection_open();
},success_cb:function(p,m,n){if(typeof m==="undefined"){Y.log("success callback was called with undefined","error");
return;
}if(m.responseText===""){Y.log("success callback was called with empty string","error");
return;
}var o=Y.JSON.parse(m.responseText);
if(this.consecutive_failures>0){if(this.backoff_timer){this.backoff_timer.cancel();
this.backoff_timer=null;
}this.start_all_timers();
}this.consecutive_failures=0;
this._destroy_route(n.id);
this.forward_to_client(o.data.ack,o.data.messages);
if(this.consecutive_invalid_ack_recv===0){this.ev.fire("on_network_reconnected");
}},failure_cb:function(r,o,p){var n=o.status;
var q=o.statusText;
this._destroy_route(p.id);
var m=(1000*Math.min(Math.pow(2,this.consecutive_failures),16));
this.consecutive_failures+=1;
if(this.consecutive_failures>4){this.ev.fire("on_network_problem");
}this.stop_timer("retransmit");
this.stop_timer("single_connection");
Y.log(["backoff:",m,n,q]);
if(this.backoff_timer){this.backoff_timer.cancel();
this.backoff_timer=null;
}this.backoff_timer=Y.Lang.later(m,this,this.keep_one_connection_open,[],false);
},_destroy_route:function(m){if(this.route_map[m]){this.route_map[m].destroy(false);
delete this.route_map[m];
}},register_timer:function(n,o,m){if(!this.timers[n]){this.timers[n]={interval:o,"function":m,timer_object:null};
}},start_all_timers:function(){IMO.Utils.foreach(this.timers,function(m,n){this.start_timer(n);
},this);
},start_timer:function(m){var n=this.timers[m];
if(n.timer_object===null){n.timer_object=Y.later(n.interval,this,n["function"],[],true);
}},stop_all_timers:function(){IMO.Utils.foreach(this.timers,function(m,n){this.stop_timer(n);
},this);
},stop_timer:function(m){var n=this.timers[m];
if(n.timer_object){n.timer_object.cancel();
n.timer_object=null;
}},destroy:function(){this.stop_all_timers();
this.abort_all_connections();
},abort_all_connections:function(){e.foreach(this.route_map,function(m){m.destroy(true);
},this);
this.route_map={};
},handle_unload:function(m){this.destroy();
},handle_beforeunload:function(m){this.destroy();
}});
IMO.make_singleton(l);
}());
(function(){var f=IMO.Constants;
var a=IMO.Utils;
var d=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
IMO.OAuth=function c(){this.ev=new IMO.Event();
IMO.EventDispatcher.get().subscribe(this,"oauthmanager","oauthmanager");
};
IMO.OAuth.GOOGLE2="google2";
IMO.OAuth.FACEBOOK="facebook";
IMO.OAuth.LINKEDIN="linkedin";
IMO.OAuth.TWITTER="twitter";
var e="https://%s/s/oauth/login?service=%s&ssid=%s&callback=%s";
Y.mix(IMO.OAuth.prototype,IMO.EventTarget);
Y.mix(IMO.OAuth.prototype,{init:function(){if(this.init_flag){return;
}this.init_flag=true;
this.windows=[];
this.on(IMO.OAuth.get());
},read_cookie:function(h){var k=h+"=";
var g=document.cookie.split(";");
for(var j=0;
j<g.length;
j++){var l=g[j];
while(l.charAt(0)===" "){l=l.substring(1,l.length);
}if(l.indexOf(k)===0){return unescape(l.substring(k.length,l.length));
}}return null;
},oauth_connect:function(l,p,q,k,h){if(l==="google"){l="google2";
}var g=a.sprintf(e,location.host,l,IMO.Network.get().ssid,p);
var j={extras:k,scope:q};
if(h){a.foreach(h,function(s,r){j[r]=s;
});
}g+=this.simple_url_serialize(j);
var i,o;
if(l===IMO.OAuth.FACEBOOK){i=500;
o=300;
}else{i=800;
o=580;
}var n=(screen.width-i)/2;
var m=(screen.height-o-50)/2;
this.windows.push(window.open(g,"_blank","width="+i+", height="+o+", top="+m+", left="+n));
},simple_url_serialize:function(h){var g=[];
a.foreach(h,function(j,i){if(j){g.push("&"+i+"="+j);
}},this);
return g.join("");
},oauth_login:null,outer_login:false,oauth_result:function(m){Y.log("OAuth Result",m);
var l=m.edata;
for(var h=0;
h<this.windows.length;
h++){this.windows[h].close();
}this.windows=[];
if(l.status==="fail"){if(l.data){this.ev.fire("on_oauth_login_fail",l.data.reason,false);
}else{this.ev.fire("oauth_failed",this,l.service);
}return;
}else{if(l.status==="ok"){var g=a.sprintf("access_token=%s&access_token_secret=%s",l.data.access_token,l.data.access_token_secret);
this.ev.fire("oauth",this,l.service,g);
}else{if(l.status==="success"){this.ev.fire("oauth",this,l.service,g);
}else{if(l.status==="oauth_login"){var k={};
k.is_oauth=true;
k.uid=l.data.uid;
k.proto=IMO.Constants.OAUTH_PROTOCOL_TO_PROTO[l.service];
if(this.outer_login){this.oauth_login(k);
if(!d.dom("spinner")){var j=d.dom("splash_oauth");
j.appendChild(this.oauth_login.loading=d.img({src:"/assets/loader_16.gif",id:"spinner"}));
}}else{this.oauth_login(k);
}}}}}},_website_can_signup:function(g){return g==IMO.OAuth.FACEBOOK||g==IMO.OAuth.GOOGLE2||g==IMO.OAuth.LINKEDIN||g==IMO.OAuth.TWITTER;
},pin_signup:function(g){if(this._website_can_signup(g)){this.oauth_connect(g,f.OAUTH_PIN_SIGNUP_CALLBACK,null,null,{login_if_taken:true});
}},profile_connect:function(g,h){if(this._website_can_signup(g)){this.oauth_connect(g,f.OAUTH_PIN_LINK_CALLBACK,null,h);
}},post_connect:function(g,h){this.oauth_connect(g,f.OAUTH_PIN_POST_CALLBACK,"publish",h);
},proto_has_oauth:function(g){return(g===IMO.Constants.PROTO_FACEBOOK||g===IMO.Constants.PROTO_GTALK||g===IMO.Constants.PROTO_YAHOO||g===IMO.Constants.PROTO_MSN);
},login:function(l,k,j,h){var m=k;
this.outer_login=h;
this.oauth_login=k;
var g=this;
var i=function(){var n=IMO.Constants.PROTO_TO_OAUTH_PROTOCOL[l];
IMO.OAuth.get().oauth_connect(n,f.OAUTH_LOGIN_CALLBACK,"chat");
};
if(!k&&arguments.callee.init_responses){arguments.callee.init_responses=false;
IMO.EventTarget.unsubscribe(IMO.OAuth.get());
}if(k&&!arguments.callee.init_responses){IMO.EventTarget.on(IMO.OAuth.get(),{on_oauth_login_fail:function(q){var o=l;
var n=IMO.UserFriendlyReason.reauth_reasons[o][q];
if(!n){n=q;
}var r=j.msg;
if(r){d.empty(r);
d.show(r);
d.add_class(r,"message");
r.appendChild(d.sprite("error_icn"));
r.appendChild(b("Login fail! "));
r.appendChild(d.div(b(n)));
}if(m.loading){d.remove(m.loading);
m.loading=null;
}}});
arguments.callee.init_responses=true;
}i();
}});
IMO.make_singleton(IMO.OAuth);
}());
(function(){var b=IMO.Utils;
var i=IMO.Utils.TranslateDom;
var h=IMO.Utils.HTML;
var f="photo";
var a="photo_comments";
var g="/phup/";
var d=2;
var e=["jpeg","jpg","bmp","png","gif"];
var j={};
IMO.GetPhotoManager=function(l,n,m){var k=l+";"+n;
if(m!==undefined){k+=";"+m;
}if(!j[k]){j[k]=new IMO.PhotoManager(l,n,m);
}return j[k];
};
IMO.PhotoManager=function c(l,o,n){this.ev=new IMO.Event();
this.acc={uid:l,proto:o};
this.streams=[];
if(n!==undefined){this.acc.gid=n;
}var k=n===undefined?l:n;
var p=n===undefined?o:"groups";
IMO.EventDispatcher.get().subscribe(this,f,f,k,p);
IMO.EventDispatcher.get().subscribe(this,a,a,k,p);
var m={meta:"",uid:l,proto:o,ssid:IMO.Network.get().ssid};
if(n!==undefined){m.gid=n;
}this._uploading_info={queue:[],common_props:m,active:0};
};
Y.mix(IMO.PhotoManager.prototype,{upload_photos:function(o,n,m){if(m===undefined){m=new Date().getTime();
}var l=this._uploading_info;
var k=Y.merge(l.common_props,{streamID:n,uncommitted:"false",timestamp:m,newUISimpleUploader:true});
b.foreach(o,function(r){var q=this.get_filename(r);
var p=Y.merge(k,{filename:q});
l.queue.push({photo:r,props:p});
},this);
this._upload_next_photo();
},refresh_streams:function(){IMO.Network.get().send(f,"getPhotoStreamsForAccount",this.acc);
},create_stream:function(){IMO.Network.get().send(f,"createStreamIDs",{accounts:[this.acc]});
},delete_photo:function(m,k){var l=Y.merge(this.acc,{streamID:m,photoID:k});
IMO.Network.get().send(f,"deletePhoto",l);
},delete_photo_from_upload_queue:function(k){var l=this._uploading_info;
l.queue=b.filter(l.queue,function(m){return m.props.filename!==k;
});
},commit_photos:function(m,l){var k=Y.merge(this.acc,{streamID:m,timestamp:l+""});
IMO.Network.get().send(f,"commitPhotos",k);
},download_photos:function(m,k){var l=Y.merge(this.acc,{streamID:m,photoIDs:k});
IMO.Network.get().send(f,"download_photos",l);
},delete_photos:function(l,m){var k=Y.merge(this.acc,{stream_id:l,photo_ids:m});
IMO.Network.get().send(f,"delete_photos",k);
},add_comment:function(k,m){var l=Y.merge(this.acc,{photo_id:k,text:m,stream_id:this.streams[0].streamID});
IMO.Network.get().send(a,"add_comment",l);
},get_comments:function(k){var l=Y.merge(this.acc,{photo_id:k,stream_id:this.streams[0].streamID});
IMO.Network.get().send(a,"get_comments",l);
},get_photo_url:function(k,m){if(m!==undefined){m=Math.min(m,k.sizes.length-1);
var l=k.sizes[m];
return b.sprintf("/o/[PHOTO_ID][WIDTH]x[HEIGHT]",{PHOTO_ID:k.photoID,WIDTH:l[0],HEIGHT:l[1]});
}else{return"/o/"+k.photoID;
}},get_photo_id_from_url:function(k){return k.substr(k.lastIndexOf("/")+1,28);
},get_photo_size_from_url:function(k){var l=k.substr(k.lastIndexOf("/")+29).split("x");
return[parseInt(l[0],10),parseInt(l[1],10)];
},get_filename:function(l){var k;
if(window.File&&l instanceof window.File){k=l.name;
}else{k=l.value;
}k=k.substr(k.lastIndexOf("\\")+1);
k=k.substr(k.lastIndexOf("/")+1);
return k;
},is_image:function(k){var m=false;
var l=k.substr(k.lastIndexOf(".")+1).toLowerCase();
b.foreach(e,function(n){m|=n===l;
});
return m;
},get_photo_size_to_cover:function(l,n,k){for(var m=0;
m<l.sizes.length;
m++){if(l.sizes[m][0]>=n&&l.sizes[m][1]>=k){return m;
}}return undefined;
},can_upload_with_file_reader:function(){return window.FileReader&&window.Uint8Array;
},getPhotoStreamsForAccount:function(k){this.streams=k.edata.streams;
this.ev.fire("on_refreshed_streams",k.edata.streams);
},createStreamIDs:function(l){var k=l.edata.streams;
this.streams=this.streams.concat(k);
this.ev.fire("on_created_streams",k);
},photo_uploaded:function(l){this._uploading_info.active--;
var k=l.edata;
this.ev.fire("on_photo_uploaded",k.streamID,k.photoObject);
this._upload_next_photo();
},photosCommitted:function(l){var k=l.edata;
this.ev.fire("on_photos_committed",k.streamID,k.timestamp);
},deletePhoto:function(l){var k=l.edata;
this.ev.fire("on_photo_deleted",k.streamID,k.photoID);
},photoFailed:function(l){this._uploading_info.active--;
var k=l.edata;
if(k.reason===null){k.reason=i("Photo already uploaded.");
}this.ev.fire("on_photo_failed",k.filename,k.reason);
this._upload_next_photo();
},download_photos_cb:function(l){var k=l.edata;
this.ev.fire("on_photos_download_ready",k.url);
},deleted_photos:function(l){var k=l.edata;
this.ev.fire("on_photos_deleted",k.num_of_deleted);
},get_comments_cb:function(l){var k=l.edata;
this.ev.fire("on_comments_received",k.photo_id,k.comments);
},add_comment_cb:function(l){var k=l.edata;
this.ev.fire("on_comment_added",k.photo_id,k.added,k.text);
},_upload_photo_by_input_file:function(k,m){var n=h.form({enctype:"multipart/form-data",id:"photo"+b.random_string()},k);
k.name="file";
Y.one("body").appendChild(n);
b.foreach(m,function(p,o){n.appendChild(h.input({type:"hidden",name:o,value:p}));
});
var l={method:"POST",form:{id:n,upload:true},on:{complete:function(){new Y.Node(n).remove(true);
this._upload_next_photo();
},failure:function(){new Y.Node(n).remove(true);
this.ev.fire("on_photo_failed",m.filename,"Uploading error. Please try again");
Y.log("Uploading for photo "+k.value+" failed.");
this._uploading_info.active--;
this._upload_next_photo();
}},context:this};
Y.io(g,l);
},_upload_photo_by_file_reader:function(l,m){Y.log(["upload_file",l]);
var o=new XMLHttpRequest();
o.open("POST",g,true);
var n=this;
o.onreadystatechange=function(){Y.log("xhr.readyState "+o.readyState);
if(o.readyState==4){Y.log("xhr.status: "+o.status);
if(o.status==200){Y.log(o);
n._upload_next_photo();
}else{Y.log(["XHR in file reader failed.",o]);
n.ev.fire("on_photo_failed",m.filename,"Uploading error. Please try again.");
n._uploading_info.active--;
n._upload_next_photo();
}}};
var k=new window.FileReader();
k.onload=function(u){var x=u.target.result;
Y.log(["len bin",x.length]);
var p="BROWSERS_ARE_TERRIBLE!!!";
var v="multipart/form-data; boundary="+p;
o.setRequestHeader("Content-Type",v);
var w="\r\n";
var t=[];
var q="Content-Disposition: form-data; ";
q+='name="file"'+w;
q+="Content-Type: application/octet-stream";
q+=w+w;
q+=x+w;
t.push(q);
for(var r in m){q="Content-Disposition: form-data; ";
q+='name="'+r+'"'+w+w;
q+=m[r]+w;
t.push(q);
}var s="--"+p+w;
s+=t.join("--"+p+w);
s+="--"+p+"--"+w;
Y.log(["xhr",o]);
if(o.sendAsBinary===undefined){Y.log("we do not have it");
XMLHttpRequest.prototype.sendAsBinary=function(z){function A(C){return C.charCodeAt(0)&255;
}var B=Array.prototype.map.call(z,A);
var y=new window.Uint8Array(B);
this.send(y.buffer);
};
}o.sendAsBinary(s);
Y.log("send done");
};
k.readAsBinaryString(l);
Y.log(["reader",k]);
},_upload_next_photo:function(){var o=this._uploading_info;
if(o.queue.length===0||o.active===d){return;
}var m=o.queue.shift();
var n=m.props;
var k=m.photo;
if(!this.is_image(n.filename)){var l=e.join(", ");
this.ev.fire("on_photo_failed",n.filename,i("Allowed files: [EXTENSIONS]",{EXTENSIONS:l}));
Y.later(10,this,this._upload_next_photo);
return;
}this.ev.fire("on_photo_upload_started",n.filename);
o.active++;
if(window.File&&k instanceof window.File){this._upload_photo_by_file_reader(k,n);
}else{this._upload_photo_by_input_file(k,n);
}}});
}());
(function(){IMO.PreferenceDefaults={allowNonBuddies:true,noEmoticons:false,saveHistory:false,show_buddy_icons:true,mute:false,beep:"imo0",desktop_notifications:false,auto_voice_im:false,allowNonImoContacts:true,showPrimitiveToNonContacts:true,window_manager:"TWM",show_discussion_join_leave:false};
}());
(function(){var a=IMO.Utils;
var e=IMO.Constants;
var c=null;
var b=30*1000;
IMO.Promo=function d(){this.ev=new IMO.Event();
this.conn=null;
this.id=null;
this.suppress_until=new Date();
this.state=0;
IMO.EventDispatcher.get().subscribe(this,"promo","promo");
this.on(IMO.Session.get());
this.on(IMO.Alpha.get());
};
Y.mix(IMO.Promo.prototype,IMO.EventTarget);
Y.mix(IMO.Promo.prototype,{init:function(){IMO.EventDispatcher.get().subscribe(this,"promo","promo");
},on_prefs_loaded:function(){this.state|=1;
if(this.state===3){this.do_start_timer();
}},on_display:function(){this.state|=2;
if(this.state===3){this.do_start_timer();
}},do_start_timer:function(){Y.later(5*1000,this,function(){if(c===null){this.request_promo();
c=Y.later(300*1000,this,function(){this.request_promo();
},null,true);
}});
},on_alpha_ads:function(){if(!this.no_ads){this.ads=true;
}},do_stop_timer:function(){if(this.ads){this.no_promos=true;
return;
}if(!c){return;
}c.cancel();
c=null;
},hide:function(h){var f=IMO.Session.get().get_pref("impref","promo_expiry",{});
var g=(new Date()).valueOf()+h;
f[this.id]=(new Date(g)).toString();
IMO.Session.get().set_pref("impref","promo_expiry",f);
this.do_stop_timer();
},suppress:function(f){var g=new Date();
this.suppress_until=new Date(g.valueOf()+f);
this.ev.fire("on_promo_empty");
},request_promo:function(){if(new Date()<this.suppress_until){Y.log("Suppress requesting promo");
return;
}if(!IMO.ActivityMonitor.get().user_is_active()){Y.log("skipping request_promo because user is inactive");
return;
}if(this.queued_promo){this.ev.fire("on_promo_arrival",this.queued_promo[0],this.queued_promo[1]);
this.queued_promo=null;
return;
}if(this.ads){if(this.no_ads){this.ads=false;
}else{this.ev.fire("display_ad");
if(this.no_promos){return;
}}}Y.log("fetching promo");
IMO.Network.get().send("promo","get_promos",{edata:{kind:"web",quantity:1}});
},promos:function(j){if(new Date()<this.suppress_until){Y.log("Suppress showing promo");
return;
}var f=null;
var i=j.edata.urls;
if(i!==null&&i.length>0){f=i[0];
}Y.log("promo URL is "+f);
if(f!==null){var g=f.replace("https://imo.im/","/");
this.id=f.match(/promo\/(.*)/)[1]||f;
var h=IMO.Session.get().get_pref("impref","promo_expiry",{})[this.id];
if(h&&(new Date(h))>(new Date())){return;
}Y.log("noxss is "+g);
this.conn=Y.io(g,{method:"GET",on:{start:null,complete:null,success:this.success_cb,failure:this.failure_cb,end:null},"arguments":this.id,context:this,timeout:b});
}else{if(!this.ads){Y.log("Null promo, so undisplaying it");
this.ev.fire("on_promo_empty");
}}},dont_display_ads:function(f){this.no_ads=true;
},success_cb:function(g,f,h){if(typeof f==="undefined"){Y.log("success callback was called with undefined","error");
return;
}if(f.responseText===""){Y.log("success callback was called with empty string","error");
return;
}Y.log("success_cb was called with response"+f.responseText);
this.conn=null;
if(this.ads){this.queued_promo=[f.responseText,h];
}else{this.ev.fire("on_promo_arrival",f.responseText,h);
}},failure_cb:function(h,f,g){Y.log("Promo fetch failure :-(");
this.conn=null;
}});
IMO.make_singleton(IMO.Promo);
}());
(function(){var b=IMO.Utils;
var e=IMO.Constants;
var d=IMO.Utils.TranslateTxt;
var a=d("on https://imo.im");
IMO.Session=function c(){this.accounts={};
this.prefs={};
this._first_prefs_arrived=false;
this.ad="";
this.primitive=IMO.Constants.PRIM_AVAILABLE;
this.status="";
this.auto_away=true;
this.ev=new IMO.Event();
this.on(IMO.Network.get());
};
Y.mix(IMO.Session.prototype,IMO.EventTarget);
Y.mix(IMO.Session.prototype,{init:function(){IMO.EventDispatcher.get().subscribe(this,"im","account");
IMO.EventDispatcher.get().subscribe(this,"im","blist");
IMO.EventDispatcher.get().subscribe(this,"session","session");
IMO.EventDispatcher.get().subscribe(this,"preference","preference");
IMO.EventDispatcher.get().subscribe(this,"pin","pin_account");
},on_network_pre_cookie_login:function(){b.foreach(this.get_accounts(),function(f){f.signed_off({});
f.signed_on_yet=false;
},this);
},get_all_sessions_for_all_accounts:function(){this.all_sessions_info={sessions:{},accounts:{}};
b.foreach(this.accounts,function(g,f){if(!g.signed_on_yet){return;
}g.send("get_sessions_for_user",{});
this.all_sessions_info.accounts[f]=null;
},this);
},online_ssids:function(h){var g=this.check_account(h,"im");
Y.log("online_ssids:");
Y.log(h);
this.all_sessions_info.accounts[g.id]=h;
b.foreach(h.info,function(k){var j=this.all_sessions_info.sessions[k.ssid]||(this.all_sessions_info.sessions[k.ssid]={});
Y.mix(j,k);
var i=j.accounts||(j.accounts={});
i[g.id]=g;
},this);
var f=b.foreach(this.all_sessions_info.accounts,function(i){if(i===null){return false;
}});
if(f!==false){Y.log("got all session info:");
Y.log(this.all_sessions_info);
this.ev.fire("on_all_account_sessions",this.all_sessions_info);
}},check_account:function(f,j){var g=f.uid;
var h=f.proto;
var i=b.get_account_id(j,h,g);
if(!this.accounts[i]){this.add(j,g,h);
}return this.accounts[i];
},private_link_accounts:function(g,h){var f=new IMO.LinkGroup(h);
b.foreach(g,function(i){var j=this.check_account(i,i.account_type);
f.add(j);
},this);
return f;
},private_unlink_accounts:function(f){b.foreach(f,function(g){var h=this.check_account(g,g.account_type);
if(h.link_group){h.link_group.remove(h);
}this.ev.fire("on_unlinked_account",h);
},this);
},signed_on:function(f){this.check_account(f,"im");
},not_signing_on:function(f){this.check_account(f,"im");
},buddy_added:function(f){this.check_account(f,"im");
},buddy_status:function(f){this.check_account(f,"im");
},buddy_icon:function(f){this.check_account(f,"im");
},account_icon:function(f){this.check_account(f,"im");
},report_account_data:function(f){this.check_account(f,"im");
},signed_off:function(f){},remember_me:function(f){},linked_accounts:function(i){var g=i.edata.accounts;
var h=i.edata.failed_accounts;
b.foreach(g,function(j){var k=this.check_account(j,"im");
if(k.state===e.IM_STATE_OFFLINE&&!k.authorized&&!k.lapw){k.authorized=true;
k.set_state(e.IM_STATE_CONNECTING);
}},this);
b.foreach(h,function(j){var k=this.check_account(j,"im");
k.authorized=false;
if(k.state===e.IM_STATE_CONNECTING){k.set_state(e.IM_STATE_OFFLINE);
}},this);
if(g.length+h.length<=1){return;
}var f={};
b.foreach(g.concat(h),function(j){if(j.link_group_id>0){if(!f[j.link_group_id]){f[j.link_group_id]=[];
}f[j.link_group_id].push(j);
}},this);
b.foreach(f,function(k,l){if(l===0){return;
}var j=this.private_link_accounts(k,l);
j.synced=true;
},this);
},linked_accounts_failed:function(f){this.ev.fire("on_linked_accounts_failed",f);
},link_success:function(g){var f=g.edata.accounts;
this.private_link_accounts(f);
this.ev.fire("on_link_success");
},unlink_success:function(g){var f=g.edata.accounts;
this.private_unlink_accounts(f);
this.ev.fire("on_unlink_success");
},signoff_all:function(f){this.ev.fire("on_signoff_all");
b.refresh_page();
},system_message:function(f){this.ev.fire("on_system_message",f.data);
},reflect:function(g){var f=g.edata;
if(f.r_name==="set_status"){IMO.ActivityMonitor.get().report_activity(false);
this.primitive=f.primitive;
this.ad=f.ad;
this.status=f.status;
this.auto_away=f.auto_away;
this.ev.fire("on_status",this.primitive,this.status,this.ad,this.auto_away);
}},get:function(f){this._first_prefs_arrived=true;
var g=false;
b.foreach(f.preferences,function(j,h){if(j.kind==="impref"){if(j.pref==="currentStatus"&&this.status!==j.value){this.status=j.value;
g=true;
}else{if(j.pref==="currentPrim"&&this.primitive!==j.value){this.primitive=j.value;
g=true;
}else{if(j.pref==="imoStatus"&&j.value===true){this.ad=a;
g=true;
}else{if(j.pref==="auto_away"){this.auto_away=j.value;
}}}}}},this);
if(g){this.set_status({});
}b.foreach(f.preferences,function(l,j){if(l.kind==="impref"&&l.pref==="buddy_star"){var k=this.check_account(f,"im");
IMO.BuddyList.get().blist_begin(Y.Object.keys(l.value).length);
b.foreach(l.value,function(m,i){var o=i.split("#");
if(o.length!==3){return;
}var p=o[2];
var n=k.get_buddy(p,true);
n.favorite=true;
n.update();
this.ev.fire("on_recv_favorite",k,p);
},this);
IMO.BuddyList.get().blist_end();
}else{var h=[l.kind,l.pref].join("#");
this.prefs[h]=l.value;
this.ev.fire("on_recv_pref",l.kind,l.pref,l.value);
}},this);
this.ev.fire("on_prefs_loaded");
},not_authenticated:function(f){var g=b.foreach(this.accounts,function(h){if(!(h instanceof IMO.IMAccount)){return;
}if(h.state===e.IM_STATE_CONNECTING){return true;
}},this);
if(g){Y.log(["ignoring not_authenticated message",f]);
return;
}Y.log(["not_authenticated - signing out",f],"error");
this.signoff_all();
},add:function(g,f,h){f=b.normalize_uid(f,h);
var j=b.get_account_id(g,h,f);
if(this.accounts[j]){return this.accounts[j];
}var i;
if(g==="im"){if(h==="imo"){i=new IMO.IMOAccount(f);
}else{i=new IMO.IMAccount(f,h);
}}else{throw"bad account type";
}this.accounts[i.id]=i;
i.session=this;
this.ev.fire("on_create_account",i);
return i;
},remove:function(h){var f=h.id;
Y.log(["deleting account",f,h]);
if(!this.accounts[f]){return false;
}var g=h.signed_on_yet;
h.link_group.remove(h);
h.destroy();
delete this.accounts[f];
this.ev.fire("on_remove_account",h);
Y.log("account deleted");
if(this.get_accounts().length===0&&g){b.refresh_page();
}return true;
},get_accounts:function(){var f=[];
b.foreach(this.accounts,function(g,h){if(g.authorized){f.push(g);
}});
return f;
},get_account_names:function(){return b.map(this.accounts,function(f){return{uid:f.uid,proto:f.proto};
});
},get_accounts_by_link_group:function(){var f={};
b.foreach(this.accounts,function(g,h){f[g.link_group?g.link_group.id:null]=g.link_group;
});
return f;
},get_accounts_by_link_group_imo_first:function(){var g=this.get_accounts_by_link_group();
var f=[];
b.foreach(g,function(i){var h=false;
b.foreach(i.accounts,function(j){if(j.proto===e.PROTO_IMO){h=true;
}},this);
if(h){f.unshift(i);
}else{f.push(i);
}},this);
return f;
},get_account:function(g,f,h){return this.accounts[b.get_account_id(g,h,f)];
},get_single_signed_on_account:function(){return this.get_account_filter(null,e.IM_STATE_ONLINE);
},get_signed_on_imo_account:function(){return this.get_account_filter(e.PROTO_IMO,e.IM_STATE_ONLINE);
},get_imo_account:function(){return this.get_account_filter(e.PROTO_IMO);
},get_account_filter:function(f,g){return b.foreach(this.get_accounts(),function(h){if((!f||f===h.proto)&&(!g||g===h.state)){return h;
}});
},signoff:function(){this.ev.fire("on_signingoff_all");
IMO.Stats.increment_counter("click_signoff");
IMO.Stats.send();
IMO.Network.get().send("session","signoff_all",{});
IMO.ActivityMonitor.get().deactivate();
},signoff_other:function(f){IMO.Network.get().send("session","signoff_all",{other_ssid:f});
},set_remember_me:function(f){IMO.Network.get().send("session","set_remember_me",{remember:!!f});
},link_accounts:function(){IMO.Network.get().send("session","link_accounts",{});
},unlink_accounts:function(){IMO.Network.get().send("session","unlink_accounts",{});
},unlink_single_account:function(g){Y.log("unlink_single_account");
if(g.link_group.size()===1){Y.log("no link group - bailing out");
return;
}var f=[{uid:g.uid,proto:g.proto,account_type:g.account_type}];
IMO.Network.get().send("session","unlink_some_accounts",{accounts:f});
},set_status:function(h){Y.log("setting status in session");
this.primitive=b.dfl(h.primitive,this.primitive);
this.status=b.dfl(h.status,this.status);
this.ad=b.dfl(h.ad,this.ad);
this.auto_away=b.dfl(h.auto_away,this.auto_away);
IMO.Network.get().send("session","set_status",{primitive:this.primitive,status:this.status,ad:this.ad,auto_away:this.auto_away});
if(this.primitive!==e.PRIM_AVAILABLE&&this.primitive!==e.PRIM_OFFLINE){var g=false;
var f=false;
b.foreach(this.accounts,function(i){if(i.state!==e.IM_STATE_ONLINE){return;
}if(i.proto===e.PROTO_NEWFACEBOOK){g=true;
}else{if(i.proto===e.PROTO_GTALK){f=true;
}}});
if(g){IMO.NM.add_notification(d("Facebook does not support statuses (your buddies will see you as available)"),IMO.REUI.Notification.types.info);
}if(f&&this.primitive===e.PRIM_INVISIBLE){IMO.NM.add_notification(d("Invisible status for Google Talk is not supported (your buddies will see you as available)"),IMO.REUI.Notification.types.info);
}}this.ev.fire("on_status",this.primitive,this.status,this.ad,this.auto_away);
},set_prefs:function(f){if(f.length===0){return;
}b.foreach(f,function(l,k){var j=[l.kind,l.pref].join("#");
this.prefs[j]=l.value;
},this);
var g=[];
b.foreach(this.accounts,function(j,i){if((j instanceof IMO.IMAccount)&&!j.signed_on_yet){return;
}g.push({uid:j.uid,proto:j.proto});
});
if(g.length===0){return;
}var h={accounts:g,preferences:f};
IMO.Network.get().send("preference","set",h);
this.ev.fire("on_set_prefs",f);
},set_pref:function(g,f,h){this.set_prefs([{kind:g,pref:f,value:h}]);
},get_pref:function(i,g,f){var h=[i,g].join("#");
return b.dfl(this.prefs[h],f);
},get_all_prefs:function(){return this.prefs;
},have_prefs_arrived:function(){return this._first_prefs_arrived;
},send_feedback:function(h,g){var f={ssid:IMO.Network.get().ssid,ua:navigator.userAgent.toLowerCase(),version:IMO.Constants.JS_VERSION,location:location.href};
IMO.Network.get().send("feedback","send_feedback",{email_address:h,message:g,metadata:f});
}});
IMO.make_singleton(IMO.Session);
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
var e=IMO.Constants;
IMO.SharedGroup=function b(h,g,f){if(g.charAt(g.length-1)!==";"){g+=";";
}IMO.SharedGroup.superclass.constructor.call(this,h,g);
this.displaylias=this.alias||d("loading...");
this.gid=g.substring(0,g.length-1);
this.is_native=!!f;
this.group=this.gid;
this.default_icon=e.DEFAULT_GROUP_BICON;
this.ubid=a.create_ubid(this.gid,h.uid,h.proto);
this.name=this.ubid;
this.guide="2#"+this.displaylias;
this.normal=false;
this.buddies={};
if(this.is_native&&this.account.proto==e.PROTO_SKYPE){this.protoicon="groups_skype";
}else{if(this.is_native){this.protoicon=this.account.proto.replace(/prpl-/,"");
}else{this.protoicon="groups_available";
}}this.muted=false;
this.set_muted();
this.admin=false;
this.topic="";
this.type=null;
this.shared_group=true;
this.favorite=false;
this.update();
};
Y.extend(IMO.SharedGroup,IMO.MessageTarget);
Y.mix(IMO.SharedGroup.prototype,IMO.BuddyGroup.prototype);
Y.mix(IMO.SharedGroup.prototype,{get_display_buid:function(){return this.display;
},update:function(g){var f={guide:this.guide,displaylias:this.displaylias,is_native:this.is_native,protoicon:this.protoicon,admin:this.admin};
a.foreach(g,function(j,i){this[i]=j;
},this);
this.displaylias=this.alias||this.display||d("loading...");
this.guide=[this._get_guide(),this.displaylias].join("#");
IMO.BuddyList.get().update_buddy(this);
this.ev.fire("on_buddy_update",this,g,f);
if((g!==undefined)&&this.account.groups.pending_to_open_groups[this.gid]){var h=this.get_im_conversation();
if(h.ui){h.ui.focus();
}delete this.account.groups.pending_to_open_groups[this.gid];
}},get_im_conversation:function(f,g){if(!this.conversation){this.conversation=new IMO.IMConversation(this.account,this);
this.account.ev.fire("on_new_im_conversation",this.conversation);
}if(!g){IMO.EventGateway.get().ev.fire("on_get_conversation",this.conversation);
}return this.conversation;
},invite_buddy:function(f){var g={uid:this.account.uid,proto:this.account.proto,gid:this.gid,iproto:f.account.proto,iuid:f.account.uid,ibuid:f.buid};
IMO.Network.get().send("im","invite_to_group",g);
},invite_non_user:function(h,f){var g={uid:this.account.uid,proto:this.account.proto,gid:this.gid,iproto:f,iuid:this.account.uid,ibuid:h};
IMO.Network.get().send("im","invite_to_group",g);
},set_alias:function(f){if(f===this.displaylias){return;
}var g=this.displaylias;
this.alias=f;
this.update();
this.account.send("change_group_alias",{gid:this.gid,alias:f});
IMO.NM.add_notification(c("[BUDDY] has been renamed to [NAME].",{BUDDY:g,NAME:this.displaylias}),IMO.REUI.Notification.types.info);
},set_topic:function(f){if(f===this.topic){return;
}this.topic=f;
this.account.send("set_group_topic",{gid:this.gid,topic:f});
},get_status:function(){var i=0;
var g=0;
for(var h in this.buddies){++i;
var f=this.buddies[h];
if(f.primitive!==e.PRIM_OFFLINE&&f.primitive!==e.PRIM_PENDING){++g;
}}return this.topic+" ("+g+"/"+i+d(" online on imo)");
},set_muted:function(h,g){if(h===undefined){h=a.dfl(IMO.Session.get().get_pref("impref","groupmutes",{})[this.name],false);
}this.muted=h;
if(g){var f=IMO.Session.get().get_pref("impref","groupmutes",{});
f[this.name]=this.muted;
IMO.Session.get().set_pref("impref","groupmutes",f);
}this.ev.fire("on_set_muted",h);
},set_favorite:function(f){if(this.favorite===f){return;
}this.favorite=f;
this.update();
var i=f?"favorite_buddy":"unfavorite_buddy";
var g={buid:this.buid,proto:this.account.proto,uid:this.account.uid};
IMO.Network.get().send("preference",i,g);
var h=f?"[BUDDY] has been marked as a favorite.":"[BUDDY] is no longer marked as a favorite.";
IMO.NM.add_notification(c(h,{BUDDY:this.displaylias}),IMO.REUI.Notification.types.info);
},set_group:function(f){Y.log("in set_group new_group: "+f);
if(f===this.blist_group){return;
}if(f!==IMO.BuddyList.get().FAVORITES_GROUP&&f!==IMO.BuddyList.get().CHAT_GROUPS_GROUP&&f!==IMO.BuddyList.get().DISCUSSIONS_GROUP){return;
}this.set_favorite(f===IMO.BuddyList.get().FAVORITES_GROUP);
},_get_guide:function(){if(this.type===e.GROUP_TYPE.DISCUSSION){return 3;
}return 2;
},destroy:function(){if(this.conversation){this.conversation.destroy();
}IMO.SharedGroup.superclass.destroy.call(this);
}},true);
}());
var swfobject=function(){var ar="undefined",aE="object",ac="Shockwave Flash",X="ShockwaveFlash.ShockwaveFlash",aF="application/x-shockwave-flash",ad="SWFObjectExprInst",ay="onreadystatechange",ag=window,aM=document,aC=navigator,ab=false,aa=[aO],aH=[],ah=[],am=[],aK,ae,aq,au,al=false,aV=false,aI,ao,aJ=true,ai=function(){var a=typeof aM.getElementById!=ar&&typeof aM.getElementsByTagName!=ar&&typeof aM.createElement!=ar,e=aC.userAgent.toLowerCase(),c=aC.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(e),j=c?/mac/.test(c):/mac/.test(e),g=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,d=!+"\v1",f=[0,0,0],k=null;
if(typeof aC.plugins!=ar&&typeof aC.plugins[ac]==aE){k=aC.plugins[ac].description;
if(k&&!(typeof aC.mimeTypes!=ar&&aC.mimeTypes[aF]&&!aC.mimeTypes[aF].enabledPlugin)){ab=true;
d=false;
k=k.replace(/^.*\s+(\S+\s+\S+$)/,"$1");
f[0]=parseInt(k.replace(/^(.*)\..*$/,"$1"),10);
f[1]=parseInt(k.replace(/^.*\.(.*)\s.*$/,"$1"),10);
f[2]=/[a-zA-Z]/.test(k)?parseInt(k.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;
}}else{if(typeof ag.ActiveXObject!=ar){try{var i=new ActiveXObject(X);
if(i){k=i.GetVariable("$version");
if(k){d=true;
k=k.split(" ")[1].split(",");
f=[parseInt(k[0],10),parseInt(k[1],10),parseInt(k[2],10)];
}}}catch(b){}}}return{w3:a,pv:f,wk:g,ie:d,win:h,mac:j};
}(),aL=function(){if(!ai.w3){return;
}if((typeof aM.readyState!=ar&&aM.readyState=="complete")||(typeof aM.readyState==ar&&(aM.getElementsByTagName("body")[0]||aM.body))){aQ();
}if(!al){if(typeof aM.addEventListener!=ar){aM.addEventListener("DOMContentLoaded",aQ,false);
}if(ai.ie&&ai.win){aM.attachEvent(ay,function(){if(aM.readyState=="complete"){aM.detachEvent(ay,arguments.callee);
aQ();
}});
if(ag==top){(function(){if(al){return;
}try{aM.documentElement.doScroll("left");
}catch(a){setTimeout(arguments.callee,0);
return;
}aQ();
})();
}}if(ai.wk){(function(){if(al){return;
}if(!/loaded|complete/.test(aM.readyState)){setTimeout(arguments.callee,0);
return;
}aQ();
})();
}aD(aQ);
}}();
function aQ(){if(al){return;
}try{var b=aM.getElementsByTagName("body")[0].appendChild(at("span"));
b.parentNode.removeChild(b);
}catch(a){return;
}al=true;
var d=aa.length;
for(var c=0;
c<d;
c++){aa[c]();
}}function ak(a){if(al){a();
}else{aa[aa.length]=a;
}}function aD(a){if(typeof ag.addEventListener!=ar){ag.addEventListener("load",a,false);
}else{if(typeof aM.addEventListener!=ar){aM.addEventListener("load",a,false);
}else{if(typeof ag.attachEvent!=ar){aN(ag,"onload",a);
}else{if(typeof ag.onload=="function"){var b=ag.onload;
ag.onload=function(){b();
a();
};
}else{ag.onload=a;
}}}}}function aO(){if(ab){Z();
}else{an();
}}function Z(){var d=aM.getElementsByTagName("body")[0];
var b=at(aE);
b.setAttribute("type",aF);
var a=d.appendChild(b);
if(a){var c=0;
(function(){if(typeof a.GetVariable!=ar){var e=a.GetVariable("$version");
if(e){e=e.split(" ")[1].split(",");
ai.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)];
}}else{if(c<10){c++;
setTimeout(arguments.callee,10);
return;
}}d.removeChild(b);
a=null;
an();
})();
}else{an();
}}function an(){var g=aH.length;
if(g>0){for(var h=0;
h<g;
h++){var c=aH[h].id;
var l=aH[h].callbackFn;
var a={success:false,id:c};
if(ai.pv[0]>0){var i=aT(c);
if(i){if(ap(aH[h].swfVersion)&&!(ai.wk&&ai.wk<312)){az(c,true);
if(l){a.success=true;
a.ref=aw(c);
l(a);
}}else{if(aH[h].expressInstall&&av()){var e={};
e.data=aH[h].expressInstall;
e.width=i.getAttribute("width")||"0";
e.height=i.getAttribute("height")||"0";
if(i.getAttribute("class")){e.styleclass=i.getAttribute("class");
}if(i.getAttribute("align")){e.align=i.getAttribute("align");
}var f={};
var d=i.getElementsByTagName("param");
var k=d.length;
for(var j=0;
j<k;
j++){if(d[j].getAttribute("name").toLowerCase()!="movie"){f[d[j].getAttribute("name")]=d[j].getAttribute("value");
}}af(e,f,c,l);
}else{aG(i);
if(l){l(a);
}}}}}else{az(c,true);
if(l){var b=aw(c);
if(b&&typeof b.SetVariable!=ar){a.success=true;
a.ref=b;
}l(a);
}}}}}function aw(b){var d=null;
var c=aT(b);
if(c&&c.nodeName=="OBJECT"){if(typeof c.SetVariable!=ar){d=c;
}else{var a=c.getElementsByTagName(aE)[0];
if(a){d=a;
}}}return d;
}function av(){return !aV&&ap("6.0.65")&&(ai.win||ai.mac)&&!(ai.wk&&ai.wk<312);
}function af(f,d,h,e){aV=true;
aq=e||null;
au={success:false,id:h};
var a=aT(h);
if(a){if(a.nodeName=="OBJECT"){aK=aP(a);
ae=null;
}else{aK=a;
ae=h;
}f.id=ad;
if(typeof f.width==ar||(!/%$/.test(f.width)&&parseInt(f.width,10)<310)){f.width="310";
}if(typeof f.height==ar||(!/%$/.test(f.height)&&parseInt(f.height,10)<137)){f.height="137";
}aM.title=aM.title.slice(0,47)+" - Flash Player Installation";
var b=ai.ie&&ai.win?"ActiveX":"PlugIn",c="MMredirectURL="+ag.location.toString().replace(/&/g,"%26")+"&MMplayerType="+b+"&MMdoctitle="+aM.title;
if(typeof d.flashvars!=ar){d.flashvars+="&"+c;
}else{d.flashvars=c;
}if(ai.ie&&ai.win&&a.readyState!=4){var g=at("div");
h+="SWFObjectNew";
g.setAttribute("id",h);
a.parentNode.insertBefore(g,a);
a.style.display="none";
(function(){if(a.readyState==4){a.parentNode.removeChild(a);
}else{setTimeout(arguments.callee,10);
}})();
}aB(f,d,h);
}}function aG(a){if(ai.ie&&ai.win&&a.readyState!=4){var b=at("div");
a.parentNode.insertBefore(b,a);
b.parentNode.replaceChild(aP(a),b);
a.style.display="none";
(function(){if(a.readyState==4){a.parentNode.removeChild(a);
}else{setTimeout(arguments.callee,10);
}})();
}else{a.parentNode.replaceChild(aP(a),a);
}}function aP(b){var d=at("div");
if(ai.win&&ai.ie){d.innerHTML=b.innerHTML;
}else{var e=b.getElementsByTagName(aE)[0];
if(e){var a=e.childNodes;
if(a){var f=a.length;
for(var c=0;
c<f;
c++){if(!(a[c].nodeType==1&&a[c].nodeName=="PARAM")&&!(a[c].nodeType==8)){d.appendChild(a[c].cloneNode(true));
}}}}}return d;
}function aB(e,g,c){var d,a=aT(c);
if(ai.wk&&ai.wk<312){return d;
}if(a){if(typeof e.id==ar){e.id=c;
}if(ai.ie&&ai.win){var f="";
for(var i in e){if(e[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){g.movie=e[i];
}else{if(i.toLowerCase()=="styleclass"){f+=' class="'+e[i]+'"';
}else{if(i.toLowerCase()!="classid"){f+=" "+i+'="'+e[i]+'"';
}}}}}var h="";
for(var j in g){if(g[j]!=Object.prototype[j]){h+='<param name="'+j+'" value="'+g[j]+'" />';
}}a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>";
ah[ah.length]=e.id;
d=aT(e.id);
}else{var b=at(aE);
b.setAttribute("type",aF);
for(var k in e){if(e[k]!=Object.prototype[k]){if(k.toLowerCase()=="styleclass"){b.setAttribute("class",e[k]);
}else{if(k.toLowerCase()!="classid"){b.setAttribute(k,e[k]);
}}}}for(var l in g){if(g[l]!=Object.prototype[l]&&l.toLowerCase()!="movie"){aR(b,l,g[l]);
}}a.parentNode.replaceChild(b,a);
d=b;
}}return d;
}function aR(b,d,c){var a=at("param");
a.setAttribute("name",d);
a.setAttribute("value",c);
b.appendChild(a);
}function ax(a){var b=aT(a);
if(b&&b.nodeName=="OBJECT"){if(ai.ie&&ai.win){b.style.display="none";
(function(){if(b.readyState==4){aU(a);
}else{setTimeout(arguments.callee,10);
}})();
}else{b.parentNode.removeChild(b);
}}}function aU(a){var b=aT(a);
if(b){for(var c in b){if(typeof b[c]=="function"){b[c]=null;
}}b.parentNode.removeChild(b);
}}function aT(a){var c=null;
try{c=aM.getElementById(a);
}catch(b){}return c;
}function at(a){return aM.createElement(a);
}function aN(a,c,b){a.attachEvent(c,b);
am[am.length]=[a,c,b];
}function ap(a){var b=ai.pv,c=a.split(".");
c[0]=parseInt(c[0],10);
c[1]=parseInt(c[1],10)||0;
c[2]=parseInt(c[2],10)||0;
return(b[0]>c[0]||(b[0]==c[0]&&b[1]>c[1])||(b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]))?true:false;
}function aA(b,f,a,c){if(ai.ie&&ai.mac){return;
}var e=aM.getElementsByTagName("head")[0];
if(!e){return;
}var g=(a&&typeof a=="string")?a:"screen";
if(c){aI=null;
ao=null;
}if(!aI||ao!=g){var d=at("style");
d.setAttribute("type","text/css");
d.setAttribute("media",g);
aI=e.appendChild(d);
if(ai.ie&&ai.win&&typeof aM.styleSheets!=ar&&aM.styleSheets.length>0){aI=aM.styleSheets[aM.styleSheets.length-1];
}ao=g;
}if(ai.ie&&ai.win){if(aI&&typeof aI.addRule==aE){aI.addRule(b,f);
}}else{if(aI&&typeof aM.createTextNode!=ar){aI.appendChild(aM.createTextNode(b+" {"+f+"}"));
}}}function az(a,c){if(!aJ){return;
}var b=c?"visible":"hidden";
if(al&&aT(a)){aT(a).style.visibility=b;
}else{aA("#"+a,"visibility:"+b);
}}function aj(b){var a=/[\\\"<>\.;]/;
var c=a.exec(b)!=null;
return c&&typeof encodeURIComponent!=ar?encodeURIComponent(b):b;
}var aS=function(){if(ai.ie&&ai.win){window.attachEvent("onunload",function(){var a=am.length;
for(var b=0;
b<a;
b++){am[b][0].detachEvent(am[b][1],am[b][2]);
}var d=ah.length;
for(var c=0;
c<d;
c++){ax(ah[c]);
}for(var e in ai){ai[e]=null;
}ai=null;
for(var f in swfobject){swfobject[f]=null;
}swfobject=null;
});
}}();
return{registerObject:function(a,e,c,b){if(ai.w3&&a&&e){var d={};
d.id=a;
d.swfVersion=e;
d.expressInstall=c;
d.callbackFn=b;
aH[aH.length]=d;
az(a,false);
}else{if(b){b({success:false,id:a});
}}},getObjectById:function(a){if(ai.w3){return aw(a);
}},embedSWF:function(k,e,h,f,c,a,b,i,g,j){var d={success:false,id:e};
if(ai.w3&&!(ai.wk&&ai.wk<312)&&k&&e&&h&&f&&c){az(e,false);
ak(function(){h+="";
f+="";
var q={};
if(g&&typeof g===aE){for(var o in g){q[o]=g[o];
}}q.data=k;
q.width=h;
q.height=f;
var n={};
if(i&&typeof i===aE){for(var p in i){n[p]=i[p];
}}if(b&&typeof b===aE){for(var l in b){if(typeof n.flashvars!=ar){n.flashvars+="&"+l+"="+b[l];
}else{n.flashvars=l+"="+b[l];
}}}if(ap(c)){var m=aB(q,n,e);
if(q.id==e){az(e,true);
}d.success=true;
d.ref=m;
}else{if(a&&av()){q.data=a;
af(q,n,e,j);
return;
}else{az(e,true);
}}if(j){j(d);
}});
}else{if(j){j(d);
}}},switchOffAutoHideShow:function(){aJ=false;
},ua:ai,getFlashPlayerVersion:function(){return{major:ai.pv[0],minor:ai.pv[1],release:ai.pv[2]};
},hasFlashPlayerVersion:ap,createSWF:function(a,b,c){if(ai.w3){return aB(a,b,c);
}else{return undefined;
}},showExpressInstall:function(b,a,d,c){if(ai.w3&&av()){af(b,a,d,c);
}},removeSWF:function(a){if(ai.w3){ax(a);
}},createCSS:function(b,a,c,d){if(ai.w3){aA(b,a,c,d);
}},addDomLoadEvent:ak,addLoadEvent:aD,getQueryParamValue:function(b){var a=aM.location.search||aM.location.hash;
if(a){if(/\?/.test(a)){a=a.split("?")[1];
}if(b==null){return aj(a);
}var c=a.split("&");
for(var d=0;
d<c.length;
d++){if(c[d].substring(0,c[d].indexOf("="))==b){return aj(c[d].substring((c[d].indexOf("=")+1)));
}}}return"";
},expressInstallCallback:function(){if(aV){var a=aT(ad);
if(a&&aK){a.parentNode.replaceChild(aK,a);
if(ae){az(ae,true);
if(ai.ie&&ai.win){aK.style.display="block";
}}if(aq){aq(au);
}}aV=false;
}}};
}();
(function(){var a=IMO.Utils;
var d=a.sprintf;
var c=IMO.Utils.HTML;
var h=IMO.Constants;
var g=function g(i){if(Y.UA.ie){return window[i];
}else{return document[i];
}};
var b="impref";
var e="mute";
var f="beep";
IMO.DynamicSoundManager={cb:{},inited:false,flash_init_cb:function(){IMO.DynamicSoundManager.inited=true;
Y.log("Dynamic Sound Manager initialized");
},flash_sc_cb:function(l){if(this.cb.hasOwnProperty(l)){var k=this.cb[l];
var j=k.context;
var i=k.cb;
delete this.cb[l];
if(i){i.apply(j);
}}},play:function(j,k,i){if(!IMO.DynamicSoundManager.inited){Y.log("Sound Manager is not initialized. Cannot play mp3");
return"";
}var l=IMO.DynamicSoundManager.ref;
var m=l.playSound(j);
this.cb[m]={context:k,cb:i};
return m;
},pause:function(j){var i=IMO.DynamicSoundManager.ref;
i.pause(j);
},resume:function(j){var i=IMO.DynamicSoundManager.ref;
i.resume(j);
},stop:function(j){var i=IMO.DynamicSoundManager.ref;
i.stopSound(j);
},position:function(j){var i=IMO.DynamicSoundManager.ref;
return i.getPosition(j);
},length:function(j){var i=IMO.DynamicSoundManager.ref;
return i.getLength(j);
}};
IMO.MP3Player=function(i){this.id=IMO.DynamicSoundManager.play(i,this,this.on_stream_end);
if(this.id===""){throw Error("Cannot play "+i);
}this.ev=new IMO.Event();
this.total_length=IMO.DynamicSoundManager.length(this.id);
this.advertised_offset=0;
this.known_length=0;
this.start_timer();
};
Y.mix(IMO.MP3Player.prototype,IMO.EventTarget);
Y.mix(IMO.MP3Player.prototype,{start_timer:function(){if(!this.timer){this.timer=Y.later(500,this,function(){var i=this.position();
var j=Math.floor(i/1000);
if(j!==this.advertised_offset){this.advertised_offset=j;
this.ev.fire("on_mp3_player_position_change",this,i);
this.length();
}},null,true);
}},stop_timer:function(){if(this.timer){this.timer.cancel;
delete this.timer;
}},stop:function(){IMO.DynamicSoundManager.stop(this.id);
this.stop_timer();
},pause:function(){IMO.DynamicSoundManager.pause(this.id);
this.stop_timer();
},resume:function(){IMO.DynamicSoundManager.resume(this.id);
this.start_timer();
},position:function(){return IMO.DynamicSoundManager.position(this.id);
},length:function(){if(this.known_length){return this.known_length;
}this.known_length=IMO.DynamicSoundManager.length(this.id);
if(this.known_length){this.ev.fire("on_mp3_player_length_known",this,this.known_length);
}return this.known_length;
},on_stream_end:function(){this.ev.fire("on_mp3_player_stream_end",this);
this.stop();
}});
IMO.Sound=function(){this.sound_objects={};
this.html5_audio_objects={};
this.on(IMO.Session.get());
this.mute=IMO.Session.get().get_pref(b,e,false);
this.sounds_holder=c.cdiv("sounds",{id:"flashholder"});
this.html5_audio_holder=c.cdiv("sounds",{id:"html5holder"});
document.body.appendChild(this.sounds_holder);
document.body.appendChild(this.html5_audio_holder);
this.init();
};
Y.mix(IMO.Sound.prototype,IMO.EventTarget);
Y.mix(IMO.Sound.prototype,{init:function(){this.env={};
try{var k=document.createElement("audio");
var j=!!(k.canPlayType('audio/mpeg; codecs="mp3"').replace(/no/,""));
var i=!!(k.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""));
var l=!!(k.canPlayType('audio/wav; codecs="1"').replace(/no/,""));
this._has_html5_audio=j||i||l;
}catch(m){this._has_html5_audio=false;
}if(this._has_html5_audio){this._create_html5_audio();
}else{this._create_sound_objects();
}},play_flash:function(i){var k=this.sound_objects[i];
Y.log("play sound:"+i);
if(k&&k.playSound&&!this.mute){try{k.playSound();
}catch(j){Y.log("Error playing flash sound "+i,"error");
}}},play:function(i,l){if(!this._has_html5_audio){this.play_flash(i);
return;
}var j=this.html5_audio_objects[i];
Y.log("play html5 audio:"+i);
if(j&&(l||!this.mute)){try{j.currentTime=0;
j.play();
}catch(k){Y.log("Error playing html5 audio "+i,"error");
}}},stop_flash:function(i){var k=this.sound_objects[i];
Y.log("stop sound:"+i);
if(k&&k.stopSound){try{k.stopSound();
}catch(j){Y.log("Error stoping flash sound "+i,"error");
}}},stop:function(i){if(!this._has_html5_audio){this.stop_flash(i);
return;
}var j=this.html5_audio_objects[i];
Y.log("stop html5 audio:"+i);
if(j){try{j.pause();
}catch(k){Y.log("Error stoping html5 audio "+i,"error");
}}},ring_flash:function(i){this.play_flash(i);
var j=this.sound_objects[i];
return{cancel:function(){if(j){try{j.stopSound();
}catch(k){}}}};
},ring:function(i){if(!this._has_html5_audio){return this.ring_flash(i);
}this.play(i);
var j=this.html5_audio_objects[i];
return{cancel:function(){if(j){try{j.pause();
j.currentTime=0;
}catch(k){Y.log("Error playing html5 audio "+i,"error");
}}}};
},set_mute:function(i){this.mute=a.dfl(i,IMO.PreferenceDefaults.mute);
if(i){a.foreach(this.html5_audio_objects,function(j,k){this.stop(k);
},this);
a.foreach(this.sound_objects,function(k){if(k&&k.stopSound){try{k.stopSound();
}catch(j){}}});
}},set_beep:function(i){var j=IMO.Session.get().get_imo_account();
if(!j||!j.premium){this.requested_sound=i;
i="imo0";
}this.html5_audio_objects.beep=this.html5_audio_objects[i];
},on_recv_pref:function(j,i,k){if(j===b&&i===e){this.set_mute(k);
}if(j===b&&i===f){this.set_beep(k);
}},on_set_prefs:function(i){a.foreach(i,function(k,j){this.on_recv_pref(k.kind,k.pref,k.value);
},this);
},on_create_account:function(i){if(i.account_type==="im"&&i.proto==="imo"){this.on(i);
this.on_premium(i.premium);
}},on_premium:function(i){if(i&&this.requested_sound){this.set_beep(this.requested_sound);
this.requested_sound=null;
}},_add_sound_obj:function(i,j,m){var l="sound_"+i;
var o=c.cdiv("sound",{id:l});
this.sounds_holder.appendChild(o);
var k=this;
try{swfobject.embedSWF(j,l,"1","1","8.0.0",null,{loop:m,play:false},{allowscriptaccess:"always",quality:"high",movie:j},{},function(p){if(p.success){k.sound_objects[i]=p.ref;
}});
}catch(n){Y.log(n);
}},_add_html5_audio:function(i,o,j,l){var n=[".mp3",".ogg",".wav"];
var q={".mp3":'audio/mpeg; codecs="mp3"',".ogg":'audio/ogg; codecs="vorbis"',".wav":'audio/wav; codecs="1"'};
var p;
if(l){p="auto";
}else{p="metadata";
}var m={id:"html5_sound_"+i,preload:p};
if(j){m.loop=true;
}var k=c.audio(m);
a.foreach(n,function(r){var s=c.source({src:o+r,type:q[r]});
k.appendChild(s);
});
this.html5_audio_holder.appendChild(k);
this.html5_audio_objects[i]=k;
},_create_sound_objects:function(){this._add_sound_obj("beep","sounds/beep.swf",false);
this._add_sound_obj("callin","sounds/callin.swf",true);
this._add_sound_obj("callout","sounds/callout.swf",true);
var i="SoundManager";
var j=c.cdiv("sound",{id:i},"this should be gone");
this.sounds_holder.appendChild(j);
swfobject.embedSWF(IMO.SWF("SoundManager"),i,"1","1","8.0.0",null,{init_cb:"IMO.DynamicSoundManager.flash_init_cb",sound_complete_cb:"IMO.DynamicSoundManager.flash_sc_cb"},{allowscriptaccess:"always",allowNetworking:"all",imo_create_callbacks:false},{},function(k){IMO.DynamicSoundManager.ref=k.ref;
});
},_create_html5_audio:function(){a.foreach(h.SOUND_NAME,function(i,j){this._add_html5_audio(j,"sounds/im/"+j,false,false);
},this);
this.html5_audio_objects.beep=this.html5_audio_objects.imo0;
this._add_html5_audio("callin","sounds/callin",true,false);
this._add_html5_audio("callout","sounds/callout",true,false);
}});
IMO.make_singleton(IMO.Sound);
}());
(function(){var f=0;
var b=IMO.Utils;
var h=IMO.Constants;
var a={};
var d=[];
var g=0;
var c={};
var e=null;
IMO.Stats={basetime:(IMO.Splash?IMO.Splash.basetime:null),signed_on:false,send:function(i){this.process_profiler();
var j=d.slice(0);
b.foreach(a,function(l,k){j.push({namespace:"reui."+k,data:l,start_time:((new Date()).getTime()/1000),end_time:((new Date()).getTime()/1000)});
delete a[k];
});
d=[];
g=0;
if(e){e.cancel();
}e=null;
if(j.length===0){return;
}IMO.Network.get().send("monitor","log_event",{uid:null,proto:null,events:j},i);
},send_later:function(){if(!e){e=Y.later(5*1000,this,function(){e=null;
this.send(false);
});
}},init:function(){IMO.Stats.inittime=new Date();
this.new_user=false;
this.cookie=b.get_cookie(h.STATS_COOKIE);
if(!this.cookie){this.new_user=true;
this.cookie=(new Date()).getTime()+":"+b.random_string();
b.set_cookie(h.STATS_COOKIE,this.cookie,3650);
}IMO.Stats.log_event("page_load",{load_time:(IMO.Stats.basetime?(IMO.Stats.inittime-IMO.Stats.basetime):undefined),page_loads:1,referrer:document.referrer,winlocation:window.location.href,doclocation:document.location.href,version:IMO.Constants.JS_VERSION,ssid:IMO.Network.get().ssid,size:[window.innerWidth,window.innerHeight],new_user:this.new_user,stats_cookie:this.cookie,ua:window.navigator.userAgent});
var i=window.location.hash;
if(/^#c-/i.test(i)){IMO.CAMP=i.substr(3);
b.log("Campaign is: "+IMO.CAMP);
IMO.Stats.log_event("campaign_land",{campaign:IMO.CAMP});
window.location.hash="#";
}},log_event:function(k,m,l,j,i){if(!l){l=((new Date()).getTime()/1000);
}if(!j){j=l;
}d.push({namespace:"reui."+k,data:m,start_time:l,end_time:j});
if(i!==false){IMO.Stats.send(i);
}else{IMO.Stats.send_later();
}},report_signed_on:function(){if(!this.signed_on){if(IMO.CAMP){Y.log("Campaign Conversion: "+IMO.CAMP);
this.log_event("campaign_conversion",{campaign:IMO.CAMP});
}this.report_user_flow("page_login_ok");
}this.signed_on=true;
},report_user_flow:function(i,j){if(this.signed_on||IMO.Network.get().cookie_login){return;
}var k={stats_cookie:this.cookie,new_user:this.new_user};
if(j){Y.mix(k,j,true);
}this.log_event(i,k,null,null,true);
},increment_counter:function(i,j){if(!a[i]){a[i]=0;
}a[i]+=j?j:1;
IMO.Stats.send(false);
},instrument:function(i,j){return j;
},process_profiler:function(){b.foreach(c,function(k){k.ncalls=k.calls.length;
k.total=0;
for(var j=0;
j<k.ncalls;
j++){k.total+=k.calls[j];
}k.mean=k.total/k.ncalls;
IMO.Stats.log_event(k.name,k,undefined,undefined,false);
},this);
c={};
}};
IMO.Stats.Profile=function(i){this.name=i;
this.start_time=new Date();
};
Y.mix(IMO.Stats.Profile.prototype,{finish:function(){var i=new Date();
var j=i-this.start_time;
if(!c.hasOwnProperty(name)){c[this.name]={name:this.name,calls:[]};
}c[this.name].calls.push(j);
IMO.Stats.send_later();
}});
}());
(function(){var a={ivc:"d57124fd43d0ae2f15893312a05ef6777f34eb8d",schat:"68b6ee7123370222024365bae593fcae9f3d6c4c",expressInstall:"1c12004633e89d6de3bbe4a190093a537bdecebe",vim:"3b1c6afc4f04cb74b88d219e4f8fd2973bf7ce84",clipboard:"4548cca9379b9a588e778df823879a04d1b0673b",voicecall:"666f07421abe07cf1c59ce0ccc038512147feeff",webcampic:"d3d6f73c0a0274f4e8caae89d23318d88a967751",nchat:"700b87ade62c28906f6a37ba71b1556e11eb30db",preview:"400aeffd135ab47e1296556566e56b720ca1f9a3",SoundManager:"a4dc473929b938534c570b72061c155317e2f3b9",this_is_a_santinel:""};
IMO.SWF=function(b){return"images/"+b+".swf?"+a[b];
};
}());
(function(){var d=IMO.Constants;
var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b="/upload/";
IMO.UploadManager=function(){};
Y.mix(IMO.UploadManager.prototype,{clear_fields:function(e){a.foreach(e.childNodes,function(f){if(f.type==="hidden"){if(f.name==="imo_service"||f.name==="imo_func_name"||f.name==="imo_param"){e.removeChild(f);
}}},this);
},add_param:function(e,f){return c.input({type:"hidden",name:e,value:f});
},add_fields:function(i,e,f,j){var h=null;
a.foreach(i.childNodes,function(k){if(k.type==="file"){h=k.value;
}},this);
var g=j;
if(h){g.filename=h;
}i.appendChild(this.add_param("imo_service",e));
i.appendChild(this.add_param("imo_func_name",f));
i.appendChild(this.add_param("imo_param",Y.JSON.stringify(j)));
i.appendChild(this.add_param("imo_ssid",IMO.Network.get().ssid));
},upload:function(f,h,l,k,i,e){this.clear_fields(k);
this.add_fields(k,f,h,l);
var g={method:"POST",form:{id:k,upload:true},on:{complete:function(q,p,n){var m=JSON.parse(p.responseText);
e.call(i,m);
}}};
var j=Y.io(b,g);
}});
IMO.make_singleton(IMO.UploadManager);
}());
(function(){var b=IMO.Utils;
var c=IMO.Constants;
var d={wowza_app:"Unrecoverable error in the Voice IM server. Service is unavailable.",flash:"You need to install Flash to use Voice IM.",no_mic:"You need a microphone to send Voice IMs."};
var a=IMO.VIM={UNINITIALIZED:0,INITIAZING:1,INITIATING2:2,ACCESS_MIC:256,READY:4,PREPARING:8,PREPARED:16,DISCONNECTED:32|4,RECORDING:64,ERROR:128,FORCED_UNPREPARE:512,get_state_str:function(e){switch(this.state){case a.UNINITIALIZED:case a.INITIATING:case a.INITIATING2:return"Loading..";
case a.READY:return"Ready";
case a.FORCED_UNPREPARE:return"Voice call";
case a.ACCESS_MIC:return"Detecting..";
case a.PREPARING:return"Connecting..";
case a.PREPARED:return"Hold to talk";
case a.DISCONNECTED:return"Reconnect";
case a.RECORDING:return(IMO.VIM.recorder===e)?"Recording":"Busy";
case a.ERROR:default:return"Error";
}},prepare_count:0,state:0,forced_unprepare_count:0,init:function(){if(this.state!==a.UNINITIALIZED){return;
}IMO.EventDispatcher.get().subscribe(IMO.VIM,"av","vim");
this.ev=new IMO.Event();
this.flash=new IMO.FlashWidget(IMO.SWF("vim"),{log:"Y.log",init_cb:"IMO.VIM.flash_init_cb",msg_cb:"IMO.VIM.flash_msg_cb",debug:"net"},null,null,"10.0.0");
this.on(this.flash);
this.set_state(a.INITIATING);
this.flash.init();
},on_embed:function(f){Y.log("VIM is embedded");
this.set_state(a.INITIATING2);
},on_embed_fail:function(f){this.error_msg=d.flash;
this.set_state(a.ERROR);
this.ev.fire("on_vim_flash_error",f);
this.ev.fire("on_vim_error");
},flash_init_cb:function(){Y.log("VIM AS is loaded");
IMO.VIM.state=a.ACCESS_MIC;
if(this.prepare_count){this.flash.call("access_mic");
}},flash_msg_cb:function(e){Y.log("VIM flash msg: "+e);
switch(e){case"panel_closed":case"need_permission":break;
case"no_mic":IMO.VIM.error_msg=d.no_mic;
IMO.VIM.set_state(a.ERROR);
IMO.VIM.stop_mic_poll_timer();
break;
case"denied_permission":IMO.VIM.set_state(a.ACCESS_MIC);
break;
case"have_permission":IMO.VIM.set_state(a.READY);
if(IMO.VIM.forced_unprepare_count){IMO.VIM.set_state(a.FORCED_UNPREPARE);
}else{if(IMO.VIM.prepare_count){IMO.VIM.do_prepare();
}}break;
case"prepared":IMO.VIM.set_state(a.PREPARED);
IMO.VIM.start_mic_poll_timer();
break;
case"connect_failed":case"disconnected":IMO.VIM.set_state(a.DISCONNECTED);
IMO.VIM.stop_mic_poll_timer();
break;
case"error":IMO.VIM.error_msg=d.wowza_app;
IMO.VIM.set_state(a.ERROR);
IMO.VIM.stop_mic_poll_timer();
break;
default:break;
}IMO.VIM.ev.fire("on_vim_msg_"+e);
if(IMO.VIM.state===a.ERROR){IMO.VIM.ev.fire("on_vim_error");
}},set_state:function(e){IMO.VIM.state=e;
IMO.VIM.ev.fire("on_vim_state_change",IMO.VIM,e);
},prepare:function(){this.prepare_count++;
b.log("prepare_count++: %d",this.prepare_count);
if(this.forced_unprepare_count){if((this.state&a.READY)){this.set_state(a.FORCED_UNPREPARE);
}return true;
}if(this.state===a.PREPARED||this.state===a.PREPARING){return true;
}if(this.state===a.ACCESS_MIC){this.flash.call("access_mic");
return true;
}if(!(this.state&a.READY)){Y.log("VIM is not ready to prepare, state: "+this.state);
return false;
}IMO.VIM.do_prepare();
return true;
},do_prepare:function(){Y.log("VIM is preparing");
IMO.VIM.set_state(a.PREPARING);
IMO.Network.get().send("av","get_wowza_ip_for_vim",{});
},do_unprepare:function(){Y.log("VIM is unpreparing");
this.flash.call("unprepare");
this.stop_mic_poll_timer();
},vim_server_ip:function(e){if(e.error){IMO.VIM.set_state(a.DISCONNECTED);
IMO.VIM.ev.fire("on_vim_no_wowza_server",IMO.IM);
return;
}IMO.VIM.flash.call("prepare",e.ip);
},unprepare:function(){this.prepare_count--;
b.log("prepare_count--: %d",this.prepare_count);
if(this.forced_unprepare_count!==0){if(this.prepare_count===0){this.set_state(a.READY);
}return true;
}if(this.state!==a.PREPARED){return false;
}if(this.prepare_count){return false;
}this.do_unprepare();
this.set_state(a.READY);
return true;
},is_prepared:function(){return this.state===a.PREPARED;
},is_recording:function(){return this.state===a.RECORDING;
},begin_forced_unprepare:function(){this.forced_unprepare_count++;
if(this.forced_unprepare_count===1){if(this.prepare_count){this.do_unprepare();
this.set_state(a.FORCED_UNPREPARE);
}}},end_forced_unprepare:function(){this.forced_unprepare_count--;
if(this.forced_unprepare_count===0){if(this.prepare_count){this.do_prepare();
}else{this.set_state(a.READY);
}}},start:function(e,f){Y.log("VIM is starting");
if(this.is_prepared()){IMO.VIM.recorder=e;
IMO.VIM.set_state(a.RECORDING);
return IMO.VIM.flash.call("start_stream",f);
}return undefined;
},stop:function(e){Y.log("VIM is stopping "+this.state);
if(this.flash.ref){if(IMO.VIM.state===a.RECORDING){delete IMO.VIM.recorder;
IMO.VIM.set_state(a.PREPARED);
}return IMO.VIM.flash.call("stop_stream");
}return undefined;
},start_mic_poll_timer:function(){IMO.VIM.stop_mic_poll_timer();
IMO.VIM.mic_timer=Y.later(100,IMO.VIM,function(){var e=this.flash.call("active_mic_level");
this.ev.fire("on_vim_mic_level",this,e);
},null,true);
},stop_mic_poll_timer:function(){if(IMO.VIM.mic_timer){IMO.VIM.mic_timer.cancel();
IMO.VIM.mic_timer=null;
}},on_panel_closed:function(){IMO.VIM.flash.call("on_panel_closed");
}};
Y.mix(IMO.VIM,IMO.EventTarget);
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var d=a.TranslateTxt;
if(!IMO.WM){IMO.WM={};
}IMO.WM.BaseWindowManager=function(f){this.ev=new IMO.Event();
this.windows=[];
this.active_wm=null;
this.dom=f;
var e={bindings:{tab:{cb:this.handle_tab},"S-tab":{cb:this.handle_tab},esc:{cb:this.handle_esc},"C-l":{cb:this.handle_clear}},context:this,weight:IMO.KeyboardManager.exec_weight.window_manager_common};
this.sc_uid=IMO.KeyboardManager.get().push(e);
this.on(IMO.BrowserFocus);
this.on(IMO.Session.get());
Y.later(0,this,function(){this.on_recv_pref("impref","windowmanager",IMO.Session.get().get_pref("impref","windowmanager","TWM"));
});
IMO.MouseManager.get().register(this.handle_window_click,this);
};
Y.mix(IMO.WM.BaseWindowManager.prototype,IMO.EventTarget);
var b=a.parse_query().hasOwnProperty("thinui");
Y.mix(IMO.WM.BaseWindowManager.prototype,{handle_window_click:function(h,f){var g=!IMO.MouseManager.get().check_handled("window*","twm*","bwm*","messagepreview*","buddyhover*","buddy");
a.log("handle_window_click unfocus=%r",g);
if(g&&!b){this.active_wm.window_focus(null);
}this.window_refocus();
},handle_resize:function(){if(this.active_wm&&this.active_wm.handle_resize_fast){this.active_wm.handle_resize_fast();
}},on_recv_pref:function(f,e,h){if(f==="impref"&&e==="windowmanager"&&!a.parse_query().hasOwnProperty("thinui")){var g=h==="TWM"?IMO.WM.TWM:IMO.WM.FWM;
this.set_wm(g);
}},handle_tab:function(g,f){if(f==="tab"){this.active_wm.focus_next();
}else{if(f==="S-tab"){this.active_wm.focus_prev();
}else{throw"WTF "+f;
}}g.halt();
},handle_esc:function(g,f){if(this.active_wm.focused_window){this.active_wm.focused_window.fire("on_close_request");
}},handle_clear:function(g,f){if(this.active_wm.focused_window){g.halt();
this.active_wm.focused_window.fire("on_clear");
}},switch_wm_click:function(){var f=this.active_wm===IMO.WM.TWM?IMO.WM.FWM:IMO.WM.TWM;
this.set_wm(f);
var e=this.active_wm===IMO.WM.TWM?"TWM":"FWM";
IMO.Session.get().set_prefs([{kind:"impref",pref:"windowmanager",value:e}]);
},set_wm:function(e){this.ev.fire("on_before_wm_switch",e);
if(this.active_wm){this.active_wm.release();
}this.active_wm=e;
this.active_wm.aquire(this.dom,this.windows);
a.foreach(this.windows,function(f){f.ev.fire("on_switch_wm",f,e);
});
this.ev.fire("on_after_wm_switch",e);
if(e===IMO.WM.FWM){c.add_class(this.flo_btn,"selected");
c.remove_class(this.tab_btn,"selected");
}else{c.add_class(this.tab_btn,"selected");
c.remove_class(this.flo_btn,"selected");
}},window_new:function(e){this.windows.push(e);
},window_destroy:function(e){if(e.wm!==null){Y.log("Destroying window with WM","warn");
}return IMO.Utils.remove(this.windows,e);
},window_open:function(e){this.window_new(e);
this.check_valid_win(e);
this.check_valid_active_wm();
this.active_wm.window_open(e);
},window_close:function(e){this.check_valid_win(e);
this.check_valid_active_wm();
this.active_wm.window_close(e);
this.window_destroy(e);
},window_set_title:function(e,f){e.ui.titlebar.set_title(f);
},window_set_icon:function(f,e){f.ui.titlebar.set_icon(e);
},check_valid_win:function(e){if(Y.Array.indexOf(this.windows,e)===-1){throw"Window not handeled";
}},check_valid_active_wm:function(){if(this.active_wm===null){throw"No active_wm";
}},on_browser_focus:function(e){if(e===IMO.BrowserFocus.BLUR){this.active_wm.window_focus(null);
}else{if(Y.UA.ie&&this.active_wm.focused_window){return;
}this.active_wm.window_focus(this.active_wm.last_focused);
}},window_refocus:function(){Y.log("refocus");
this.active_wm.window_refocus();
},destroy:function(){this.unsubscribe_all();
IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
}});
}());
(function(){var c=IMO.Utils;
IMO.BlockedBuddyStats=function(){this.on(IMO.BuddyList.get());
};
var a=false;
var b=function(){return c.size(IMO.BuddyList.get().buddies)==c.size(IMO.BuddyList.get().OFFLINE_GROUP.buddies)&&c.size(IMO.BuddyList.get().buddies)>20;
};
var d=function(){a=false;
if(b()){Y.log("Buddy counts (Total / Blocked / Offline): "+c.size(IMO.BuddyList.get().buddies)+" / "+c.size(IMO.BuddyList.get().BLOCKED_GROUP.buddies)+" / "+c.size(IMO.BuddyList.get().OFFLINE_GROUP.buddies));
IMO.Stats.log_event("blocked_buddy_counts",{ssid:IMO.Network.get().ssid,buddies:c.size(IMO.BuddyList.get().buddies),blocked:c.size(IMO.BuddyList.get().BLOCKED_GROUP.buddies),offline:c.size(IMO.BuddyList.get().OFFLINE_GROUP.buddies)});
}};
Y.mix(IMO.BlockedBuddyStats.prototype,IMO.EventTarget);
Y.mix(IMO.BlockedBuddyStats.prototype,{on_blist_end:function(){if(a){return;
}if(b()){a=true;
Y.later(10000,this,d);
}}});
}());
(function(){var b=IMO.Utils;
var e=b.HTML;
IMO.BrowserFocus={BLUR:0,FOCUS:1,ev:new IMO.Event()};
IMO.BrowserFocus.current_focus_state=IMO.BrowserFocus.FOCUS;
var d;
IMO.BrowserFocus.init=function(){if(Y.UA.ie){document.onfocusin=function(h){d(h,IMO.BrowserFocus.FOCUS);
};
document.onfocusout=function(h){d(h,IMO.BrowserFocus.BLUR);
};
}else{e.on("blur",d,window,null,IMO.BrowserFocus.BLUR);
e.on("focus",d,window,null,IMO.BrowserFocus.FOCUS);
}};
var a=function(h){b.log("real_browser_focus(%r)",h);
IMO.BrowserFocus.ev.fire("on_browser_focus",h);
};
var f=null;
var g=function(h){if(IMO.BrowserFocus.current_focus_state!==h){IMO.BrowserFocus.current_focus_state=h;
a(h);
}f=null;
};
var c=100;
d=function(i,h){if(Y.UA.ie){if(f){f.cancel();
f=null;
}f=Y.later(c,null,g,h);
}else{g(h);
}};
}());
(function(){var b=IMO.Utils;
var c=b.HTML;
IMO.BrowserResize={RESIZE:0,ev:new IMO.Event()};
var a;
IMO.BrowserResize.init=function(){c.on("resize",a,window,null,IMO.BrowserResize.RESIZE);
};
a=function(f,d){IMO.BrowserResize.ev.fire("on_browser_resize");
};
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=a.sprintf;
var d=IMO.Constants;
IMO.BuddyIconDownloader=function(){this.requests={};
this.downloaded_imgs={};
this.failed_imgs={};
this.pending_ubids={};
this.imgs_to_ubids={};
this.imgs=[];
this.active_conn_cnt=0;
this.max_conn_cnt=Y.UA.ie?1:4;
this.priority_manager=null;
this.ev=new IMO.Event();
this.on(IMO.BuddyList.get());
};
Y.mix(IMO.BuddyIconDownloader.prototype,IMO.EventTarget);
Y.mix(IMO.BuddyIconDownloader.prototype,{on_blist_add:function(e){},on_blist_remove:function(e){delete this.requests[e.ubid];
delete this.pending_ubids[e.ubid];
if(e.get_icon()){a.remove(this.imgs_to_ubids[e.get_icon()],e.ubid);
}},on_buddy_update:function(e){var f=this.requests[e.ubid];
if(f===undefined){return;
}var g=e.get_icon();
if(!g){delete this.requests[e.ubid];
}if(f.img!==g){this.pending_ubids[e.ubid]=true;
f.state=d.BID_STATE_PENDING;
a.remove(this.imgs_to_ubids[f.img],e.ubid);
f.img=g;
if(g){this.imgs_to_ubids[g]=this.imgs_to_ubids[g]||[];
this.imgs_to_ubids[g].push(e.ubid);
}this.try_start();
}},load:function(g){var f=IMO.BuddyList.get().get_message_target(g);
var e;
if(f){e=f.get_icon();
}if(!f||!e){delete this.pending_ubids[g];
delete this.requests[g];
return false;
}if(this.downloaded_imgs.hasOwnProperty(e)){return true;
}if(this.failed_imgs.hasOwnProperty(e)){Y.log("skipping failed icon: "+e);
return false;
}var h=this.requests[g];
if(h===undefined){this.pending_ubids[g]=true;
this.requests[g]={img:e,state:d.BID_STATE_PENDING,retries:0};
this.imgs_to_ubids[e]=this.imgs_to_ubids[e]||[];
this.imgs_to_ubids[e].push(f.ubid);
}else{if(h.img!==e){a.remove(this.imgs_to_ubids[h.img],g);
h.img=e;
h.retries=0;
this.pending_ubids[g]=true;
h.state=d.BID_STATE_PENDING;
this.imgs_to_ubids[e]=this.imgs_to_ubids[e]||[];
this.imgs_to_ubids[e].push(g);
}else{if(h.state===d.BID_STATE_DONE){Y.log("we should NEVER get here","error");
return true;
}Y.log(a.sprintf("bicondownloader load same item ubid:%s state:%s retries:%s",g,h.state,h.retries));
if(Y.Array.indexOf(this.imgs_to_ubids[e],g)<0){this.imgs_to_ubids[e].push(g);
}}}this.try_start();
return false;
},try_start:function(){if(this.active_conn_cnt>=this.max_conn_cnt){return;
}var e=this.priority_manager.get_next();
if(e===null){return;
}var f=this.requests[e];
if(f.retries>6){Y.log(a.sprintf("Failed to fetch:%s",f.img));
this.failed_imgs[f.img]=true;
this.try_start();
return;
}if(this.downloaded_imgs[f.img]){delete this.pending_ubids[e];
f.state=d.BID_STATE_DONE;
this.try_start();
return;
}this.fetch(e);
this.try_start();
},fetch:function(g){var i=this;
var f=IMO.BuddyList.get().get_message_target(g);
var e=new Image();
var h=this.requests[g];
c.on("load",this.img_done_,e,this,g,e,h.img,d.BID_STATE_DONE);
c.on("error",this.img_done_,e,this,g,e,h.img,d.BID_STATE_ERROR);
c.on("abort",this.img_done_,e,this,g,e,h.img,d.BID_STATE_ERROR);
e.src=h.img;
if(h.state!==d.BID_STATE_PENDING&&h.state!==d.BID_STATE_ERROR){Y.log("unexpected state: "+h.state);
throw"unexpected state";
}delete this.pending_ubids[g];
h.state=d.BID_STATE_DOWNLOADING;
++this.active_conn_cnt;
this.imgs.push(e);
},img_done_:function(j,h,f,g,i){Y.later(0,this,this.img_done,[j,h,f,g,i]);
},img_done:function(l,h,f,g,j){--this.active_conn_cnt;
a.remove(this.imgs,f);
Y.later(0,this,this.try_start);
var i=this.requests[h];
if(i===undefined){Y.log(["req is undefined",h,f,g,j]);
return;
}i.state=j;
var k;
if(j===d.BID_STATE_DONE){this.downloaded_imgs[g]=true;
k="on_bicon_ready";
}else{++i.retries;
k="on_bicon_error";
}a.foreach(this.imgs_to_ubids[g],function(e){this.ev.fire(k,e,g);
},this);
}});
IMO.make_singleton(IMO.BuddyIconDownloader);
}());
(function(){var d=IMO.Constants;
var c=0;
var b=1;
var a=2;
IMO.Captcha={ev:new IMO.Event(),state:c,shown:false,element:null,load:function(){if(this.state!==c){return;
}this.state=b;
var e=this;
Y.Get.script(IMO.Constants.RECAPTCHA_JS_URL,{onSuccess:function(){Y.log("Recaptcha js loaded");
e._on_loaded();
},onFailure:function(){Y.log("Recaptcha failed it");
},onTimeout:function(){Y.log("Recaptcha timed out");
}});
},show_captcha:function(e){if(this.state===a){if(this.shown&&this.element===e){this.recaptcha.reload();
this.recaptcha.focus_response_field();
}else{this._create(e);
}}this.shown=true;
this.element=e;
if(this.state===c){this.load();
}},hide_captcha:function(e){if(this.state===a&&this.shown&&this.element===e){this.recaptcha.destroy();
}this.shown=false;
},get_data:function(){if(!this.recaptcha){return null;
}return{challenge:this.recaptcha.get_challenge(),response:this.recaptcha.get_response()};
},_create:function(e){this.recaptcha.create(d.RECAPTCHA_PUBLIC_KEY,e,{theme:"clean",callback:this.recaptcha.focus_response_field});
},_on_loaded:function(){this.recaptcha=Recaptcha;
this.state=a;
if(this.shown){this._create(this.element);
}}};
})();
(function(){var b=IMO.Utils;
var e=b.HTML;
var a;
var f=0;
var g=1;
var c=2;
var d=4;
IMO.FlashWidget=function(h,k,l,j,i){this.version=i||"10.0.0";
this.swf_url=h;
this.params=l;
this.vars=k;
this.imo_params=j;
this._reinit_queue=[];
this.state=f;
this.ref=null;
this.ev=new IMO.Event();
};
IMO.FlashWidget.init_cb={};
Y.mix(IMO.FlashWidget.prototype,{add_callback:function(h,i){this.cb_object()[h]=i;
},cb_object:function(){return IMO.FlashWidget.callbacks["id_"+this.id];
},init:function(h,m,n,k,i){if(this.state!=f){this.destroy();
}this.id="flash_widget_"+b.random_string();
this.version=i||this.version||"10.0.0";
this.swf_url=h||this.swf_url;
this.vars=m||this.vars||{};
this.params=n||this.params||{};
this.imo_params=k||this.imo_params||{};
Y.mix(this.params,{allowscriptaccess:"always"});
Y.mix(this.imo_params,{create_callbacks:true});
var j=this;
if(this.imo_params.create_callbacks){this.vars.imo_callback_prefix="IMO.FlashWidget.callbacks.id_"+this.id+".";
IMO.FlashWidget.callbacks["id_"+this.id]={};
this.cb_object()["init_cb"]=function(){delete j.cb_object()["init_cb"];
j.ev.fire("on_as_init",j.id);
};
}Y.mix(this.vars,{log:"Y.log",id:this.id});
if(this.imo_params.callbacks){b.foreach(this.imo_params.callbacks,function(p,o){this.add_callback(o,p);
},this);
delete this.imo_params.callbacks;
}if(!this.imo_params.dom){this.dom=e.cdiv("flash_widget_container",e.div({id:this.id}));
a.appendChild(this.dom);
}else{this.dom=this.imo_params.dom;
this.dom.appendChild(e.div({id:this.id}));
}try{Y.log([this.swf_url,this.id,this.version]);
swfobject.embedSWF(this.swf_url,this.id,""+this.dom.clientWidth,""+this.dom.clientHeight,this.version,"images/expressInstall.swf",this.vars,this.params,{},function(o){Y.later(0,j,j.handle_embed,o);
});
}catch(l){Y.log(l);
j.handle_embed({fail:"yup"});
}this.state=g;
},handle_embed:function(k){if(k.success){this.state=d;
this.ref=k.ref;
var j=this._reinit_queue;
this._reinit_queue=[];
for(var h=0;
h<j.length;
++h){this.call.apply(this,j[h]);
}this.ev.fire("on_embed",k);
}else{this.state=c;
this.delete_cb();
this.ev.fire("on_embed_fail",k);
}},hide:function(){if(this.state===f){return;
}e.set_off(this.dom,[-5000,-5000]);
e.set_size(this.dom,[1,1]);
if(this.ref){e.set_size(this.ref,[1,1]);
}},show:function(h){if(this.state===f){return;
}var i=e.get_rect(h,e.dom("imo"));
e.set_off(this.dom,[i.x,i.y]);
e.set_size(this.dom,[i.w,i.h]);
if(this.ref){e.set_size(this.ref,[i.w,i.h]);
this.call("setAttribute","width",""+i.w);
this.call("setAttribute","height",""+i.h);
}},destroy:function(){if(this.state===f){return;
}this.state=f;
this.delete_cb();
this.ev.fire("on_destroy",this);
e.remove(this.dom);
this.ref=null;
this.dom=null;
},delete_cb:function(){if(this.id){delete IMO.FlashWidget.callbacks["id_"+this.id];
}},call:function(h){if(this.state===f){this._reinit_queue.push([].slice.call(arguments,0));
return;
}if(this.ref[h]){return this.ref[h].apply(this.ref,[].slice.call(arguments,1));
}else{this._reinit_queue.push([].slice.call(arguments,0));
Y.log("Error: flash widget "+this.swf_url+" crashed!");
this.destroy();
this.init();
}}});
IMO.FlashWidget.init=function(){a=e.div({id:"flash_container"});
document.body.appendChild(a);
IMO.FlashWidget.callbacks={};
};
}());
(function(){var c=IMO.Utils;
var d=c.HTML;
var b=d.idiv("move_net");
var f=[];
var e=false;
var a=null;
IMO.MoveNet={is_attached:function(){return e;
},attach_move_net:function(i,h){if(e){if(a){a.f.call(a.context,null);
}return false;
}Y.log("attaching move net");
d.dom("imo").appendChild(b);
var g=Array.prototype.slice.call(arguments,2);
var j=["EVENT_NAME",i,b,h];
j=j.concat(g);
f.push(d.on.apply(Y,c.splice(j,0,1,"mousemove")),d.on.apply(Y,c.splice(j,0,1,"mouseup")));
Y.log("attaching mouse handlers on window object");
j[2]=window;
f.push(d.on.apply(Y,c.splice(j,0,1,"mousemove")),d.on.apply(Y,c.splice(j,0,1,"mouseup")));
e=true;
a={f:i,context:h};
return true;
},detach_move_net:function(h,g){if(!e){Y.log("move net not attached");
return;
}Y.log("removing move net");
d.remove(b);
IMO.Utils.foreach(f,function(i){i.detach();
});
f=[];
e=false;
a=null;
},mouse_event_filter_creator:function(g){return function(h){if((h.button&g===0)&&h.button>0){return"smartnone";
}if(h.type==="mousemove"&&(h.button&g!==0)){return"smartmove";
}if(h.type==="mouseup"||(h.button===0&&h.type==="mousemove")){return"smartup";
}if(h.type==="mousedown"){return"smartdown";
}throw"WTF";
};
}};
}());
(function(){var j=IMO.Utils.HTML;
var c=IMO.Utils;
var e=IMO.Utils.sprintf;
var i=c.TranslateTxt;
var k=IMO.Utils.cap;
if(!IMO.WM){IMO.WM={};
}if(!IMO.WM.Floating){IMO.WM.Floating={};
}var g=IMO.MoveNet.mouse_event_filter_creator(1);
var f=500;
var d=5;
var a=10003;
var h=10000;
var b={};
b.min=[250,250];
b.max=[100000,100000];
IMO.WM.Floating.TitleBar=function(l){this.win=l;
this.dom=j.div({cls:"titlebar"},this.close_btn=j.sprite("icn_close",{cls:"close",title:i("Close window"),alt:i("Close window")}),j.div({cls:"titleicon"},this.icon=j.sprite(l.icon,{cls:"icon"}),this.title=j.span({cls:"title"})),this.att=j.cdiv("attention-bubble sprite_badge"));
j.chide(this.att);
this.ev=new IMO.Event();
j.on("mousedown",this.handle_mousedown,this.dom,this);
j.on("mousedown",function(m){m.halt();
},this.close_btn,null);
j.on("click",function(m){IMO.MouseManager.get().handled(m,"window-close-button");
this.win.fire("on_close_request");
},this.close_btn,this);
};
Y.mix(IMO.WM.Floating.TitleBar.prototype,{set_title:function(l){j.empty(this.title).appendChild(j(l));
},set_icon:function(l){j.css(this.icon,{cls:"icon sprite_"+l});
},handle_mousedown:function(l){if(l.button===1){IMO.WM.FWM.window_initiate_move(this.win,l);
}},set_attention:function(l){if(this.win.att_data.icon_dom!==null){j.replace_content(this.att,this.win.att_data.icon_dom);
j.cshow(this.att);
}else{if(this.win.att_data.messages>0){var n=function(p){return"sprite_"+p;
};
var o=this.win.att_data.messages;
var m=o<10?"badge":"badge_expand";
j.replace_content(this.att,j.span(o<100?e("%d",o):"+\u221E"));
j.mex_class(this.att,n(m),[n("badge"),n("badge_expand")]);
j.cshow(this.att);
}else{j.chide(this.att);
}}},destroy:function(){}});
IMO.WM.Floating.WindowManager=function(){this.opened_windows=[];
this.focused_window=null;
this.last_focused=null;
this.focus_order=new c.CList();
this.attention_list=new c.CList();
this.desktop=j.div({id:"desktop"});
this.window_container=j.div({id:"window_container"});
this.move_net=j.div({id:"move_net"});
};
Y.mix(IMO.WM.Floating.WindowManager.prototype,{decorate:function(l){l=j.dom("imo");
Y.one(l).append(this.desktop);
Y.one(l).append(this.window_container);
this.browser_resize_evt_id=j.on("resize",this.handle_browser_resize,window,this);
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{"C-y":{cb:this.reposition_cb}},context:this,weight:IMO.KeyboardManager.exec_weight.window_manager_specific});
},undecorate:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.browser_resize_evt_id.detach();
delete this.browser_resize_evt_id;
j.remove(this.desktop);
j.remove(this.window_container);
},release:function(){if(this.focused_window){this.focused_window.focused=true;
}c.foreach(this.opened_windows,function(l){this.hide_content(l);
this.window_undecorate(l);
},this);
this.opened_windows=[];
this.focused_window=null;
this.focus_order.clear();
this.attention_list.clear();
this.undecorate();
},aquire:function(p,o){this.decorate(p);
var m=null;
c.foreach(o,function(r){this.window_decorate(r);
this.opened_windows.push(r);
var q=this.focus_order.add_before(r);
this.show_content(r);
if(r.focused!==undefined){m=q;
delete r.focused;
}if(r.need_att){j.add_class(r.ui.inner,"attention");
this.attention_list.add_before(q);
}},this);
if(m!==null){this.focus_order.head=m;
this.window_focus(m.data);
}var n={w:this.desktop.offsetWidth,h:this.desktop.offsetHeight};
var l=this._get_rects();
c.foreach(this.opened_windows,function(s){this.recalc_sizes(s);
var q=s.ui.size.min;
var r={w:q[0],h:q[1]};
var t=IMO.WM.position(n,l,r);
j.set_off(s.ui.dom,[t.x,t.y]);
this.resize_window(s,q);
l.push({x:t.x,y:t.y,w:r.w,h:r.h});
},this);
},reposition_cb:function(m,l){this.reposition(false);
},reposition:function(l){var m=[];
c.foreach(this.opened_windows,function(p){m.push({x:p.ui.dom.offsetLeft,y:p.ui.dom.offsetTop,w:l?p.ui.dom.offsetWidth:p.ui.size.min[0],h:l?p.ui.dom.offsetHeight:p.ui.size.min[1],win:p});
});
var n=this._get_rects();
var o={w:this.desktop.offsetWidth,h:this.desktop.offsetHeight};
m.sort(function(q,p){return q.y*2000+q.x-p.y*2000-p.x;
});
c.foreach(m,function(p){var q=IMO.WM.position(o,n,{w:p.w,h:p.h});
j.css(p.win.ui.dom,{left:q.x,top:q.y,width:p.w,height:p.h});
p.win.fire("on_move");
p.win.fire("on_resize");
n.push({x:q.x,y:q.y,w:p.w,h:p.h});
});
},window_decorate:function(l){l.wm=this;
l.ui.dom=j.div({"class":"floatingwindowholder"});
l.ui.click_evt_id=j.on("click",this.handle_window_click,l.ui.dom,this);
l.ui.inner=j.div({"class":"floatingwindow"});
l.ui.dom.appendChild(l.ui.inner);
l.ui.titlebar=new IMO.WM.Floating.TitleBar(l);
l.ui.titlebar.set_title(l.title);
l.ui.titlebar.set_attention(l.attention);
l.ui.inner.appendChild(l.ui.titlebar.dom);
l.ui.main=j.div({"class":"windowbody"});
l.ui.main.appendChild(l.content);
l.ui.inner.appendChild(l.ui.main);
l.ui.resize_marker=j.cdiv("resizemarker",j.cdiv("sprite_icn_window_expand"));
l.ui.resize_evt_id=j.on("mousedown",function(n,m){if(n.button===1){this.window_initiate_resize(n,m);
}},l.ui.resize_marker,this,l);
l.ui.main.appendChild(l.ui.resize_marker);
},window_undecorate:function(l){l.wm=null;
j.remove(l.ui.titlebar.dom);
l.ui.titlebar.destroy();
delete l.ui.titlebar;
j.remove(l.ui.resize_marker);
l.ui.resize_evt_id.detach();
delete l.ui.resize_evt_id;
delete l.ui.resize_marker;
j.remove(l.content);
j.remove(l.ui.main);
delete l.ui.main;
j.remove(l.ui.inner);
delete l.ui.inner;
l.ui.click_evt_id.detach();
delete l.ui.click_evt_id;
delete l.ui.dom;
delete l.ui.size;
},window_open:function(o){this.window_decorate(o);
var m=this._get_rects();
c.foreach(this.opened_windows,function(q){m.push({x:q.ui.dom.offsetLeft,y:q.ui.dom.offsetTop,w:q.ui.dom.offsetWidth,h:q.ui.dom.offsetHeight});
});
var n={w:this.desktop.offsetWidth,h:this.desktop.offsetHeight};
this.recalc_sizes(o);
var l=o.ui.size.min;
var p=IMO.WM.position(n,m,{w:l[0],h:l[1]});
j.set_off(o.ui.dom,[p.x,p.y]);
this.resize_window(o,l);
this.opened_windows.push(o);
this.show_content(o);
this.focus_order.add_after(o);
if(this.opened_windows.length===1){if(IMO.BrowserFocus.current_focus_state===IMO.BrowserFocus.FOCUS){}}this.reset_zindex();
},window_close:function(l){this.hide_content(l);
if(l.get_focus()===true){this.focus_next();
if(l.get_focus()===true){this.window_focus(null);
}}IMO.Utils.remove(this.opened_windows,l);
if(this.attention_list.each(function(n,m){if(n.data===l){this.attention_list.remove(m);
this.focus_order.remove(n);
return false;
}},this)===undefined){this.focus_order.remove(this.focus_order.find(l));
}this.window_undecorate(l);
l.fire("on_close");
},window_get_focus:function(l){return l===this.focused_window;
},window_set_attention:function(n,l){n.ui.titlebar.set_attention(l);
var m=this.attention_list.each(function(p,o){if(p.data===n){return o;
}});
if(!m&&n.need_att){j.add_class(n.ui.inner,"attention");
this.attention_list.add_before(this.focus_order.find(n));
this.attention_list.rotate(-1);
}else{if(m&&n.need_att){this.attention_list.move_before(m);
this.attention_list.rotate(-1);
}else{if(m&&!n.need_att){j.remove_class(n.ui.inner,"attention");
this.attention_list.remove(m);
}}}n.fire("on_set_attention",l);
},window_resize:function(m,l){l=c.dfl(l,this.get_current_win_size(m));
this.recalc_sizes(m);
c.vcap(l,m.ui.size.min,m.ui.size.max);
this.resize_window(m,l);
this.reposition_window(m);
},recalc_sizes:function(l){l.ui.size={};
var m=[2,IMO.Constants.titlebar_height+1];
l.ui.size.min=c.vadd(c.vdfl(l.size.min||[NaN,NaN],b.min),m);
l.ui.size.max=c.vadd(c.vdfl(l.size.max||[NaN,NaN],b.max),m);
},window_focus:function(l){this.last_focused=this.focused_window;
if(l===this.focused_window){return;
}if(this.focused_window!==null){j.remove_class(this.focused_window.ui.inner,"focused");
this.focused_window.fire("on_focus_change",false);
}if(l!==null){j.add_class(l.ui.inner,"focused");
l.fire("on_focus_change",true);
}this.focused_window=l;
if(this.focused_window===null){return;
}c.remove(this.opened_windows,this.focused_window);
this.opened_windows.unshift(this.focused_window);
this.reset_zindex();
if(this.focus_order.head.data!==this.focused_window){this.focus_order.move_after(this.focus_order.find(this.focused_window));
this.focus_order.rotate(1);
}},window_refocus:function(){var l=this.focused_window;
if(l!==null){l.fire("on_focus_change",true);
}},focus_next:function(){if(this.opened_windows.length===0||this.opened_windows.length===1&&this.focused_window){return;
}if(this.focused_window===null){this.focus_order.head.data.set_focus();
return;
}var l=null;
this.attention_list.each(function(m){if(m.data!==this.focused_window){l=m;
return false;
}});
if(l!==null){this.focus_order.move_after(l);
}this.focus_order.rotate(1);
this.focus_order.head.data.set_focus();
},focus_prev:function(){if(this.opened_windows.length===0){return;
}this.focus_order.rotate(-1);
this.focus_order.head.data.set_focus();
},reset_zindex:function(){var l=(this.opened_windows.length-1)*d+a;
c.foreach(this.opened_windows,function(o,n){var m=l-d*n;
j.css(o.ui.dom,{z_index:m});
o.fire("on_zindex",m);
});
},window_initiate_move:function(n,m){c.clear_selection();
n.set_focus();
if(!IMO.MoveNet.attach_move_net(this.window_handle_move,this,n)){return;
}var l=Y.one(n.ui.dom).getXY();
if(n.ui.ptr_offset!==undefined){IMO.MoveNet.detach_move_net();
delete n.ui.ptr_offset;
return;
}n.ui.ptr_offset=[l[0]-m.clientX,l[1]-m.clientY];
},window_handle_move:function(n,m){c.clear_selection();
var l=null;
if(n!==null){l=g(n);
}else{l="smartup";
}if(l==="smartmove"){this.reposition_window(m,[n.clientX+m.ui.ptr_offset[0],n.clientY+m.ui.ptr_offset[1]]);
}else{if(l==="smartup"){IMO.MoveNet.detach_move_net();
if(m.ui.ptr_offset){delete m.ui.ptr_offset;
}}else{if(l!=="smartnone"){alert("throwing WTF");
throw"WTF";
}}}},window_initiate_resize:function(p,o){c.clear_selection();
o.set_focus();
if(!IMO.MoveNet.attach_move_net(this.window_handle_resize,this,o)){return;
}var n=[o.ui.dom.offsetWidth,o.ui.dom.offsetHeight];
var l=Y.one(o.ui.dom).getXY();
var m=j.offsetAncestor(o.ui.resize_marker,o.ui.dom);
o.ui.ptr_offset=[n[0]-(p.clientX-l[0]),n[1]-(p.clientY-l[1])];
},window_handle_resize:function(o,n){c.clear_selection();
var q;
if(o!==null){q=g(o);
}else{q="mouseup";
}if(q==="smartmove"){var r=Y.one(n.ui.dom).getXY();
var s=[o.clientX-r[0]+n.ui.ptr_offset[0],o.clientY-r[1]+n.ui.ptr_offset[1]];
var l=Y.one(this.desktop).getXY();
var m=[this.desktop.offsetWidth,this.desktop.offsetHeight];
var p=[m[0]-(r[0]-l[0]),m[1]-(r[1]-l[1])];
var t=n.ui.size.min;
IMO.Utils.foreach(s,function(v,u){s[u]=k(v,t[u],p[u]);
});
this.resize_window(n,s);
}else{if(q==="smartup"){IMO.MoveNet.detach_move_net();
if(n.ui.ptr_offset){delete n.ui.ptr_offset;
}}else{if(q!=="smartnone"){throw"WTF";
}}}},window_set_title:function(l,m){l.ui.titlebar.set_title(m);
},window_set_icon:function(m,l){m.ui.titlebar.set_icon(l);
},handle_browser_resize:function(l){if(this.resize_later_cb){this.resize_later_cb.cancel();
}this.resize_later_cb=Y.later(f,this,this.handle_resize_good,null,false);
this.handle_resize_fast();
},handle_resize_fast:function(){c.foreach(this.opened_windows,function(r){var o=j.get_size(r.ui.dom);
var m=r.ui.size.min;
var q=j.get_size(this.desktop);
var l=j.offsetAncestor(r.ui.dom,this.desktop);
var n=c.vsub(q,l);
if(!c.vle(o,n)){o[0]=k(o[0],m[0],n[0]);
o[1]=k(o[1],m[1],n[1]);
if(o[0]<m[0]){o[0]=m[0];
}if(o[1]<m[1]){o[1]=m[1];
}this.resize_window(r,o);
}if(!c.vle(m,n)){var p=c.vsub(q,o);
c.vcap(p,p,l);
j.css(r.ui.dom,{left:e("%dpx",p[0]),top:e("%dpx",p[1])});
}},this);
},handle_resize_good:function(){Y.log("GOOD resize");
},handle_window_click:function(l){IMO.MouseManager.get().handled(l,"window");
},get_current_win_size:function(l){return c.map(["width","height"],function(m){return parseInt(Y.DOM.getComputedStyle(l.ui.dom,m),10);
});
},resize_window:function(m,l){j.set_size(m.ui.dom,l);
Y.log("window resize");
m.fire("on_resize");
},reposition_window:function(p,q){q=c.dfl(q,Y.DOM.getXY(p.ui.dom));
var m=Y.one(this.desktop).getXY();
var n=[this.desktop.offsetWidth,this.desktop.offsetHeight];
var o=[p.ui.dom.offsetWidth,p.ui.dom.offsetHeight];
var l=[q[0]-m[0],q[1]-m[1]];
IMO.Utils.foreach(l,function(s,r){l[r]=k(s,0,n[r]-o[r]);
});
j.css(p.ui.dom,{left:l[0],top:l[1]});
p.fire("on_move");
},show_content:function(l){l.fire("on_before_content_visibility_change",true);
this.window_container.appendChild(l.ui.dom);
l.fire("on_after_content_visibility_change",true);
},hide_content:function(l){l.fire("on_before_content_visibility_change",false);
j.remove(l.ui.dom);
l.fire("on_after_content_visibility_change",false);
},_get_rects:function(){var l=[];
l.push(j.get_rect("header","imo"));
l.push(j.get_rect("footer","imo"));
l.push(j.get_rect("mnp-panel","imo"));
l.push(j.get_rect("buddypanel","imo"));
return l;
}});
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=10;
IMO.IconHolder=function(){};
Y.mix(IMO.IconHolder.prototype,{get_id:function(){throw"Unimplemented!";
},get_icon_url:function(){throw"Unimplemented!";
},img_downloaded:function(d){throw"Unimplemented!";
},img_failed:function(){throw"Unimplemented!";
}});
IMO.PriorityIconDownloader=function(){this.downloading_requests={};
this.pending_requests={};
this.priority_pending_requests=[];
for(var d=0;
d<=b;
d++){this.priority_pending_requests[d]={};
}this.active_conn_cnt=0;
this.max_conn_cnt=Y.UA.ie?1:4;
};
Y.mix(IMO.PriorityIconDownloader.prototype,{request_image_download:function(e,d){Y.log(["requesting image",e,d]);
d=this.normalize_priority(d);
var f={img:null,img_src:e.get_icon_url(),retries:0,holder:e,priority:d};
this.pending_requests[e.get_id()]=f;
this.priority_pending_requests[d][e.get_id()]=true;
this.download_next();
},priority_changed:function(e,d){d=this.normalize_priority(d);
var g=e.get_id();
var f=this.pending_requests[g];
if(f===undefined){f=this.downloading_requests[g];
}else{delete this.priority_pending_requests[f.priority][g];
this.priority_pending_requests[d][g]=true;
}if(f===undefined){return;
}f.priority=d;
},normalize_priority:function(d){if(d>b){return b;
}if(d<0){return 0;
}return d;
},get_next_request:function(){Y.log(["get_next_request",this.pending_requests]);
for(var e=b;
e>=0;
e--){for(var d in this.priority_pending_requests[e]){var f=this.pending_requests[d];
delete this.pending_requests[d];
delete this.priority_pending_requests[e][d];
return f;
}}return null;
},download_next:function(){Y.log("Downloading next image...");
if(this.active_conn_cnt>=this.max_conn_cnt){return;
}var d=this.get_next_request();
Y.log(["Request:",d]);
if(d===null){return;
}if(d.retries>6){Y.log(["Failed to fetch:",d.img_src,d.holder]);
d.holder.img_failed();
Y.later(0,this,this.download_next);
return;
}this.fetch(d);
Y.later(0,this,this.download_next);
},fetch:function(d){this.active_conn_cnt++;
d.img=new Image();
c.on("load",this.img_done,d.img,this,d);
c.on("error",this.img_failed,d.img,this,d);
c.on("abort",this.img_failed,d.img,this,d);
d.img.src=d.img_src;
this.downloading_requests[d.holder.get_id()]=d;
},img_done:function(f,d){Y.log(["Img done:",d]);
this.active_conn_cnt--;
delete this.downloading_requests[d.holder.get_id()];
Y.later(0,this,this.download_next);
d.holder.img_downloaded(d.img.src);
},img_failed:function(f,d){Y.log(["Img failed:",d]);
this.active_conn_cnt--;
delete this.downloading_requests[d.holder.get_id()];
Y.later(0,this,this.download_next);
d.img=null;
d.retries++;
var g=d.holder.get_id();
this.pending_requests[g]=d;
this.priority_pending_requests[d.priority][g]=d;
}});
IMO.make_singleton(IMO.PriorityIconDownloader);
}());
(function(){var c=IMO.Utils;
var h=IMO.Utils.HTML;
var d=c.sprintf;
var f={window_manager_common:5,window_manager_specific:6,status_console:15,global:20,high:100,activity_monitor:110};
var i={"?":true,"/":true,"C-a":true,"C-c":true,"C-v":true,"C-x":true};
var e={shift:16,ctrl:17,alt:18,"left meta key":91,"right meta key":92};
var a={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,"left arrow":37,"up arrow":38,"right arrow":39,"down arrow":40,insert:45,"delete":46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,"left meta key":91,"command left":91,"right meta key":92,"select key":93,"command right":93,"numpad 0":96,"numpad 1":97,"numpad 2":98,"numpad 3":99,"numpad 4":100,"numpad 5":101,"numpad 6":102,"numpad 7":103,"numpad 8":104,"numpad 9":105,multiply:106,add:107,subtract:109,"decimal point":110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,"num lock":144,"scroll lock":145,";":186,"=":187,",":188,dash:189,".":190,"/":191,"`":192,"open bracket":219,"\\":220,"close bracket":221,"'":222};
var b={"[":"{","]":"}","\\":"|",";":":","'":'"',",":"<",".":">","/":"?","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+","`":"~"};
if(Y.UA.os==="macintosh"&&Y.UA.webkit){Y.mix(a,{"right meta key":a["select key"],"select key":undefined},true);
}var g=[];
c.foreach(a,function(k,j){g[k]=j;
});
IMO.KeyboardManager=function(){h.on("keydown",this.dispatch,document,this);
if(Y.UA.gecko&&Y.UA.os!=="windows"){h.on("keypress",this.dispatch,document,this);
}this.shortcut_contexts=[];
};
IMO.KeyboardManager.name2code=a;
IMO.KeyboardManager.exec_weight=f;
Y.mix(IMO.KeyboardManager.prototype,{push:function(l){if(l.weight===undefined){l.weight=IMO.KeyboardManager.exec_weight.high;
}var j={};
c.foreach(l.bindings,function(n,m){if(n.target!==undefined){n.ev_handle=h.on("keydown",this.dispatch,n.target,this);
}if(n.comb===undefined){n.comb=m;
}if(n.alt!==undefined){var o=n.alt;
if(Y.Array.test(n.alt)===0){o=[n.alt];
}c.foreach(o,function(p){j[p]=n;
});
}});
Y.mix(l.bindings,j);
var k;
for(k=this.shortcut_contexts.length;
k>0&&this.shortcut_contexts[k-1].weight>l.weight;
--k){this.shortcut_contexts[k]=this.shortcut_contexts[k-1];
}this.shortcut_contexts[k]=l;
l.uid=c.create_uid();
return l.uid;
},pop:function(k){var j=c.foreach(this.shortcut_contexts,function(n,m){if(n.uid===k){return m;
}});
if(j===undefined){throw"WTF";
}var l=this.shortcut_contexts[j];
this.shortcut_contexts.splice(j,1);
c.foreach(l.bindings,function(m){if(m.ev_handle!==undefined){m.ev_handle.detach();
delete m.ev_handle;
}});
return l;
},dispatch:function(o){var k;
var p;
if(o.type==="keydown"){var l="";
k=g[o.keyCode]||o.keyCode||"???";
k=""+k;
if(k!=="ctrl"){l+=o.ctrlKey?"C-":"";
}if(k!=="shift"){l+=o.shiftKey?"S-":"";
}if(k!=="alt"){l+=o.altKey?"A-":"";
}if(!k.match(/meta/)){l+=o.metaKey?"M-":"";
}k=l+k;
if(k.length===3&&l==="S-"){if(b[k.slice(2)]!==undefined){k=b[k.slice(2)];
}}this.last_comb=k;
this.first=true;
}else{k=this.last_comb;
if(this.first){this.first=false;
return;
}}var m=false;
if(false){m=true;
Y.log(["got comb",k]);
}var s=o.target._node.nodeName.toLowerCase();
if((s==="textarea"||s==="input")&&i[k]){return;
}o.kb_bottom=function(){this.bottom=true;
};
for(var n=this.shortcut_contexts.length-1;
n>=0;
--n){var q=this.shortcut_contexts[n];
if(m){c.log("sc %d: w %d",n,q.weight);
}var r=q.bindings[k]||q.bindings.any;
if(r!==undefined){var j=r.context||q.context;
p=r.cb.call(j,o,k,r);
if(m===true){c.log("called something (i %d, w %d), rv: %s",n,q.weight,o._event.returnValue);
}if(o.bottom===true){break;
}}if(q.bottom===true){break;
}}if(k==="esc"){o.preventDefault();
}return p;
}});
IMO.make_singleton(IMO.KeyboardManager);
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.UIWidgets.Menu=function(d){this.config=d;
var c=a.args(arguments,1);
this.dom=b.span({cls:"dropdown",onclick:function(f){IMO.MouseManager.get().handled(f,"dropdown");
this.toggle();
},context:this},this.main=b.span({cls:"main"},c),this.options_container=b.div({cls:"options-container"},this.options=b.div({cls:"options shadow"})));
IMO.MouseManager.get().register(this.on_mouse,this);
this.visible=false;
b.hide(this.options);
};
Y.mix(IMO.UIWidgets.Menu.prototype,{add_option:function(g,c,e){var f=b.div({cls:"option",context:this,onclick:function(h){var d=true;
if(c){d=c.call(e||this.config.context,h);
}if(d===false){IMO.MouseManager.get().handled(h,"dropdown");
if(h){h.stopPropagation();
}}}},g);
this.options.appendChild(f);
return f;
},remove_option:function(c){this.options.removeChild(c);
},on_mouse:function(){if(!IMO.MouseManager.get().check_handled("dropdown")){this.close();
}},open:function(){b.show(this.options);
this.visible=true;
},close:function(){b.hide(this.options);
this.visible=false;
},toggle:function(){if(this.visible){this.close();
}else{this.open();
}},destroy:function(){IMO.MouseManager.get().unregister(this.on_mouse,this);
}});
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=a.TranslateDom;
IMO.ModalPopup=function(d){this.widget=d;
this.content=null;
this.size=[];
this.title=null;
this.shown=false;
this.close_on_outside_click=true;
};
Y.mix(IMO.ModalPopup.prototype,{adjust_size:function(){c.css(this.popup_dom,{width:"",height:"",top:"0px"});
this.css={};
this.css.width=!isNaN(this.size[0])?this.size[0]:this.popup_dom.offsetWidth;
this.css.top=Math.floor((Y.DOM.docHeight()-this.popup_dom.offsetHeight)/2);
c.css(this.popup_dom,this.css);
},set_content:function(e,d){this.content=e;
this.content_size=d;
},set_title:function(d){this.title=d;
},set_close_on_outside_click:function(d){this.close_on_outside_click=d;
},prepare:function(){if(this.content===null){throw"Content not set";
}var d;
if(this.title!==null){var e;
if(typeof this.title==="string"){e=b(this.title);
}else{e=this.title;
}d=c.cdiv("modal-popup-titled",this.titlebar=c.cdiv("modal-popup-titlebar",e),c.div({cls:"line"}),this.content_dom=c.cdiv("modal-popup-content",this.content),c.div({style:{clear:"both"}}));
this.size=a.vadd(this.content_size,[0,IMO.Constants.modal_popup_title_height]);
if(this.widget){this.titlebar.appendChild(c.sprite("icn_close_2",{cls:"close",onclick:function(f){IMO.MouseManager.get().handled(f,"modalpopup-close-button");
this.widget.hide();
},context:this}));
}}else{d=c.cdiv("modal-popup-raw",this.content);
this.dom=this.content;
this.size=this.content_size;
}this.dom=c.cdiv("modal-popup-container",{cls:"shadow"},this.overlay=c.cdiv("modal-popup-overlay"),this.popup_dom=d);
if(this.widget){c.on("click",function(f){IMO.MouseManager.get().handled(f,"modalpopup-overlay");
if(this.close_on_outside_click){this.widget.hide();
}},this.overlay,this);
}this.dom.style.visibility="hidden";
c.dom("imo").appendChild(this.dom);
Y.log([d.offsetWidth,d.offsetHeight]);
this.adjust_size();
c.hide(this.dom);
this.dom.style.visibility="";
},show:function(){if(this.shown){return false;
}c.show(this.dom);
this.shown=true;
return true;
},hide:function(){if(!this.shown){return false;
}c.hide(this.dom);
this.shown=false;
return true;
},destroy:function(){c.remove(this.dom);
if(this.dom!==this.content){c.remove(this.content);
}}});
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
var c=800;
var f=600;
var d=100;
var e=100;
IMO.ModalPopup2=function(g){this._title=a.dfl(g.title,"");
this._content=null;
this._max_width=a.dfl(g.max_width,c);
this._max_height=a.dfl(g.max_height,f);
this._min_width=a.dfl(g.min_width,d);
this._min_height=a.dfl(g.min_height,e);
this._close_on_outside_click=a.dfl(g.close_on_outside_click,true);
this._build_dom();
IMO.ResizeManager.register(this._adjust_size,this);
};
Y.mix(IMO.ModalPopup2.prototype,{show:function(){b.show(this.dom);
},hide:function(){b.hide(this.dom);
},build_content:function(){throw"unimplemented";
},destroy:function(){b.remove(this.dom);
},build_header:function(){return b.cdiv("modal-popup-header",b.cspan("modal-popup-title",this._title),b.sprite("icn_close_2",{onclick:this.hide,context:this}));
},build_footer:function(){return b.cdiv("modal-popup-footer");
},_build_dom:function(){this.dom=b.cdiv("modal-popup2",this.build_header(),this.build_content(),this.build_footer());
b.hide(this.dom);
b.dom("imo").appendChild(this.dom);
},_get_size:function(){var h=a.max(this.dom.offsetWidth,this._min_width);
h=a.min(h,this._max_width);
var g=a.max(this.dom.offsetHeight,this._min_height);
g=a.min(g,this._max_height);
return[h,g];
},_adjust_size_and_position:function(){b.css(this.dom,{width:"",height:"",top:"0px"});
var h=this._get_size();
var g={width:h[0],height:h[1],top:Math.floor((Y.DOM.docHeight()-h[1])/2)};
b.css(this.dom,g);
}});
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=a.sprintf;
IMO.MouseManager=function(){c.on("click",this.handle_click_raw,document,this);
this.handlers=[];
this.handled_data=[];
this.ev=new IMO.Event();
};
Y.mix(IMO.MouseManager.prototype,{register:function(d,e){this.handlers.push({cb:d,context:e});
},unregister:function(d,e){this.handlers=a.filter(this.handlers,function(f){return(f.cb!==d||f.context!==e);
});
},handle_click_raw:function(f){var d;
if(f.which){d=(f.which===3);
}else{if(f.button){d=(f.button===2);
}}if(d){return;
}this.handle_click(f);
this.handled_data.length=0;
},handled:function(f,d){Y.log("handled mouse click "+d);
if(!f||f.type==="click"){this.handled_data.push({e:f,data:d,when:(new Date()).getTime()});
}else{Y.log("dropping event with type "+f.type,"warn");
}},print_queue:function(){var d=a.map(this.handled_data,function(e){return e.data;
}).join(" ");
if(this.handled_data.length===0){d="(empty queue)";
}return d;
},handle_click:function(d){Y.log("handle_click: "+this.print_queue());
a.foreach(this.handlers,function(e){e.cb.call(e.context,d,this.handled_data);
},this);
this.ev.fire("on_click",d,this);
},data2str:function(d){if(typeof d==="string"){return d;
}else{if(typeof d.msg==="string"){return d.msg;
}else{return"unknown";
}}},check_handled:function(){return !!a.foreach(arguments,function(d){var e;
if(d.indexOf("*")){e=d.replace(/\*/g,".*");
e=new RegExp("^"+e+"$","gm");
}return a.foreach(this.handled_data,function(f){var g=typeof f.data==="string"&&f.data||typeof f.data.msg==="string"&&f.data.msg||"";
if(e?g.match(e):g===d){return true;
}},this);
},this);
}});
IMO.make_singleton(IMO.MouseManager);
}());
(function(){var a=IMO.Utils;
var c=a.sprintf;
var b=a.cap;
var f=function(g){var j=1;
for(var h=1;
h<g.length;
++h){if(g[h]!==g[h-1]){g[j++]=g[h];
}}g.length=j;
};
var e=function(i){var h=0,g=1;
while(g<i){++h;
g*=2;
}return[g,h];
};
var d=function(H,o,w){var n=[0,H.w,H.w-w.w],k=[0,H.h,H.h-w.h];
var q,A;
var u=[],s=[];
var p=[];
a.foreach(o,function(i){if(i.x-w.w>=0){n.push(i.x-w.w);
}n.push(i.x);
n.push(i.x+i.w);
if(i.y-w.h>=0){n.push(i.y-w.h);
}k.push(i.y);
k.push(i.y+i.h);
p.push({x:i.x,ya:i.y,ys:i.y+i.h});
p.push({x:i.x+i.w,ya:i.y+i.h,ys:i.y});
});
n.sort(function(j,i){return j-i;
});
f(n);
q=n.length;
k.sort(function(j,i){return j-i;
});
f(k);
A=k.length;
a.foreach(n,function(j,i){u[j]=i;
});
a.foreach(k,function(j,i){s[j]=i;
});
p.sort(function(j,i){return j.x-i.x;
});
var y=0;
var v=e(A),z=v[1];
var x=[];
var h=[];
var F,J,I;
x.length=q*v[0];
h.length=A;
var D,C;
for(C=0;
C<A;
++C){h[C]=0;
x[C]=0;
}for(D=1;
D<q;
++D){var B=D<<z,r=(D-1)<<z;
x[B]=0;
for(;
y<p.length&&p[y].x<n[D];
++y){++h[s[p[y].ya]];
--h[s[p[y].ys]];
}J=0;
for(C=1;
C<A;
++C){J+=h[C-1];
I=(n[D]-n[D-1])*(k[C]-k[C-1]);
F=J*I;
x[B+C]=x[B+C-1]+x[r+C]+F-x[r+C-1];
}}var G,E;
var m,g=1;
var l=x[((q-1)<<z)+A-1]+1,t;
for(C=0;
C+1<A;
++C){m=C;
for(;
g<A&&k[g]-k[m]<w.h;
++g){}if(g===A){break;
}E=1;
for(D=0;
D+1<q;
++D){G=D;
for(;
E<q&&n[E]-n[G]<w.w;
++E){}if(E===q){break;
}J=x[(E<<z)+g]+x[(G<<z)+m]-x[(G<<z)+g]-x[(E<<z)+m];
if(J<l){l=J;
t=[G,m,E,g];
}}}return{x:n[t[0]],y:k[t[1]]};
};
IMO.WM.position=function(k,h,j,l,g){l=l||5;
g=g||10;
var m=[];
a.foreach(h,function(q){var n=b(q.x-l,0,k.w);
var r=b(q.y-l,0,k.h);
var o=b(q.w+2*l,0,k.w-n);
var p=b(q.h+2*l,0,k.h-r);
m.push({x:n,y:r,w:o,h:p});
});
var i=d(k,m,{w:j.w+2*l,h:j.h+2*l},k.w,k.h);
if(a.foreach(m,function(n){if(n.x===i.x&&n.y===i.y){return false;
}})!==undefined){i.x+=i.x+g+j.w<k.w?g:0;
i.y+=i.y+g+j.h<k.h?g:0;
}return{x:i.x+l,y:i.y+l};
};
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.ResizeManager={init:function(){this.listeners=[];
b.on("resize",this.dispatch,window,this);
},register:function(c,d){this.listeners.push({cb:c,context:d});
},unregister:function(c,d){this.listeners=a.filter(this.listeners,function(e){return !(e.cb===c&&e.context===d);
});
},dispatch:function(){a.foreach(this.listeners,function(c){c.cb.apply(c.context);
});
}};
}());
if(!IMO.config){IMO.config={};
}IMO.config.debug=false;
(function(){function b(d,c){return function(e){d[c].call(d,e);
};
}var a=(function(){if(typeof Y!=="undefined"&&Y.log){return b(Y,"log");
}if(typeof console!=="undefined"){return b(console,"log");
}if(typeof opera!=="undefined"&&opera.postError){return b(opera,"postError");
}return function(){};
}());
IMO.log=function(c){if(!IMO.config||!IMO.config.debug){return;
}a(c);
};
}());
(function(){var a=IMO.Utils;
a.DListNode=function(c,d,b){this.left=d||null;
this.right=b||null;
this.data=c;
};
a.CList=function(){this.head=null;
};
a.mix(a.CList.prototype,{rotate:function(c){if(c===0||this.head===null){return;
}var b=c>0?"right":"left";
c=Math.abs(c);
while(c--){IMO.log(["rotate",this.head]);
this.head=this.head[b];
}},add_before:function(d,c){c=c||this.head;
var b=new a.DListNode(d,c&&c.left,c);
if(this.head===null){this.head=b;
this.head.left=this.head.right=this.head;
return b;
}c.left.right=b;
c.left=b;
return b;
},add_after:function(c,d){d=d||this.head;
var b=new a.DListNode(c,d,d&&d.right);
if(this.head===null){this.head=b;
this.head.left=this.head.right=this.head;
return b;
}d.right.left=b;
d.right=b;
return b;
},remove:function(b){if(this.head===b&&this.head.left===this.head){this.head=null;
return;
}try{b.left.right=b.right;
b.right.left=b.left;
if(this.head===b){this.head=b.left;
}}catch(c){a.error(c);
}},move_before:function(b,c){c=c||this.head;
if(b===c||c.left===b){return;
}b.right.left=b.left;
b.right.left=b.right;
b.right=c;
b.left=c.left;
c.left.right=b;
c.left=b;
},move_after:function(b,c){c=c||this.head;
if(b===c||c.right===b){return;
}b.left.right=b.right;
b.right.left=b.left;
b.left=c;
b.right=c.right;
c.right.left=b;
c.right=b;
},each:function(i,d,c,h,g){if(this.head===null){return undefined;
}c=c||this.head;
h=h||this.head;
g=g||1;
var e=g>0?["right","left"]:["left","right"];
var j=c;
var k=0;
do{IMO.log(["each",j]);
var b=i.call(d,j.data,j);
if(b!==undefined){return b;
}j=j[e[0]];
k++;
if(k>1000){IMO.log("Breaking out of long-lived clist.each","error");
IMO.log(j,"error");
IMO.Stats.increment_counter("clist_each_terminated");
return;
}}while(j!==h);
return undefined;
},find:function(c){var b=this.each(function(f,e){if(f===c){return e;
}});
return b;
},clear:function(){while(this.head!==null){IMO.log(["clear",this.head]);
this.remove(this.head);
}},count_eq:function(c){if(c===0){return this.head===null;
}var b=this.head.right;
for(--c;
c>0&&b!==this.head;
--c,b=b.right){IMO.log(["count_eq",b]);
}return c===0&&b===this.head;
}});
}());
(function(){var f=IMO.Utils;
var n=IMO.Utils.HTML;
var h=f.sprintf;
var c=IMO.Constants;
var o=f.TranslateDom;
var k=f.TranslateTxt;
if(!IMO.WM){IMO.WM={};
}if(!IMO.WM.Tabbed){IMO.WM.Tabbed={};
}var l=function(q){q.fire("on_before_content_visibility_change",false);
n.add_class(q.ui.main,"hidden-window-content");
q.fire("on_after_content_visibility_change",false);
};
var e=function(q){q.fire("on_before_content_visibility_change",true);
n.remove_class(q.ui.main,"hidden-window-content");
q.fire("on_after_content_visibility_change",true);
};
var b=1;
var g=2;
var i=3;
var p=120;
var d=30;
var m=250;
var a=100;
var j=5000;
IMO.WM.Tabbed.TabBar=function(){this.titlebars=[];
this.dom=n.div({"class":"tabbar"});
this.visible_tabs=n.div({"class":"visible-tab-list"});
n.chide(this.visible_tabs);
this.dom.appendChild(this.visible_tabs);
this.more_indicators=[n.div({"class":"left-more-indicator"},n.span(" "),n.sprite("icn_previous"),n.span(" ")),n.div({"class":"right-more-indicator"},n.span(" "),n.sprite("icn_next"),n.span(" "))];
f.foreach(this.more_indicators,function(r,q){f.foreach(["mousedown","mouseup","mouseleave"],function(s){n.on(s,this.handle_more_mouse,r,this,q);
},this);
n.chide(r);
this.dom.appendChild(r);
},this);
this.all_tabs=n.div({"class":"complete-tab-list"});
this.all_tabs_aux=n.cdiv("tab-terminator");
this.all_tabs.appendChild(this.all_tabs_aux);
this.visible_tabs.appendChild(this.all_tabs);
this.menu_button=n.cdiv("menu-button",o("All tabs \u00bb"));
n.on("click",this.handle_menu_btn_mouse,this.menu_button,this);
n.chide(this.menu_button);
this.dom.appendChild(this.menu_button);
this.tab_menu_on=false;
this.state=b;
this.ev=new IMO.Event();
IMO.MouseManager.get().register(this.handle_window_click,this);
};
Y.mix(IMO.WM.Tabbed.TabBar.prototype,{handle_window_click:function(s,q){if(!this.tab_menu_on){return;
}var r=IMO.MouseManager.get().check_handled("twm-tabbar-more-button","wm-titlebar-menubar","twm-titlebar-close");
if(!r){this.close_tab_menu();
}},handle_resize_fast:function(){this.ev.fire("on_tabbar_move");
this.recalc();
},add_tab:function(q){this.all_tabs.insertBefore(q.dom,this.all_tabs_aux);
this.titlebars.push(q);
if(this.tab_menu_on===true){this.tab_menu_tabs.appendChild(q.mdom);
}n.css(this.all_tabs,{width:h("%dpx",this.all_tabs_width())});
this.recalc();
},remove_tab:function(q){n.remove(q.dom);
if(this.tab_menu_on===true){n.remove(q.mdom);
}f.remove(this.titlebars,q);
n.css(this.all_tabs,{width:h("%dpx",this.all_tabs_width())});
this.recalc();
},ensure_visible:function(v){var x=-1;
var q=v.dom;
f.foreach(this.all_tabs.childNodes,function(A,z){if(A===q){x=z;
return false;
}});
var y=x*p;
var s=this.visible_tabs.scrollLeft;
s=f.cap(s,y-this.visible_tabs.offsetWidth+p,y);
if(s!==this.visible_tabs.scrollLeft){this.ev.fire("on_tabbar_move");
this.visible_tabs.scrollLeft=s;
this.recalc_ind();
}if(this.tab_menu_on===true){var t=this.tab_menu_tabs.offsetHeight;
var w=v.mdom.offsetHeight+v.mdom.offsetTop-t;
var u=v.mdom.offsetTop;
var r=this.tab_menu_tabs.scrollTop;
r=f.cap(r,w,u);
this.tab_menu_tabs.scrollTop=r;
}},recalc:function(){var r=this.dom.offsetWidth-d;
var s=this.all_tabs_width();
var q=this.all_tabs.childNodes.length===1?b:s<=r?g:i;
if(q!==this.state){this.change_state(this.state,q);
}else{this.recalc_ind();
}},change_state:function(q,r){this.ev.fire("on_tabbar_move");
if(r===b){n.chide(this.menu_button);
n.chide(this.visible_tabs);
f.foreach(this.more_indicators,n.chide,n);
}if(r===g){this.visible_tabs.scrollLeft=0;
n.cshow(this.visible_tabs);
n.cshow(this.menu_button);
f.foreach(this.more_indicators,n.chide,n);
n.remove_class(this.visible_tabs,"arrows");
n.add_class(this.visible_tabs,"no-arrows");
n.remove_class(this.all_tabs,"attention");
}if(r===i){n.cshow(this.menu_button);
n.cshow(this.visible_tabs);
f.foreach(this.more_indicators,n.cshow,n);
n.remove_class(this.visible_tabs,"no-arrows");
n.add_class(this.visible_tabs,"arrows");
}this.state=r;
this.recalc_ind();
},recalc_ind:function(){if(this.state!==i){n.remove_class(this.menu_button,"attention");
return;
}var t=this.visible_tabs.offsetWidth;
var s=this.all_tabs_width();
var r=this.visible_tabs.scrollLeft;
var q=[r>0,r+t<s];
f.foreach(this.more_indicators,function(v,u){n[q[u]?"add_class":"remove_class"](v,"active");
});
if(r+t>s){this.visible_tabs.scrollLeft=s-t;
}this.recalc_attention();
},handle_more_click:function(u){this.ev.fire("on_tabbar_move");
var r=this.visible_tabs.scrollLeft;
var q=(new Date()).getTime();
var t=(q-this.last_moved)/1000;
var s=(u===0?-1:1)*m*t;
this.last_moved=q;
r+=s;
r=f.cap(r,0,this.all_tabs_width()-this.visible_tabs.offsetWidth);
this.visible_tabs.scrollLeft=r;
this.recalc_ind();
f.clear_selection();
},handle_more_mouse:function(r,s){r.halt();
if(r.type==="mousedown"){IMO.MouseManager.get().handled(null,"twm-tabbar-scroll-button");
IMO.MouseManager.get().handle_click_raw(r);
}var q=r.type==="mouseout"&&"mouseleave"||r.type;
if(q==="mousedown"){this.last_moved=(new Date()).getTime()-a;
this.handle_more_click(s);
this.mover=Y.later(a,this,this.handle_more_click,s,true);
}else{if(q==="mouseup"||q==="mouseleave"){if(this.last_moved){this.mover.cancel();
delete this.mover;
delete this.last_moved;
}}else{if(q==="dblclick"){}else{Y.log(["got unrecognized event",q],"error");
}}}},handle_menu_btn_mouse:function(q){IMO.MouseManager.get().handled(q,"twm-tabbar-more-button");
if(this.tab_menu_on===false){this.open_tab_menu();
}else{this.close_tab_menu();
}},close_tab_menu:function(){if(!this.tab_menu_on){return;
}n.remove(this.tab_menu);
delete this.tab_menu;
delete this.tab_menu_tabs;
this.tab_menu_on=false;
},open_tab_menu:function(){if(this.tab_menu_on){return;
}this.tab_menu=n.cdiv("tab-menu");
this.tab_menu.appendChild(n.div({cls:"tab-menu-shadow"}));
this.tab_menu_tabs=n.cdiv("tabs");
f.foreach(this.titlebars,function(q){this.tab_menu_tabs.appendChild(q.mdom);
},this);
this.tab_menu.appendChild(this.tab_menu_tabs);
IMO.WM.TWM.content.appendChild(this.tab_menu);
this.tab_menu_on=true;
this.resize_tab_menu();
if(IMO.WM.TWM.focused_window){this.ensure_visible(IMO.WM.TWM.focused_window.ui.titlebar);
}},menu_used:function(){this.close_tab_menu();
},all_tabs_width:function(){if(this.all_tabs.childNodes.length<=1){return 0;
}return(this.all_tabs.childNodes[0].offsetWidth+2)*(this.all_tabs.childNodes.length-1);
},resize_tab_menu:function(){n.css(this.all_tabs,{width:h("%dpx",this.all_tabs_width())});
if(!this.tab_menu_on){return;
}var q=Y.DOM.winHeight()-(c.titlebar_height+c.reui_header_height+c.reui_footer_height+c.reui_conv_buttons_height+50);
n.css(this.tab_menu_tabs,{max_height:q});
if(q<this.tab_menu_tabs.scrollHeight){n.css(this.tab_menu,{width:"165px"});
}},handle_resize:function(){this.resize_tab_menu();
},destroy:function(){},recalc_attention:function(){if(this.state!==i){n.remove_class(this.menu_button,"attention");
return;
}var s=0;
var r=0;
var q=this.more_indicators[0].offsetWidth+3;
var t=this.visible_tabs.scrollLeft+q;
var u=this.visible_tabs.offsetWidth-2*q;
f.foreach(this.titlebars,function(v){if(v.attentive){if(v.hidden_left(t,u)){s+=1;
}if(v.hidden_right(t,u)){r+=1;
}}});
if(s>0||r>0){n.add_class(this.menu_button,"attention");
}else{n.remove_class(this.menu_button,"attention");
}if(s>0){n.add_class(this.more_indicators[0],"attention");
}else{n.remove_class(this.more_indicators[0],"attention");
}if(r>0){n.add_class(this.more_indicators[1],"attention");
}else{n.remove_class(this.more_indicators[1],"attention");
}}});
IMO.WM.Tabbed.TitleBar=function(r,q){this.win=r;
this.attentive=false;
this.dom=n.div({cls:"titlebar-tabbed"},this.close_btn=n.sprite("icn_close",{cls:"close",alt:k("Close window"),title:k("Close window"),onclick:function(s){IMO.MouseManager.get().handled(s,"twm-titlebar-close");
r.fire("on_close_request");
}}),n.div({cls:"titleicon"},this.icon=n.sprite(r.icon,{cls:"icon"}),this.title=n.span({cls:"title"})),this.att=n.cdiv("attention-bubble sprite_badge"));
n.chide(this.att);
this.mdom=n.div({cls:"titlebar-tabbed"},this.mclose_btn=n.sprite("icn_close",{cls:"close",onclick:function(s){IMO.MouseManager.get().handled(s,"twm-titlebar-close");
r.fire("on_close_request");
}}),n.div({cls:"titleicon"},this.micon=n.sprite(r.icon,{cls:"icon"}),this.mtitle=n.span({cls:"title"})),this.matt=n.cdiv("attention-bubble sprite_badge"));
n.chide(this.matt);
n.on("click",this.click_handler,this.dom,this,"titlebar");
n.on("click",this.click_handler,this.mdom,this,"menubar");
this.preview=null;
this.ev=new IMO.Event();
this.on(q);
};
Y.mix(IMO.WM.Tabbed.TitleBar.prototype,IMO.EventTarget);
Y.mix(IMO.WM.Tabbed.TitleBar.prototype,{set_title:function(q){n.replace_content(this.title,n(q));
n.replace_content(this.mtitle,n(q));
},set_icon:function(q){n.css(this.icon,{cls:"icon sprite_"+q});
n.css(this.micon,{cls:"icon sprite_"+q});
},hidden_left:function(q,r){return(this.dom.offsetLeft+this.dom.offsetWidth<q);
},hidden_right:function(q,r){return(this.dom.offsetLeft>q+r);
},set_attention:function(){if(this.win.att_data.messages>0||this.win.att_data.icon_dom){if(!this.attentive){this.attentive=true;
this.win.wm.tabbar.recalc_attention();
}}else{if(this.attentive){this.attentive=false;
this.win.wm.tabbar.recalc_attention();
}}f.foreach([this.dom,this.mdom],function(s){n.toggle_class(s,"attention",this.win.need_att);
},this);
if(this.win.att_data.icon_dom!==null){var r=this.win.att_data.icon_dom.cloneNode(true);
n.replace_content(this.att,this.win.att_data.icon_dom);
n.replace_content(this.matt,r);
n.cshow(this.att);
n.cshow(this.matt);
}else{if(this.win.att_data.messages>0){var u=function(s){return"sprite_"+s;
};
var v=this.win.att_data.messages;
var t=v<10?"badge":"badge_expand";
var q=v<100?h("%d",v):"+\u221E";
var w=[u("badge"),u("badge_expand")];
n.replace_content(this.att,n.span(q));
n.replace_content(this.matt,n.span(q));
n.mex_class(this.att,u(t),w);
n.mex_class(this.matt,u(t),w);
n.cshow(this.att);
n.cshow(this.matt);
}else{n.chide(this.att);
n.chide(this.matt);
}}},set_focus:function(q){f.foreach([this.dom,this.mdom],function(r){n.toggle_class(r,"focused",q);
});
this.hide_preview();
},set_preview:function(s){this.hide_preview();
var q=Y.DOM.getXY(this.dom);
var r=Y.DOM.getXY(this.dom.parentNode.parentNode);
if(r[0]>q[0]||r[0]+this.dom.parentNode.parentNode.offsetWidth<q[0]+Math.floor(this.dom.offsetWidth/2)||IMO.WM.TWM.not_hidden===this.win){return;
}this.preview=IMO.REUI.MessagePreview(s);
n.on("click",this.handle_preview_click,this.preview,this);
n.set_off(this.preview,f.vadd(q,[0,c.titlebar_height+c.sprite_tooltip2_arrow_height-10]));
n.dom("imo").appendChild(this.preview);
this.preview_cb=Y.later(j,this,this.hide_preview);
},on_tabbar_move:function(){this.hide_preview();
},hide_preview:function(){if(!this.preview){return;
}this.preview_cb.cancel();
this.preview_cb=null;
n.remove(this.preview);
this.preview=null;
},handle_preview_click:function(q){if(q.target._node.nodeName.toLowerCase()==="a"){IMO.MouseManager.get().handled(q,"messagepreview-link");
return;
}IMO.MouseManager.get().handled(q,"messagepreview");
this.win.set_focus();
},click_handler:function(s,r){if(r==="titlebar"||r==="menubar"){var q=IMO.MouseManager.get().check_handled("twm-titlebar-close");
if(q){return;
}this.win.wm.window_focus(this.win);
if(r==="menubar"){IMO.WM.TWM.tabbar.menu_used();
}}else{if(r==="close"){this.win.fire("on_close_request");
}}IMO.MouseManager.get().handled(s,"twm-titlebar-"+r);
},destroy:function(){this.hide_preview();
if(this.attentive){this.win.wm.tabbar.recalc_attention();
}}});
IMO.WM.Tabbed.WindowManager=function(){this.opened_windows=new f.CList();
this.focused_window=null;
this.last_focused=null;
this.not_hidden=null;
this.focused_node=null;
this.tabbar=new IMO.WM.Tabbed.TabBar();
this.content=n.div({"class":"content"});
this.not_hidden=null;
};
Y.mix(IMO.WM.Tabbed.WindowManager.prototype,IMO.EventTarget);
Y.mix(IMO.WM.Tabbed.WindowManager.prototype,{decorate:function(q){Y.one(q).append(this.tabbar.dom).append(this.content);
this.browser_resize_evt_id=n.on("resize",this.handle_browser_resize,window,this);
},undecorate:function(){this.browser_resize_evt_id.detach();
delete this.browser_resize_evt_id;
n.remove(this.tabbar.dom);
n.remove(this.content);
},release:function(){if(this.focused_window){this.focused_window.focused=true;
}var q=this.focused_window||this.not_hidden;
if(q){l(q);
}this.opened_windows.each(function(r){this.tabbar.remove_tab(r.ui.titlebar);
this.window_undecorate(r);
},this);
n.empty(this.content);
this.opened_windows.clear();
this.focused_window=null;
this.not_hidden=null;
this.focused_node=null;
this.undecorate();
},aquire:function(s,q){this.decorate(s);
var r=null;
f.foreach(q,function(t){if(t.focused!==undefined){r=t;
delete t.focused;
}this.window_decorate(t);
this.tabbar.add_tab(t.ui.titlebar);
t.ui.titlebar.set_attention();
l(t);
this.content.appendChild(t.ui.main);
this.opened_windows.add_before(t);
},this);
if(r!==null){this.window_focus(r);
}else{if(!this.opened_windows.count_eq(0)){this.not_hidden=this.opened_windows.head.data;
e(this.not_hidden);
this.not_hidden.fire("on_resize");
}}},window_decorate:function(q){q.wm=this;
q.ui.titlebar=new IMO.WM.Tabbed.TitleBar(q,this.tabbar);
q.ui.titlebar.set_title(q.title);
q.ui.main=n.div({"class":"windowbody"});
q.ui.click_evt_id=n.on("click",this.handle_window_click,q.ui.main,this);
q.ui.main.appendChild(q.content);
},window_undecorate:function(q){if(q===this.not_hidden){l(this.not_hidden);
this.not_hidden=null;
}q.ui.titlebar.destroy();
delete q.ui.titlebar;
q.wm=null;
q.ui.click_evt_id.detach();
delete q.ui.click_evt_id;
n.remove(q.content);
delete q.ui.main;
},window_open:function(q){this.window_decorate(q);
l(q);
this.tabbar.add_tab(q.ui.titlebar);
this.content.appendChild(q.ui.main);
this.opened_windows.add_before(q);
if(this.opened_windows.count_eq(1)){this.not_hidden=q;
e(q);
q.fire("on_resize");
}},window_close:function(r){Y.log("window close");
var s;
n.remove(r.ui.main);
this.tabbar.remove_tab(r.ui.titlebar);
var q=false;
if(r.get_focus()===true||this.not_hidden===r){q=true;
}this.opened_windows.remove(this.opened_windows.find(r));
this.window_undecorate(r);
Y.log(["change focus?",q]);
if(q){this.focused_window=null;
this.focus_next();
}r.fire("on_close");
},window_set_title:function(q,r){q.ui.titlebar.set_title(r);
},window_set_icon:function(r,q){r.ui.titlebar.set_icon(q);
},window_set_attention:function(r,q){r.ui.titlebar.set_attention();
r.fire("on_set_attention",q);
},window_set_preview:function(q,r){q.ui.titlebar.set_preview(r);
},window_get_focus:function(q){return q===this.focused_window;
},focus:function(){},focus_next:function(){if(this.opened_windows.count_eq(0)||this.opened_windows.count_eq(1)&&this.focused_window){return;
}if(this.focused_window===null){if(this.not_hidden!==null){this.not_hidden.set_focus();
}else{Y.log("focusing a random window");
this.opened_windows.head.data.set_focus();
}return;
}var q=this.opened_windows.each(function(r){if(r.need_att){return r;
}},null,this.focused_node.right,this.opened_windows.head);
if(!q){q=this.focused_node.right.data;
}q.set_focus();
},focus_prev:function(){if(this.opened_windows.count_eq(0)||this.opened_windows.count_eq(1)&&this.focused_window){return;
}var r=this.focused_node;
if(this.focused_window===null){if(this.not_hidden===null){Y.log("no focus, no not_hidden, some windows ...","error");
return;
}r=this.opened_windows.find(this.not_hidden);
}var q=this.opened_windows.each(function(s){if(s.need_att){return s;
}},null,r.left,this.opened_windows.head.left,-1);
if(!q){q=r.left.data;
}q.set_focus();
},window_focus:function(q){f.log("window_focus(%s), focused_window=%s",q&&q.title,this.focused_window&&this.focused_window.title);
this.last_focused=this.focused_window;
if(q===this.focused_window){return;
}if(this.focused_window!==null){this.focused_window.ui.titlebar.set_focus(false);
l(this.focused_window);
this.focused_window.fire("on_focus_change",false);
}if(q!==null){if(this.not_hidden){l(this.not_hidden);
this.not_hidden=null;
}q.ui.titlebar.set_focus(true);
e(q);
this.tabbar.ensure_visible(q.ui.titlebar);
q.fire("on_focus_change",true);
q.fire("on_resize");
this.focused_node=this.opened_windows.find(q);
}else{this.focused_node=null;
if(this.focused_window!==null){if(this.not_hidden!==null){throw"VERY BAD!! - we have another not_hidden window";
}e(this.focused_window);
this.not_hidden=this.focused_window;
}}this.focused_window=q;
},window_refocus:function(){var q=this.focused_window;
if(q!==null){q.ui.titlebar.set_focus(true);
this.tabbar.ensure_visible(q.ui.titlebar);
q.fire("on_focus_change",true);
q.fire("on_resize");
}},handle_window_click:function(q){IMO.MouseManager.get().handled(q,"window");
},handle_browser_resize:function(q){this.handle_resize_fast();
},handle_resize_fast:function(){this.tabbar.handle_resize_fast();
var q=this.focused_window||this.not_hidden;
if(q){q.fire("on_resize");
}this.tabbar.handle_resize();
}});
}());
(function(){var b=IMO.Utils;
var d=b.HTML;
var f=1000;
var e=document.getElementsByTagName("head")[0];
var c=["images/favicon.ico","images/favicon_orange.ico"];
var a=0;
IMO.TitleNotifier=function(){this.msgs=[];
this.blue_count=0;
var g=e.getElementsByTagName("link");
b.foreach(g,function(h){if(h.type!=="image/x-icon"){return;
}if(h.rel==="icon"){this.icon1=h;
}if(h.rel==="shortcut icon"){this.icon2=h;
}},this);
};
Y.mix(IMO.TitleNotifier.prototype,{add:function(h){var g=IMO.Session.get().get_pref("impref","title_notifier",{ignore:false});
if(g.ignore===true){return;
}Y.log("title_notifier.add");
this.msgs.push(h);
if(!this.changer){this.changer=Y.later(f,this,this.timer_cb,[],true);
}this.timer_cb();
return h;
},remove:function(g){b.log("title_notifier.remove_node(%r)",g);
if(g){b.remove(this.msgs,g);
this.timer_cb();
}},timer_cb:function(){if(this.msgs.length===0){this.favicon_change("images/favicon.ico");
document.title="imo";
this.blue_count++;
if(this.blue_count>5){this.blue_count=0;
if(this.changer){this.changer.cancel();
this.changer=null;
}}return;
}if(a>=this.msgs.length){document.title="imo";
this.favicon_change(c[a%c.length]);
a=0;
return;
}this.msgs.unshift(this.msgs.pop());
var g=this.msgs[0];
document.title=g();
this.blue_count=0;
this.favicon_change(c[a%c.length]);
a++;
},favicon_change:function(g){Y.later(10,this,function(){this.icon1.href=g;
this.icon2.href=g;
});
},add_link:function(h,g){var i=d.link({type:"image/x-icon",rel:g,href:h});
e.appendChild(i);
return i;
}});
IMO.make_singleton(IMO.TitleNotifier);
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.WebcamCapture=function(c){this.ev=new IMO.Event();
this.swf_dom=c;
};
Y.mix(IMO.WebcamCapture.prototype,IMO.EventTarget);
Y.mix(IMO.WebcamCapture.prototype,{open:function(){this.swf=new IMO.FlashWidget(IMO.SWF("webcampic"));
this.on(this.swf);
this.swf.init();
this.on_image_frozen(false);
},close:function(){this.on_image_frozen(false);
this.unsubscribe(this.swf);
this.swf.destroy();
delete this.swf;
},freeze:function(){this.snapshot=this.swf.call("snapshot","jpg");
this.on_image_frozen(true);
},live:function(){delete this.snapshot;
this.swf.call("live");
this.on_image_frozen(false);
},on_image_frozen:function(c){this.is_frozen=c;
this.ev.fire("on_can_capture_change",this,c);
},on_as_init:function(){this.swf.show(this.swf_dom);
this.on_image_frozen(false);
this.ev.fire("on_swf_init",this);
},on_embed:function(){this.ev.fire("on_swf_embed",this);
},on_embed_fail:function(){this.ev.fire("on_swf_embed_fail",this);
}},true);
}());
(function(){var a=IMO.Utils;
var b=a.TranslateTxt;
if(!IMO.WM){IMO.WM={};
}IMO.WM.Window=function(){this.content=null;
this.title="";
this.icon="";
this.need_att=false;
this.att_data={messages:0,icon_dom:null};
this.size={min:[NaN,NaN],max:[NaN,NaN]};
this.visible=false;
this.is_open=false;
this.attn_func=null;
this.ui={};
this.ev=new IMO.Event();
};
Y.mix(IMO.WM.Window.prototype,IMO.EventTarget);
Y.mix(IMO.WM.Window.prototype,{get_focus:function(){return this.wm.window_get_focus(this);
},set_focus:function(){if(this.get_focus()){return;
}this.wm_do("focus");
},set_title:function(c){this.title=c;
this.wm_do("set_title",c);
},set_icon:function(c){this.icon=c;
this.wm_do("set_icon",c);
},set_content:function(c){this.content=c;
this.wm_do("set_content",c);
},set_attention:function(d,c){var f=this.need_att;
this.att_data.messages=d;
this.need_att=d>0;
if(c){IMO.TitleNotifier.get().remove(this.attn_func);
this.attn_func=c;
}if(!f&&this.need_att){IMO.TitleNotifier.get().remove(this.attn_func);
if(!this.attn_func){var e=this;
this.attn_func=function(){return a.sprintf("(%s) (%s)",e.att_data.messages,e.title);
};
}IMO.TitleNotifier.get().add(this.attn_func);
}if(!this.need_att){IMO.TitleNotifier.get().remove(this.attn_func);
}this.wm_do("set_attention",this.att_data);
},set_attention_icon:function(c){this.att_data.icon_dom=c;
this.need_att=!this.get_focus()&&c!==null;
this.wm_do("set_attention",this.att_data);
},set_preview:function(c){if(!this.get_focus()){this.wm_do("set_preview",c);
}},on_after_content_visibility_change:function(c){this.visible=c;
},wm_do:function(d){var c=Array.prototype.slice.call(arguments,1);
c.unshift(this);
if(this.wm&&typeof this.wm["window_"+d]==="function"){return this.wm["window_"+d].apply(this.wm,c);
}return null;
},fire:function(){var c=Array.prototype.slice.call(arguments);
if(this[c[0]]){this[c[0]].apply(this,c.slice(1));
}c.splice(1,0,this);
this.ev.fire.apply(this.ev,c);
},open:function(){if(this.is_open){return;
}IMO.WM.B.window_open(this);
this.is_open=true;
},close:function(){IMO.WM.B.window_close(this);
this.is_open=false;
},resize:function(){var c=Array.prototype.slice.call(arguments,0);
c.unshift("resize");
this.wm_do.apply(this,c);
},destroy:function(){IMO.TitleNotifier.get().remove(this.attn_func);
}});
}());
(function(){var a=IMO.Utils;
IMO.REUI=function(){this.ev=new IMO.Event();
this.state="";
this.query=null;
this.main={};
this.imo=null;
this._mnp_shown=false;
this.set_state("splash_loading");
};
Y.mix(IMO.REUI.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.prototype,{set_state:function(b){var c=this.state;
this.state=b;
a.log("Now in UI state %s",b);
this.ev.fire("on_state_change",c,b);
}});
}());
(function(){var h=IMO.Utils;
var k=h.HTML;
var l=h.TranslateDom;
var j=h.TranslateTxt;
var d=IMO.Constants;
var e;
var a;
var c;
var b;
var f;
var i=function(){this.prims=[d.PRIM_AVAILABLE,d.PRIM_AWAY,d.PRIM_BUSY,d.PRIM_INVISIBLE];
this.dd=new IMO.UIWidgets.Menu({context:this},this.sprite=k.sprite("imo_available"),k.sprite("icn_arrdown_s",{cls:"arrow"}));
h.foreach(this.prims,function(m,o){var n=m==="invisible"?"offline":m;
this.dd.add_option([k.sprite("imo_"+n),l(m)],function(){IMO.Session.get().set_status({primitive:m});
});
},this);
this.dd.add_option([this.auto_away=k.input({id:"account-prim-auto",type:"checkbox",checked:IMO.Session.get().auto_away,context:this,oncbchange:function(){Y.later(0,this,this.on_auto_away);
}}),k.label({"for":"account-prim-auto"},l("Auto set away when idle"))],function(){return false;
});
this.dom=k.cspan("primitive_container",this.dd.dom);
this.on(IMO.Session.get());
};
Y.mix(i.prototype,IMO.EventTarget);
Y.mix(i.prototype,{on_auto_away:function(){IMO.Session.get().set_status({auto_away:this.auto_away.checked});
},on_status:function(m,q,p,o){var n=m==="invisible"?"offline":m;
this.sprite.className="sprite_imo_"+n;
this.auto_away.checked=o;
}});
var g=function(){this.dom=k.span({cls:"account-status",context:this,onclick:function(m){IMO.MouseManager.get().handled(m,"statusmsg-popup");
this.show_input();
}},this.status=k.span(this._format_status(IMO.Session.get().status)));
this.popup=k.div({cls:"statusmsg-popup shadow",onclick:function(m){IMO.MouseManager.get().handled(m,"statusmsg-popup");
}},k.div({cls:"input-container inner-shadow"},this.input=k.textarea({rows:"1",context:this,onkeypress:this.on_input_change}),k.div({cls:"line"}),this.add_imo=k.input({type:"checkbox",id:"statusmsg-add"}),k.label({"for":"statusmsg-add"},l("Add https://imo.im to my status"))),k.div({cls:"buttons"},(new IMO.UIWidgets.Button2("Set",{onclick:this.on_click_set,context:this})).dom,k.a({href:"#"},l("Cancel"),{context:this,onclick:function(){k.hide(this.popup);
}})));
k.hide(this.popup);
k.on("key",this.on_click_set,this.input,"press:13",this);
this.on(IMO.Session.get());
IMO.MouseManager.get().register(this.on_mouse,this);
};
Y.mix(g.prototype,IMO.EventTarget);
Y.mix(g.prototype,{on_mouse:function(){if(!IMO.MouseManager.get().check_handled("statusmsg-popup")){k.hide(this.popup);
}},on_status:function(n,m,p,o){k.replace_content(this.status,k(this._format_status(m)));
this.add_imo.checked=p?true:false;
},show_input:function(){this.input.value=IMO.Session.get().status;
k.show(this.popup);
this.input.focus();
this.input.select();
this.input.setAttribute("rows","1");
},on_input_change:function(){var m;
if(this.input.scrollHeight>this.input.clientHeight){m=parseInt(this.input.getAttribute("rows"),10);
this.input.setAttribute("rows",""+(m+1));
}},on_click_set:function(){k.hide(this.popup);
IMO.Session.get().set_status({status:this.input.value,ad:(this.add_imo.checked?j("on https://imo.im"):"")});
},_format_status:function(m){return(m||j("Set status..."))+"\u00a0";
},set_status:function(){}});
IMO.REUI.AccountBar=function(){this.dom=k.div({id:"account-bar"},this.account_gear=k.div({cls:"account-gear",id:"account-gear"},this.counter_span=k.span("0/0"),this.gears_icn=k.sprite("icn_cog"),{context:this,onclick:function(r){IMO.MouseManager.get().handled(r,"account-console");
this.toggle_account_console();
}}),(this.account_icon_display=new IMO.REUI.AccountIconDisplay()).dom,(this.prim=new i()).dom,(this.statusmsg=new g()).dom,(this._account_console=new f()).dom,this.statusmsg.popup);
var o=this;
var n=function(){var s=0;
var r=0;
h.foreach(IMO.Session.get().accounts,function(t){r++;
if(t.state===d.IM_STATE_ONLINE){s++;
}});
k.replace_content(o.counter_span,k(h.sprintf("%s/%s",s,r)));
o._account_console.update();
};
var p=null;
var q=function(){if(p){return;
}p=Y.later(20,this,function(){p=null;
n();
});
};
this.disconnect_notifications={};
var m={on_state_change:function(r){q();
},on_signed_on:function(r){o.clear_notification(r);
},on_disconnect:function(t,v){var u=v.edata["reason"];
var r=IMO.UserFriendlyReason(u,t);
if(r){o.clear_notification(t);
var s=IMO.REUI.Notification.types.error;
if(u==="reconnecting"){s=IMO.REUI.Notification.types.info;
}var w=IMO.NM.add_notification(r,s,{momentary:false});
o.disconnect_notifications[t.id]=w;
}}};
IMO.EventTarget.on(IMO.Session.get(),{on_create_account:function(r){q();
IMO.EventTarget.on(r,m);
},on_remove_account:function(r){q();
IMO.EventTarget.unsubscribe(r,m);
},on_linked_account:function(r){q();
}});
q();
IMO.MouseManager.get().register(function(){if(!IMO.MouseManager.get().check_handled("account-console","hover","hover-account-alias-edit")){this.hide_account_console();
}},this);
};
Y.mix(IMO.REUI.AccountBar.prototype,{clear_notification:function(m){if(this.disconnect_notifications[m.id]){IMO.NM.remove_notification(this.disconnect_notifications[m.id]);
delete this.disconnect_notifications[m.id];
}},show_account_console:function(){k.add_class(this.account_gear,"open");
k.mex_class(this.gears_icn,"sprite_icn_cog_inv",["sprite_icn_cog","sprite_icn_cog_inv"]);
this._account_console.show();
},hide_account_console:function(){k.remove_class(this.account_gear,"open");
k.mex_class(this.gears_icn,"sprite_icn_cog",["sprite_icn_cog","sprite_icn_cog_inv"]);
this._account_console.hide();
},toggle_account_console:function(){if(this._account_console.visible){this.hide_account_console();
}else{this.show_account_console();
}}});
f=function(){this.visible=false;
this.dom=k.div({id:"account-console",cls:"shadow",onclick:function(m){IMO.MouseManager.get().handled(m,"account-console");
}},k.div({cls:"account-header"},(this.add_btn=new IMO.UIWidgets.Button2("Add",{onclick:IMO.REUI.Accounts.show_account_login},{cls:"fr"})).dom,k.h2(l("Accounts"))),this.lg_help=k.div({cls:"cr account-link"},(this.link_btn=new IMO.UIWidgets.Button2("Link",{onclick:IMO.Session.get().link_accounts},{cls:"fr"})).dom,k.h3(l("Link accounts together?")),l(IMO.Texts.LINKING_HELP)),this.lg_container=k.div((this.link_groups=new e()).dom),k.div({cls:"action",context:this,onclick:function(m){m.preventDefault();
this.hide();
IMO.REUI.AllSessions.show();
}},k.a({href:"#"},l("Sessions"))),k.div({cls:"action",context:this,onclick:function(m){m.preventDefault();
this.hide();
IMO.REUI.Preferences.show();
}},k.a({href:"#"},l("Preferences"))),this.premium_account=k.div({cls:"action",context:this,onclick:function(m){m.preventDefault();
this.hide();
IMO.REUI.PremiumAccount.show();
}},k.a({href:"#"},l("Premium Account"))),k.div({cls:"action",onclick:function(n){n.preventDefault();
var m=700;
if(window.navigator&&window.navigator.userAgent&&(/CrOS/.test(window.navigator.userAgent))){m=450;
}window.open("/?thinui","_blank","height="+m+",width=266,location=no,menubar=no,scrollbars=no,toolbar=no");
window.location="/popped_out.html";
}},k.a({href:"#"},l("Pop out imo"))),k.div({cls:"action signout",context:this,onclick:function(m){m.preventDefault();
this.hide();
IMO.Session.get().signoff();
}},k.a({href:"#"},l("Sign out"))));
this.tooltipmanager=new IMO.REUI.AccountTooltipManager(this.dom);
k.hide(this.dom);
};
Y.mix(f.prototype,IMO.EventTarget);
Y.mix(f.prototype,{show:function(){k.show(this.dom);
this.visible=true;
this.ensure_visible();
},hide:function(){k.hide(this.dom);
this.visible=false;
},toggle:function(){if(this.visible){this.hide();
}else{this.show();
}},update:function(){k.remove(this.link_groups.dom);
this.link_groups.destroy();
var m=IMO.Session.get().get_accounts_by_link_group_imo_first();
if(m.length===1){k.hide(this.lg_help);
}else{k.show(this.lg_help);
}k.replace_content(this.lg_container,(this.link_groups=new e(m)).dom);
this.ensure_visible();
},ensure_visible:function(){k.css(this.dom,{height:"auto",overflow:""});
Y.later(10,this,function(){var n=k.get_rect(this.dom).h;
var m=k.get_rect(k.dom("imo")).h-d.reui_header_height;
if(n>m){k.css(this.dom,{height:(m+"px"),overflow:"auto"});
}});
}});
e=function(m){this.dom=k.div({cls:"accounts-list"});
this.link_groups=[];
h.foreach(m,function(o){var n=new a(o);
this.dom.appendChild(n.dom);
this.link_groups.push(n);
},this);
};
Y.mix(e.prototype,{destroy:function(){h.foreach(this.link_groups,function(m){m.destroy();
});
this.link_groups=[];
k.empty(this.dom);
this.dom=null;
}});
a=function(n){this.dom=k.div({cls:"account-link-group"});
this.link_group=n;
this.account_items=[];
var m=null;
h.foreach(n.accounts,function(p){var o;
switch(p.constructor){case IMO.IMOAccount:o=new b(p);
m=o;
break;
default:o=new c(p);
break;
}this.dom.appendChild(o.dom);
this.account_items.push(o);
},this);
if(m&&this.dom.firstChild){this.dom.insertBefore(m.dom,this.dom.firstChild);
}};
Y.mix(a.prototype,{destroy:function(){h.foreach(this.account_items,function(m){m.destroy();
});
this.account_items=[];
k.empty(this.dom);
this.dom=null;
}});
c=function(n){this.account=n;
this.on(n);
var m=null;
switch(n.state){case d.IM_STATE_ONLINE:m=k.sprite("switcher_on",{cls:"switcher",onclick:function(){n.logout();
}});
break;
case d.IM_STATE_CONNECTING:case d.IM_STATE_DISCONNECTING:m=k.img({src:"assets/loading_16.gif",cls:"switcher"});
break;
case d.IM_STATE_OFFLINE:m=k.sprite("switcher_off",{cls:"switcher",onclick:function(){n.relogin();
}});
break;
default:break;
}this.dom=k.div({cls:"account-item","data-account":n.id},this.toggle=m,this.img=k.sprite(n.get_proto_icon(),{cls:"account-icon"}),this.name=k.span(n.get_display_name()));
};
Y.mix(c.prototype,IMO.EventTarget);
Y.mix(c.prototype,{destroy:function(){k.empty(this.dom);
this.dom=null;
this.unsubscribe(this.account);
},on_change_alias:function(m){this.account.alias=m;
k.replace_content(this.name,k(this.account.get_display_name()));
},on_show_pin_tutorial:function(){Y.later(1000,this,IMO.REUI.APP.MeetUtils.show_pin_tutorial);
}});
b=function(m){b.superclass.constructor.call(this,m);
this.dom.appendChild(k.div({cls:"imoaccount"},k.a({href:"#",onclick:this.click_profile,context:this},l("Edit Public Profile")),k.a({id:"accountconsole-cp",onclick:function(n){IMO.REUI.PIN.CPHelpPopup.show();
}},this.cp=k.span({cls:"cp"}),this.cp_text=k.span("CP"))));
this.on_comm_points_left_changed(m.cnt_comm_points_left,m.cnt_max_comm_points);
};
Y.extend(b,c);
Y.mix(b.prototype,{click_profile:function(){IMO.REUI.PIN.ProfileEdit.show();
},on_comm_points_left_changed:function(n,m){k.replace_content(this.cp,k(h.sprintf("%s/%s",n||"?",m||"?")));
}});
}());
(function(){var a=IMO.Utils;
var e=a.HTML;
var d=a.sprintf;
var f=IMO.Constants;
var c=10;
var b=15;
IMO.REUI.TooltipManager=function(g){this.dom=g;
this.timer=null;
this.out_timer=null;
this.hovering_dom=null;
this.enabled=true;
this.tooltip=new IMO.REUI.Tooltip();
this.tooltip.decorate(IMO.REUI.Tooltip.LEFT,this.tooltip_arrow_sprite,1);
this.last_dom_xy=[NaN,NaN];
e.chide(this.tooltip.dom);
this.need_reenter=false;
this.ev=new IMO.Event();
e.on("mouseover",this.handle_mouse_over,this.dom,this);
e.on("mouseout",this.handle_mouse_out,this.dom,this);
e.on("mouseover",this.handle_tt_over,this.tooltip.dom,this);
e.on("mouseout",this.handle_tt_out,this.tooltip.dom,this);
e.on("click",this.handle_tt_click,this.tooltip.dom,this);
e.on("mousedown",this.handle_tt_md,this.tooltip.dom,this);
};
Y.mix(IMO.REUI.TooltipManager.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.TooltipManager.prototype,{tooltip_arrow_sprite:"profile_popover_arrow",min_arr_bottom:f.reui_buddyhover_buttons_h+f.sprite_profile_popover_arrow_height+2,disable_tt:function(g){this.enabled=false;
if(!g){this.tooltip.hide();
}},enable_tt:function(){this.enabled=true;
},hide_current:function(g){if(this.tooltip.shown){this.tooltip.hide();
if(g){this.need_reenter=true;
}}},is_an_item:function(g){throw"not_implemented_error is_an_item";
},handle_hover:function(g){throw"not_implemented_error handle_hover";
},handle_mouse_over:function(h){if(!this.enabled){return;
}var g;
for(g=h.target._node;
g&&g!==this.dom&&!this.is_an_item(g);
g=g.parentNode){}if(!g||!this.is_an_item(g)){return;
}this.stop_timer();
if(g!==this.hovering_dom){this.need_reenter=false;
this.hovering_dom=g;
this.handle_hover(g);
this.position_tt(true,true);
}else{if(!this.need_reenter){this.position_tt(false,!this.tooltip.shown);
}else{this.stop_out_timer();
}}},handle_mouse_out:function(g){this.reset_timer();
if(this.need_reenter){this.reset_out_timer();
}},handle_tt_over:function(g){this.stop_timer();
},handle_tt_out:function(g){this.reset_timer();
},handle_tooltip_mousedown:function(){throw"not_implemented_error handle_tooltop_mousedown";
},handle_tt_md:function(g){if(this.handle_tooltip_mousedown()){this.skip_tt_click=true;
}},handle_tt_click:function(g){if(!this.enabled){return;
}if(this.skip_tt_click){this.skip_tt_click=false;
return;
}if(a.get_text_selection()!==""){return;
}this.ev.fire("on_tt_click",this);
},stop_timer:function(){if(this.timer!==null){this.timer.cancel();
this.timer=null;
}},reset_timer:function(){this.stop_timer();
this.timer=Y.later(c,this,this.handle_timer);
},handle_timer:function(){if(!this.enabled){return;
}this.tooltip.hide();
},stop_out_timer:function(){if(this.out_timer!==null){this.out_timer.cancel();
this.out_timer=null;
}},reset_out_timer:function(){this.stop_out_timer();
this.out_timer=Y.later(b,this,this.handle_out_timer);
},handle_out_timer:function(){this.need_reenter=false;
},handle_position_tt:function(j,g,k,i,h){throw"not_implemented_error handle_position_tt";
},position_tt:function(l,h){var g=Y.DOM.getXY(this.hovering_dom);
if(!l&&g[1]===this.last_dom_xy[1]){e.cshow(this.tooltip.dom);
this.tooltip.shown=true;
return;
}this.last_dom_xy=g;
var j=e.get_size(this.hovering_dom);
if(!this.tooltip.dom.parentNode||!this.appended){this.appended=true;
e.dom("imo").appendChild(this.tooltip.dom);
}e.cshow(this.tooltip.dom);
var k=[this.tooltip.dom.clientWidth,this.tooltip.dom.clientHeight];
var i=this.handle_position_tt(g,j,[0,0],k,h);
var n=i.tt_pos;
var m=i.arr_pos;
e.css(this.tooltip.dom,n);
e.css(this.tooltip.dom,{z_index:IMO.Constants.reui_buddyhover_zindex});
e.css(this.tooltip.arrow,m);
this.tooltip.shown=true;
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var c=a.sprintf;
var b=IMO.Utils.TranslateDom;
var f=IMO.Utils.TranslateTxt;
var g=IMO.Constants;
var e=function(h){return(String(parseInt(h))===h);
};
IMO.REUI.AccountHover=function(m,j){this.account=m;
this.manager=j;
this.editable=(m.proto===g.PROTO_MSN||m.proto===g.PROTO_YAHOO||m.proto===g.PROTO_STEAM||(m.proto===g.PROTO_AIM&&e(m.uid)));
this.alias=d.cspan("alias",this.editable&&d.sprite("icn_edit",{onclick:this.show_edit_alias,context:this}),this.alias_div=d.cspan(this.editable?"editable_alias":"alias",m.get_display_name(),{onclick:this.show_edit_alias,context:this}),this.alias_input=this.editable&&d.input({"class":"editable_alias",onblur:this.rename,context:this,onclick:this.show_edit_alias,onkeydown:function(n){if(n.keyCode===13){this.rename();
}}}),d.cdiv("clear"));
d.hide(this.alias_input);
var l=d.div({cls:"bhover_button",context:this,onclick:this.unlink_click},d.sprite("icn_link_smaller"),d.span({"class":"btn_text"},b("Unlink Account")));
var k=[];
if(m.link_group.size()>1){k.push(l);
}var i=b("buddies:");
var h=d.cdiv("detail",d.cspan("key",b("uid:")),d.cspan("value",m.uid));
if(this.account.proto===g.PROTO_IMO){i=b("contacts:");
h=null;
}this.text_details_div=d.cdiv("text_details",d.cdiv("alias",d.sprite(this.account.protoicon),this.alias),h,d.cdiv("detail",d.cspan("key",i),d.cspan("value",m.buddies_list.length.toString())));
this.buttons_div=d.cdiv("buttons",k,d.cdiv("clear"));
this.dom=d.div({cls:"accounthover"},this.text_details_div,this.buttons_div);
};
Y.mix(IMO.REUI.AccountHover.prototype,{unlink_click:function(h){IMO.Session.get().unlink_single_account(this.account);
this.account.link_group.remove(this.account);
},delete_click:function(i){Y.log("delete_account");
var h=this;
this.popup=new IMO.REUI.ConfirmModalPopup("Delete your imo account?",f("Deleting your imo account. Are you sure?"),[[b("Yes"),"blue"],[b("No"),"grey"]],function(j){if(j===0){h.account.delete_account();
}h.popup.destroy();
},this);
},show_edit_alias:function(h){IMO.MouseManager.get().handled(h,"hover-account-alias-edit");
if(!this.editable){return;
}d.hide(this.alias_div);
d.show(this.alias_input);
this.alias_input.value=this.account.get_display_name();
this.alias_input.select();
this.editing=true;
this.manager.disable_tt(true);
},rename:function(){if(!this.editable){return;
}var h=this.alias_input.value||this.account.get_display_name();
d.replace_content(this.alias_div,d(h));
d.hide(this.alias_input);
d.show(this.alias_div);
this.account.set_display_name(h);
this.manager.enable_tt();
},destroy:function(){delete this.account;
delete this.dom;
}});
IMO.REUI.AccountTooltipManager=function(h){IMO.REUI.AccountTooltipManager.superclass.constructor.call(this,h);
};
Y.extend(IMO.REUI.AccountTooltipManager,IMO.REUI.TooltipManager);
Y.mix(IMO.REUI.AccountTooltipManager.prototype,{tooltip_arrow_sprite:"profile_popover_arrow",is_an_item:function(h){return(Y.DOM.hasClass(h,"account-item"));
},handle_hover:function(h){var i=a.foreach(IMO.Session.get().get_accounts(),function(j){if(h.getAttribute("data-account")===j.id){return j;
}},this);
if(!i){return;
}if(this.hover){this.hover.destroy();
}this.hover=new IMO.REUI.AccountHover(i,this);
this.tooltip.set_content(this.hover.dom);
},handle_tooltip_mousedown:function(){return document.activeElement===this.hover.alias_input;
},handle_position_tt:function(k,h,l,j,i){return{arr_pos:{top:(j[1]/2-3)+"px"},tt_pos:{top:(k[1]+10-(j[1]/2))+"px",left:(k[0]-j[0])+"px"}};
}},true);
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var b=a.TranslateDom;
var e=a.TranslateTxt;
var f;
var c=["account-icon-display"];
IMO.REUI.AccountIconDisplay=function(){this.dom=d.span({cls:"account-icon-display"},this.img=d.img({cls:"account-icon-image tall-img",src:IMO.AccountManager.get().current_account_icon_url,alt:e("Change display picture"),title:e("Change display picture"),onclick:function(g){IMO.MouseManager.get().handled(g,"accountitemdisplay-image");
IMO.REUI.AccountIconPanel.show();
}}));
this.on(IMO.AccountManager.get());
};
Y.mix(IMO.REUI.AccountIconDisplay.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.AccountIconDisplay.prototype,{on_set_account_icon:function(h){f=new Image();
var g=this;
f.onload=function(){var n=f.width;
var j=f.height;
var m={"padding-top":"0px","padding-bottom":"0px"};
d.remove_class(g.img,"wide-img");
d.remove_class(g.img,"tall-img");
d.css(g.img,m);
if(j>n){d.add_class(g.img,"tall-img");
}else{var i=IMO.Constants.reui_header_height;
var k=IMO.Constants.reui_header_height;
var o=i*j/n;
d.add_class(g.img,"wide-img");
var p=Math.floor((k-o)/2);
var l={"padding-top":p,"padding-bottom":p};
d.css(g.img,l);
}g.img.src=h;
};
f.src=h;
}});
}());
(function(){var c=IMO.Utils;
var j=c.HTML;
var k=IMO.Utils.TranslateDom;
var i=IMO.Utils.TranslateTxt;
var a=IMO.REUI.AccountIconPanel={};
var g=this;
var f=["jpg","gif","png","jpeg","bmp"];
var b="/u/";
var d=["upload","crop","submit","cancel"];
var h=function(){this.build_dom();
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[300,NaN]);
this.popup.set_title(i("Upload Profile Photo"));
this.popup.prepare();
this.on(IMO.AccountManager.get());
};
Y.mix(h.prototype,IMO.EventTarget);
Y.mix(h.prototype,{on_set_account_icon:function(l){this.set_upload_widget_image(l);
},show:function(){this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.canceled}},bottom:true,context:this});
this.set_upload_widget_image();
this.popup.show();
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.upForm.reset();
this.popup.hide();
},canceled:function(l){IMO.MouseManager.get().handled(l,"accounticonupload-cancel-button");
this.hide();
},upload_click:function(s){IMO.MouseManager.get().handled(s,"accounticonupload-upload-button");
s.preventDefault();
var n=this.picField.value;
var m=n.lastIndexOf(".");
if(m===-1){IMO.NM.add_notification(j.div(k("File type was not recognized - please try another file!")),IMO.REUI.Notification.types.error);
this.hide();
return;
}m+=1;
var q=n.substring(m,n.length).toLowerCase();
for(var p=0;
p<f.length;
p++){if(q===f[p]){break;
}}if(p===f.length){IMO.NM.add_notification(j.div(k("Sorry, we don't support that type of file - please try another file!")),IMO.REUI.Notification.types.error);
this.hide();
return;
}this.fileNameField.value=n;
Y.log("uploading picture: "+this.fileNameField.value);
var l={method:"POST",form:{id:this.upForm,upload:true},on:{complete:this.initial_upload_complete},context:this};
var o=b+"upload/";
var r=Y.io(o,l);
},initial_upload_complete:function(l,n,x){Y.log("upload complete. Response: "+n.responseText);
var s;
try{s=Y.JSON.parse(n.responseText);
}catch(w){Y.log("Bad response text: "+n.responseText);
IMO.NM.add_notification(j.div(k("There was an error uploading your account icon - please try again.")),IMO.REUI.Notification.types.error);
this.hide();
return;
}if(s.hasOwnProperty("result")){if(s.result==="success"){var m=s.width;
var y=s.width;
var p=s.uri;
var v=p.substring(p.lastIndexOf("/")+1,p.length);
var r=c.sprintf("t=%d&l=%d&w=%d&h=%d",0,0,m,y);
var q=c.sprintf("%scrop/%s?%s",b,v,r);
var u={method:"GET",on:{success:this.crop_success,failure:this.crop_failure},context:this};
var t=Y.io(q,u);
}else{if(s.error==="size"){IMO.NM.add_notification(j.div(k("The image you uploaded was too large - please choose a smaller image.")),IMO.REUI.Notification.types.error);
this.hide();
return;
}else{if(s.error==="invalid file"){IMO.NM.add_notification(j.div(k("The image you uploaded was not recognized - please choose a different image.")),IMO.REUI.Notification.types.error);
this.hide();
return;
}}}}},crop_success:function(n,p,x){Y.log("crop_success. response: "+p.responseText);
var s;
try{s=Y.JSON.parse(p.responseText);
}catch(v){Y.log("Bad response text: "+p.responseText);
IMO.NM.add_notification(j.div(k("There was an error uploading your account icon - please try again.")),IMO.REUI.Notification.types.error);
this.hide();
return;
}if("result" in s){var q=s.uri;
var w=q.substring(q.lastIndexOf("/")+1,q.length);
var y=IMO.Session.get().get_account_names();
var m=IMO.Network.get().ssid;
var l=c.sprintf("imageId=%s&ssid=%s&accounts=%s",w,m,Y.JSON.stringify(y));
var r=b+"submit/";
var u={method:"POST",data:l};
var t=Y.io(r,u);
IMO.NM.add_notification(j.div(k("Account icon successfully uploaded!")),IMO.REUI.Notification.types.info);
this.hide();
}},crop_failure:function(n,m,l){IMO.NM.add_notification(j.div(k("There was an error uploading your account icon - please try again.")),IMO.REUI.Notification.types.error);
this.hide();
},try_to_display_selected_image:function(){var m;
try{m=this.picField.files[0].getAsDataURL();
}catch(l){return;
}this.set_upload_widget_image(m);
},set_upload_widget_image:function(m){var l=this;
m=c.dfl(m,IMO.AccountManager.get().current_account_icon_url);
var n=new Image();
n.onload=function(){var t=n.width;
var p=n.height;
var s={"padding-top":"0px","padding-bottom":"0px"};
j.remove_class(l.current_account_icon_img,"wide-img");
j.remove_class(l.current_account_icon_img,"tall-img");
j.css(l.current_account_icon_img,s);
if(p>t){j.add_class(l.current_account_icon_img,"tall-img");
}else{var o=IMO.Constants.reui_account_icon_upload_container_size;
var q=IMO.Constants.reui_account_icon_upload_container_size;
var u=o*p/t;
j.add_class(l.current_account_icon_img,"wide-img");
var v=Math.floor((q-u)/2);
var r={paddingTop:v,paddingBottom:v};
j.css(l.current_account_icon_img,r);
}l.current_account_icon_img.src=m;
};
n.src=m;
},click_on_img:function(l){IMO.MouseManager.get().handled(l,"acciconupload-img");
this.picField.click();
},build_dom:function(){var l=this;
var m;
this.dom=j.cdiv("account-icon-upload-widget",j.div({cls:"account-icon-upload-text"},k("Select an image on your hard drive to use as your profile picture. This image will be associated with all your accounts while you are using imo.im.")),j.div({cls:"current-icon-container"},this.current_account_icon_img=j.img({cls:"account-icon-img",src:IMO.AccountManager.get().current_account_icon_url,onclick:this.click_on_img,context:this})),this.upForm=j.form({enctype:"multipart/form-data"},this.picField=j.input({cls:"file-select-form",type:"file",name:"picture",value:"",context:this,onchange:function(){this.upload_button.disabled=false;
this.try_to_display_selected_image(this);
}}),this.fileNameField=j.input({type:"hidden",name:"filename",value:""})),m=j.div({cls:"account-icon-controls"},IMO.REUI.Button("grey",k("Cancel"),{onclick:this.canceled,context:this}),this.upload_button=IMO.REUI.Button("blue",k("Upload icon"),{onclick:this.upload_click,context:this}),j.cdiv("clear")));
j.css(m,{width:IMO.REUI.Button.sizes[0]+IMO.REUI.Button.sizes[1]+20});
}});
var e=null;
a.show=function(){if(e===null){e=new h();
}e.show();
IMO.Stats.increment_counter("show_accounticonupload");
};
}());
(function(){var g=IMO.Utils;
var h=IMO.Utils.sprintf;
var n=IMO.Utils.HTML;
var o=IMO.Utils.TranslateDom;
var l=IMO.Utils.TranslateTxt;
var d=IMO.Constants;
var p;
var c;
var b;
var a;
var e=true;
IMO.REUI.AccountsBar=function(){this.dom=n.idiv("accounts-bar",n.idiv("accounts-bar-signoff",o("Sign out"),{title:l("Sign out of all accounts"),context:this,onclick:function(q){IMO.MouseManager.get().handled(q,"accounts-signout-button");
IMO.Session.get().signoff();
}}));
};
IMO.REUI.Accounts=function(){var z={};
var A;
var x=this;
this.accounts_list_expanded=e;
var w=g.parse_query().hasOwnProperty("thinui");
IMO.REUI.MA=new IMO.REUI.MiniApp();
this.dom=n.div({id:"accounts"},n.div({id:"accounts_main"},(w?null:n.div({cls:"bar lightblue sprite_add_accounts_button",id:"show_directory_button",style:{display:"none"},onclick:function(t){IMO.MouseManager.get().handled(t,"accounts-directory-search");
Y.later(10,this,function(){IMO.REUI.PIN.Directory.show();
});
}},n.sprite("icn_directory_16",{cls:"accounts_left_icn"}),o("Directory"))),(w?null:n.div({cls:"bar darkblue sprite_accounts",id:"accounts_bar",onclick:this.toggle_accounts_list,context:this},n.span({cls:"title"},o("Accounts")),this.accounts_count_dom=n.span({id:"accounts_count"},"0/0"),this.expand_icon=n.sprite("icn_expand",{cls:"accounts_right_icn"}))),this.sign_out_btn=n.div({cls:"bar grey "+(w?"sprite_signout_all_wide":"sprite_signout_all"),onclick:function(t){IMO.MouseManager.get().handled(t,"accounts-signout-button");
IMO.Session.get().signoff();
}},n.sprite("icn_signout_large",{cls:"accounts_left_icn"}),o("Sign Out All")),(w?"":this.add_account_btn=n.div({cls:"bar lightblue sprite_add_accounts_button",onclick:function(t){IMO.MouseManager.get().handled(t,"accounts-add-button");
IMO.REUI.Accounts.show_account_login();
}},n.sprite("icn_add_large",{cls:"accounts_left_icn"}),o("Add Account"))),this.link_button=n.div(n.sprite("icn_link_small",{cls:"accounts_left_icn"}),o("Link accounts"),(this.link_question_dom=n.sprite("icn_question",{cls:"accounts_right_icn"})),{id:"accounts-link-button",cls:"bar lightblue",context:this,onclick:function(t){IMO.MouseManager.get().handled(t,"accounts-unlink-button");
IMO.Session.get().link_accounts();
}}),this.accounts_list_dom=(z=n.idiv("accounts_list")),IMO.REUI.MA.dom));
this.find_friends_dom=this.build_find_friends_dom(0);
this.invite_widget=n.idiv("accounts_invite",n.span(" "),new IMO.UIWidgets.Button({},{context:this,onclick:function(){IMO.REUI.PIN.InvitePopup().show();
}},{},o("Invite Friends")).dom,this.find_friends_dom);
this.dom.appendChild(this.invite_widget);
n.hide(this.invite_widget);
var r=new IMO.REUI.AccountTooltipManager(z);
var y=new IMO.REUI.LinkTooltipManager(this.link_question_dom,IMO.Texts.LINKING_HELP,"sprite_icn_question");
this.update_link_buttons=function(){if(!this.accounts_list_expanded){return;
}var t=IMO.Session.get().get_accounts_by_link_group();
var C=g.size(t)>1;
var B=false;
g.foreach(t,function(D){if(D.size()>1){B=true;
}},this);
(C?n.show:n.hide)(this.link_button);
};
var v=function(t){IMO.MouseManager.get().handled(t,"accounts-link-button");
IMO.Session.get().link_accounts();
IMO.NM.remove_notification(this.link_notification);
};
this.suggest_link=function(){var t=IMO.Session.get().get_accounts_by_link_group();
var B=IMO.Session.get().get_accounts();
if(g.filter(B,function(C){return(C.authorized===false);
}).length>0){return;
}if(g.size(t)!==g.size(B)||IMO.Network.get().cookie_login===true||g.size(t)<2||this.link_notification!==undefined){return;
}this.show_suggest_link();
};
this.show_suggest_link=function(){var B=n.span(o("Link your accounts now!"),{cls:"action",context:this,onclick:v});
var t=n.div(B,n.br(),o("Linking accounts saves you time. It allows you to automatically sign into all of your accounts when you sign into any one of them."));
this.link_notification=IMO.NM.add_notification(t,IMO.REUI.Notification.types.info,{momentary:true,on_time:30000});
};
var s={};
var q=function(B){if(!B.group_item){var t=new p(B);
}s[B.id]=B.group_item;
return B.group_item;
};
var u=function(){n.empty(z);
g.foreach(s,function(B){B.destroy();
},this);
s={};
p.ncolor=0;
x.count_accounts();
var t=IMO.Session.get().get_accounts_by_link_group_imo_first();
g.foreach(t,function(C){var B=q(C);
B.clear();
g.foreach(C.accounts,function(D){if(D.proto===d.PROTO_IMO_OLD){return;
}if(D.proto===d.PROTO_IMO){B.add(D,true);
}else{B.add(D);
}},this);
z.appendChild(B.dom);
},this);
x.update_link_buttons();
};
IMO.EventTarget.on(IMO.Session.get(),{on_create_account:function(t){u();
Y.later(3000,x,x.suggest_link);
x.count_accounts();
x.on(t);
},on_remove_account:function(t){u();
x.count_accounts();
x.unsubscribe(t);
},on_prefs_loaded:function(){x.on_prefs_loaded();
},on_linked_account:u});
u();
Y.later(0,this,this.on_prefs_loaded);
this.on(IMO.Alpha.get());
};
Y.mix(IMO.REUI.Accounts.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.Accounts.prototype,{init_accounts_count:function(){this.accounts_count={online:0,total:0};
},build_find_friends_dom:function(q){return n.span({id:"find_friends"},o("Find Friends ([NUMBER])",{NUMBER:q}),{context:this,onclick:function(){IMO.REUI.PIN.FFPopup().show();
}});
},update_founded_friends_number:function(r){var q=this.build_find_friends_dom(r);
this.find_friends_dom.parentNode.replaceChild(q,this.find_friends_dom);
this.find_friends_dom=q;
},count_accounts:function(){this.init_accounts_count();
var r=IMO.Session.get().get_accounts();
this.accounts_count.total=r.length;
for(var q=0;
q<r.length;
q++){if(r[q].state===d.IM_STATE_ONLINE){this.accounts_count.online++;
}}n.replace_content(this.accounts_count_dom,g.HTML(this.accounts_count.online+"/"+this.accounts_count.total));
Y.log(this.accounts_count);
},on_state_change:function(r,q){this.count_accounts();
},on_disconnect:function(q,r){this.set_accounts_list_state(false,false);
},on_imo_account_signup:function(q){IMO.REUI.MA.set_state(false,false);
},on_alpha_friends_finder:function(){},toggle_accounts_list:function(q){var r=this.accounts_list_expanded;
Y.log(this.accounts_count);
this.set_accounts_list_state(r);
},set_accounts_list_state:function(s,q){if(this.accounts_list_expanded!==s){return;
}q=g.dfl(q,true);
var r=null;
this.accounts_list_expanded=!s;
if(s){r="sprite_icn_collapse";
n.hide(this.accounts_list_dom);
n.hide(this.add_account_btn);
n.hide(this.sign_out_btn);
n.hide(this.link_button);
}else{r="sprite_icn_expand";
n.show(this.accounts_list_dom,"block");
n.show(this.add_account_btn,"block");
n.show(this.sign_out_btn,"block");
n.show(this.link_button,"block");
this.update_link_buttons();
IMO.REUI.MA.set_state(true);
}n.mex_class(this.expand_icon,r,["sprite_icn_collapse","sprite_icn_expand"]);
if(q){IMO.Session.get().set_pref(d.UI_PREF_KIND,IMO.SharedConstants.Preferences.COLLAPSE_ACCOUNTS,s);
}},on_prefs_loaded:function(){var q=IMO.Session.get().get_pref(d.UI_PREF_KIND,IMO.SharedConstants.Preferences.COLLAPSE_ACCOUNTS,null);
if(q!==null&&q===e){this.set_accounts_list_state(true,false);
}}});
p=function(q){this.group=q;
q.group_item=this;
this.dom=n.div({cls:"group_item"},this.list=n.div());
this.color=p.colors[p.ncolor++%8];
n.css(this.dom,{"background-color":this.color});
};
p.colors=["","#E7945F","#E1E75F","#72E75F","#5FE784","#5FE7D5","#5FB5E7","#6C5FE7"];
p.ncolor=0;
Y.mix(p.prototype,{add:function(r,q){if(!r.account_item){if(r.proto===d.PROTO_IMO){r.account_item=new a(r);
}else{r.account_item=new c(r);
}}if(q&&this.list.childNodes.length>0){this.list.insertBefore(r.account_item.dom,this.list.firstChild);
}else{this.list.appendChild(r.account_item.dom);
}},clear:function(){n.empty(this.list);
},destroy:function(){if(!this.list){return;
}this.clear();
delete this.group.group_item;
delete this.group;
delete this.list;
delete this.dom;
}});
c=function(q){if(q.account_item){Y.log("Account already has account_item property","error");
}this.account=q;
q.account_item=this;
this.spinning=false;
this.disconnect_notifications=[];
this.check=n.input({type:"checkbox",context:this,oncbchange:function(r){Y.later(0,this,function(){var s;
Y.log(["CHECK",this.check.checked,r]);
if(this.check.checked){s=q.relogin();
Y.log("relogin:  "+s);
if(s){this.spin();
}else{this.check.checked=false;
}}else{s=q.logout();
Y.log("logout:  "+s);
if(s){this.spin();
}}});
}});
this.spinner=n.img({src:"assets/loading_16.gif"});
this.dom=n.div(this.check,this.img=n.sprite(q.get_proto_icon()),this.name=n.span(q.get_display_name()),{cls:"account_item"});
this.on_state_change();
this.on(this.account);
};
Y.mix(c.prototype,IMO.EventTarget);
Y.mix(c.prototype,{spin:function(){if(this.spinning){return false;
}this.spinning=true;
this.dom.replaceChild(this.spinner,this.check);
return true;
},unspin:function(){if(!this.spinning){return false;
}this.spinning=false;
this.dom.replaceChild(this.check,this.spinner);
return true;
},set_alias:function(){n.replace_content(this.name,n(this.account.get_display_name()));
},on_show_pin_tutorial:function(){IMO.REUI.APP.MeetUtils.show_pin_tutorial();
},on_state_change:function(){var q;
switch(this.account.state){case d.IM_STATE_OFFLINE:q=false;
this.check.checked=false;
break;
case d.IM_STATE_CONNECTING:q=true;
this.check.checked=false;
break;
case d.IM_STATE_ONLINE:q=false;
this.check.checked=true;
break;
case d.IM_STATE_DISCONNECTING:q=true;
this.check.checked=true;
break;
default:break;
}if(q){this.spin();
}else{this.unspin();
}},on_change_alias:function(q){this.account.alias=q;
this.set_alias();
},on_signed_on:function(q,r){this.set_alias();
g.foreach(this.disconnect_notifications,function(s){IMO.NM.remove_notification(s);
},this);
this.disconnect_notifications=[];
},on_linked_account_login_fail:function(r,t){var s=t.edata["reason"];
if(s==="lapw"){var q=IMO.UserFriendlyReason(s,r);
if(q){var u=IMO.NM.add_notification(q,IMO.REUI.Notification.types.error,{momentary:false});
this.disconnect_notifications.push(u);
}r.authorized=false;
}},on_login_fail:function(q,r){if(!q.authorized){IMO.Session.get().remove(q);
}else{q.authorized=false;
}},on_disconnect:function(r,t){var s=t.edata["reason"];
var q=IMO.UserFriendlyReason(s,r);
if(q){var u=IMO.NM.add_notification(q,IMO.REUI.Notification.types.error,{momentary:false});
this.disconnect_notifications.push(u);
}},destroy:function(){this.unsubscribe_all();
delete this.account.account_item;
}});
a=function(t){a.superclass.constructor.call(this,t);
n.add_class(this.dom,"imo-account-item");
var r=t.cnt_comm_points_left;
var u=t.cnt_max_comm_points;
var q="?/?";
if(r!==undefined&&u!==undefined){q=h("%d/%d",r,u);
}this.dom.appendChild(n.cdiv("imo-account-details",n.cdiv("imo-account-details-first-line",n.cdiv("imo-edit-profile",{context:this,onclick:this.imo_edit_profile},o("Edit Public Profile")),n.cdiv("imo-comm-points",this.imo_comm_points_count=n.cspan("imo-comm-points-count",n(q)),this.cp_dom=n.cspan("imo-comm-points-text",o("CP")))),n.cdiv("imo-account-details-second-line",n.cdiv("imo-change-password",{context:this,onclick:this.imo_change_password},o("Change password")))));
var s=new IMO.REUI.LinkTooltipManager(this.cp_dom,IMO.Texts.COMM_POINTS_HELP,"imo-comm-points-text");
};
Y.extend(a,c);
Y.mix(a.prototype,{on_comm_points_left_changed:function(q,r){Y.log(["accountwidget.on_comm_points_left_changed",q]);
n.replace_content(this.imo_comm_points_count,n(h("%d/%d",q,r)));
},imo_edit_profile:function(){Y.log("imo_edit_profile called");
IMO.REUI.PIN.ProfileEdit.show();
},imo_change_password:function(){Y.log("imo_change_password");
IMO.REUI.PIN.ChangePasswordPopup.show();
}});
var m=null;
var i=null;
var k=function(){return i!==null;
};
var j=function(q){m.username.disabled=!q;
m.password.disabled=!q;
};
var f=function(){m.username.value="";
m.password.value="";
};
IMO.REUI.Accounts.show_account_login=function(q,s,r){if(m===null){m=new b();
}if(m.popup.shown){return;
}i=IMO.KeyboardManager.get().push({bindings:{esc:{cb:IMO.REUI.Accounts.hide_account_login}},bottom:true});
if(!q){f();
}if(s){if(s.proto===d.PROTO_IMO&&s.alias){m.username.value=(s.alias);
m.hidden_username=s.uid;
}else{m.username.value=s.uid;
}m.set_proto(s.proto);
}else{delete m.hidden_username;
}if(r){m.set_proto(r);
}m.popup.show();
m.show();
Y.later(0,this,function(){m.username.focus();
if(s){m.password.focus();
}});
IMO.Stats.increment_counter("show_acccount_login");
};
IMO.REUI.Accounts.hide_account_login=function(){if(m===null){return;
}if(!m.popup.shown){return;
}m.username.blur();
m.password.blur();
IMO.KeyboardManager.get().pop(i);
i=null;
m.popup.hide();
};
IMO.REUI.Accounts.show_oauth_failure_reason=function(r){var q=n.dom("oauth_login_msg");
if(q===null){return;
}n.empty(q);
n.add_class(q,"error");
q.appendChild(o(r));
};
b=function(){var s=[d.PROTO_IMO,d.PROTO_MSN,d.PROTO_YAHOO,d.PROTO_GTALK,d.PROTO_NEWFACEBOOK,d.PROTO_AIM,d.PROTO_ICQ,d.PROTO_XMPP,d.PROTO_STEAM];
var z;
var w;
var H;
var E;
var x;
var F;
var A;
var v;
var J;
var r;
var C;
var q;
var y=this;
this.pin_signup_button=n.a("Sign Up",{cls:"pin-signup-button",onclick:function(){this.hide();
IMO.U.request_imo_signup_window(IMO.pin_invite_id);
},context:this});
this.dom=n.div({id:"account_login_container"},n.form({onsubmit:function(t){t.preventDefault();
H(t);
return false;
},context:this},n.div({id:"account_login"},w=this.account_login_protos=n.div({id:"account_login_protos"}),z=n.div({id:"account_login_form",cls:"account_login_form"},this.login_more=n.div({id:"account_login_username",cls:"input"},C=n.cspan("label",o("Username")),this.username=n.input({name:"username"}),this.pin_signup_button),n.div({id:"account_login_password",cls:"input"},q=n.cspan("label",o("Password")),this.forgot_password=n.cspan("text_button forgot_password",{context:this,onclick:function(t){IMO.REUI.Accounts.hide_account_login();
IMO.REUI.PIN.ForgotPasswordPopup.show();
}},o("Forgot password")),this.password=n.input({type:"password",name:"password"}),n.cdiv("clear")),n.div({id:"account_imo_already_online_text"},o("You are already on IMO")),this.message=n.div({id:"account_console"})),r=n.div({id:"account_oauth_form",cls:"account_login_form"},n.div({id:"oauth_login_extra_info"},""),n.div({id:"oauth_login_msg"},""),n.div({id:"oauth_login_picture_placeholder"}),n.div({id:"oauth_or_passwd",style:{"margin-bottom":"5px",color:"#888"}},n.span("OR",{cls:"account_login_form or",style:{"font-weight":"normal"}})),n.span({id:"oauth_login_passwd_link",onclick:function(K){n.hide(r);
n.show(z);
var t=n.dom("account_login_ok");
n.show(t);
if(m){n.empty(m.message);
}K.halt();
},context:y},o("Sign in with a different account"))),v=n.div({id:"account_steam_form",cls:"account_login_form",style:{display:"none"}},n.cspan("label",o("SteamGuard Access Code:")),J=n.input({type:"text",id:"steamauthtoken"})),E=n.cdiv("imo-signup-captcha-msg",o("You did not complete the signup process. Please complete the captcha shown below. By clicking Login  you are indicating that you have read and agreed to the"),n.a("Terms of Service",{href:"/policies/terms_of_service.html",target:"_blank"})," ",n.span(o("and"))," ",n.a("Privacy Policy",{href:"/policies/privacy_policy.html",target:"_blank"}),"."),x=n.div({id:"account_login_captcha"})),n.div({id:"account-login-fake-buttons"},n.input({type:"submit",value:l("Login")})),n.div({id:"account_login_buttons"},n.div({style:{clear:"both"}}),(new IMO.UIWidgets.Button2(o("Login"),{},{id:"account_login_ok",onclick:function(t){IMO.MouseManager.get().handled(t,"accounts-login-button");
t.preventDefault();
H(t);
},context:this})).dom,(new IMO.UIWidgets.Button2(o("Cancel"),{style:"secondary"},{id:"account_login_cancel",onclick:function(t){IMO.MouseManager.get().handled(t,"accounts-cancellogin-button");
t.preventDefault();
IMO.REUI.Accounts.hide_account_login();
},context:this})).dom)));
n.chide(this.forgot_password);
n.chide(this.pin_signup_button);
n.hide(E);
this.get_proto=function(){return(Y.Cookie.get("selected-proto")||"prpl-msn");
};
var B=false;
var I=false;
F=function(){n.show(x);
B=true;
var t=n.dom("account_login");
n.add_class(t,"captcha");
IMO.Captcha.show_captcha("account_login_captcha");
};
H=function(P){var O=m.get_username();
var K=m.password.value;
var M=y.get_proto();
if(M==d.PROTO_ICQ){M=d.PROTO_AIM;
}if(!O||!K){n.empty(m.message);
n.add_class(m.message,"error");
m.message.appendChild(n.sprite("error_icn"));
m.message.appendChild(o("Please enter a username and password"));
return;
}var Q={};
Q.steamauthtoken=J.value;
var N=IMO.Session.get().add("im",O,M);
var R=N.login(K,IMO.Captcha.get_data(),Q);
Y.log(m.message);
n.empty(m.message);
n.remove_class(m.message,"error");
m.message.appendChild(n.img({width:"16",height:"16",src:"assets/loading_16.gif"}));
m.message.appendChild(n(h("Signing on %s...",O)));
var L=function(S,T){j(true);
};
j(false);
IMO.REUI.Accounts.hide_account_login();
var t={on_login_fail:function(S,T){L();
if(!k()){IMO.REUI.Accounts.show_account_login(true,S);
}m.password.select();
IMO.EventTarget.unsubscribe(S,t);
IMO.Session.get().remove(S);
n.empty(m.message);
n.add_class(m.message,"error");
m.message.appendChild(n.sprite("error_icn"));
if(T.edata.reason!=="captcha"){m.message.appendChild(o("Login failed! "));
}m.message.appendChild(IMO.UserFriendlyReason(T.edata.reason,S));
if(S.proto===d.PROTO_GTALK&&T.edata.reason==="uidpassword"&&!S.is_oauth){m.message.appendChild(n.br());
m.message.appendChild(o("Two-factor authentication? Go "));
m.message.appendChild(n.a({href:"https://www.google.com/accounts/IssuedAuthSubTokens",target:"_blank"},"here"));
m.message.appendChild(o("."));
}if(T.edata.reason==="signup_captcha"){n.show(E);
I=true;
}if(T.edata.reason==="captcha"||T.edata.reason==="signup_captcha"||B){F();
}if(T.edata.reason==="steamguard"){n.show(v);
Y.later(0,this,function(){J.focus();
});
}else{Y.later(0,this,function(){m.password.focus();
});
}},on_signed_on:function(){L();
if(k()){m.username.select();
m.password.value="";
}n.hide(x);
n.hide(E);
B=false;
I=false;
var S=n.dom("account_login");
n.remove_class(S,"captcha");
IMO.Captcha.hide_captcha("account_login_captcha");
IMO.EventTarget.unsubscribe(N,t);
m.clear_old_state();
}};
IMO.EventTarget.on(N,t);
};
this.oauth_login=function(O){var L=O.proto;
var K=O.uid;
var t;
var N=IMO.Session.get().add("im",K,L);
N.is_oauth=true;
Y.log(m.message);
n.empty(m.message);
n.remove_class(m.message,"error");
m.message.appendChild(n.img({width:"16",height:"16",src:"assets/loading_16.gif"}));
m.message.appendChild(n(h("Signing on %s...",K)));
var P=function(Q,R){j(true);
};
j(false);
IMO.REUI.Accounts.hide_account_login();
var M={on_login_fail:function(Q,R){P();
if(!k()){IMO.REUI.Accounts.show_account_login(true,Q);
}IMO.EventTarget.unsubscribe(Q,M);
IMO.Session.get().remove(Q);
n.empty(m.message);
n.add_class(m.message,"error");
m.message.appendChild(n.sprite("error_icn"));
if(R.edata.reason!=="captcha"){m.message.appendChild(o("Login failed! "));
}m.message.appendChild(IMO.UserFriendlyReason(R.edata.reason,Q));
},on_signed_on:function(){P();
n.hide(x);
n.hide(E);
B=false;
I=false;
var Q=n.dom("account_login");
n.remove_class(Q,"captcha");
IMO.Captcha.hide_captcha("account_login_captcha");
IMO.EventTarget.unsubscribe(N,M);
m.clear_old_state();
}};
IMO.EventTarget.on(IMO.OAuth.get(),M);
IMO.EventTarget.on(N,M);
};
var u=n.sprite("homepage_pointer arrow");
var G={};
this.get_username=function(){var t=y.get_proto();
if(t===d.PROTO_IMO&&m.hidden_username){return m.hidden_username;
}else{return m.username.value;
}};
this.set_proto=function(K){var V=y.get_proto();
if(G[V]){n.remove_class(G[V],"selected");
}Y.Cookie.set("selected-proto",K,{expires:new Date(2199023255551)});
if(G[K]){n.add_class(G[K],"selected");
G[K].appendChild(u);
}var Q=d.PROTO_TO_UI[K];
if(K===d.PROTO_IMO){n.replace_content(C,o("[PROTO] Username/E-Mail",{PROTO:Q}));
if(B&&I){n.show(E);
}else{n.hide(E);
}}else{if(K===d.PROTO_VKONTAKTE){var S=new IMO.REUI.VKHover();
n.replace_content(C,o("[PROTO] Username or ID ",{PROTO:Q}),(S.dom));
}else{n.replace_content(C,o("[PROTO] Username",{PROTO:Q}));
}}n.replace_content(q,o("[PROTO] Password",{PROTO:Q}));
n.show(z);
Y.later(0,this,function(){m.username.focus();
});
var O;
if(IMO.OAuth.get().proto_has_oauth(K)){n.hide(z);
O=n.dom("account_login_ok");
n.hide(O);
var W=n.dom("oauth_login_msg");
n.empty(W);
var N=false;
var t=n.dom("oauth_login_picture_placeholder");
n.empty(t);
function U(X){IMO.EventTarget.on(IMO.OAuth.get(),{on_oauth_login_fail:function(ac){var ab=y.get_proto();
var aa=IMO.UserFriendlyReason.reauth_reasons[ab][ac];
if(!aa){aa=ac;
}var Z=n.dom("oauth_login_msg");
n.empty(Z);
n.add_class(Z,"error");
Z.appendChild(o(aa));
}});
IMO.OAuth.get().login(y.get_proto(),y.oauth_login,y.oauth_login.msg,false);
}if(t){var R=IMO.REUI.create_oauth_button(K,U,y);
t.appendChild(R);
}var L=n.dom("oauth_login_extra_info");
if(K===IMO.Constants.PROTO_NEWFACEBOOK&&IMO.Session.get().get_account_filter(K)){n.replace_content(L,o("You already have one Facebook account. To add a new account to imo, please make sure you are signed in to that account on the Facebook page."));
}else{n.empty(L);
}var M=n.dom("oauth_or_passwd");
var T=n.dom("oauth_login_passwd_link");
if(N){n.show(M);
n.show(T);
}else{n.hide(M);
n.hide(T);
}n.show(r);
}else{n.hide(r);
O=n.dom("account_login_ok");
n.show(O);
}var P=n.dom("account_imo_already_online_text");
if(K===d.PROTO_IMO){n.cshow(this.forgot_password);
if(IMO.Session.get().get_imo_account()){n.chide(this.pin_signup_button);
if(IMO.Session.get().get_imo_account().authorized){n.show(P);
j(false);
}else{if(IMO.Session.get().get_imo_account().alias){n.hide(P);
m.username.disabled=true;
m.password.disabled=false;
}}}else{n.cshow(this.pin_signup_button);
n.hide(P);
j(true);
}}else{n.hide(P);
n.hide(E);
n.chide(this.pin_signup_button);
n.chide(this.forgot_password);
j(true);
}if(K!==d.PROTO_STEAM){n.hide(v);
}if(m){n.empty(m.message);
}};
this.show=function(){this.set_proto(y.get_proto());
};
g.foreach(s,function(K){var L=K.replace(/prpl-/,"");
var t=d.PROTO_TO_UI[K];
var M=n.div({cls:"proto",context:this,onclick:function(N){IMO.MouseManager.get().handled(N,"accounts-proto-"+K+"-button");
this.set_proto(K);
}},n.sprite("logo_"+L+"_big",{cls:"icon",title:t,alt:t}),n.br(),n.div({cls:"proto-name"},t));
G[K]=M;
w.appendChild(M);
},this);
w.appendChild(n.div({style:{clear:"both"}}));
this.popup=new IMO.ModalPopup(this);
var D=((d.sprite_logo_msn_big_width+20+2)*d.num_protos)+2*d.reui_splash_protolist_padding;
this.popup.set_content(this.dom,[D,NaN]);
this.popup.set_title(l("Add Account"));
this.popup.prepare();
n.css(this.account_login_protos,{width:(d.sprite_logo_msn_big_width+20+2)*d.num_protos});
this.hide=function(){IMO.REUI.Accounts.hide_account_login();
};
};
Y.mix(b.prototype,{clear_old_state:function(){n.empty(this.message);
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var b=a.TranslateDom;
var e=a.TranslateTxt;
var c=function(g,f,h){this.popup=new IMO.ModalPopup(this);
this.popup.set_title(b(g));
this.popup.set_content(d.div({cls:"buddy_popup"},d.form({onsubmit:this.submit,context:this},a.args(arguments,3),this.ok_button_dom=(new IMO.UIWidgets.Button2(f,{onclick:this.ok,context:this})).dom,this.cancel_button_dom=(new IMO.UIWidgets.Button2(h,{onclick:this.cancel,context:this})).dom)),[250,NaN]);
this.popup.prepare();
this.popup.show();
this.kb=IMO.KeyboardManager.get().push({bindings:{enter:{cb:this.ok},esc:{cb:this.cancel}},bottom:true,context:this});
};
Y.mix(c.prototype,{close:function(){d.destroy(this.popup.dom);
this.popup.hide();
this.popup.destroy();
IMO.KeyboardManager.get().pop(this.kb);
delete this.popup;
},hide:function(){this.close();
},submit:function(f){f.halt();
this.ok();
}});
IMO.REUI.AddBuddy=function(){IMO.REUI.AddBuddy.superclass.constructor.call(this,"Add New Buddy","Add Buddy","Cancel",d.h3(b("Buddy's Username")),this.buid=d.input({type:"text"}),d.h3(b("Link Buddy to Your Account")),this.uid=d.select(),d.h3(b("Buddy Group")),this.group=d.select());
a.foreach(IMO.Session.get().accounts,function(h,i){var g=h.pretty_display();
this.uid.appendChild(d.option({value:i},g));
},this);
var f=0;
a.foreach(IMO.BuddyList.get().get_groups(),function(g){if(!g.normal){return;
}this.group.appendChild(d.option({value:g.name},g.name));
f++;
},this);
if(!f){this.group.appendChild(d.option({value:"Buddies"},"Buddies"));
}this.buid.focus();
};
Y.extend(IMO.REUI.AddBuddy,c);
Y.mix(IMO.REUI.AddBuddy.prototype,{ok:function(){var h=Y.Lang.trim(this.buid.value);
var g=this.uid.options[this.uid.selectedIndex].value;
var f=IMO.Session.get().accounts[g];
var i=this.group.options[this.group.selectedIndex].value;
if(!h||!f||!i){return;
}f.add_buddy(h,i);
this.close();
},cancel:function(){this.close();
}});
IMO.REUI.AddGroup=function(){IMO.REUI.AddGroup.superclass.constructor.call(this,"Create List","Add List","Cancel",d.h3(b("List Name")),this.group=d.input({type:"text"}));
this.group.focus();
};
Y.extend(IMO.REUI.AddGroup,c);
Y.mix(IMO.REUI.AddGroup.prototype,{ok:function(){var f=Y.Lang.trim(this.group.value);
if(!f){return;
}IMO.BuddyList.get().get_group(f);
this.close();
},cancel:function(){this.close();
}});
IMO.REUI.AddGroupChat=function(){IMO.REUI.AddGroupChat.superclass.constructor.call(this,"Create Chat Group","Add Group","Cancel",d.h3(b("Group Name")),this.group=d.input({type:"text"}),d.h3(b("Account")),this.uid=d.select());
a.foreach(IMO.Session.get().accounts,function(g,h){var f=g.pretty_display();
this.uid.appendChild(d.option({value:h},f));
},this);
this.group.focus();
};
Y.extend(IMO.REUI.AddGroupChat,c);
Y.mix(IMO.REUI.AddGroupChat.prototype,{ok:function(){var h=Y.Lang.trim(this.group.value);
var g=this.uid.options[this.uid.selectedIndex].value;
var f=IMO.Session.get().accounts[g];
if(!h||!f){return;
}f.groups.create_group(h,false);
this.close();
},cancel:function(){this.close();
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var b=a.TranslateDom;
var e=a.TranslateTxt;
var f;
var c={reui:"Web",normal:"Web"};
IMO.REUI.AllSessions=function(){this.dom=d.div({id:"all_sessions"},d.cdiv("explain",b("Your accounts are logged in on the following devices")),this.table_container=d.div(d.cdiv("loading","Loading..")),d.div(IMO.REUI.Button("blue","OK",{onclick:this.hide,context:this})),d.div({style:{clear:"both"}}));
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[500,NaN]);
this.popup.set_title(e("Active Sessions"));
this.popup.prepare();
this.on(IMO.Session.get());
};
IMO.REUI.AllSessions.show=function(){IMO.Session.get().get_all_sessions_for_all_accounts();
if(!f){f=new IMO.REUI.AllSessions();
}f.show();
};
Y.mix(IMO.REUI.AllSessions.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.AllSessions.prototype,{show:function(){this.popup.show();
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.hide}},bottom:true,context:this});
},hide:function(){this.popup.hide();
this.popup.destroy();
this.unsubscribe_all();
this.popup=null;
IMO.KeyboardManager.get().pop(this.sc_uid);
f=null;
},on_all_account_sessions:function(h){d.empty(this.table_container);
var g=d.table();
var k=d.tr();
k.appendChild(d.th("IP"));
k.appendChild(d.th(b("Type")));
k.appendChild(d.th(b("Last Activity")));
var j=Y.Object.keys(h.accounts);
g.appendChild(k);
var i=Y.Object.keys(h.sessions);
i.sort(function(m,l){if(m===IMO.Network.get().ssid){return -1;
}if(l===IMO.Network.get().ssid){return 1;
}return h.sessions[m].last_activity<h.sessions[l].last_activity;
});
a.foreach(i,function(p){Y.log(p);
var o=h.sessions[p];
var q=d.tr();
var l=new Date(o.last_activity*1000);
var n=l.toLocaleDateString()+" "+l.toLocaleTimeString();
var m=b(c[o.kind]||o.kind);
q.appendChild(d.td(o.ip));
q.appendChild(d.td(m));
q.appendChild(d.td(n));
q.appendChild(d.td(p===IMO.Network.get().ssid?d.strong(b("This session")):d.a(b("Sign Out"),{href:"#",onclick:function(r){r.halt();
IMO.Session.get().signoff_other(o.ssid);
IMO.Session.get().get_all_sessions_for_all_accounts();
}})));
g.appendChild(q);
},this);
this.table_container.appendChild(g);
}});
}());
(function(){var b=IMO.Utils;
var c=b.HTML;
var f="Discuss whats on your mind with interesting people around the world instantly.";
var g="Register now to be one of the first people on the imo network. Your early feedback is appreciated!";
var a="Broadcast what's on your mind, share interesting links, or ask questions.  Discuss broadcasts in real-time groups.";
var e="Meet New People lets you contact and chat with users on the imo network.";
var d="The public directory is a searchable listing of all users on the imo network.";
IMO.pin_invite_id="x4FaX4mBQu6Y8oSQFcJI";
IMO.REUI.MNPRegisterAnnouncement=function(i,h){this.invite_id=i;
this.email=h;
this.dom=this.build_content();
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[580,NaN]);
this.popup.set_title("imo Network");
this.popup.prepare();
};
Y.mix(IMO.REUI.MNPRegisterAnnouncement.prototype,{build_content:function(){var h=new IMO.UIWidgets.Button2("Register",{onclick:function(j){this._hide();
IMO.U.show_imo_signup(this.invite_id,true,this.email);
},context:this});
var i=c.cdiv("mnp-announce",c.cdiv("mnp-announce-subtitle",f),c.cdiv("mnp-announce-subtext",c.span(g)),c.cdiv("mnp-announce-actions",h.dom),c.cdiv("clear"),this.v=c.cdiv("mnp-announce-video",c.idiv("mnp-video-div"),this.cover=c.img({id:"mnp-video-cover",onclick:this.play_tutorial,context:this,src:"/graphics/pin/video_tutorial_cover.png"})),c.cdiv("clear"),c.cdiv("line"),c.cdiv("mnp-announce-column",c.cdiv("mnp-announce-ctitle","Broadcasts"),c.span(a)),c.cdiv("mnp-announce-column",c.cdiv("mnp-announce-ctitle","Meet New People"),c.span(e)),c.cdiv("mnp-announce-column mnp-announce-column-last",c.cdiv("mnp-announce-ctitle","Public directory"),c.span(d)),c.cdiv("clear"));
return i;
},play_tutorial:function(){c.hide(this.cover);
swfobject.embedSWF("https://www.youtube.com/v/stGwEI9wvS8?version=3&feature=player_profilepage&enablejsapi=1&rel=0&autoplay=1","mnp-video-div",580,280,"8","expressInstall.swf",{allowfullscreen:true},{allowFullScreen:true,allowscriptaccess:"always"},{});
},show:function(){this.popup.show();
},_hide:function(){this.popup.hide();
IMO.U.show_main_ui();
},_extract_email:function(i){var h=i.indexOf("email=");
return h>=0?i.substr(h+6):"";
},hide:function(){if(IMO.Session.get().get_accounts().length===0){this.popup.hide();
b.refresh_page(true);
}else{this._hide();
}}},this);
IMO.REUI.Announcements=function(){this.alpha_pin=true;
this.on(IMO.Session.get());
};
Y.mix(IMO.REUI.Announcements.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.Announcements.prototype,{on_prefs_loaded:function(){Y.later(30000,this,this.try_prefs);
},try_prefs:function(){var h=IMO.Session.get().get_pref("reui","tutorials",{});
if(h.mnp_register!==true){this.tutorial_pin=true;
this.try_to_show();
}},try_to_show:function(){if(this.alpha_pin&&this.tutorial_pin){this.show(false,IMO.pin_invite_id);
}},show:function(j,k,i){var h=IMO.Session.get().get_pref("reui","tutorials",{});
h.mnp_register=true;
if(IMO.Session.get().get_imo_account()&&!j){Y.log(["not showing pin signup announce"]);
IMO.Session.get().set_pref("reui","tutorials",h);
return;
}if(!this.mnp_register){this.mnp_register=new IMO.REUI.MNPRegisterAnnouncement(k,i);
}this.mnp_register.show();
IMO.Session.get().set_pref("reui","tutorials",h);
}});
}());
(function(){var d=IMO.Utils;
var j=IMO.Utils.HTML;
var k=IMO.Utils.TranslateDom;
var i=IMO.Utils.TranslateTxt;
var a=IMO.Constants;
var e=300;
var h=50;
var c=0;
var b=1;
var f=2;
IMO.REUI.GetAPIWidget=function(m,l){return new IMO.REUI.APIWidget(m,l);
};
IMO.REUI.APIWidget=function(m,l){this.url=m;
this.height=l;
this.build_dom();
this.win=new IMO.WM.Window();
this.win.set_content(this.dom);
this.win.size.min=[e,h];
this.on(this.win);
this.win.set_title(i("[NAME]",{NAME:"name of this game"}));
this.group=null;
this.search_result=[];
};
Y.mix(IMO.REUI.APIWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.APIWidget.prototype,{build_dom:function(){this.dom=j.iiframe("api_iframe",{"class":"api-iframe",src:this.url,scrolling:"yes",frameborder:"no",marginheight:"0px",marginwidth:"0px",width:"100%",height:this.height});
},on_focus_change:function(l,m){if(m===true){}},focus_win:function(){this.win.set_focus();
},show:function(){this.win.open();
this.win.set_focus();
},on_close_request:function(l){this.win.close();
}});
var g=function(n){var m=["https://apps.imoapi.com/imo.im/picassimo/","https://apps.imoapi.com/imo.im/reversimo/","https://apps.imoapi.com/imo.im/connectmore/","https://apps.imoapi.com/imo.im/suduoku/","https://apps.imoapi.com/imo.im/hangman/","https://apps.imoapi.com/imo.im/go/","https://apps.imoapi.com/imo.im/backgammon/","https://apps.imoapi.com/imo.im/rps/","https://apps.imoapi.com/imo.im/whiteboard/","https://apps.imoapi.com/imo.im/chess/"];
var q=[c,c,c,c,c,c,c,f,c,c];
var l=["100%","100%","100%","100%","100%","100%","100%","160px","100%","100%"];
var r=["https://apps.imoapi.com/imo.im/picassimo/icon.png","https://apps.imoapi.com/imo.im/reversimo/icon.png","https://apps.imoapi.com/imo.im/connectmore/icon.png","https://apps.imoapi.com/imo.im/suduoku/icon.png","https://apps.imoapi.com/imo.im/hangman/icon.png","https://apps.imoapi.com/imo.im/go/icon.png","https://apps.imoapi.com/imo.im/backgammon/icon.png","https://apps.imoapi.com/imo.im/rps/icon.png","https://apps.imoapi.com/imo.im/whiteboard/icon.png","https://apps.imoapi.com/imo.im/chess/icon.png"];
var p=["Picassimo","Reversimo","ConnectMore","Su-duo-ku","Hangman","Go","Backgammon","Rock, Paper, Scissors","Whiteboard","Chess"];
for(var o=0;
o<m.length;
o++){if(n.substr(0,m[o].length)!==m[o]){continue;
}return{prefix:m[o],open:q[o],height:l[o],icon_url:r[o],app_name:p[o]};
}return null;
};
IMO.REUI.APITransformer={show_api_widget:function(m,n){var l=IMO.REUI.GetAPIWidget(m,"100%");
l.win.set_title(n);
Y.later(10,this,function(){l.show();
});
},make_show_api_widget:function(l,n,m){return function(o){o.preventDefault();
IMO.REUI.APITransformer.show_api_widget(l,m);
};
},message_transformer:function(p){var x=["https://apps.imoapi.com/","http://lichess.org/"];
var m=p.msg;
var o=false;
var y;
for(var q=0;
q<x.length;
q++){y=m.indexOf(x[q]);
if(y!=-1){o=true;
break;
}}if(!o){return;
}var t=(m+" ").indexOf(" ",y);
var l=m.substr(y,t-y);
var s=g(l);
if(s===null){return;
}var n=p.msg_dom;
var u;
if(p.hasOwnProperty("uid")){u=p.uid;
}else{u=this.conv.account.uid;
}var r;
if(p.hasOwnProperty("proto")){r=p.proto;
}else{r=this.conv.account.proto;
}if(p.hasOwnProperty("history")){s.open=c;
}var v=s.prefix;
var w;
switch(s.open){case c:case b:w=j.a(j.img({src:s.icon_url,style:{}}),{onclick:"return false;",href:""});
j.replace_content(n,j(m.substr(0,y)));
n.appendChild(j.p());
n.appendChild(w);
n.appendChild(j.p());
n.appendChild(j(m.substr(t+1)));
break;
case f:w=j.div({style:{height:s.height}});
j.replace_content(n,w);
break;
}IMO.Network.get().send("games","web_get_client_token",{uid:u,proto:r,app_id:v,api_url:l},true,function(z){IMO.REUI.APITransformer.message_transformer_cb(z,l,y,m,s,n,w);
},this);
},message_transformer_cb:function(p,l,t,m,q,o,r){var s=p;
l+="#"+escape(s);
switch(q.open){case c:r.href=l;
r.target="_blank";
break;
case b:r.onclick=IMO.REUI.APITransformer.make_show_api_widget(l,o,q.app_name);
r.href=l;
break;
case f:var n=IMO.REUI.GetAPIWidget(l,q.height);
r.appendChild(j.cdiv("api",n.dom));
break;
}}};
}());
(function(){var b=IMO.Constants;
var j=IMO.Utils.HTML;
var e=IMO.Utils;
var g=function(){};
var a=function(m,k){var n=m;
var l=j.input({type:"checkbox",oncbchange:function(p){var o=l.checked;
alert(o);
if(o!==n){n=o;
k(n);
}}});
l.checked=n;
return l;
};
var f=function(l,t,o,m,n,r,q){var p=m;
r=r===undefined?true:r;
var k=new IMO.REUI.SliderBar(IMO.REUI.SliderBar.HORIZONTAL_BAR,t,o,m,l,r,q);
var s=new IMO.REUI.ValueListener(k,function(v,u){u=Math.round(u);
if(p!==u){p=u;
n(p);
}},true);
return k;
};
var i=function(m,l,k){if(l===undefined){return j.tr(j.td(m));
}if(k===undefined){return j.tr(j.td(m),j.td(l));
}return j.tr(j.td(m),j.td(l),j.td(k));
};
var c=function c(l,k){this.name=k;
this.tab_dom=j.cdiv("tab idle_tab",{context:this,onclick:function(){l.set_panel(this);
}},k);
this.panel_dom=j.div("");
this.on_open=function(){};
this.on_close=function(){};
};
IMO.REUI.AVSettingsWidget=function d(l,k){this.av_conv=k;
this.swf_object=l;
this.setOptions={input:this.swf_object.getOptions("input"),output:this.swf_object.getOptions("output")};
this.videoOptions={min:this.swf_object.getVideoOptions("min"),max:this.swf_object.getVideoOptions("max"),def:this.swf_object.getVideoOptions("default"),remote:this.swf_object.getVideoOptions("remote")};
this.mic_tab=new c(this,"Microphone");
this.build_select_mic_panel();
this.cam_tab=new c(this,"Webcam");
this.build_select_cam_panel();
this.remote_video_tab=new c(this,"Buddy Video");
this.build_remote_video_panel();
this.panel=j.cdiv("panel");
this.dom=j.cdiv("av_settings",j.cdiv("tabs",this.mic_tab.tab_dom,this.cam_tab.tab_dom,this.remote_video_tab.tab_dom,j.cdiv("new_line")),this.panel);
this.new_panel=this.mic_tab;
};
var h={};
IMO.REUI.AVSettingsWidget.preview_cb=function(k){h[k]=true;
};
Y.mix(IMO.REUI.AVSettingsWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.AVSettingsWidget.prototype,{open:function(){this.open_panel();
},close:function(){this.close_panel();
},on_av_video_options_change:function(k,m,l){this.videoOptions[m]=l;
this.remote_video_tab.update_all();
},on_av_options_change:function(k,m,l){this.setOptions[m]=l;
this.remote_video_tab.update_all();
this.mic_tab.update_all();
this.cam_tab.update_all();
},on_av_mic_change:function(k,l){if(this.current_panel!==this.mic_tab){return;
}this.mic_tab.radio.set_value(l);
},on_av_cam_change:function(k,l){if(this.current_panel!==this.cam_tab){return;
}this.cam_tab.radio.set_value(l);
},close_panel:function(){if(this.current_panel){j.remove_class(this.current_panel.tab_dom,"active_tab");
j.add_class(this.current_panel.tab_dom,"idle_tab");
this.current_panel.on_close();
this.unsubscribe(this.av_conv);
}j.empty(this.panel);
this.current_panel=null;
},open_panel:function(){j.remove_class(this.new_panel.tab_dom,"idle_tab");
j.add_class(this.new_panel.tab_dom,"active_tab");
this.current_panel=this.new_panel;
this.panel.appendChild(this.current_panel.panel_dom);
this.current_panel.on_open();
this.on(this.av_conv);
},set_panel:function(k){if(k===this.current_panel){return;
}this.close_panel();
this.new_panel=k;
this.open_panel();
},build_remote_video_panel:function(){var o=this;
var l=j.table();
var n=100;
this.remote_video_tab.update_list=[];
var m=function(s,q,p){var r=f(n,o.videoOptions.min[p],o.videoOptions.max[p],o.videoOptions[q][p],function(u){if(o.videoOptions[q][p]===u){return;
}o.videoOptions[q][p]=u;
o.swf_object.setVideoOptions(q,o.videoOptions[q]);
});
var t=function(){r.set_value(o.videoOptions[q][p]);
};
l.appendChild(i(s,r.dom));
o.remote_video_tab.update_list.push(t);
};
this.remote_video_tab.update_all=function(){e.foreach(o.remote_video_tab.update_list,function(q,p){q();
});
};
m("Brightness","remote","brightness");
m("Contrast","remote","contrast");
var k=j.cdiv("reset_button",IMO.REUI.Button("grey",{context:this,onclick:function(p){this.swf_object.setVideoOptions("remote",this.videoOptions.def);
}},j.span("Reset to defaults")));
this.remote_video_tab.panel_dom=j.div(l,k);
},build_select_mic_panel:function(){var n=j.table();
var p=this;
this.mic_tab.radio=new IMO.REUI.RadioButtonGroup();
n.appendChild(j.tr(j.td({colspan:3},j.p({align:"left"},"Microphone input level"))));
var l=f(150,this.setOptions.input.min_av,this.setOptions.input.max_av,this.setOptions.input.av,function(r){if(p.setOptions.input.av===r){return;
}p.setOptions.input.av=r;
if(p.swf_object.setOptions){p.swf_object.setOptions("input",p.setOptions.input);
}});
n.appendChild(j.tr(j.td({colspan:3},l.dom)));
n.appendChild(j.tr(j.td({colspan:3},j.p({align:"left"},"Audio source"))));
this.mic_names=this.swf_object.getMics();
this.mic_volumes=this.swf_object.getMicVolume();
if(this.mic_names.length===0){n.appendChild(i(this.mic_tab.radio.create_radio_button("No microphone"),j.div(),"No microphone"));
}this.mic_sliders=[];
for(var m=0;
m<this.mic_names.length;
++m){var k=this.mic_names[m];
var q=this.mic_volumes[m];
if(q<0){q=0;
}if(q>100){q=100;
}var o=new IMO.REUI.VolumeIndicator(0,100,q);
this.mic_sliders.push(o);
n.appendChild(i(this.mic_tab.radio.create_radio_button(k),o.dom,k));
}this.mic_tab.radio.set_value(this.swf_object.getCurrentMic());
this.mic_tab.panel_dom=n;
this.mic_tab.radio_listener=new IMO.REUI.ValueListener(this.mic_tab.radio,function(s,r){p.swf_object.setCurrentMic(r);
});
this.mic_tab.on_open=function(){Y.log("Current mic: "+p.swf_object.getCurrentMic());
p.mic_tab.radio.set_value(p.swf_object.getCurrentMic());
p.mic_tab.radio_listener.connect();
};
this.mic_tab.update_all=function(){l.set_value(p.setOptions.input.av);
};
this.mic_tab.on_close=function(){p.mic_tab.radio_listener.disconnect();
};
this.mic_tab.panel_dom=n;
},build_select_cam_panel:function(){var k=this;
this.cam_tab.on_open=function(){var n=j.table();
k.cam_tab.radio=new IMO.REUI.RadioButtonGroup();
k.cam_names=k.swf_object.getCameras();
k.cam_info={};
n.appendChild(j.tr(j.td({colspan:3},j.p({align:"left"},"Video bandwidth"))));
var m=f(100,k.setOptions.input.min_vb,k.setOptions.input.max_vb,k.setOptions.input.vb,function(p){if(k.setOptions.input.vb===p){return;
}k.setOptions.input.vb=p;
if(k.swf_object.setOptions){k.swf_object.setOptions("input",k.setOptions.input);
}},true,[20,50,200,500]);
n.appendChild(j.tr(j.td({colspan:3},j.cdiv("float_left",m.dom),k.cam_tab.vbw_text=j.cdiv("float_right"),j.cdiv("clear"))));
n.appendChild(j.tr(j.td({colspan:3},j.p({align:"left"},"Video source"))));
var o=false;
e.foreach(k.cam_names,function(q,p){o=true;
k.cam_info[q]={id:e.create_uid(),div:j.div()};
n.appendChild(i(k.cam_tab.radio.create_radio_button(q),k.cam_info[q].div,q));
});
if(!o){n.appendChild(i(k.cam_tab.radio.create_radio_button("No camera"),j.div(),"No camera"));
}k.cam_tab.radio.set_value(k.swf_object.getCurrentCam());
j.replace_content(k.cam_tab.panel_dom,n);
k.cam_tab.radio_listener=new IMO.REUI.ValueListener(k.cam_tab.radio,function(q,p){k.swf_object.setCurrentCam(p);
});
k.cam_tab.timer=Y.later(50,k,function(){e.foreach(k.cam_names,function(q,p){var r=k.cam_info[q];
if(h[r.id]){var s=k.swf_object.getSnapshot(q);
r.ref.display(s);
}});
},null,true);
k.cam_tab.radio_listener.connect();
k.cam_tab.radio.set_value(k.swf_object.getCurrentCam());
Y.log("Current cam: "+k.swf_object.getCurrentCam());
var l=function(){j.replace_content(k.cam_tab.vbw_text,j(m.value*8+" kbits/s"));
};
k.cam_tab.update_all=function(){m.set_value(k.setOptions.input.vb);
l();
};
l();
e.foreach(k.cam_names,function(q,p){var r=k.cam_info[q];
j.empty(r.div);
r.div.appendChild(j.div({id:r.id}));
swfobject.embedSWF(IMO.SWF("preview"),r.id,32,24,"9.0.0","images/expressInstall.swf",{init_cb:"IMO.REUI.AVSettingsWidget.preview_cb",id:r.id},{allowscriptaccess:"always",bgcolor:"#ffffff",wmode:"transparent"},{},function(s){r.ref=s.ref;
});
});
};
this.cam_tab.on_close=function(){k.cam_tab.timer.cancel();
k.cam_tab.radio_listener.disconnect();
e.foreach(k.cam_names,function(m,l){var n=k.cam_info[m];
swfobject.removeSWF(n.id);
delete n.ref;
delete h[n.id];
});
delete k.cam_tab.timer;
delete k.cam_tab.radio;
j.empty(k.cam_tab.panel_dom);
k.swf_object.stopCameraPreview();
};
this.cam_tab.panel_dom=j.div();
}});
}());
(function(){var a=IMO.Utils;
var c=a.sprintf;
var b=a.HTML;
var d=IMO.Utils.TranslateTxt;
var f=250;
var e=250;
IMO.REUI.AVSettingsWMAdaptor=function(g){this.avwidget=g;
this.opened=false;
this.settings_widget=null;
this.win=null;
if(IMO.WM.B){this.on(IMO.WM.B);
}this.on(g);
};
Y.mix(IMO.REUI.AVSettingsWMAdaptor.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.AVSettingsWMAdaptor.prototype,{is_visible:function(){if(!IMO.WM.B){return true;
}var h=this.avwidget.av_conv.conv;
if(!h.ui){return false;
}var g=h.ui.win;
if(this.avwidget.is_fullscreen){return true;
}if(IMO.WM.B.active_wm===IMO.WM.FWM){return true;
}else{return IMO.WM.TWM.focused_window===g;
}},is_open:function(){return this.opened;
},open:function(){if(this.opened){return;
}this.prepare_settings_widget();
if(this.is_visible()){b.css(this.avwidget.settings,{width:c("%dpx",f)});
this.avwidget.add_right_padding(f);
this.avwidget.settings.appendChild(this.settings_widget.dom);
this.avwidget.unprotect(true);
this.avwidget.ev.fire("on_widget_request_resize");
}else{if(IMO.WM.B.active_wm===IMO.WM.FWM){this.prepare_window();
this.win.open();
Y.later(0,this,this.position_window,[a.vadd(Y.DOM.getXY(this.avwidget.settings_btn),a.vmul(b.get_size(this.avwidget.settings_btn),[0,1]),[0,2])]);
}}this.opened=true;
this.settings_widget.open();
this.avwidget.adjust_flash_placement();
},close:function(){if(!this.opened){return;
}if(this.is_visible()){b.css(this.avwidget.settings,{width:c("0px")});
this.avwidget.remove_right_padding(f);
this.avwidget.unprotect(true);
b.remove(this.settings_widget.dom);
}else{if(IMO.WM.B.active_wm===IMO.WM.FWM){this.win.close();
}}this.opened=false;
this.settings_widget.close();
this.avwidget.adjust_flash_placement();
},prepare_settings_widget:function(){if(this.settings_widget!==null){return;
}this.settings_widget=new IMO.REUI.AVSettingsWidget(this.avwidget.av_conv.swf_object,this.avwidget.av_conv);
},prepare_window:function(){if(this.win!==null){return;
}this.win=new IMO.WM.Window();
this.win.set_title(d("Settings"));
this.win.set_content(this.settings_widget.dom);
this.win.size.min[0]=f;
this.win.size.min[1]=e;
this.on(this.win);
},position_window:function(g){IMO.WM.FWM.reposition_window(this.win,g);
this.win.set_focus();
},on_close_request:function(g){this.close();
},on_before_wm_switch:function(){if(this.is_open()){this.reopen_after_switch=true;
}this.close();
},on_after_wm_switch:function(){if(this.reopen_after_switch){delete this.reopen_after_switch;
this.open();
}},destroy:function(){this.unsubscribe_all();
this.close();
}});
}());
(function(){var b=IMO.Utils;
var d=b.sprintf;
var j=IMO.Constants;
var g=b.HTML;
var r=b.TranslateDom;
var c=400;
var m=250;
var n="http://get.adobe.com/flashplayer/";
var l=function(){};
var o=function(w,t){var v=t.parentNode;
var u=g.div({style:{position:"relative",width:g.get_size(t)[0],height:g.get_size(t)[1]}});
v.insertBefore(u,t);
g.remove(t);
u.appendChild(g.div({style:{position:"absolute",top:"0px",left:"0px"}},t));
u.appendChild(g.div({style:{position:"absolute",top:"0px",left:"0px"}},w));
};
var e="Show link";
var f="Hide link";
var a=["sprite_btn_videochat_speaker_enabled","sprite_btn_videochat_speaker_disabled"];
var k=["sprite_btn_videochat_expand","sprite_btn_videochat_shrink"];
var p=["sprite_btn_videochat_audio_enabled","sprite_btn_videochat_audio_disabled"];
var s=["sprite_btn_videochat_video_enabled","sprite_btn_videochat_video_disabled"];
var q=null;
IMO.REUI.AVWidget=function i(t){this.av_conv=t;
this.state=t.state;
t.ui=this;
t.ev.fire("on_create_ui",t,this);
this.win=t.conv.ui&&t.conv.ui.win;
this.ev=new IMO.Event();
this.settings_adaptor=null;
this.cam_disabled=false;
this.mic_muted=false;
this.speaker_muted=false;
this.is_fullscreen=false;
this.flash_running=false;
this.last_height=m;
this.swf=new IMO.FlashWidget(IMO.SWF("nchat"),null,null,null,"9.0.0");
this.settings=g.cdiv("settings");
this.flash_space=g.cdiv("av_flash_space");
this.flash_install_div=g.cdiv("av_flash_install",g.span(r("You need to upgrade your Adobe Flash Player to do Audio and Video chat."),g.br(),g.a({href:n,target:"about:blank"},r("Download Adobe Flash player."))));
this.link_copy_button=new IMO.UIWidgets.Button({button_size:"small",truncate_left:true},{cls:"av_link_copy_button"},{cls:"av_link_copy_button_internal"},r("Copy"));
if(b.can_bookmark_page()){this.bookmark_dom=g.cdiv("av_hot_link av_link_text",g.p(r("Bookmark "),g.cspan("av_link_feature_text","imo now")),g.cdiv("text_button",{onclick:function(){b.bookmark_page("imo now","https://imo.im/now");
}},"https://imo.im/now"));
}else{this.bookmark_dom=g.cdiv("av_hot_link av_link_text",g.p(r("Use "),g.cspan("av_link_feature_text","imo now"),r(" anytime at")),g.p(g.span("https://imo.im/now")));
}this.link_space=g.cdiv("av_link",g.cdiv("av_link_content",g.cdiv("av_link_logo",g.sprite("imo_simple_chat_logo")),g.cdiv("av_link_text",g.p(g.cspan("av_link_feature_text","imo now"),r(" is a fast, free and simple way to voice and video chat with friends and family.")),g.p(g.br()),g.p(r("No registration, account or download is required.  Send the link below to a friend to start chatting now!")),g.p(g.br())),g.table({cls:"av_link_line"},g.tr(g.td(g.sprite("imo_simple_corners")),g.td(this.link_input=g.input({cls:"av_link_input_box",id:"anon_chat_input_url",type:"text",readonly:"readonly",context:this,onclick:function(){this.link_input.select();
}})),g.td(this.link_copy_button.dom))),this.av_link_copied_dom=g.cdiv("av_link_copied",g.p(r("Link copied"))),this.bookmark_dom));
g.chide(this.av_link_copied_dom);
this.av_top=g.cdiv("av_top",this.link_space,this.settings,this.flash_space);
g.chide(this.link_space);
this.protect();
this.create_controls();
this.av_controls=g.cdiv("av_controls",this.buttons=g.cdiv("buttons"),this.right_buttons=g.cdiv("buttons-right",this.settings_btn,this.link_btn));
this.av_duration_timer=g.span();
this.av_conn_status=g.span();
this.av_status=g.cdiv("av_status",this.av_duration_timer," - ",this.av_conn_status);
this.av_answer_cont=g.cdiv("av_answer_cont",g.cdiv("av_answer_message",this.caller_alias=g.span("dog"),g(" is requesting a "),this.incoming_call_text=g.span(),g(" with you")),this.av_answer_buttons=g.cdiv("av_answer_buttons",this.answer_btn,this.reject_btn,g.cdiv("clear")));
g.add_class(this.reject_btn,"last");
g.css(this.av_answer_buttons,{width:d("%dpx",parseInt(this.answer_btn.style.width,10)+parseInt(this.reject_btn.style.width,10)+j.reui_av_button_margin)});
g.chide(this.av_answer_cont);
this.dom=g.cdiv("av_chat",this.av_top,this.av_status,this.av_controls,this.av_answer_cont);
this.cleanup=l;
this._disabled_vim=false;
this.swf_id="";
this.on(t);
this.refresh();
g.show(this.settings_btn);
this.resizable=true;
this.right_margins=[];
};
Y.mix(IMO.REUI.AVWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.AVWidget.prototype,{calculate_right_padding:function(){var t=0;
for(var u=0;
u<this.right_margins.length;
++u){if(this.right_margins[u]>t){t=this.right_margins[u];
}}g.css(this.flash_space,{right:d("%dpx",t)});
this.adjust_flash_placement();
},add_right_padding:function(t){this.right_margins.push(t);
this.calculate_right_padding();
},remove_right_padding:function(u){for(var t=0;
t<this.right_margins.length;
++t){if(this.right_margins[t]===u){this.right_margins.splice(t,1);
break;
}}this.calculate_right_padding();
},create_controls:function(){this.reject_btn=g.cdiv("av_button",{id:"reject_btn"},IMO.REUI.Button("grey",{context:this,onclick:this.on_reject_click},g.sprite("icn_deny"),g.span("Reject")));
g.css(this.reject_btn,{width:d("%dpx",IMO.REUI.Button.sizes[0])});
this.answer_btn=g.cdiv("av_button",{id:"answer_btn"},IMO.REUI.Button("blue",{context:this,onclick:this.on_answer_click},g.sprite("icn_accept"),g.span("Answer")));
g.css(this.answer_btn,{width:d("%dpx",IMO.REUI.Button.sizes[0])});
this.fsc_btn=g.cdiv("av_button",{id:"fsc_btn",context:this,onclick:this.toggle_fullscreen},this.fsc_btn_sprite=g.sprite(k[0]));
this.cam_btn=g.cdiv("av_button",{id:"cam_btn",context:this,onclick:this.toggle_disable_camera},this.cam_btn_sprite=g.sprite(s[0]));
this.mic_btn=g.cdiv("av_button",{id:"mic_btn",context:this,onclick:this.toggle_mic_mute},this.mic_btn_sprite=g.sprite(p[0]));
this.spk_btn=g.cdiv("av_button",{id:"spk_btn",context:this,onclick:this.toggle_speaker_mute,onmouseenter:this.show_volhover,onmouseleave:this.decay_volhover},this.spk_btn_sprite=g.sprite(a[0]));
this.hang_up_btn=g.cdiv("av_button",{id:"hang_up_btn"},IMO.REUI.Button("grey",{context:this,onclick:this.on_hang_up_click},g.sprite("icn_hangup"),r("Hang up")));
this.settings_btn=g.cdiv("av_button",{id:"settings_btn"},IMO.REUI.Button("grey",{context:this,onclick:this.on_settings_click},g.sprite("icn_settings"),g.span("Settings")));
this.link_btn=g.cdiv("av_button",{id:"link_btn"},IMO.REUI.Button("grey",{context:this,onclick:this.on_link_btn_click},g.sprite("icn_show_chat"),this.link_btn_text_dom=g.span(r(f))));
g.chide(this.link_btn);
this.install_fl_btn=g.cdiv("av_button",{id:"install_fl_btn"},IMO.REUI.Button("blue",{context:this,onclick:function(t){window.open(n);
}},g.span(r("Install Flash"))));
this.close_fl_btn=g.cdiv("av_button",{id:"close_fl_btn"},IMO.REUI.Button("grey",{context:this,onclick:function(t){this.av_conv.close_local_conv();
}},g.span(r("Close"))));
},on_hang_up_click:function(t){IMO.MouseManager.get().handled(t,"avw-hangup-button");
this.av_conv.close_conv("hangup");
},on_reject_click:function(t){IMO.MouseManager.get().handled(t,"avw-reject-button");
g.chide(this.av_answer_cont);
this.av_conv.ringing_response(IMO.AVConv.incoming_action_refuse);
},on_answer_click:function(t){IMO.MouseManager.get().handled(t,"avw-answer-button");
g.chide(this.av_answer_cont);
this.av_conv.ringing_response(IMO.AVConv.incoming_action_accept);
},toggle_fullscreen:function(t){IMO.MouseManager.get().handled(t,"avw-fullscreen-button");
if(this.is_fullscreen){this.close_full_screen();
}else{this.open_full_screen();
}},open_full_screen:function(){this.ev.fire("on_before_wm_switch");
this.protect();
this.parent=this.dom.parentNode;
g.dom("imo").appendChild(this.dom);
g.css(this.swf.dom,{z_index:16051});
g.css(this.dom,{z_index:16050});
this.unprotect();
this.is_fullscreen=true;
this.update_buttons();
this.ev.fire("on_after_wm_switch");
},close_full_screen:function(){this.ev.fire("on_before_wm_switch");
this.protect();
this.parent.appendChild(this.dom);
if(this.flash_zindex){g.css(this.swf.dom,{z_index:this.flash_zindex});
}this.unprotect();
this.is_fullscreen=false;
this.update_buttons();
this.ev.fire("on_after_wm_switch");
},toggle_disable_camera:function(t){IMO.MouseManager.get().handled(t,"avw-cam-disable-mutton");
this.av_conv.set_disable_camera(!this.cam_disabled);
},toggle_mic_mute:function(t){IMO.MouseManager.get().handled(t,"avw-mic-mute-button");
this.av_conv.set_mic_mute(!this.mic_muted);
},toggle_speaker_mute:function(t){IMO.MouseManager.get().handled(t,"avw-speaker-mute-button");
Y.log(["Speaker muted is ",this.speaker_muted]);
this.av_conv.set_speaker_mute(!this.speaker_muted);
},update_buttons:function(){g.empty(this.buttons);
var t=0;
if(!this.no_wm_mode){this.buttons.appendChild(this.fsc_btn);
g.mex_class(this.fsc_btn_sprite,k[this.is_fullscreen?1:0],k);
t+=j[a[0]+"_width"];
}this.buttons.appendChild(this.cam_btn);
g.mex_class(this.cam_btn_sprite,s[this.cam_disabled?1:0],s);
t+=j[k[0]+"_width"];
this.buttons.appendChild(this.mic_btn);
g.mex_class(this.mic_btn_sprite,p[this.mic_muted?1:0],p);
t+=j[p[0]+"_width"];
this.buttons.appendChild(this.spk_btn);
g.mex_class(this.spk_btn_sprite,a[this.speaker_muted?1:0],a);
t+=j[s[0]+"_width"];
this.buttons.appendChild(this.hang_up_btn);
t+=parseInt(this.hang_up_btn.firstChild.style.width,10);
t+=5*2*j.reui_av_button_side_margin;
this.buttons.appendChild(g.cdiv("clear"));
g.css(this.buttons,{width:d("%dpx",t)});
},adjust_flash_placement:function(){this.swf.show(this.flash_space);
},on_settings_click:function(t){IMO.MouseManager.get().handled(t,"avw-settings-button");
if(!this.settings_adaptor.is_open()){this.settings_adaptor.open();
}else{this.settings_adaptor.close();
}},on_link_btn_click:function(t){IMO.MouseManager.get().handled(t,"avw-link-nutton");
if(this.link_space_visible){this.hide_link_space();
g.replace_content(this.link_btn_text_dom,r(e));
}else{this.show_link_space();
g.replace_content(this.link_btn_text_dom,r(f));
}},show_link_space:function(){g.cshow(this.link_space);
this.add_right_padding(this.link_space.clientWidth);
this.link_space_visible=true;
},hide_link_space:function(){var t=this.link_space.clientWidth;
g.chide(this.link_space);
this.remove_right_padding(t);
this.link_space_visible=false;
},set_conv_panel:function(t){this.conv_panel=t;
this.on(t);
},show_init_options:function(){g.empty(this.buttons);
this.buttons.appendChild(this.hang_up_btn);
},show_ringing_options:function(){var t=this.av_conv.call_options.audio_only;
g.replace_content(this.incoming_call_text,t?r(" voice chat "):r(" video chat "));
g.cshow(this.av_answer_cont);
g.text(this.caller_alias,this.av_conv.buddy.displaylias);
if(this.conv_panel!==undefined){this.conv_panel.toggle_widget_visibility(IMO.REUI.ConversationPanel.CALL,true);
}this.ring_in={};
this.ring_in.ring=IMO.Sound.get().ring("callin");
this.ring_in.auto_cancel=Y.later(IMO.AVConv.RINGING_TIME,this,function(){if(this.ring_in){this.ring_in.ring.cancel();
this.ring_in=null;
this.av_conv.ringing_response(IMO.AVConv.incoming_action_missed);
g.chide(this.av_answer_cont);
}},null,false);
},show_av_swf:function(t){if(this.flash_running){return;
}var w=this.av_conv.call_options.flashvars.id;
if(w===this.swf_id){return;
}this.swf_id=w;
var u=this;
this.flash_running=true;
this.unprotect();
var v;
IMO.EventTarget.on(this.swf,v={on_embed:function(x){u.av_conv.swf_object=x.ref;
u.unprotect();
},on_embed_fail:function(x){Y.log("failed to embed flash","error");
u.display_flash_install();
u.av_conv.close_conv("flash",true,true,IMO.AVConv.state_noflash);
},on_destroy:function(x){IMO.EventTarget.unsubscribe(x,v);
}});
this.swf.init(null,t.flashvars,t.flashparams,t.imo_params);
if(!this._disabled_vim){this._disabled_vim=true;
IMO.VIM.begin_forced_unprepare();
}},display_flash_install:function(){g.empty(this.buttons);
g.replace_content(this.flash_space,this.flash_install_div);
this.buttons.appendChild(this.install_fl_btn);
this.buttons.appendChild(this.close_fl_btn);
},stop_ringing:function(){if(this.ring_in){this.ring_in.ring.cancel();
this.ring_in.auto_cancel.cancel();
this.ring_in=null;
}if(this.ring_out){this.ring_out.ring.cancel();
this.ring_out.auto_cancel.cancel();
this.ring_out=null;
}},cleanup_conv:function(){if(this.settings_adaptor){this.settings_adaptor.destroy();
this.settings_adaptor=null;
}if(this.volume_slider_container){g.remove(this.volume_slider_container);
delete this.volume_slider_container;
delete this.volume_slider;
}this.protect();
this.swf.destroy();
if(this._disabled_vim){IMO.VIM.end_forced_unprepare();
this._disabled_vim=false;
}if(this.clipboard_swf){this.clipboard_swf.destroy();
}this.flash_running=false;
this.stop_ringing();
this.stop_duration_timer();
if(this.is_fullscreen){this.close_full_screen();
}this.update_connection_status("");
if(this.hide_remote_url){this.hide_remote_url();
}if(this.volume_slider){this.unsubscribe(this.volume_slider);
delete this.volume_slider;
}},on_av_conv_state_change:function(t){if(t===this.state){return;
}this.state=t;
switch(t){case IMO.AVConv.state_idle:this.cleanup_conv();
if((typeof(this.conv_panel)!=="undefined")&&(this.conv_panel.get_top_widget(this.conv_panel.active_top_widget)===this)){this.conv_panel.hide_top_widget();
}if(this.no_wm_mode){b.goto_main_imo_page();
}break;
case IMO.AVConv.state_init:this.show_init_options();
break;
case IMO.AVConv.state_ringing:this.show_ringing_options();
break;
case IMO.AVConv.state_active:this.update_connection_status("");
this.stop_ringing();
this.stop_duration_timer();
this.start_duration_timer();
this.show_av_swf(this.av_conv.call_options);
break;
case IMO.AVConv.state_ringing_buddy:if(this.av_conv.call_type==="native"){this.ring_out={ring:IMO.Sound.get().ring("callout"),auto_cancel:Y.later(IMO.AVConv.RINGING_TIME,this,function(){if(this.ring_out){this.ring_out.ring.cancel();
this.ring_out=null;
this.av_conv.close_conv("buddy_missed",true,false);
}},null,false)};
}this.update_connection_status(this.av_conv.call_type!=="native"?"Waiting for buddy to access link":"Ringing buddy");
this.start_duration_timer();
this.show_av_swf(this.av_conv.call_options);
break;
case IMO.AVConv.state_noflash:this.cleanup_conv();
this.display_flash_install();
break;
default:break;
}if(t!==IMO.AVConv.state_ringing){g.chide(this.av_answer_cont);
}},start_duration_timer:function(){this.duration_timer=Y.later(1000,this,this.update_duration_timer,null,true);
this.start_time=new Date();
},stop_duration_timer:function(){if(this.duration_timer){this.duration_timer.cancel();
g.replace_content(this.av_duration_timer,g(""));
}this.duration_timer=null;
},update_duration_timer:function(){var v=new Date();
var y=(v.getTime()-this.start_time.getTime())/1000;
var x=y%60;
var w=Math.floor((y%3600)/60);
var t=Math.floor(y/3600);
var u=IMO.Utils.sprintf("%02d:%02d",w,x);
if(t){u=t+":"+u;
}g.replace_content(this.av_duration_timer,g(u));
},update_connection_status:function(t){g.replace_content(this.av_conn_status,r(t));
},on_av_connection_status_change:function(u,t){if(this.av_conv.state===IMO.AVConv.state_active){this.update_connection_status(t);
}},on_before_top_widget_visibility_change:function(u,t){if(u===IMO.REUI.ConversationPanel.CALL){if(t===false){this.protect();
}}},on_after_top_widget_visibility_change:function(u,t){if(u===IMO.REUI.ConversationPanel.CALL){if(t===true){this.unprotect();
}}this.visible=t;
},protect:function(){this.swf.hide();
},unprotect:function(t){if(!this.flash_running||t&&!this.visibility){return;
}this.adjust_flash_placement();
},show_volhover:function(){if(this.volhover_timer){this.volhover_timer.cancel();
delete this.volhover_timer;
}if(this.volume_slider_container&&!this.volhover_visible){var t=Y.DOM.getXY(this.spk_btn);
var u=Y.DOM.getXY(this.volume_slider_container.parentNode);
var w=t[1]-this.volume_slider.length-j.sprite_thumb_classic_y_height-2-u[1];
var v=t[0]-u[0];
this.volume_slider_container.style.top=w+"px";
this.volume_slider_container.style.left=v+"px";
g.css(this.volume_slider_container,{z_index:16200});
g.cshow(this.volume_slider_container);
this.volhover_visible=true;
}},decay_volhover:function(){if(!IMO.MoveNet.is_attached()&&!this.volhover_timer){this.volhover_timer=Y.later(200,this,this.hide_volhover,null,false);
}},hide_volhover:function(){if(this.volhover_timer){this.volhover_timer.cancel();
delete this.volhover_timer;
}if(this.volume_slider_container&&this.volhover_visible){g.chide(this.volume_slider_container);
this.volhover_visible=false;
}},on_av_remote_url_received:function(w,u){if(u===""||!this.no_wm_mode){return;
}g.cshow(this.link_btn);
this.link_input.value=u;
Y.later(0,this.link_input,this.link_input.select);
this.show_link_space();
this.clipboard_width=this.link_copy_button.dom.offsetWidth;
this.clipboard_height=this.link_copy_button.dom.offsetHeight;
this.clipboard_dom=g.div({style:{width:this.clipboard_width+"px",height:this.clipboard_height+"px",position:"absolute"}});
o(this.clipboard_dom,this.link_copy_button.dom);
var v=this;
this.clipboard_swf=new IMO.FlashWidget(IMO.SWF("clipboard"));
this.clipboard_swf.init(null,{text:u,hand_cursor:true},{bgcolor:"#0",wmode:"transparent"},{dom:this.clipboard_dom,callbacks:{on_mouse_enter:function(){},on_mouse_leave:function(){},on_click:function(){v.link_input.select();
g.cshow(v.av_link_copied_dom);
if(v.hide_av_link_copied){v.hide_av_link_copied.cancel();
delete v.hide_av_link_copied;
}v.hide_av_link_copied=Y.later(3000,v,function(){g.chide(v.av_link_copied_dom);
delete v.hide_av_link_copied;
});
}}});
},on_zindex:function(t){if(this.is_fullscreen){this.flash_zindex=t;
return;
}if(this.swf.dom){g.css(this.swf.dom,{z_index:t+1});
}},on_pos_size_change:function(){if(this.visible){this.unprotect();
}},on_call_button_pressed:function(t,u){if(this.av_conv.state===IMO.AVConv.state_idle){this.av_conv.initiate_call(u);
}},on_av_flash_init:function(v){this.settings_adaptor=new IMO.REUI.AVSettingsWMAdaptor(this);
g.show(this.settings_btn,"inline-block");
var t=this.av_conv.swf_object.getOptions("input");
var u=this.av_conv.swf_object.getOptions("output");
this.on_av_options_change(v,"input",t);
this.on_av_options_change(v,"output",u);
this.volume_slider=new IMO.REUI.SliderBar(IMO.REUI.SliderBar.VERTICAL_BAR,0,100,u.av,100,true);
this.on(this.volume_slider);
this.volume_slider_container=g.cdiv("volume-slider-container",{style:{position:"absolute"},context:this,onmouseenter:this.show_volhover,onmouseleave:this.decay_volhover},this.volume_slider.dom);
g.chide(this.volume_slider_container);
this.swf.dom.appendChild(this.volume_slider_container);
this.update_buttons();
},on_set_value:function(u,t){if(u===this.volume_slider){this.av_conv.set_speaker_volume(t);
return;
}},on_av_options_change:function(w,v,u){var t=false;
if(v==="input"){if(this.mic_muted!==u.mute){this.mic_muted=u.mute;
t=true;
}if(this.cam_disabled!==u.pause){this.cam_disabled=u.pause;
t=true;
}}else{if(this.speaker_muted!==u.mute){this.speaker_muted=u.mute;
t=true;
}}if(t){this.update_buttons();
}},refresh:function(){this.on_av_conv_state_change(this.av_conv.state);
},flash_log:function h(u,t){Y.log("Log from flash <"+u+"> : "+t);
},get_min_size:function(){return[c,m];
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var c=a.sprintf;
var e=IMO.Constants;
var b=15;
IMO.REUI.BuddyTooltipManager=function(f){this.blist=f;
this.hover=IMO.REUI.GetBuddyHover();
IMO.REUI.BuddyTooltipManager.superclass.constructor.call(this,this.blist.dom);
this.tooltip.set_content(this.hover.dom);
this.on(IMO.BuddyList.get());
this.on(this.hover);
};
Y.extend(IMO.REUI.BuddyTooltipManager,IMO.REUI.TooltipManager);
Y.mix(IMO.REUI.BuddyTooltipManager.prototype,{on_blist_remove:function(f){if(!this.hover||!this.hover.buddy){return;
}if(this.hover.buddy===f){this.hover.replace_buddy(null);
this.tooltip.hide();
}else{if(f.gid===this.hover.buddy.gid){if(f.ui&&f.ui.dom){d.remove(f.ui.dom);
f.ui.destroy();
}}}},is_an_item:function(f){return(Y.DOM.hasClass(f,"buddyitem")||Y.DOM.hasClass(f,"sharedgroup"));
},handle_hover:function(g){var f=IMO.BuddyList.get().buddies[Y.DOM.getAttribute(g,"id")];
if(!f){f=IMO.BuddyList.get().groups[Y.DOM.getAttribute(g,"id")];
}if(f!==this.hover.buddy){this.hover.replace_buddy(f);
}},handle_tooltip_mousedown:function(){if(document.activeElement===this.hover.buddy_alias_input){return true;
}return false;
},on_buddyhover_hide_request:function(){if(this.tooltip.shown){this.tooltip.hide();
}},handle_position_tt:function(l,p,k,g,n){var h=1;
var r=Y.DOM.getXY(this.blist.dom);
var q=d.get_size(this.blist.dom);
if(n){d.scroll_to_child(this.blist.dom,this.hovering_dom);
}var f=d.sprite_size(this.tooltip_arrow_sprite);
var j=l[1];
var o=j+g[1]-(r[1]+q[1]);
var m=Math.floor((p[1]/2)-(f[1]/2));
if(o>0){Y.log([this.min_arr_bottom,g[1],m]);
var i=a.min(o,g[1]-this.min_arr_bottom-m);
Y.log(i);
m+=i;
j-=i;
o-=i;
}if(o>b){j-=o-b;
}return{tt_pos:{top:j+"px",right:(d.dom("imo").offsetWidth-l[0]+h-f[0])+"px"},arr_pos:{top:m+"px"}};
}},true);
}());
(function(){var a=IMO.Utils;
var d=IMO.Utils.HTML;
var e=IMO.MoveNet.mouse_event_filter_creator(1);
var g=true;
var c=20;
var f=50;
var b=10;
IMO.REUI.DragDropBuddyManager=function(h){this.blistw=h;
d.on("mousedown",this.handle_blist_mouse_down,this.blistw.xdom,this);
d.on("mouseup",this.handle_blist_mouse_up,this.blistw.xdom,this);
this.ev=new IMO.Event();
this.moved=null;
};
Y.mix(IMO.REUI.DragDropBuddyManager.prototype,{handle_blist_mouse_down:function(j){if(j.button!==1){return;
}var i;
for(i=j.target._node;
i&&i!==this.blistw.xdom&&!Y.DOM.hasClass(i,"buddyitem")&&!Y.DOM.hasClass(i,"control_container")&&!Y.DOM.hasClass(i,"bar");
i=i.parentNode){}if(!i||!Y.DOM.hasClass(i,"buddyitem")){if(Y.DOM.hasClass(i,"sharedgroup")||Y.DOM.hasClass(i,"control_container")){var h=IMO.BuddyList.get().groups[i.id];
if(h&&IMO.REUI.BuddySearch.is_active()){this.ev.fire("on_click",h,j);
}}}else{this.core_buddy=IMO.BuddyList.get().buddies[i.getAttribute("id")];
this.buddy_dom=i;
this.prepare(j);
}},handle_blist_mouse_up:function(h){this.handle_mouse(h);
},prepare:function(i){this.initial_target=i.target._node;
if(!IMO.MoveNet.attach_move_net(this.handle_mouse,this)){Y.log("move net already attached");
var h=this.core_buddy;
this.core_buddy=null;
this.buddy_dom=null;
this.ev.fire("on_click",h,i,this.initial_target);
return;
}this.moved=false;
this.lasty=i.clientY;
this.dist_moved=0;
this.blist=this.blistw.dom;
this.blist_y=Y.DOM.getY(this.blist);
this.yoff=i.clientY-Y.DOM.getY(this.buddy_dom);
this.movable=null;
this.blist_overlay=null;
this.group_offs=null;
this.groups_height=null;
this.hi_group_id=null;
this.auto_scroll=null;
this.auto_scroll_timer=null;
},start_move:function(){this.ev.fire("on_begin_dd");
this.blist_overlay=d.cdiv("blist-overlay");
this.blist.parentNode.appendChild(this.blist_overlay);
this.movable=this.buddy_dom.cloneNode(true);
d.add_class(this.movable,"moving");
this.movable.setAttribute("id",null);
d.set_off(this.movable,[0,this.buddy_dom.offsetTop]);
d.set_size(this.movable,d.get_size(this.buddy_dom));
this.blist_overlay.appendChild(this.movable);
d.add_class(this.buddy_dom,"moved");
this.group_offs=[0];
var j=0;
var i=this.blistw.groups;
var h=null;
a.foreach(i,function(l,k){if(l===this.core_buddy.blist_group){h=k;
}j+=l.ui.dom.offsetHeight;
this.group_offs.push(j);
},this);
this.groups_height=j;
if(h===null){throw"WTF yy";
}this.hi_group_id=h;
d.add_class(i[this.hi_group_id].ui.dom,"moveto");
this.moved=true;
},scroll_if_needed:function(j){var h=this.blist;
var i=null;
if(j===0&&g){i="up";
}else{if(j+this.movable.offsetHeight===this.blist_overlay.offsetHeight&&g){i="down";
}}if(this.auto_scroll!==i){if(this.auto_scroll){this.auto_scroll_timer.cancel();
delete this.auto_scroll_timer;
}if(i){this.auto_scroll_timer=Y.later(f,this,function(){var k=a.cap(h.scrollTop+(i==="up"?-1:1)*c,0,h.scrollHeight-h.offsetHeight);
h.scrollTop=k;
},null,true);
}this.auto_scroll=i;
}},cleanup:function(){Y.log("cleaning up");
IMO.MoveNet.detach_move_net();
if(this.moved){this.ev.fire("on_end_dd");
d.remove_class(this.buddy_dom,"moved");
d.remove(this.movable);
d.remove(this.blist_overlay);
d.remove_class(this.blistw.groups[this.hi_group_id].ui.dom,"moveto");
if(this.auto_scroll_timer){this.auto_scroll_timer.cancel();
}}this.core_buddy=null;
this.buddy_dom=null;
this.moved=null;
},hi_nearest_group:function(l){if(this.group_offs[this.hi_group_id]<=l&&l<this.group_offs[this.hi_group_id+1]){return this.hi_group_id;
}var j=l<this.group_offs[this.hi_group_id]?-1:1;
var k=this.hi_group_id;
for(k+=j;
k>=0&&k+1<this.group_offs.length&&!(this.group_offs[k]<=l&&l<this.group_offs[k+1]);
k+=j){}if(k<0||k+1>=this.group_offs.length){throw"WTF";
}var h=this.blistw.groups;
d.remove_class(h[this.hi_group_id].ui.dom,"moveto");
d.add_class(h[k].ui.dom,"moveto");
this.hi_group_id=k;
return k;
},handle_mouse:function(m){a.clear_selection();
var k=null;
if(m!==null){k=e(m);
}else{k="mouseup";
}if(k==="smartup"){var j,l;
if(this.moved===null){return;
}else{if(this.moved===false){j=this.core_buddy;
this.cleanup();
this.ev.fire("on_click",j,m,this.initial_target);
}else{if(this.moved===true){j=this.core_buddy;
if(j instanceof IMO.IMBuddy&&j.gid){this.cleanup();
}else{l=this.blistw.groups[this.hi_group_id];
this.cleanup();
this.ev.fire("on_buddy_move",j,l);
}}else{Y.log("this.moved undefined?","error");
}}}}else{if(k==="smartmove"){var i=this.blist;
if(this.moved===false){this.dist_moved+=Math.abs(this.lasty-m.clientY);
this.lasty=m.clientY;
if(this.dist_moved>b){this.start_move();
}else{return;
}}var n=m.clientY-this.yoff-this.blist_y;
var h=a.min(i.offsetHeight,this.groups_height);
n=a.cap(n,0,h-this.movable.offsetHeight);
this.hi_nearest_group(n+i.scrollTop+this.yoff);
this.scroll_if_needed(n);
d.set_off(this.movable,[0,n]);
}else{Y.log("wtf","error");
}}if(m&&!IMO.MouseManager.get().check_handled("dd-on-click")){m.halt();
}},destroy:function(){}});
}());
(function(){var b=IMO.Utils;
var d=IMO.Utils.HTML;
var c=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
var f=IMO.Constants;
var a=null;
IMO.REUI.GetBuddyHover=function(){if(a===null){a=new IMO.REUI.BuddyHover();
IMO.REUI.GetBuddyHover=function(){return a;
};
}return a;
};
IMO.REUI.BuddyHover=function(){this.editable_buddy_alias_div=d.cspan("buddy_alias editable",{onclick:this.show_edit_alias,context:this});
this.buddy_alias_input=d.input({"class":"buddy_alias editable",onblur:this.rename_buddy,onkeydown:function(i){if(i.keyCode===13){this.rename_buddy();
}},context:this});
this.pencil=d.sprite("icn_edit",{onclick:this.show_edit_alias,context:this});
this.buddy_alias_div=d.cdiv("buddy_alias",this.editable_buddy_alias_div,this.buddy_alias_input,d.cdiv("clear"));
this.buddy_text=d.cspan("buddy_text",{onclick:this.show_buddy_text_input,context:this});
this.buddy_text_input=d.input({"class":"inner_buddy_status editable",onblur:this.set_buddy_text,onkeydown:function(i){if(i.keyCode===13){this.set_buddy_text();
}},context:this});
this.buddy_text_div=d.cdiv("buddy_text_div",this.buddy_text,this.buddy_text_input);
this.buddy_id_div=d.cdiv("detail",this.buddy_id_val=d.cspan("value"));
this.buddy_display_div=d.cdiv("detail",d.cspan("key",c("display name:")),this.buddy_display_val=d.cspan("value"));
d.chide(this.buddy_display_div);
this.buddy_group_div=d.cdiv("detail",d.cspan("key",c("group:")),this.buddy_group_val=d.cspan("value"));
this.buddy_account_div=d.cdiv("detail",d.cspan("key",c("account:")),this.buddy_account_val=d.cspan("value"));
this.buddy_details_div=d.cdiv("buddy-profile-details",this.buddy_id_div);
this.text_details_div=d.cdiv("text_details",this.buddy_alias_div,this.buddy_details_div,this.buddy_text_div);
this.inv_btn_span=d.span({"class":"btn_text"},c("Invite Buddy"));
this.inv_btn_div=d.cdiv("bhover_button",{onclick:this.inv_btn_click,context:this,id:"inv_btn"},d.sprite("icn_invite_plus"),this.inv_btn_span);
this.mute_btn_span=d.span({"class":"btn_text"},c("Mute"));
this.mute_btn_div=d.cdiv("bhover_button",{onclick:this.mute_btn_click,context:this,id:"mute_btn"},d.sprite("btn_videochat_speaker_enabled"),this.mute_btn_span);
this.leave_btn_span=d.span({"class":"btn_text"},c("Leave"));
this.leave_btn_div=d.cdiv("bhover_button",{onclick:this.delete_btn_click,context:this,id:"leave_btn"},d.sprite("icn_delete"),this.leave_btn_span);
this.fav_btn_span=d.span({"class":"btn_text"},"");
this.fav_btn_div=d.cdiv("bhover_button",{onclick:this.fav_btn_click,context:this,id:"fav_btn"},d.sprite("icn_favorite"),this.fav_btn_span);
this.block_btn_span=d.span({"class":"btn_text"},"");
this.block_btn_div=d.cdiv("bhover_button",{onclick:this.block_btn_click,context:this,id:"block_btn"},d.sprite("icn_block"),this.block_btn_span);
this.delete_btn_span=d.span({"class":"btn_text"},c("Delete"));
this.delete_btn_div=d.cdiv("bhover_button",{onclick:this.delete_btn_click,context:this,id:"delete_btn"},d.sprite("icn_delete"),this.delete_btn_span);
this.kick_btn_span=d.span({"class":"btn_text"},c("Kick"));
this.kick_btn_div=d.cdiv("bhover_button",{onclick:this.kick_btn_click,context:this,id:"kick_btn"},d.sprite("icn_delete"),this.kick_btn_span);
this.ban_btn_span=d.span({"class":"btn_text"},c("Ban"));
this.ban_btn_div=d.cdiv("bhover_button",{onclick:this.ban_btn_click,context:this,id:"ban_btn"},d.sprite("icn_delete"),this.ban_btn_span);
this.history_btn_span=d.span({"class":"btn_text"},c("History"));
var h=d.cdiv("bhover_button",{onclick:this.history_btn_click,context:this,id:"history_btn"},d.sprite("icn_chathistory_clock"),this.history_btn_span);
this.add_btn_span=d.span({"class":"btn_text"},c("Add to Contacts"));
this.add_btn_div=d.cdiv("bhover_button",{onclick:this.add_btn_click,context:this,id:"add_btn"},d.sprite("icn_add_buddy"),this.add_btn_span);
this.btn_states={"delete":1,kick:1,block:1,fav:1,leave:1,mute:1,inv:1,add:1};
var j=[];
j[0]=d.cdiv("clear");
j[1]=h;
var g=2;
b.foreach(this.btn_states,function(k,i){j[g]=this[i+"_btn_div"];
++g;
},this);
j[g]=d.cdiv("clear");
this.buttons_div=d.cdiv("buttons",j);
this.main_right_div=d.cdiv("main_right",this.text_details_div);
this.buddy_icon_img=d.img();
this.buddy_icon_pol=d.div({cls:"buddyicon_pol",onclick:this.set_group_image,context:this},d.span(" "),this.buddy_icon_img,d.span(" "));
this.buddy_icon_div=d.cdiv("buddyicon",this.buddy_icon_pol);
this.buddy_header=d.cdiv("buddy_header",this.main_right_div,this.buddy_icon_div);
this.buddy_list=d.cdiv("members_list");
this.dom=d.cdiv("buddyhover",{context:this},this.buddy_header,this.buddy_list,d.cdiv("clear"));
this.buddy=null;
this.on(IMO.BuddyIconDownloader.get());
this.ev=new IMO.Event();
this.load_preferences();
this.on(IMO.Session.get());
};
Y.mix(IMO.REUI.BuddyHover.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.BuddyHover.prototype,{on_bicon_ready:function(g,h){if(this.buddy&&this.buddy.ubid===g){this.buddy_icon_img.src=h;
}},set_detail:function(g,h){if(h){d.text(this[g+"_val"],h);
d.cshow(this[g+"_div"]);
}else{d.chide(this[g+"_div"]);
}},apply_btn_states:function(j){var h;
for(var g in j){h=j[g];
if(this.btn_states[h]===0){d.show(this[h+"_btn_div"]);
}this.btn_states[h]=2;
}for(h in this.btn_states){if(this.btn_states[h]===0){continue;
}--this.btn_states[h];
if(this.btn_states[h]===0){d.hide(this[h+"_btn_div"]);
}}},on_buddy_update:function(){d.replace_content(this.editable_buddy_alias_div,d(Y.Lang.trim(this.buddy.displaylias)||" "));
var n=null;
if(this.buddy instanceof IMO.SharedGroup){n=this.buddy.topic&&this.buddy.topic.length>0?this.buddy.topic:e("Set topic...");
}else{n=this.buddy.status;
}d.replace_content(this.buddy_text,IMO.Utils.linkify_string(n));
var m=[f.PROTO_GTALK,f.PROTO_MSN,f.PROTO_YAHOO,f.PROTO_SKYPE,f.PROTO_AIM,f.PROTO_XMPP];
if(!this.buddy.gid&&Y.Array.indexOf(m,this.buddy.account.proto)!==-1){this.set_detail("buddy_id",this.buddy.buid);
}else{this.set_detail("buddy_id",null);
}d.remove_class(this.editable_buddy_status_span,"editable");
d.remove_class(this.buddy_icon_pol,"clickable");
d.show(this.pencil);
d.add_class(this.editable_buddy_alias_div,"editable");
if(this.buddy.gid){if(this.buddy instanceof IMO.IMBuddy){d.hide(this.pencil);
d.remove_class(this.editable_buddy_alias_div,"editable");
var k=this.buddy.account.uid+";"+this.buddy.account.proto;
if((this.buddy.gid+";"+k!==this.buddy.buid)&&(this.buddy.account.groups.get_group(this.buddy.gid).admin||this.buddy.inviter===k)){d.remove_class(this.ban_btn_div,"disabled");
d.remove_class(this.kick_btn_div,"disabled");
}else{d.add_class(this.kick_btn_div,"disabled");
d.add_class(this.ban_btn_div,"disabled");
}if(this.buddy.type===f.GROUP_TYPE.DISCUSSION){this.apply_btn_states(["ban"]);
}else{this.apply_btn_states(["kick"]);
}}else{this.apply_btn_states(["leave","inv","mute"]);
d.add_class(this.editable_buddy_status_span,"editable");
d.add_class(this.buddy_icon_pol,"clickable");
d.replace_content(this.mute_btn_span,c(this.buddy.muted?"Unmute":"Mute"));
}}else{if(this.buddy.account.proto===f.PROTO_IMO&&this.buddy.nonbuddy){this.apply_btn_states(["block","add"]);
}else{this.apply_btn_states(["delete","block","fav"]);
if(this.buddy.account.proto===f.PROTO_NEWFACEBOOK){d.add_class(this.delete_btn_div,"disabled");
}else{d.remove_class(this.delete_btn_div,"disabled");
}}}var g=this.buddy.favorite?c("Remove Favorite"):c("Add Favorite");
d.replace_content(this.fav_btn_span,g);
var h=this.buddy.blocked?c("Unblock"):c("Block");
d.replace_content(this.block_btn_span,h);
d.replace_content(this.editable_buddy_status_span,IMO.Utils.linkify_string(this.buddy.get_status()));
this.buddy_icon_img.src=this.buddy.request_buddy_icon();
d.empty(this.buddy_list);
if(this.buddy.gid){var j=0;
b.foreach(this.buddy.get_buddies(),function(o){if(o.primitive===f.PRIM_OFFLINE){j++;
return;
}this._add_group_member(o);
},this);
if(j>0){var i=e("Show");
var l=j===1?e("offline contact"):e("offline contacts");
this.offline_header=d.cdiv("offline_header",d.cspan("button",d.sprite("icn_collapse")),d(i+" "+j+" "+l),{onclick:this._show_offline_buddies,context:this});
this.buddy_list.appendChild(this.offline_header);
}}},on_delete_buddy:function(g){this.replace_buddy(null);
this.ev.fire("on_buddyhover_hide_request",this);
},replace_buddy:function(g){this.rename_buddy();
if(this.buddy){this.unsubscribe(this.buddy);
}this.buddy=g;
if(g){this.on(this.buddy);
this.on_buddy_update();
}},inv_btn_click:function(h){IMO.MouseManager.get().handled(h,"hover-buddyhover-invite-button");
var g=IMO.REUI.GetGroupInviteWidget();
g.set_group(this.buddy);
Y.later(10,this,function(){g.show();
});
},mute_btn_click:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-mute_button");
this.buddy.set_muted(!this.buddy.muted,true);
if(this.buddy.muted){IMO.NM.add_notification(c("[GROUP] has been muted.",{GROUP:this.buddy.displaylias}));
d.replace_content(this.mute_btn_span,c("Unmute"));
}else{IMO.NM.add_notification(c("[GROUP] has been unmuted.",{GROUP:this.buddy.displaylias}));
d.replace_content(this.mute_btn_span,c("Mute"));
}},fav_btn_click:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-favorite-button");
if(this.buddy.gid){return;
}this.buddy.set_favorite(!this.buddy.favorite);
},block_btn_click:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-block-button");
if(this.buddy.gid){return;
}this.buddy.set_blocked(!this.buddy.blocked);
},add_btn_click:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-add-button");
this.buddy.account.add_buddy(this.buddy.buid,IMO.SharedConstants.BuddyGroups.IMO_CONTACTS);
},delete_btn_click:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-delete-button");
if(this.buddy.account.proto===f.PROTO_NEWFACEBOOK&&(!this.buddy.gid)){return;
}if(this.buddy.gid&&this.buddy instanceof IMO.IMBuddy){return;
}var i=null;
var h=null;
if(this.buddy instanceof IMO.SharedGroup){if(this.buddy.type===f.GROUP_TYPE.DISCUSSION){this.buddy.account.del_buddy(this.buddy);
return;
}i=e("Leave Group?");
h=e("Leaving [BUDDY_ALIAS].\n\nAre you sure?",{BUDDY_ALIAS:this.buddy.displaylias});
}else{i="Delete Contact?";
h=e("Deleting [BUDDY_ALIAS].\n\nAre you sure?",{BUDDY_ALIAS:this.buddy.displaylias});
}this.del_buddy_conf=new IMO.REUI.ConfirmModalPopup(i,h,[[c("Yes"),"blue"],[c("No"),"grey"]],this.handle_delete_buddy_confirm,this);
},kick_btn_click:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-kick-button");
if(!this.buddy.gid||d.has_class(this.kick_btn_div,"disabled")){return;
}var i=e("Kick member?");
var h=e("Kicking [BUDDY_ALIAS].",{BUDDY_ALIAS:this.buddy.displaylias})+"\n\n"+e("Are you sure?");
this.kick_member_conf=new IMO.REUI.ConfirmModalPopup(i,h,[[c("Yes"),"blue"],[c("No"),"grey"]],this.handle_kick_member_confirm,this);
},ban_btn_click:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-ban-button");
if(!this.buddy.gid||d.has_class(this.ban_btn_div,"disabled")){return;
}var i=e("Ban member?");
var h=e("Permanently banning [BUDDY_ALIAS] from this discussion.",{BUDDY_ALIAS:this.buddy.displaylias})+"\n\n"+e("Are you sure?");
this.ban_member_conf=new IMO.REUI.ConfirmModalPopup(i,h,[[c("Yes"),"blue"],[c("No"),"grey"]],this.handle_ban_member_confirm,this);
},history_btn_click:function(h){IMO.MouseManager.get().handled(h,"hover-buddyhover-history-button");
var g=IMO.REUI.get_history_search_widget();
g.show_previews(this.buddy);
},handle_delete_buddy_confirm:function(g){Y.log("got button "+g);
if(g===0){this.buddy.account.del_buddy(this.buddy);
}this.del_buddy_conf.destroy();
delete this.del_buddy_conf;
},handle_kick_member_confirm:function(g){Y.log("got button "+g);
if(g===0){this.buddy.account.groups.kick_member(this.buddy);
}this.kick_member_conf.destroy();
delete this.kick_member_conf;
},handle_ban_member_confirm:function(g){Y.log("got button "+g);
if(g===0){this.buddy.account.groups.ban_member(this.buddy);
}this.ban_member_conf.destroy();
delete this.ban_member_conf;
},show_edit_alias:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-alias-edit");
if(this.buddy.gid&&this.buddy instanceof IMO.IMBuddy){return;
}d.hide(this.editable_buddy_alias_div);
d.show(this.buddy_alias_input,"inline");
this.buddy_alias_input.value=this.buddy.displaylias;
this.buddy_alias_input.select();
this.editing=true;
IMO.REUI.B.blist_tt_manager.disable_tt(true);
},show_buddy_text_input:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-group-topic-edit");
if(!(this.buddy instanceof IMO.SharedGroup)){return;
}d.hide(this.buddy_text);
d.show(this.buddy_text_input,"inline");
this.buddy_text_input.value=this.buddy.topic;
this.buddy_text_input.select();
this.editing=true;
IMO.REUI.B.blist_tt_manager.disable_tt(true);
},set_buddy_text:function(){if(!this.editing){return;
}if(!(this.buddy instanceof IMO.SharedGroup)){return;
}this.editing=false;
d.hide(this.buddy_text_input);
d.show(this.buddy_text);
if(this.buddy instanceof IMO.SharedGroup){this.buddy.set_topic(this.buddy_text_input.value);
}IMO.REUI.B.blist_tt_manager.enable_tt();
},set_group_image:function(g){IMO.MouseManager.get().handled(g,"hover-buddyhover-icon-click");
if(!(this.buddy instanceof IMO.SharedGroup)){return;
}IMO.MouseManager.get().handled(g,"hover-buddyhover-icon-click");
IMO.REUI.IconPanel.show("Set group image",e("This image will be visible to all users in the group"),this.buddy.get_buddy_icon(),"im","set_group_image",{uid:this.buddy.account.uid,proto:this.buddy.account.proto,gid:this.buddy.gid,ssid:IMO.Network.get().ssid},this,this.set_group_image_complete);
},set_group_image_complete:function(g){},rename_buddy:function(){if(!this.editing){return;
}this.editing=false;
d.hide(this.buddy_alias_input);
d.show(this.editable_buddy_alias_div);
this.buddy.set_alias(Y.Lang.trim(this.buddy_alias_input.value));
IMO.REUI.B.blist_tt_manager.enable_tt();
},on_set_prefs:function(g){b.foreach(g,function(i,h){if(i.kind==="impref"&&i.pref==="show_buddy_icons"){this.show_buddy_icons(i.value);
}},this);
},on_recv_pref:function(h,g,i){if(h==="impref"&&g==="show_buddy_icons"){this.show_buddy_icons(i);
}},load_preferences:function(){var g=IMO.Session.get().get_pref("impref","show_buddy_icons",{value:true});
if(g!==null){this.show_buddy_icons(g.value);
}},show_buddy_icons:function(g){if(g===true){d.add_class(this.buddy_list,"icon_view");
}else{d.remove_class(this.buddy_list,"icon_view");
}},_show_offline_buddies:function(g){IMO.MouseManager.get().handled(g,"hover-show-offline");
d.chide(this.offline_header);
b.foreach(this.buddy.get_buddies(),function(h){if(h.primitive===f.PRIM_OFFLINE){this._add_group_member(h);
}},this);
},_add_group_member:function(i){var h=IMO.BuddyList.get().search([i.fake_buid]);
b.foreach(h,function(j){if(j.buid===i.fake_buid&&j.proto===i.proto&&j.displaylias){i.displaylias=j.displaylias;
}});
var g=new IMO.REUI.BuddyItem(i);
i.ui=g;
this.buddy_list.appendChild(g.dom);
}});
}());
(function(){var a=IMO.Utils;
var b=IMO.Constants;
var c=5000;
IMO.REUI.BuddyIconPriorityManager=function(){this.waiting_errors=[];
this.conversation_ubids=[];
this.visible_ubids=[];
this.vup=0;
Y.later(c,this,this.fetch_visible,null,true);
this.on(IMO.EventGateway.get());
};
Y.mix(IMO.REUI.BuddyIconPriorityManager.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.BuddyIconPriorityManager.prototype,{set_download_manager:function(d){this.download_manager=d;
this.on(this.download_manager);
},get_next:function(){var f;
if(this.get_hover_buddy()){f=this.download_manager.requests[this.get_hover_buddy().ubid];
if(f&&f.state===IMO.Constants.BID_STATE_PENDING){return this.get_hover_buddy().ubid;
}}var d;
try{d=a.foreach(this.conversation_ubids,function(h,e){var j=this.download_manager.requests[h];
if(j&&j.state===b.BID_STATE_PENDING){a.shiftn(this.conversation_ubids,e+1);
return h;
}},this);
if(d){return d;
}else{this.conversation_ubids.length=0;
}}catch(g){Y.log("conversation did not request image?","warn");
}d=a.foreach(this.waiting_errors,function(h,e){var j=this.download_manager.requests[h];
if(j&&j.state===b.BID_STATE_ERROR){a.shiftn(this.waiting_errors,e+1);
return h;
}},this);
if(d){f=this.download_manager.requests[d];
return d;
}else{this.waiting_errors.length=0;
}if(Y.DOM.hasClass(IMO.REUI.B.xdom,"icon_view")){for(;
this.vup<this.visible_ubids.length;
++this.vup){f=this.download_manager.requests[this.visible_ubids[this.vup]];
if(f&&f.state===b.BID_STATE_PENDING){return this.visible_ubids[this.vup++];
}}d=a.foreach(this.download_manager.pending_ubids,function(e,h){var i=this.download_manager.requests[h];
if(i&&i.state!==b.BID_STATE_PENDING){Y.log("bad pending_ubids!!","error");
}else{return h;
}return undefined;
},this);
return a.dfl(d,null);
}return null;
},on_bicon_error:function(e,d){var f=this.download_manager.requests[e];
var g=(1<<a.min(f.retries,8))*1000*(1+Math.random()*0.2);
Y.later(g,this,this.handle_error_timeout,[e],false);
},handle_error_timeout:function(d){this.waiting_errors.push(d);
this.download_manager.try_start();
},get_hover_buddy:function(){return IMO.REUI.B.blist_tt_manager.hover.buddy;
},on_get_conversation:function(d){this.conversation_ubids.push(d.buddy.ubid);
},fetch_visible:function(){this.visible_ubids.length=0;
this.vup=0;
if(!IMO.Session.get().get_pref("impref","show_buddy_icons")){return;
}var d=IMO.REUI.B.groups;
var f=IMO.REUI.B.dom.scrollTop;
var e=f+IMO.REUI.B.dom.offsetHeight;
a.foreach(d,function(n){if(n.ui.hidden){return;
}var j=n.ui.dom.offsetTop;
var o=j+b.sprite_group_header_height;
var m=j+n.ui.dom.offsetHeight;
if(f>=m||e<=o){return;
}var k=Math.floor((a.max(f,o)-o)/b.reui_buddyitem_big_height);
var h=Math.ceil((a.min(e,m)-o)/b.reui_buddyitem_big_height);
k=a.max(k,0);
h=a.min(h,n.ui.buddies.length);
for(var l=k;
l<h;
++l){this.visible_ubids.push(n.ui.buddies[l].ubid);
}},this);
},destroy:function(){this.unsubscribe_all();
}});
}());
(function(){var a=IMO.Utils;
var d=function(e){return IMO.Utils.HTML(e);
};
var c=function(f,g,e){g=g||f;
return IMO.Utils.HTML.a({href:f,target:"_blank",onclick:function(h){if(e){e(f,h);
}}},g);
};
var b=(function(){var h=/(?:ftp|http|https|gopher|mailto|news|nntp|telnet|wais|file|prospero|aim|webcal):\/\//i;
var f=/(?:ac|ad|ae|aero|af|ag|ai|al|am|an|ao|aq|ar|arpa|as|asia|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|biz|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cat|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|com|coop|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|info|int|io|iq|ir|is|it|je|jm|jo|jobs|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mo|mobi|mp|mq|mr|ms|mt|mu|museum|mv|mw|mx|my|mz|na|name|nc|ne|net|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|pro|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|travel|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|xxx|ye|yt|yu|za|zm|zw)/i;
var j=/(?:[A-Z0-9._%+\-]+@[A-Z0-9.\-]+\.[A-Z]{2,4})/i;
var g=/(?:[A-Z0-9._%+\-]+(?::[A-Z0-9._%+\-]+)?@)/i;
var l=/(?:[A-Z0-9_%+\-]+(?:\.[A-Z0-9_%+\-]+)*)/i;
var i=/(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/i;
var e=/(?::\d{1,5})/i;
var m=/(?:[\/]\S*(?=(?:\s|$)))/i;
var k=new RegExp("\\b("+j.source+"(?![\\\\/]))|(("+h.source+"|)("+g.source+"|)((?:(?:"+l.source+"\\."+f.source+")|"+i.source+")"+e.source+"?)("+m.source+"|\\b(?![\\\\/])))","ig");
return k;
}());
IMO.Utils.linkify_string=function(k,e,i){if(!k){return IMO.Utils.HTML.span();
}k=k||"";
i=i||Number.POSITIVE_INFINITY;
var j="";
var f=[];
var h=0;
var g=0;
k.replace(b,function(q,p,r,o,n,u,w,m,v){f.push(d(v.slice(h,Math.min(m,i))));
g=i-m;
if(g<=0){h=i;
return"";
}else{h=m+q.length;
}var l;
var t;
if(p){l="mailto:"+q;
t=q;
j=t.slice(0,g);
f.push(c(l,d(j),e));
return q;
}if(n.match(/^mailto:/)&&!w&&!o){l=n+u;
t=q;
j=t.slice(0,g);
f.push(c(l,d(j),e));
return q;
}t=r;
l=(o||"http://")+n+u+w;
j=t.slice(0,g);
f.push(c(l,d(j),e));
return q;
});
j=k.slice(h,i);
f.push(d(j));
return IMO.Utils.HTML.span(f);
};
IMO.Utils.EMOTICON_MAP={":(":"frown",":-(":"frown",":)":"smile",":-)":"smile",":p":"tongue",":P":"tongue",":-p":"tongue",":-P":"tongue",";)":"wink",";-)":"wink"};
IMO.Utils.emoticonify=function(m){var g=[];
var f=-1;
var l=false;
var n=m.nodeValue;
for(var j=0;
j<n.length;
j++){var h=2;
var e=n.substr(j,h);
var k=IMO.Utils.EMOTICON_MAP[e];
if(!k){h=3;
e=n.substr(j,h);
k=IMO.Utils.EMOTICON_MAP[e];
}if(k){if(f!==-1){g.push(IMO.Utils.HTML(n.substring(f,j)));
f=-1;
}g.push(IMO.Utils.HTML.sprite("imot_"+k,{alt:e}));
j+=h-1;
l=true;
}else{if(f===-1){f=j;
}}}if(f!==-1){g.push(IMO.Utils.HTML(n.substring(f,n.length)));
}return(l?IMO.Utils.HTML.span(g):m);
};
a.word_breaker=function(j){if(j.nodeType===3){var f;
var e=-1;
var h=0;
var g=document.createDocumentFragment();
for(f=0;
f<j.nodeValue.length;
++f){if(a.is_space(j.nodeValue.charAt(f))){e=f;
}else{if(f-e>15){g.appendChild(IMO.Utils.HTML(j.nodeValue.slice(h,f)));
g.appendChild(IMO.Utils.HTML.wbr());
h=f;
e=f-1;
}}}g.appendChild(IMO.Utils.HTML(j.nodeValue.slice(h,j.nodeValue.length)));
return g.childNodes.length>1?g:j;
}else{if(j.nodeType===1){a.foreach(j.childNodes,function(k){var i=a.word_breaker(k);
if(i!==k){j.replaceChild(i,k);
}});
return j;
}}};
a.shorten_buddy_name=(function(){var g=15;
var f=new RegExp("^.{1,"+g+"}[|/\\!@#$%&*_\\=+. \t]");
var e={};
return function(i){if(e.hasOwnProperty(i)){Y.log("cached");
return e[i].cloneNode(true);
}if(i.length<=g){e[i]=IMO.Utils.HTML(i);
return e[i];
}var h=i.match(f);
if(h===null){h=[i.substr(0,g-1),"\u2026"];
}else{Y.log(h);
h=h.toString();
h=h.substr(0,h.length-1);
}e[i]=IMO.Utils.HTML.span(h,{title:i});
return e[i];
};
}());
}());
(function(){var b=IMO.Utils;
var j=IMO.Utils.HTML;
var k=IMO.Utils.TranslateDom;
var i=IMO.Utils.TranslateTxt;
var a=IMO.Constants;
var d=b.sprintf;
var l;
var h;
var c;
var f;
var g;
IMO.REUI.BuddyPanel=function(){this.blist=new l();
this.auth_buddy_widgets=[];
this.auth_group_widgets=[];
this.on(IMO.Session.get());
this.on(IMO.Alpha.get());
var m=new IMO.UIWidgets.Menu({context:this},j.sprite("icn_add"));
m.add_option(k("Add Buddy"),function(){new IMO.REUI.AddBuddy();
});
m.add_option(k("Create Buddy List"),function(){new IMO.REUI.AddGroup();
});
m.add_option(k("Create Chat Group"),function(){new IMO.REUI.AddGroupChat();
});
this.buddysearch=new IMO.REUI.BuddySearch();
this.buddysearch_div=j.idiv("buddysearch",this.buddysearch.input_div,m.dom);
this.dom=j.idiv("buddypanel",{cls:"shadow"},this.buddysearch_div,this.blist.xdom);
this.load_preferences();
};
Y.mix(IMO.REUI.BuddyPanel.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.BuddyPanel.prototype,{on_set_prefs:function(m){b.foreach(m,function(o,n){if(o.kind==="impref"&&o.pref==="show_buddy_icons"){this.show_buddy_icons(o.value);
}},this);
},on_recv_pref:function(n,m,o){if(n==="impref"&&m==="show_buddy_icons"){this.show_buddy_icons(o);
}},load_preferences:function(){var m=IMO.Session.get().get_pref("impref","show_buddy_icons",{value:true});
if(m!==null){this.show_buddy_icons(m.value);
}},show_buddy_icons:function(m){if(m===true){j.add_class(this.blist.xdom,"icon_view");
IMO.BuddyIconDownloader.get().try_start();
}else{j.remove_class(this.blist.xdom,"icon_view");
}},on_create_account:function(m){this.on(m);
},on_remove_account:function(m){this.unsubscribe(m);
},destroy:function(){this.unsubscribe_all();
},get_widget:function(m){switch(m){case"auth-buddy":return this.auth_buddy_widgets[0];
case"auth-group":return this.auth_group_widgets[0];
default:return null;
}},on_hide:function(m){if(this.auth_buddy_widgets.length>0){this.auth_buddy_widgets[0].do_show();
}else{if(this.auth_group_widgets.length>0){this.auth_group_widgets[0].do_show();
}else{var n=m instanceof IMO.REUI.AuthBuddyWidget?"has_buddy_dialog":"has_group_dialog";
j.remove_class(this.blist.xdom,n);
}}},on_show:function(m){if(m.shown){return;
}this.dom.insertBefore(m.dom,this.buddysearch_div);
var n=m instanceof IMO.REUI.AuthBuddyWidget?"has_buddy_dialog":"has_group_dialog";
j.add_class(this.blist.xdom,n);
},on_auth_done:function(m){b.remove(this.auth_buddy_widgets,m);
b.remove(this.auth_group_widgets,m);
m.do_hide();
this.dom.removeChild(m.dom);
},on_auth_done_reflect:function(o){var n=function(p){if(p.buid===o||p.gid===o){return p;
}};
var m=b.foreach(this.auth_buddy_widgets,n);
if(m===undefined){m=b.foreach(this.auth_group_widgets,n);
}if(m!==undefined){this.on_auth_done(m);
}},on_buddy_request:function(p,q){var o=q.buid;
var n=q.balias;
var r=q.msg;
var m=new IMO.REUI.AuthBuddyWidget(p,o,n,r);
this.on(m);
this.auth_buddy_widgets.push(m);
this.auth_buddy_widgets[0].do_show();
},on_group_invitation:function(q,r){var o=null;
for(var p=0;
p<this.auth_group_widgets.length;
++p){var n=this.auth_group_widgets[p];
if(r.buid===n.buid){if(n.iid){IMO.NM.add_notification(k("Accept the invitation to chat in the group"),IMO.REUI.Notification.types.info);
IMO.Session.get().group_invitation.destroy();
o=p;
}}}var m=new IMO.REUI.AuthGroupWidget(q,r);
this.on(m);
if(o===null){this.auth_group_widgets.push(m);
this.auth_group_widgets[0].do_show();
}else{if(o===0){this.auth_group_widgets=this.auth_group_widgets.splice(1,0,m);
this.on_auth_done(this.auth_group_widgets[0]);
}else{this.auth_group_widgets=this.auth_group_widgets.splice(o,1,m);
}}}});
var e=null;
l=function(){e=this;
IMO.REUI.B=this;
this.xdom=j.cdiv("blist-container",this.dom=j.idiv("blist"));
this.groups=[];
this.frozen=false;
this.freeze_timer=null;
this.on(IMO.BuddyList.get());
this.on(IMO.Session.get());
this.on_recv_pref("impref","grouptoggles",IMO.Session.get().get_pref("impref","grouptoggles",{}));
this.on_recv_pref("impref","groupmutes",IMO.Session.get().get_pref("impref","groupmutes",{}));
this.blist_tt_manager=new IMO.REUI.BuddyTooltipManager(this);
this.buddy_dd_manager=new IMO.REUI.DragDropBuddyManager(this);
this.on(this.blist_tt_manager);
this.on(this.buddy_dd_manager);
this.on(IMO.BuddyIconDownloader.get());
b.foreach(IMO.BuddyList.get().get_groups(),function(m){this.on_blist_create_group(m);
},this);
};
Y.mix(l.prototype,IMO.EventTarget);
Y.mix(l.prototype,{insert_group:function(o){if(!o.shared_group){o.ui=new h(o,this);
}if(o===IMO.BuddyList.get().DISCUSSIONS_GROUP){return;
}var m=this.groups.length;
if(this.groups.length===0||this.groups[m-1].guide<o.guide){this.dom.appendChild(o.ui.dom);
this.groups.push(o);
return;
}var n=0;
while((n<m)&&(this.groups[n].guide<o.guide)){n++;
}this.dom.insertBefore(o.ui.dom,this.groups[n].ui.dom);
this.groups.splice(n,0,o);
},remove_group:function(m){j.remove(m.ui.dom);
IMO.Utils.remove(this.groups,m);
},delay_unfreeze:function(m){if(!this.frozen){return;
}if(this.freeze_timer){this.freeze_timer.cancel();
}this.freeze_timer=Y.later(m,this,function(){this.freeze_timer=null;
this.unfreeze();
});
},freeze:function(){if(this.frozen){return;
}this.frozen=true;
b.foreach(this.groups,function(m){m.ui.clear(true);
},this);
Y.log(d("freezing buddylist %.0f",((new Date()).getTime()%10000)),"info");
},unfreeze:function(){if(!this.frozen){return;
}Y.log(d("unfreezing buddylist %.0f",((new Date()).getTime()%10000)),"info");
this.last_unfreeze=new Date();
if(!this.last_unfreeze_timer){this.last_unfreeze_timer=Y.later(20000,this,function(){var m=new Date();
});
}j.hide(this.dom);
b.foreach(this.groups,function(m){m.ui.populate();
},this);
j.show(this.dom);
this.frozen=false;
},on_blist_begin:function(m){if(m>5){this.freeze();
this.delay_unfreeze(5000);
}else{this.delay_unfreeze(200);
}},on_blist_end:function(){this.delay_unfreeze(200);
},on_blist_add:function(m){m.ui=new IMO.REUI.BuddyItem(m);
var n=m.blist_group;
if(!n.ui){this.insert_group(n);
}if(!this.frozen){n.ui.insert_buddy(m);
}},on_buddy_update:function(m){if(m.ui){m.ui.on_buddy_update(m,null,null,true);
}},on_blist_shared_group_add:function(m){this.insert_shared_group(m);
},on_blist_group_changed:function(m,o){if(this.frozen){return;
}o.ui.remove_buddy(m);
var n=m.blist_group;
if(!n.ui){this.insert_group(n);
}n.ui.insert_buddy(m);
},on_blist_remove:function(m){if(m.gid&&m instanceof IMO.IMBuddy){return;
}if(m.ui){if(!this.frozen&&m.blist_group){m.blist_group.ui.remove_buddy(m);
}m.ui.destroy();
}},on_blist_create_group:function(m){if(!m.ui){this.insert_group(m);
}b.foreach(m.get_buddies(),function(n){if(!n.ui){this.on_blist_add(n);
}},this);
},on_blist_remove_group:function(m){if(m.ui){m.ui.destroy();
}},on_recv_pref:function(n,m,o){if(n==="impref"&&m==="grouptoggles"){b.foreach(this.groups,function(p){if(o.hasOwnProperty(p.name)&&(o[p.name]!==p.ui.hidden)){p.ui.toggle();
}});
}},on_tt_click:function(m){if(!IMO.MouseManager.get().check_handled("hover-show-offline")){m.tooltip.hide();
}if(IMO.MouseManager.get().check_handled("control*")||IMO.MouseManager.get().check_handled("hover*")){return;
}if(m.hover.buddy){this.open_conv(m.hover.buddy);
}},on_click:function(m,o,n){if(n&&n.tagName==="A"){o.stopPropagation();
IMO.MouseManager.get().handled(null,"dd-on-click");
window.open(n.href);
return;
}if(IMO.MouseManager.get().check_handled("control*")){return;
}IMO.MouseManager.get().handled(null,"buddy");
this.open_conv(m);
this.blist_tt_manager.hide_current(true);
},open_conv:function(m){var n=m.get_im_conversation();
if(n.ui){n.ui.focus();
}},on_buddy_move:function(m,n){if(m instanceof IMO.IMBuddy&&m.gid){return;
}if(m.nonbuddy){m.account.add_buddy(m.buid,n.name);
}else{m.set_group(n);
}},on_begin_dd:function(){this.blist_tt_manager.disable_tt();
},on_end_dd:function(){this.blist_tt_manager.enable_tt();
},on_bicon_ready:function(n,o){var m=IMO.BuddyList.get().buddies[n];
if(m&&m.ubid===n){m.ui.icon.src=o;
}}});
h=function(n,m){this.buddylist=m;
this.group=n;
this.buddies=[];
this.change={};
this.list=j.div({"class":"buddygrouplist"});
this.hidden=false;
this.dom=j.div({"class":"buddygroup"},j.div(this.bar=IMO.REUI.Bar("white",{context:this,onclick:this.toggle},j.span({cls:"title"},n.display_name,null),j.span({cls:"button"},this.expand=j.sprite("icn_expand")),j.span({cls:"button dummy"}))),this.list);
if(IMO.Session.get().get_pref("impref","grouptoggles",{})[n.name]){this.toggle();
}};
Y.mix(h.prototype,IMO.EventTarget);
Y.mix(h.prototype,{handle_header_click:function(m){IMO.MouseManager.get().handled(m,"buddylist-grouptitle");
this.set_collapsed(!this.hidden,true);
},set_collapsed:function(o,m){if(o===undefined){o=b.dfl(IMO.Session.get().get_pref("impref","grouptoggles",{})[this.group.name],false);
}if(this.hidden!==o){j[o?"hide":"show"](this.list);
this.expand.className="sprite_icn_"+(o?"collapse":"expand");
this.hidden=o;
Y.log("setting class name to "+this.expand.className);
if(o){j.add_class(this.bar,"collapsed");
}else{j.remove_class(this.bar,"collapsed");
}}if(m){var n=IMO.Session.get().get_pref("impref","grouptoggles",{});
n[this.group.name]=this.hidden;
IMO.Session.get().set_pref("impref","grouptoggles",n);
}},toggle:function(m){IMO.MouseManager.get().handled(m,"buddylist-grouptitle");
this.set_collapsed(!this.hidden,true);
},insert_buddy:function(m){this._insert_buddy(m);
this.subscribe_change(m);
},subscribe_change:function(n){var m=function(q,p,r,o){if((q==="on_buddy_update")&&(p.guide!==o.guide)&&(p.blist_group===this.group)&&o.guide){this._remove_buddy(p);
this._insert_buddy(p);
}};
this.change[n.ubid]={buddy:n,cb:m};
n.ev.subscribe(m,this,true);
},unsubscribe_change:function(m){if(this.change[m.ubid]){m.ev.unsubscribe(this.change[m.ubid].cb,this);
delete this.change[m.ubid];
}},remove_buddy:function(m){this._remove_buddy(m);
this.unsubscribe_change(m);
},_insert_buddy:function(p){if(this.group===IMO.BuddyList.get().OFFLINE_GROUP){j.add_class(p.ui.dom,"offline");
}else{j.remove_class(p.ui.dom,"offline");
}j.chide(p.ui.control_container);
p.ui.group=this;
var m=this.buddies.length;
if((this.buddies.length===0)||IMO.IMBuddy.buddyComparator(p,this.buddies[m-1])>0){this.list.appendChild(p.ui.dom);
this.buddies.push(p);
return;
}var q=0;
var n=m-1;
while(q<n){var o=Math.floor((q+n)/2);
if(IMO.IMBuddy.buddyComparator(p,this.buddies[o])<0){n=o;
}else{q=o+1;
}}this.list.insertBefore(p.ui.dom,this.buddies[n].ui.dom);
this.buddies.splice(n,0,p);
},_remove_buddy:function(m){if(m.ui&&m.ui.dom){j.remove(m.ui.dom);
}b.remove(this.buddies,m);
},populate:function(){this.clear();
var m=document.createDocumentFragment();
b.foreach(this.group.get_buddies(),function(n){if(this.group===IMO.BuddyList.get().OFFLINE_GROUP){j.add_class(n.ui.dom,"offline");
}else{j.remove_class(n.ui.dom,"offline");
}n.ui.group=this;
this.subscribe_change(n);
this.buddies.push(n);
m.appendChild(n.ui.dom);
},this);
this.list.appendChild(m);
},clear:function(m){b.foreach(this.change,function(o,n){if(o.buddy.ev){o.buddy.ev.unsubscribe(o.cb,this);
}delete this.change[n];
},this);
b.foreach(this.buddies,function(n){if(n.ui){delete n.ui.group;
}});
this.buddies=[];
if(!m){j.empty(this.list);
}},destroy:function(){this.clear();
e.remove_group(this.group);
j.destroy(this.dom);
delete this.dom;
delete this.list;
delete this.group.ui;
}});
IMO.REUI.BuddyItem=function(m){this.group=null;
this.buddy=m;
if(j.div().getElementsByClassName){if(m instanceof IMO.SharedGroup){Y.mix(this,IMO.REUI.BuddyItem.get_group_item(m));
}else{Y.mix(this,IMO.REUI.BuddyItem.get_buddy_item(m));
}}else{if(m instanceof IMO.SharedGroup){this.dom=j.cdiv("buddyitem",this.control_container=j.span({cls:"control_container"}),j.span({cls:"imgwrap"},this.icon=j.img({cls:"icon"})),this.img=j.img({cls:"buddyimg img",src:"/images/blank.gif"}),this.online=j.span({cls:"online"}),j.span({cls:"accountdisplay"},this.display=j.span({cls:"group_name"})),this.status=j.span({cls:"statusdisplay status"},j.span()));
}else{this.dom=j.cdiv("buddyitem",this.control_container=j.span({cls:"control_container"}),j.span({cls:"imgwrap"},this.icon=j.img({cls:"icon"})),this.img=j.img({cls:"buddyimg img",src:"/images/blank.gif"}),j.span({cls:"accountdisplay"},this.display=j.span()),this.status=j.span({cls:"statusdisplay status"},j.span()));
}}this.dom.setAttribute("id",this.buddy.ubid);
j.on("mouseover",this.handle_mouse_over,this.dom,this);
j.on("mouseout",this.handle_mouse_out,this.dom,this);
j.on("click",this.open_conv,this.dom,this);
this.on(m);
this.on_buddy_update(m,null,null,true);
};
IMO.REUI.BuddyItem.get_buddy_item=function(){if(!IMO.REUI.BuddyItem.buddy_allocator){var m=j.div({cls:"buddyitem"},j.span({cls:"control_container"}),j.span({cls:"imgwrap"},j.img({cls:"icon",src:"/images/blank.gif"})),j.img({cls:"buddyimg img",src:"/images/blank.gif"}),j.span({cls:"accountdisplay"},j.span({cls:"display"})),j.span({cls:"statusdisplay status"},j.span()));
IMO.REUI.BuddyItem.buddy_allocator=new b.DomAllocator(m,["icon","img","status","display","control_container"]);
}return IMO.REUI.BuddyItem.buddy_allocator.get();
};
IMO.REUI.BuddyItem.get_group_item=function(){if(!IMO.REUI.BuddyItem.group_allocator){var m=j.div({cls:"buddyitem"},j.span({cls:"control_container"}),j.span({cls:"imgwrap"},j.img({cls:"icon",src:"/images/blank.gif"})),j.span({cls:"online"}),j.span({cls:"accountdisplay"},j.span({cls:"display group_name"})),j.span({cls:"statusdisplay status"},j.span()));
IMO.REUI.BuddyItem.group_allocator=new b.DomAllocator(m,["icon","online","status","display","control_container"]);
}return IMO.REUI.BuddyItem.group_allocator.get();
};
Y.mix(IMO.REUI.BuddyItem.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.BuddyItem.prototype,{on_buddy_update:function(p,r,m,s){if(s||m.icon!==p.icon){this.icon.src=this.buddy.request_buddy_icon();
}if(p instanceof IMO.IMBuddy&&(s||m.primitive!==p.primitive)){this.img.className="buddyimg sprite_"+this.buddy.protoicon;
if(p.blist_group instanceof IMO.SharedGroup){this.update_online_members(p.blist_group);
}}if(p instanceof IMO.SharedGroup){this.update_online_members(p);
}if(s||m.displaylias!==p.displaylias){j.replace_content(this.display,j(this.buddy.displaylias));
}if((s&&p.status)||(!s&&m.status!==p.status)){if(this.status.firstChild){this.status.replaceChild(IMO.Utils.linkify_string(this.buddy.status),this.status.firstChild);
}else{this.status.appendChild(IMO.Utils.linkify_string(this.buddy.status));
}}if((s&&p.topic)||(!s&&m.topic!==p.topic)){var o=IMO.Utils.linkify_string(this.buddy.topic);
if(this.status.firstChild){this.status.replaceChild(o,this.status.firstChild);
}else{this.status.appendChild(o);
}}if(this.buddy instanceof IMO.SharedGroup||!this.buddy.gid){var n=this.buddy.favorite?"Remove favorite":"Add favorite";
if(this.fav_text!==n){j.replace_content(this.fav_text_container,k(n));
this.fav_text=n;
}var q=this.buddy.blocked?"Unblock":"Block";
if(this.block_text!==q){j.replace_content(this.block_text_container,k(q));
this.block_text=q;
}}},open_conv:function(m){if(IMO.MouseManager.get().check_handled("control*")||IMO.MouseManager.get().check_handled("dropdown*")){return;
}if(m){IMO.MouseManager.get().handled(m,"hover-buddyhover-click");
}var n=this.buddy.get_im_conversation();
if(n.ui){n.ui.focus();
}},handle_mouse_over:function(){if(!this.more_menu){var q=null;
this.more_menu=new IMO.UIWidgets.Menu({context:this},j.sprite("icn_buddy_more"));
j.add_class(this.more_menu.options_container,"options_container");
if(this.buddy instanceof IMO.SharedGroup){q=j.span({cls:"control_buttons"},j.sprite("icn_invite",{cls:"control_button",title:i("Invite"),onclick:this.inv_btn_click,context:this}),this.mute_button=j.span({cls:"control_button",title:i(this.buddy.muted?"Unmute":"Mute"),onclick:this.mute_btn_click,context:this},j.sprite(this.buddy.muted?"icn_muted":"icn_mute")));
this.fav_text=(this.buddy.favorite?"Remove favorite":"Add favorite");
this.more_menu.add_option(this.fav_text_container=j.span(k(this.fav_text)),this.fav_btn_click,this);
this.more_menu.add_option(k("History"),this.history_btn_click,this);
this.more_menu.add_option(k("Leave"),this.delete_btn_click,this);
this.control_container.appendChild(q);
this.control_container.appendChild(this.more_menu.dom);
}else{q=j.span({cls:"control_buttons"},j.sprite("icn_history",{cls:"control_button",title:i("History"),onclick:this.history_btn_click,context:this}));
this.control_container.appendChild(q);
if(this.buddy.gid){if(this.buddy.account){var n=this.buddy.account.groups.get_group(this.buddy.gid);
var p=n.admin;
if(p){var m=this.buddy.admin;
if(!m){var o;
if(n.type===a.GROUP_TYPE.DISCUSSION){o=i("Ban");
}else{o=i("Kick");
}q.appendChild(j.sprite("icn_kick",{cls:"control_button",title:o,onclick:this.kick_btn_click,context:this}));
}}}}else{this.fav_text=this.buddy.favorite?"Remove favorite":"Add favorite";
this.more_menu.add_option(this.fav_text_container=j.span(k(this.fav_text)),this.fav_btn_click,this);
this.more_menu.add_option(k("Delete"),this.delete_btn_click,this);
this.block_text=this.buddy.blocked?"Unblock":"Block";
this.more_menu.add_option(this.block_text_container=j.span(k(this.block_text)),this.block_btn_click,this);
this.control_container.appendChild(this.more_menu.dom);
}}}j.chide(this.status);
j.cshow(this.control_container);
},handle_mouse_out:function(){j.chide(this.control_container);
j.cshow(this.status);
},inv_btn_click:function(n){IMO.MouseManager.get().handled(null,"control-invite-button");
var m=IMO.REUI.GetGroupInviteWidget();
m.set_group(this.buddy);
Y.later(10,this,function(){m.show();
});
},mute_btn_click:function(m){IMO.MouseManager.get().handled(m,"control-mute_button");
this.buddy.set_muted(!this.buddy.muted,true);
if(this.buddy.muted){IMO.NM.add_notification(k("[GROUP] has been muted.",{GROUP:this.buddy.displaylias}));
j.replace_content(this.mute_button,j.sprite("icn_muted"));
this.mute_button.title=i("Unmute");
}else{IMO.NM.add_notification(k("[GROUP] has been unmuted.",{GROUP:this.buddy.displaylias}));
j.replace_content(this.mute_button,j.sprite("icn_mute"));
this.mute_button.title=i("Mute");
}},fav_btn_click:function(m){IMO.MouseManager.get().handled(m,"control-favorite-button");
this.buddy.set_favorite(!this.buddy.favorite);
},block_btn_click:function(m){IMO.MouseManager.get().handled(m,"control-block-button");
if(this.buddy.gid){return;
}this.buddy.set_blocked(!this.buddy.blocked);
},delete_btn_click:function(m){IMO.MouseManager.get().handled(m,"control-delete-button");
if(this.buddy.account.proto===a.PROTO_NEWFACEBOOK&&(!this.buddy.gid)){return;
}if(this.buddy.gid&&this.buddy instanceof IMO.IMBuddy){return;
}var o=null;
var n=null;
if(this.buddy instanceof IMO.SharedGroup){this.buddy.set_favorite(false);
this.buddy.account.del_buddy(this.buddy);
return;
}o="Delete Contact?";
n=i("Deleting [BUDDY_ALIAS].\n\nAre you sure?",{BUDDY_ALIAS:this.buddy.displaylias});
this.del_buddy_conf=new IMO.REUI.ConfirmModalPopup(o,n,[[k("Yes"),"blue"],[k("No"),"grey"]],this.handle_delete_buddy_confirm,this);
},kick_btn_click:function(o){IMO.MouseManager.get().handled(o,"control-kick-button");
if(!this.buddy.gid){return;
}var n=this.buddy.account.uid+";"+this.buddy.account.proto;
var m=this.buddy.account.groups.get_group(this.buddy.gid);
if(!((this.buddy.gid+";"+n!==this.buddy.buid)&&(m.admin||this.buddy.inviter===n))){return;
}var q=i("Kick member?");
var p=i("Kicking [BUDDY_ALIAS].",{BUDDY_ALIAS:this.buddy.displaylias})+"\n\n"+i("Are you sure?");
if(m.type===a.GROUP_TYPE.DISCUSSION){q=i("Ban member?");
p=i("Permanently banning [BUDDY_ALIAS] from this discussion.",{BUDDY_ALIAS:this.buddy.displaylias})+"\n\n"+i("Are you sure?");
}this.kick_member_conf=new IMO.REUI.ConfirmModalPopup(q,p,[[k("Yes"),"blue"],[k("No"),"grey"]],this.handle_kick_member_confirm,this);
},history_btn_click:function(n){IMO.MouseManager.get().handled(n,"control-history-button");
var m=IMO.REUI.get_history_search_widget();
m.show_previews(this.buddy);
},handle_delete_buddy_confirm:function(m){Y.log("got button "+m);
if(m===0){this.buddy.set_favorite(false);
this.buddy.account.del_buddy(this.buddy);
}this.del_buddy_conf.destroy();
delete this.del_buddy_conf;
},handle_kick_member_confirm:function(m){Y.log("got button "+m);
if(m===0){var n=this.buddy.account.groups.get_group(this.buddy.gid);
if(n.type===a.GROUP_TYPE.DISCUSSION){this.buddy.account.groups.ban_member(this.buddy);
}else{this.buddy.account.groups.kick_member(this.buddy);
}}this.kick_member_conf.destroy();
delete this.kick_member_conf;
},update_online_members:function(n){if(n instanceof IMO.SharedGroup&&n.buddies&&n.ui){var m=0,o=0;
b.foreach(n.get_buddies(),function(p){o++;
if(p.primitive!==a.PRIM_OFFLINE&&p.primitive!==a.PRIM_PENDING){m++;
}});
j.replace_content(n.ui.online,j(m+"/"+o));
}},destroy:function(){this.unsubscribe_all();
delete this.buddy;
if(this.dom){j.remove(this.dom);
j.destroy(this.dom);
}delete this.dom;
}});
g=function(n,m){this.buddylist=m;
this.group=n;
this.buddy=n;
this.buddies=[];
this.change={};
this.list=j.div({"class":"buddygrouplist"});
this.hidden=false;
this.color_classes={};
this.color_classes[a.GROUP_TYPE.TEMP]="grey sharedgroup sprite_conference_header";
this.color_classes[a.GROUP_TYPE.DISCUSSION]="grey sharedgroup sprite_discussion_header";
this.color_classes[a.GROUP_TYPE.IMOGROUP]="grey sharedgroup sprite_sharedgroup_header";
this.color_classes[a.GROUP_TYPE.DEFAULT]="grey sharedgroup sprite_sharedgroup_header";
this.dom=j.div({cls:"buddygroup"},j.div(this.bar=IMO.REUI.Bar(this.color_classes[n.type||a.GROUP_TYPE.DEFAULT],{context:this,onclick:this.fake_blist_click,"class":"sharedgroup",id:n.ubid},this.title=j.span({cls:"title"},n.displaylias),this.icn_native=j.sprite("groups_skype_20"),this.icn_muted=j.sprite("icn_group_muted"),j.span({cls:"button",context:this,onclick:this.click_toggle},this.expand=j.sprite("icn_expand")),j.span({cls:"button dummy"}))),this.invite_btn=this.group.is_native?null:j.div({cls:"invite-btn",context:this,onclick:this.click_inv_buddy},k("Invite Buddy")),this.list);
if(IMO.Session.get().get_pref("impref","grouptoggles",{})[n.name]){this.toggle();
}if(!this.group.is_native){j.hide(this.icn_native);
}this.on(n);
this.on_set_muted(n.muted);
};
Y.extend(g,h);
Y.mix(g.prototype,IMO.EventTarget);
Y.mix(g.prototype,{fake_blist_click:function(){if(!IMO.MouseManager.get().check_handled("buddylist-sharedgroup*")){this.buddylist.on_click(this.buddy,null,null);
}},click_inv_buddy:function(n){IMO.MouseManager.get().handled(n,"buddylist-invite-button");
var m=IMO.REUI.GetGroupInviteWidget();
m.set_group(this.group);
Y.later(10,this,function(){m.show();
});
},toggle:function(){g.superclass.toggle.call(this);
if(!this.invite_btn){return;
}if(this.invite_btn.style.display==="none"){j.show(this.invite_btn);
}else{j.hide(this.invite_btn);
}},click_toggle:function(m){IMO.MouseManager.get().handled(m,"buddylist-sharedgroup-toggle");
this.toggle();
},handle_header_click:function(){this.fake_blist_click();
},on_set_muted:function(m){if(m){j.show(this.icn_muted);
if(this.group.is_native){j.hide(this.icn_native);
}}else{j.hide(this.icn_muted);
if(this.group.is_native){j.show(this.icn_native);
}}},on_buddy_update:function(){this.bar.replaceChild(j.span({cls:"title"},this.group.displaylias),this.bar.firstChild);
var m=this.color_classes[this.group.type||a.GROUP_TYPE.DEFAULT];
j.mex_class(this.bar,m,Y.Object.values(this.color_classes));
this.buddylist.update_shared_group(this.group);
}},true);
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
IMO.REUI.BuddySearch=function(){var g=false;
var m;
IMO.REUI.BuddySearch.is_active=function(){return g;
};
var f="";
var k=0;
var v=0;
var s=[];
var p=null;
var h=IMO.REUI.B.dom;
var y=function(){if(p===null){p=h.scrollTop;
}};
var z=function(){if(p!==null){h.scrollTop=p;
p=null;
}};
var t=function(A){a.foreach(IMO.BuddyList.get().get_groups(),function(C,B){a.foreach(C.get_buddies(),function(E,F){var D=E.ui;
if(!D){return;
}A(D);
});
});
};
var n=c.cdiv("no-buddies-msg",b("no buddies matched your criteria"));
c.chide(n);
IMO.REUI.B.dom.appendChild(n);
var l=function(A){return a.filter(A,function(B){if(B.gid&&B instanceof IMO.IMBuddy){return false;
}return B.ui;
});
};
var q=function(A){y();
if(!g){m.value="";
}g=true;
c.add_class(m,"active");
IMO.Stats.increment_counter("focus_buddysearch");
s=l(IMO.BuddyList.get().get_buddies());
k=0;
if(s[k]){c.add_class(s[k].ui.dom,"selected");
c.scroll_to_child(h,s[k].ui.dom);
}a.foreach(IMO.BuddyList.get().groups,function(B){B.ui.set_collapsed(false,false);
});
};
var e=function(){Y.log("buddysearch blur");
g=false;
c.remove_class(m,"active");
m.value=d("Search buddies\u2026");
s=[];
var A=function(B){B.search_hide=false;
c.remove_class(B.dom,"selected");
c.show(B.dom);
};
t(A);
a.foreach(IMO.BuddyList.get().groups,function(B){c.show(B.ui.dom);
B.ui.set_collapsed();
});
c.chide(n);
z();
if(document.activeElement===m){m.blur();
}a.log("IMO.WM.B = %s",IMO.WM.B);
if(IMO.WM.B){Y.later(10,IMO.WM.B,IMO.WM.B.window_refocus);
}return true;
};
var x=function(B){if(!g){return;
}if(document.activeElement.tagName==="input"&&!(c.is_child("buddypanel",document.activeElement)||c.is_child("buddyhover",document.activeElement))){Y.log(document.activeElement,"info");
e();
}var A=c.walk(B.target._node,function(C){if(c.has_class(C,"buddyhover")){return true;
}if(C.id==="buddypanel"){return true;
}});
if(!A){Y.log(B.target._node,"info");
e();
}};
IMO.MouseManager.get().register(x,null);
var u=function(A){};
var i=false;
var w=function(A){if(i){return;
}i=true;
Y.later(10,this,function(){i=false;
});
if(s[k]){c.remove_class(s[k].ui.dom,"selected");
}if(A===38){k--;
}if(A===40){k++;
}k=(k+s.length)%s.length;
if(s[k]){c.add_class(s[k].ui.dom,"selected");
c.scroll_to_child(h,s[k].ui.dom);
}else{Y.log("error: inconsistency between blist and search result");
}};
var r=function(){a.log("buddysearch select %d %r",k,s[k]);
if(!s[k]){return;
}var A=s[k].get_im_conversation();
A.ui.focus();
IMO.Stats.increment_counter("buddysearch_kb_return");
z();
};
var j=function(){y();
if(f===m.value){return;
}f=m.value;
var B=f.toLowerCase().split(/\s+|[\._@,!#\$%\^\?&\*\(\)\-\+=\|\[\]\\\/'":;><~`]+/);
if(s[k]){c.remove_class(s[k].ui.dom,"selected");
c.scroll_to_child(h,s[k].ui.dom);
}var A=l(IMO.BuddyList.get().search(B,true,true));
if(A.length===0&&!f){A=l(IMO.BuddyList.get().get_buddies());
}s=A;
k=0;
t(function(C){c.hide(C.dom);
});
a.foreach(IMO.BuddyList.get().groups,function(C){c.hide(C.ui.dom);
});
if(s[k]){c.add_class(s[k].ui.dom,"selected");
c.scroll_to_child(h,s[k].ui.dom);
}a.foreach(s,function(C){if(C&&C.ui){c.show(C.ui.dom);
if(C.blist_group){c.show(C.blist_group.ui.dom);
}}});
c.toggle_class(n,"hidden",s.length>0);
};
var o=function(B){var A=B.keyCode;
if(A===27){B.halt();
e();
}else{if(A===13){B.halt();
r();
e();
}else{if(A===37||A===39){return;
}else{if(A===38||A===40){B.halt();
w(A);
return;
}else{if(m.value!==j){Y.later(10,this,j);
}}}}}};
this.input=m=c.input({name:"buddysearch",id:"buddysearch_input",type:"text",cls:"blurred inner-shadow",value:d("Search buddies\u2026"),context:this,onfocus:q,onblur:function(A){Y.later(10,this,u,A);
},onkeydown:o,onkeypress:o});
this.input_div=c.idiv("buddysearch_input_div",this.input,c.sprite("icn_search_2"));
u();
};
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
var g=IMO.Constants;
var d=function(h){this.delegate=h;
this.groups=[];
this.sel_grpdom=null;
a.foreach(IMO.BuddyList.get().get_groups(),this.on_blist_create_group,this);
if(this.sel_grpdom===null){this.delegate.selected_group_changed(null,null,true);
}this.on(IMO.BuddyList.get());
};
Y.mix(d.prototype,IMO.EventTarget);
Y.mix(d.prototype,{on_blist_create_group:function(h){if(!h.normal){return;
}var i=this.delegate.create_group_dom(h);
var j={group:h,dom:i};
this.groups.push(j);
if(this.sel_grpdom===null){this.set_selected_group({dom:i});
}},on_blist_remove_group:function(i){var h;
var j=a.foreach(this.groups,function(l,k){if(l.group===i){h=k;
return l;
}});
if(j!==undefined){this.groups.splice(h,1);
if(this.sel_grpdom===j){this.set_selected_group(this.groups.length>0?this.groups[0]:{});
}this.delegate.erase_group_dom(j.group,j.dom);
}else{Y.log("erasing nonexistent group!");
}},set_selected_group:function(h){var i=a.foreach(this.groups,function(j){if(h.group===j.group||h.dom===j.dom){return j;
}});
i=a.dfl(i,null);
if(this.sel_grpdom!==null){this.delegate.selected_group_changed(this.sel_grpdom.group,this.sel_grpdom.dom,false);
}this.sel_grpdom=i;
if(i!==null){this.delegate.selected_group_changed(this.sel_grpdom.group,this.sel_grpdom.dom,true);
}else{this.delegate.selected_group_changed(null,null,true);
}},get_selected:function(){return this.sel_grpdom;
},destroy:function(){this.unsubscribe_all();
this.groups=null;
this.sel_grpdom=null;
this.delegate=null;
}});
var f=g.reui_buddylist_width-2*g.reui_buddylist_dialog_padding;
IMO.REUI.AddBuddyWidget=function(){this.sel_acc_id=-1;
this.accounts=[];
this.shown=false;
var j={onclick:function(l){IMO.MouseManager.get().handled(l,"addbuddyw-account-dd");
this.toggle_menu(l,"account");
},context:this};
var k={onclick:function(l){IMO.MouseManager.get().handled(l,"addbuddyw-group-dd");
this.toggle_menu(l,"group");
},context:this};
var i;
this.dom=c.cdiv("dialog",{cls:"add-buddy"},c.cdiv("title",b("Add a buddy")),c.cdiv("field",c.cdiv("label",b("Account:")),this.account_dd=c.cdiv("dropdown-container",this.chosen_account=c.cdiv("chosen",this.chosen_account_txt=c(""),j),c.cdiv("dropdown-button sprite_frm_dropdown",j),this.account_menu=c.cdiv("menu"))),c.cdiv("field",c.cdiv("label",b("Buddy username:")),this.username=c.input()),c.cdiv("field",c.cdiv("label",b("Add to list:")),this.group_dd=c.cdiv("dropdown-container",this.chosen_group=c.cdiv("chosen",this.chosen_group_txt=c(""),k),c.cdiv("dropdown-button sprite_frm_dropdown",k),this.group_menu=c.cdiv("menu"))),i=c.cdiv("buttons",IMO.REUI.Button("grey",{cls:"cancel-button",onclick:function(l){IMO.MouseManager.get().handled(l,"addbuddyw-cancel-button");
this.handle_cancel();
},context:this},b("Cancel")),IMO.REUI.Button("blue",{cls:"add-button",onclick:function(l){IMO.MouseManager.get().handled(l,"addbuddyw-add-button");
this.handle_add();
},context:this},b("Add")),c.cdiv("clear")),this.add_buddy_error=c.cdiv("add-error",b("Please specify a buddy username.")));
c.on("click",function(l){IMO.MouseManager.get().handled(l,"addbuddyw");
},this.dom,null);
var h=IMO.REUI.Button.sizes[0]+10+IMO.REUI.Button.sizes[1];
c.css(i,{width:a.cap(h,0,f)});
this.ev=new IMO.Event();
this.on(IMO.Session.get());
this.group_dom_list=new d(this);
IMO.MouseManager.get().register(this.handle_window_click,this);
};
Y.mix(IMO.REUI.AddBuddyWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.AddBuddyWidget.prototype,{do_show:function(){this.shown=true;
c.hide(this.add_buddy_error);
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.handle_cancel},enter:{cb:this.handle_add}},context:this});
this.ev.fire("on_show",this);
this.username.focus();
},do_hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
this.ev.fire("on_hide",this);
this.shown=false;
},on_create_account:function(h){this.on(h);
},on_remove_account:function(h){this.unsubscribe(h);
},on_state_change:function(m,l){var j=a.foreach(this.accounts,function(p,o){if(p.account===m){return o;
}});
if(j===undefined&&l===g.IM_STATE_ONLINE&&m.proto!==g.PROTO_NEWFACEBOOK){var h=m.pretty_display();
var n=c.cdiv("account",c(h),{onclick:function(p){IMO.MouseManager.get().handled(p,"addbuddyw-accountmenu-item");
var o=a.foreach(this.accounts,function(r,q){if(r.account===m){return q;
}});
this.set_selected_account(o);
this.toggle_menu(p,"account");
},context:this});
this.account_menu.appendChild(n);
this.accounts.push({account:m,dom:n});
if(this.sel_acc_id===-1){this.set_selected_account(0);
}}else{if(j!==undefined&&l!==g.IM_STATE_ONLINE){var k=this.accounts[j];
c.remove(k.dom);
this.accounts.splice(j,1);
if(this.sel_acc_id===j){this.set_selected_account(this.accounts.length===0?-1:j>0?j-1:j);
}}}},create_group_dom:function(h){var i=c.cdiv("group",c(h.name),{onclick:function(j){IMO.MouseManager.get().handled(j,"addbuddyw-groupmenu-item");
this.group_dom_list.set_selected_group({group:h});
this.toggle_menu(j,"group");
},context:this});
this.group_menu.appendChild(i);
return i;
},erase_group_dom:function(h,i){this.group_menu.removeChild(i);
},selected_group_changed:function(i,j,h){if(h){this.chosen_group_txt.nodeValue=i&&i.name||e("no groups");
}},set_selected_account:function(h){this.chosen_account_txt.nodeValue=h!==-1?this.accounts[h].account.pretty_display():"no online accounts";
this.sel_acc_id=h;
},toggle_menu:function(j,i){var h=this[i+"_dd"];
if(this[i+"_menu"].childNodes.length===0&&!Y.DOM.hasClass(h,"expanded")){return;
}Y.DOM.toggleClass(h,"expanded");
},handle_window_click:function(l,h){var k=false,i=false;
var j=false;
a.foreach(h,function(m){var n=IMO.MouseManager.get().data2str(m.data);
if(a.prefix(n,"addbuddyw-group")){k=true;
}if(a.prefix(n,"addbuddyw-account")){i=true;
}if(a.prefix(n,"addbuddyw")||a.prefix(n,"buddylist")){j=true;
}});
a.log("handle_window_click group=%r account=%r in_widget=%r shown=%r",k,i,j,this.shown);
if(!k){c.remove_class(this.group_dd,"expanded");
}if(!i){c.remove_class(this.account_dd,"expanded");
}if(!j&&this.shown){this.do_hide();
}},handle_add:function(){c.hide(this.add_buddy_error);
var i=this.sel_acc_id!==-1&&this.accounts[this.sel_acc_id].account||undefined;
if(!i){return;
}var h=this.username.value;
var k=this.group_dom_list.get_selected();
var j=k&&k.group;
if(!j){IMO.BuddyList.get().get_group("Buddies");
k=this.group_dom_list.get_selected();
j=k&&k.group;
}if(i.add_buddy(h,j.name)){this.username.value="";
this.ev.fire("on_buddy_add",this,i,h,j);
}else{c.show(this.add_buddy_error);
}},handle_cancel:function(){this.username.value="";
this.do_hide();
},destroy:function(){this.unsubscribe_all();
this.group_dom_list.destroy();
}});
IMO.REUI.AddGroupWidget=function(){var i;
this.shown=false;
this.dom=c.cdiv("dialog",{cls:"add-group"},c.cdiv("title",b("Create a new list")),c.cdiv("field",c.cdiv("label",b("List name:")),this.group_name=c.input()),i=c.cdiv("buttons",IMO.REUI.Button("grey",{cls:"cancel-button",onclick:function(j){IMO.MouseManager.get().handled(j,"addgroupw-cancel-button");
this.handle_cancel();
},context:this},b("Cancel")),IMO.REUI.Button("blue",{cls:"add-button",onclick:function(j){IMO.MouseManager.get().handled(j,"addgroupw-add-button");
this.handle_add();
},context:this},b("Add")),c.cdiv("clear")),this.group_add_error=c.cdiv("add-error",b("Please specify a list name.")));
var h=IMO.REUI.Button.sizes[0]+10+IMO.REUI.Button.sizes[1];
c.css(i,{width:a.cap(h,0,f)});
c.on("click",function(j){IMO.MouseManager.get().handled(j,"addgroupw");
},this.dom,null);
IMO.MouseManager.get().register(this.handle_window_click,this);
this.ev=new IMO.Event();
};
Y.mix(IMO.REUI.AddGroupWidget.prototype,{do_show:function(){this.shown=true;
a.log("in do show");
c.hide(this.group_add_error);
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.handle_cancel},enter:{cb:this.handle_add}},context:this});
this.ev.fire("on_show",this);
this.group_name.focus();
},do_hide:function(){a.log("in do hide");
IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.ev.fire("on_hide",this);
this.shown=false;
},handle_cancel:function(){this.group_name.value="";
this.do_hide();
},handle_add:function(){Y.log("in handle_add group");
c.hide(this.group_add_error);
var h=Y.Lang.trim(this.group_name.value);
if(!h){c.show(this.group_add_error);
return;
}IMO.BuddyList.get().get_group(h);
this.ev.fire("on_add_group",this,h);
this.group_name.value="";
},handle_window_click:function(j,h){var i=IMO.MouseManager.get().check_handled("addgroupw*","buddylist*");
if(!i&&this.shown){this.do_hide();
}}});
IMO.REUI.AddSharedGroupWidget=function(){this.sel_acc_id=-1;
this.accounts=[];
this.types=["ImoGroup"];
this.shown=false;
var k={onclick:function(l){IMO.MouseManager.get().handled(l,"addsharedgroupw-account-dd");
this.toggle_menu(l,"account");
},context:this};
var i={onclick:function(l){IMO.MouseManager.get().handled(l,"addsharedgroupw-type-dd");
this.toggle_menu(l,"type");
},context:this};
var j;
this.dom=c.cdiv("dialog",{cls:"add-sharedgroup"},c.cdiv("title",b("Create a new chat group")),c.cdiv("field",c.cdiv("label",b("Group name:")),this.gname=c.input({value:""})),c.cdiv("field",c.cdiv("label",b("Account:")),this.account_dd=c.cdiv("dropdown-container",this.chosen_account=c.cdiv("chosen",this.chosen_account_txt=c(""),k),c.cdiv("dropdown-button sprite_frm_dropdown",k),this.account_menu=c.cdiv("menu"))),j=c.cdiv("buttons",IMO.REUI.Button("grey",{cls:"cancel-button",onclick:function(l){IMO.MouseManager.get().handled(l,"addsharedgroupw-cancel-button");
this.handle_cancel();
},context:this},b("Cancel")),IMO.REUI.Button("blue",{cls:"add-button",onclick:function(l){IMO.MouseManager.get().handled(l,"addsharedgroupw-add-button");
this.handle_add();
},context:this},b("Add")),c.cdiv("clear")),this.add_error=c.cdiv("add-error",""));
c.on("click",function(l){IMO.MouseManager.get().handled(l,"addsharedgroupw");
},this.dom,null);
var h=IMO.REUI.Button.sizes[0]+10+IMO.REUI.Button.sizes[1];
c.css(j,{width:a.cap(h,0,f)});
this.ev=new IMO.Event();
this.on(IMO.Session.get());
IMO.MouseManager.get().register(this.handle_window_click,this);
};
Y.mix(IMO.REUI.AddSharedGroupWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.AddSharedGroupWidget.prototype,{do_show:function(){this.shown=true;
c.hide(this.add_error);
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.handle_cancel},enter:{cb:this.handle_add}},context:this});
this.ev.fire("on_show",this);
this.gname.focus();
},do_hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
this.ev.fire("on_hide",this);
this.shown=false;
},on_create_account:function(h){this.on(h);
},on_remove_account:function(h){this.unsubscribe(h);
},on_state_change:function(l,k){var h=a.foreach(this.accounts,function(o,n){if(o.account===l){return n;
}});
if(h===undefined&&k===g.IM_STATE_ONLINE){var m=c.cdiv("account",c(l.pretty_display()),{onclick:function(o){IMO.MouseManager.get().handled(o,"addsharedgroupw-accountmenu-item");
var n=a.foreach(this.accounts,function(q,p){if(q.account===l){return p;
}});
this.set_selected_account(n);
this.toggle_menu(o,"account");
},context:this});
this.account_menu.appendChild(m);
this.accounts.push({account:l,dom:m});
if(this.sel_acc_id===-1){this.set_selected_account(0);
}}else{if(h!==undefined&&k!==g.IM_STATE_ONLINE){var j=this.accounts[h];
c.remove(j.dom);
this.accounts.splice(h,1);
if(this.sel_acc_id===h){this.set_selected_account(this.accounts.length===0?-1:h>0?h-1:h);
}}}},set_selected_account:function(h){this.chosen_account_txt.nodeValue=h!==-1?this.accounts[h].account.pretty_display():"no online accounts";
this.sel_acc_id=h;
},toggle_menu:function(j,i){var h=this[i+"_dd"];
if(this[i+"_menu"].childNodes.length===0&&!Y.DOM.hasClass(h,"expanded")){return;
}Y.DOM.toggleClass(h,"expanded");
},handle_window_click:function(l,h){var i=false,j=false;
var k=false;
a.foreach(h,function(m){var n=IMO.MouseManager.get().data2str(m.data);
if(a.prefix(n,"addsharedgroupw-type")){i=true;
}if(a.prefix(n,"addsharedgroupw-account")){j=true;
}if(a.prefix(n,"addsharedgroupw")||a.prefix(n,"buddylist")){k=true;
}});
a.log("handle_window_click type=%r account=%r in_widget=%r shown=%r",i,j,k,this.shown);
if(!j){c.remove_class(this.account_dd,"expanded");
}if(!k&&this.shown){this.do_hide();
}},handle_add:function(){c.hide(this.add_error);
var h="";
var i=this.sel_acc_id!==-1&&this.accounts[this.sel_acc_id].account||undefined;
if(!i){h=e("Please select an account.");
}else{if(Y.Lang.trim(this.gname.value)===""){h=e("Please specify a group name.");
}}if(h!==""){this.add_error.textContent=h;
c.show(this.add_error);
return;
}i.groups.create_group(this.gname.value,false);
IMO.NM.add_notification(b('Creating group "[GROUPNAME]".\nDrag people into the group to invite them.',{GROUPNAME:this.gname.value}));
this.gname.value="";
this.do_hide();
},handle_cancel:function(){this.gname.value="";
this.do_hide();
},destroy:function(){this.unsubscribe_all();
}});
IMO.REUI.AuthBuddyWidget=function(m,l,k,n){this.account=m;
this.buid=l;
this.balias=k;
this.msg=n;
Y.log("new auth widget account: "+this.account+" buid: "+this.buid+" balias: "+this.balias+" msg: "+this.msg);
var o={onclick:function(p){IMO.MouseManager.get().handled(p,"authbuddyw-group-dd");
this.toggle_menu(p,"group");
},context:this};
this.msgdom=c.div();
if(this.msg){this.msgdom=c.cdiv("field",c.cdiv("label",b("Message:")),c.cdiv("auth-message user-message",this.msg?b(this.msg):""));
}var j,i;
this.dom=c.cdiv("dialog",{cls:"auth-buddy"},c.cdiv("title","Friend request:"),c.cdiv("field",c.cdiv("auth-message",b("[BUDDY_NAME] ([BUID]) wants to add [ACCOUNT] ([PROTO]) as a friend",{BUID:this.buid,BUDDY_NAME:(this.balias||this.buid),ACCOUNT:this.account.uid,PROTO:g.PROTO_TO_UI[this.account.proto]}))),this.msgdom,c.cdiv("field",c.cdiv("label",b("Add to list:")),this.group_dd=c.cdiv("dropdown-container",this.chosen_group=c.cdiv("chosen",this.chosen_group_txt=c(""),o),c.cdiv("dropdown-button sprite_frm_dropdown",o),this.group_menu=c.cdiv("menu"))),j=c.cdiv("buttons",IMO.REUI.Button("grey",{cls:"deny-button",onclick:function(p){this.handle_auth(p,"spam");
},context:this},b("Spam")),IMO.REUI.Button("grey",{cls:"block-button",onclick:function(p){this.handle_auth(p,"block");
},context:this},b("Block")),IMO.REUI.Button("grey",{cls:"add-button",onclick:function(p){this.handle_auth(p,"deny");
},context:this},b("Deny")),IMO.REUI.Button("grey",{cls:"add-button",onclick:function(p){this.handle_auth(p,"ignore");
},context:this},b("Ignore"))),i=c.cdiv("buttons",IMO.REUI.Button("blue",{cls:"add-button",onclick:function(p){this.handle_auth(p,"add");
},context:this},b("Add")),c.cdiv("clear")));
var h=IMO.REUI.Button.sizes[3]+10+IMO.REUI.Button.sizes[1]+10+IMO.REUI.Button.sizes[2];
c.css(j,{width:a.cap(h,0,f)});
c.css(i,{width:a.cap(IMO.REUI.Button.sizes[0],0,f)});
this.ev=new IMO.Event();
this.group_dom_list=new d(this);
IMO.MouseManager.get().register(this.handle_window_click,this);
};
Y.mix(IMO.REUI.AuthBuddyWidget.prototype,{do_show:function(){Y.log("in do_show");
this.ev.fire("on_show",this);
},do_hide:function(){this.ev.fire("on_hide",this);
},create_group_dom:function(h){var i=c.cdiv("group",c(h.name),{onclick:function(j){IMO.MouseManager.get().handled(j,"authbuddyw-group-item");
this.group_dom_list.set_selected_group({group:h});
this.toggle_menu(j,"group");
},context:this});
this.group_menu.appendChild(i);
return i;
},erase_group_dom:function(h,i){this.group_menu.removeChild(i);
},selected_group_changed:function(i,j,h){if(h){this.chosen_group_txt.nodeValue=i&&i.name||e("no groups");
}},toggle_menu:function(j,i){var h=this[i+"_dd"];
if(this[i+"_menu"].childNodes.length===0&&!Y.DOM.hasClass(h,"expanded")){return;
}Y.DOM.toggleClass(h,"expanded");
},handle_window_click:function(j,h){var i=IMO.MouseManager.get().check_handled("authbuddyw-group-dd","authbuddyw-group-item");
if(!i){c.remove_class(this["group_dd"],"expanded");
}},handle_auth:function(k,i){IMO.MouseManager.get().handled(k,"authbuddyw-"+i+"-button");
Y.log("in handle_auth action: "+i);
var l=this.group_dom_list.get_selected();
var j=l&&l.group;
if(!j){this.ev.fire("on_auth_done",this);
return;
}var h="";
if(i!=="ignore"){this.account.auth_buddy(this.buid,i,j.name,h);
}this.ev.fire("on_auth_done",this);
},destroy:function(){this.group_dom_list.destroy();
}});
IMO.REUI.AuthGroupWidget=function(o,p){this.account=o;
this.gid=p.gid;
this.msg=p.msg;
this.display=p.display;
this.iid=p.iid;
this.uid=o.uid;
this.proto=o.proto;
var q=[null,null];
if(p.from){if(p.from.lastIndexOf(";")!=-1){q=a.groups_split(p.from);
}else{Y.log('wrong format for "from" in group invite',"warning");
}}else{Y.log('missing "from" field from group invite',"warning");
}var j=q[0];
var m=q[1];
if(m&&m.indexOf(";")!=-1){m=a.groups_split(m)[0];
}var l=IMO.BuddyList.get().search([j]);
a.foreach(l,function(s){if(s.buid===j&&s.proto===m&&s.displaylias){j=s.displaylias;
}});
Y.log("new auth widget account: "+this.account+" gid: "+this.gid);
var i=p.from_display||j;
var r;
var n=(p.type===g.GROUP_TYPE.DISCUSSION)?"[FRIEND] ([FRIENDPROTO]) has invited [ACCOUNT] ([PROTO]) to a public discussion":"[FRIEND] ([FRIENDPROTO]) has invited [ACCOUNT] ([PROTO]) to a group chat";
if(this.display){n+=' "[DISPLAY]"';
}r=c.cdiv("field",c.cdiv("auth-message",b(n,{FRIEND:i,FRIENDPROTO:g.PROTO_TO_UI[m],ACCOUNT:this.account.get_display_text(),DISPLAY:this.display,PROTO:g.PROTO_TO_UI[this.proto]})));
var k;
this.dom=c.cdiv("dialog",{cls:"auth-group"},c.cdiv("title","Group chat request:"),r,k=c.cdiv("buttons",IMO.REUI.Button("grey",{cls:"deny-button",onclick:function(s){this.handle_auth(s,"deny");
},context:this},b("Ignore")),IMO.REUI.Button("blue",{cls:"add-button",onclick:function(s){this.handle_auth(s,"add");
},context:this},b("Accept")),c.cdiv("clear")));
var h=IMO.REUI.Button.sizes[0]+10+IMO.REUI.Button.sizes[1];
c.css(k,{width:a.cap(h,0,f)});
this.ev=new IMO.Event();
IMO.MouseManager.get().register(this.handle_window_click,this);
};
Y.mix(IMO.REUI.AuthGroupWidget.prototype,{do_show:function(){Y.log("in do_show");
this.ev.fire("on_show",this);
},do_hide:function(){this.ev.fire("on_hide",this);
},handle_window_click:function(i,h){},handle_auth:function(i,h){IMO.MouseManager.get().handled(i,"authbuddyw-"+h+"-button");
Y.log("in handle_auth action: "+h);
if(this.iid){this.account.groups.invitation_response_from_iid(this.gid,h,this.iid);
}else{this.account.groups.auth_group(this.gid,h);
}this.ev.fire("on_auth_done",this);
},destroy:function(){}});
}());
(function(){var d=IMO.Constants;
var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
if(!IMO.REUI){IMO.REUI={};
}IMO.REUI.Bar=function(f){var g=Array.prototype.slice.call(arguments,0);
var e="bar";
if(typeof f==="string"){e+=" "+f;
g.shift();
}g.unshift({cls:e});
return c.div.apply(this,g);
};
d.glow_center_x=402;
d.glow_center_y=d.sprite_glow_wide_height;
IMO.REUI.Glow=function(f){var e=a.vmul(f,[0.4,0.55]);
var h=c.sprite("glow_wide");
var g=a.vsub(e,[d.glow_center_x,d.glow_center_y]);
c.set_off(h,a.vrnd(g));
c.add_class(h,"glow");
return c.div({cls:"glow"},h);
};
IMO.REUI.Button=function(e){var g=Array.prototype.slice.call(arguments,1);
var j=c.div(g,{cls:"button",style:{visibility:"hidden",position:"absolute",top:"-10000px"}});
document.body.appendChild(j);
var f=j.clientWidth;
document.body.removeChild(j);
f=a.cap(f,55,200);
var i=d.sprite_btn_blue_small_left_width*2;
var h="btn_"+e+"_small";
IMO.REUI.Button.sizes.unshift(f+i);
if(IMO.REUI.Button.sizes.length>10){IMO.REUI.Button.sizes.pop();
}return c.div({cls:"sprite_"+h+"_middle button "+e,style:{width:(f+i)+"px"}},c.sprite(h+"_left button-left"),g,c.sprite(h+"_right button-right"));
};
IMO.REUI.Button.sizes=[];
IMO.REUI.Button.align=function(k){var g=function(i){return parseInt(i.style.width.replace("px",""),10);
};
var f=function(l,i){l.style.width=""+i+"px";
};
var e=0;
var h=0;
for(h=0;
h<k.length;
++h){var j=g(k[h]);
if(j>e){e=j;
}}for(h=0;
h<k.length;
++h){f(k[h],e);
}return k;
};
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.REUI.Carousel=function(c){this.container=c;
this.root=b.get_elements_by_class(c,"slideshow")[0];
this.pages=[];
a.foreach(b.get_elements_by_class(this.root,"page"),function(e){this.pages.push(e);
},this);
this.container.appendChild(this.pager=this.make_pager());
b.empty(this.root);
this.root.appendChild(this.pages[0]);
this.width=this.pages[0].offsetWidth;
this.current=0;
this.timer=null;
this.auto_timer=null;
var d=this;
this.container.insertBefore(b.div(b.sprite("splash_arr_left"),"\u00a0",{cls:"arrow l",onclick:function(){d.go((d.current-1+d.pages.length)%d.pages.length,-1);
}}),this.root);
this.container.insertBefore(b.div("\u00a0",b.sprite("splash_arr_right"),{cls:"arrow r",onclick:function(){d.go((d.current+1)%d.pages.length,1);
}}),this.root.previousSibling);
this.reset();
};
Y.mix(IMO.REUI.Carousel.prototype,{make_pager:function(){var d=b.div({cls:"pager"});
var c=this;
a.foreach(this.pages,function(f,e){d.appendChild(b.sprite("icn_dotwhite",{onclick:function(){c.go(e);
}}));
},this);
return d;
},go:function(f,c,h){if(this.timer){this.reset();
}c=c||(this.current<f?1:-1);
h=h||5;
b.toggle_class(this.pager.children[this.current],"selected",0);
b.toggle_class(this.pager.children[this.current],"sprite_icn_dotblack",0);
b.toggle_class(this.pager.children[this.current],"sprite_icn_dotwhite",1);
this.current=f;
b.toggle_class(this.pager.children[this.current],"sprite_icn_dotblack",1);
b.toggle_class(this.pager.children[this.current],"sprite_icn_dotwhite",0);
var j;
var e;
if(c===1){this.root.appendChild(this.pages[f]);
j=0;
e=function(i){j=Math.min(this.width,j+c*i*h);
return(j===this.width);
};
}else{this.root.insertBefore(this.pages[f],this.root.firstChild);
j=this.width;
e=function(i){j=Math.max(0,j+c*i*h);
return(j===0);
};
}this.root.scrollLeft=j;
var g=new Date();
var d=this;
this.timer=setInterval(function(){var i=new Date();
var k=i-g;
g=i;
if(!e.call(d,k)){d.root.scrollLeft=j;
}else{d.reset();
}},20);
},reset:function(){clearInterval(this.timer);
this.timer=null;
b.empty(this.root);
this.root.scrollLeft=0;
this.root.appendChild(this.pages[this.current]);
b.toggle_class(this.pager.children[this.current],"selected",1);
b.toggle_class(this.pager.children[this.current],"sprite_icn_dotblack",1);
b.toggle_class(this.pager.children[this.current],"sprite_icn_dotwhite",0);
if(this.auto_timer){clearInterval(this.auto_timer);
this.auto_timer=null;
}var c=this;
this.auto_timer=setInterval(function(){c.go((c.current+1)%c.pages.length,1,1);
},15000);
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var c=a.sprintf;
var b=a.TranslateDom;
var e=a.TranslateTxt;
IMO.REUI.ConfirmModalPopup=function(l,k,j,f,h){this.buttons=j;
this.cb=f;
this.context=h;
var i;
this.dom=d.cdiv("confirmation",d.div(k),i=d.cdiv("buttons"));
var g=0;
a.foreach(j,function(o,n){var m=IMO.REUI.Button(o[1],o[0],{cls:"button",onclick:{func:this.handle_button_click,args:n},context:this});
i.appendChild(m);
g+=IMO.REUI.Button.sizes[0];
if(n===j.length-1){d.css(m,{margin_right:"0px"});
}},this);
g+=(j.length)*10;
d.css(i,{width:g});
i.appendChild(d.cdiv("clear"));
this.shortcuts=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide}},bottom:true,context:this});
this.popup=new IMO.ModalPopup();
this.popup.set_content(this.dom,[300,300]);
this.popup.set_title(e(l));
this.popup.prepare();
this.popup.show();
};
Y.mix(IMO.REUI.ConfirmModalPopup.prototype,{handle_button_click:function(g,f){IMO.MouseManager.get().handled(g,"confirmation-"+f+"-button");
this.hide();
this.notify(f);
},hide:function(){IMO.KeyboardManager.get().pop(this.shortcuts);
delete this.shortcuts;
this.popup.hide();
},notify:function(f){this.cb.call(this.context,f);
},destroy:function(){this.popup.destroy();
delete this.popup;
}});
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
var e=IMO.Constants;
IMO.REUI.GamesPanel=function(h){this.app_dom={};
this.dom=c.cdiv("convgames");
this.dom.appendChild(c.cdiv("convgames_add",c.a({href:"/developers/",target:"_blank"},"Developer? Write your own games using the all-new imo API!")));
var j=IMO.Games.get().get_game_list(h);
for(var g=0;
g<j.length;
g++){var f=j[g];
var k=IMO.Games.get().get_game_info(f);
var l=(k.on_mobile?"Also on mobile":"");
this.dom.appendChild(c.div({cls:"conv_game",onclick:this.generate_onclick(f),context:this},this.get_image(f),c.cdiv("conv_game_right",c.cdiv("game_title",k.title),c.cdiv("game_desc",k.desc),c.cdiv("game_desc",c.cspan("game_mobile",l))),c.cdiv("clear")));
}this.dom.appendChild(c.cdiv("clear"));
this.resizable=false;
};
Y.mix(IMO.REUI.GamesPanel.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.GamesPanel.prototype,{get_min_size:function(){if(this.type=="group_conv"||this.type=="broadcast"){return[null,e.reui_conv_games_height*2/3];
}else{return[null,e.reui_conv_games_height];
}},get_image:function(g){var h=IMO.Games.get().get_game_info(g);
var f=null;
if(h){if(h.sprite_hack){f=c.sprite(h.img);
}else{f=c.img({src:h.img,alt:""});
}}return f;
},get_text:function(f){return IMO.Games.get().get_game_info(f).broadcast_text;
},generate_onclick:function(f){return function(g){this.play(g,f);
};
}});
IMO.REUI.ConvGamesPanel=function(h,g){this.conv=h;
this.parent=g;
var f="conv";
if(h.buddy instanceof IMO.SharedGroup){f="group_conv";
}IMO.REUI.GamesPanel.call(this,f);
};
Y.mix(IMO.REUI.ConvGamesPanel.prototype,IMO.REUI.GamesPanel.prototype);
Y.mix(IMO.REUI.ConvGamesPanel.prototype,{set_conv_panel:function(f){this.conv_panel=f;
this.on(this.conv_panel);
},play:function(g,f){IMO.MouseManager.get().handled(g,"games-play-game-button");
if(this.parent.active_top_widget===IMO.REUI.ConversationPanel.GAMES){this.parent.hide_top_widget();
}IMO.Games.get().start_game(this.conv.buddy,f,this.conv);
}});
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
var e=IMO.Constants;
IMO.REUI.ConvProfilePanel=function(f){Y.log("conv profile panel");
this.buddy=f;
this.is_imo_buddy=false;
if((this.buddy.gid&&this.buddy.fake_bproto===e.PROTO_IMO)||(!this.buddy.gid&&this.buddy.proto===e.PROTO_IMO)){this.is_imo_buddy=true;
}this.buddy_alias_div=c.span({cls:"inner_buddy_alias editable",onclick:this.show_edit_alias,context:this});
this.buddy_alias_input=c.input({"class":"inner_buddy_alias editable",onblur:this.rename_buddy,onkeydown:function(h){if(h.keyCode===13){this.rename_buddy();
}},onclick:function(h){IMO.MouseManager.get().handled(h,"convprofw-alias-edit");
},context:this});
this.buttons=c.cdiv("buttons");
this.create_action_buttons(f);
this.group_span=c.span({"class":"prof_bold_text"});
this.buid_span=c.span({"class":"prof_bold_text"});
this.proto_div=c.cdiv("buddy_detail");
this.buddyof_span=c.span({"class":"prof_bold_text"},this.buddy.account.uid);
this.primitive_img=c.sprite(this.buddy.protoicon,{cls:"buddyimg"});
this.editable_status_span=c.cspan(f instanceof IMO.SharedGroup?"inner_buddy_status editable":"inner_buddy_status",{onclick:this.show_edit_group_topic,context:this});
this.group_topic_input=c.input({"class":"inner_buddy_status editable",onblur:this.set_group_topic,onkeydown:function(h){if(h.keyCode===13){this.set_group_topic();
}},context:this});
c.replace_content(this.editable_status_span,a.word_breaker(a.linkify_string(this.buddy.get_status())));
this.buddy_id_div=c.cdiv("detail",c.cspan("key",b("id:")),this.buddy_id_val=c.cspan("value"));
this.buddy_display_div=c.cdiv("detail",c.cspan("key",b("display name:")),this.buddy_display_val=c.cspan("value"));
this.buddy_group_div=c.cdiv("detail",c.cspan("key",b("group:")),this.buddy_group_val=c.cspan("value"));
this.buddy_account_div=c.cdiv("detail",c.cspan("key",b("account:")),this.buddy_account_val=c.cspan("value"));
this.other_details=c.cdiv("buddy-profile-details",this.buddy_id_div,this.buddy_display_div,this.buddy_group_div,this.buddy_account_div);
var g=c.cdiv("convprof_details",this.buttons,c.cdiv("clear"),this.alias_div=c.cdiv("buddy_alias",c.sprite("icn_edit",{onclick:this.show_edit_alias,context:this}),this.buddy_alias_div,this.buddy_alias_input),c.cdiv("buddy_detail",this.buid_span),this.status_div=c.cdiv("buddy_status",this.primitive_img,this.editable_status_span,this.group_topic_input),this.other_details);
this.icon_img=c.img({src:this.buddy.request_buddy_icon()});
if(this.is_imo_buddy){this.dom=c.cdiv("convprofile",c.img({cls:"loading",src:"/assets/loading_54.gif"}));
this.use_imodirectory2=(IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im");
IMO.EventDispatcher.get().subscribe(this,"imo_directory","profile");
if(this.use_imodirectory2){this.to_system="query_engine";
}else{this.to_system="imo_directory";
}this.update_imo_profile();
}else{this.dom=c.cdiv("convprofile",c.cdiv("convprof_buddy_icon",{cls:"sprite_polaroid_background",onclick:this.set_group_image,context:this},this.icon_img),g);
}this.on_buddy_update();
this.on(f);
this.resizable=true;
this.on(IMO.BuddyIconDownloader.get());
};
Y.mix(IMO.REUI.ConvProfilePanel.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.ConvProfilePanel.prototype,{create_action_buttons:function(l){var g=!l.gid;
var n=!l.gid&&!l.nonbuddy;
var i=l.nonbuddy;
var f=l.account.proto!==e.PROTO_FACEBOOK&&(!l.gid||l instanceof IMO.SharedGroup);
var j=l instanceof IMO.SharedGroup?"Leave":"Delete";
var k=n?c.cdiv("convprof_button",{onclick:this.set_favorite,context:this},c.sprite("icn_favorite"),this.fav_bt_txt_div=c.cspan("convprof_button_text")):null;
var h=i?c.cdiv("convprof_button",{onclick:this.set_add,context:this},c.sprite("icn_add_buddy"),this.add_bt_txt_div=c.cspan("convprof_button_text")):null;
var o=g?c.cdiv("convprof_button",{onclick:this.set_block,context:this},c.sprite("icn_block"),this.block_bt_txt_div=c.cspan("convprof_button_text")):null;
var m=f?c.cdiv("convprof_button",{onclick:this.delete_buddy,context:this},c.sprite("icn_delete"),c.cspan("convprof_button_text",b(j))):null;
c.replace_content(this.buttons,h,k,o,m);
},fetch_profile_result:function(h){if(h.edata.buid!==(this.buddy.fake_buid||this.buddy.buid)){Y.log(["fetch_profile_result: buids don't match",h.edata.buid,this.buddy],"error");
return;
}Y.log(["fetch_profile",h]);
var f=h.edata.profile;
var g=IMO.REUI.APP.MeetUtils.create_person_widget(f,this);
c.replace_content(this.dom,g.dom);
c.add_class(g.dom,"single-result");
},set_conv_panel:function(f){this.conv_panel=f;
this.on(this.conv_panel);
},on_bicon_ready:function(f,g){if(this.buddy.get_buddy_icon()===g){this.icon_img.src=g;
}},on_after_top_widget_visibility_change:function(g,f,h){if(g===IMO.REUI.ConversationPanel.PROFILE&&f){this.on_pos_size_change();
if(this.is_imo_buddy&&h){this.update_imo_profile();
}}},on_pos_size_change:function(){},update_imo_profile:function(){var g=IMO.Session.get().get_imo_account();
if(!g){g=this.buddy.account;
}var f={uid:g.uid,proto:g.proto,buid:(this.buddy.fake_buid||this.buddy.buid)};
Y.log(["fetch_profile",f]);
g.send("fetch_profile",f,this.to_system);
},set_detail:function(f,g){if(g){c.text(this[f+"_val"],g);
c.cshow(this[f+"_div"]);
}else{c.chide(this[f+"_div"]);
}},on_buddy_update:function(){this.create_action_buttons(this.buddy);
var f=(this.is_imo_buddy)?b("Add to Contacts"):b("Add Buddy");
c.replace_content(this.add_bt_txt_div,f);
var h=this.buddy.favorite?b("Remove Favorite"):b("Add Favorite");
c.replace_content(this.fav_bt_txt_div,h);
var g=this.buddy.blocked?b("Unblock"):b("Block");
c.replace_content(this.block_bt_txt_div,g);
c.replace_content(this.buddy_alias_div,c(this.buddy.displaylias));
if(this.buddy.gid){this.set_detail("buddy_id",(this.buddy instanceof IMO.IMBuddy)&&(this.buddy.fake_buid+" ("+e.PROTO_TO_UI[this.buddy.fake_bproto]+")"));
this.set_detail("buddy_display",this.buddy.display!==this.buddy.buid&&this.buddy.display!==this.buddy.displaylias&&this.buddy.display);
this.set_detail("buddy_group",(this.buddy instanceof IMO.IMBuddy)&&IMO.BuddyList.get().get_group(this.buddy).displaylias);
}else{if(this.buddy.account.proto===e.PROTO_IMO){this.set_detail("buddy_id",null);
}else{this.set_detail("buddy_id",this.buddy.buid);
}this.set_detail("buddy_display",this.buddy.display);
this.set_detail("buddy_group",this.buddy.group);
}this.set_detail("buddy_account",Y.Object.values(IMO.Session.get().accounts).length>1&&this.buddy.account.pretty_display());
c.replace_content(this.proto_div,c(e.PROTO_TO_UI[this.buddy.account.proto]));
c.replace_content(this.buddyof_span,c(this.buddy.account.uid));
c.css(this.primitive_img,{"class":"sprite_"+this.buddy.protoicon});
c.replace_content(this.editable_status_span,a.word_breaker(a.linkify_string(this.buddy.get_status())));
},show_edit_alias:function(f){if(this.editing){return;
}IMO.MouseManager.get().handled(f,"convprofw-alias-edit");
c.hide(this.buddy_alias_div);
c.show(this.buddy_alias_input,"inline");
this.buddy_alias_input.value=this.buddy.displaylias;
this.editing=true;
Y.log("editing");
Y.later(20,this.buddy_alias_input,function(){this.select();
});
},rename_buddy:function(){if(!this.editing){return;
}Y.log("not editing");
this.editing=false;
c.hide(this.buddy_alias_input);
c.show(this.buddy_alias_div,"inline");
if(this.buddy_alias_input.value!==this.buddy.displaylias){this.buddy.set_alias(this.buddy_alias_input.value);
}},show_edit_group_topic:function(f){IMO.MouseManager.get().handled(f,"convprofw-group-topic-edit");
if(!(this.buddy instanceof IMO.SharedGroup)){return;
}c.hide(this.editable_status_span);
c.show(this.group_topic_input,"inline");
this.group_topic_input.value=this.buddy.topic;
this.editing=true;
Y.later(20,this.group_topic_input,function(){this.select();
});
},set_group_topic:function(){if(!this.editing){return;
}this.editing=false;
c.hide(this.group_topic_input);
c.show(this.editable_status_span);
this.buddy.set_topic(this.group_topic_input.value);
},set_add:function(g){IMO.MouseManager.get().handled(g,"convprofw-add-button");
var f=(this.is_imo_buddy)?IMO.SharedConstants.BuddyGroups.IMO_CONTACTS:IMO.SharedConstants.BuddyGroups.BUDDIES;
this.buddy.account.add_buddy(this.buddy.buid,f);
},set_favorite:function(f){IMO.MouseManager.get().handled(f,"convprofw-favorite-button");
this.buddy.set_favorite(!this.buddy.favorite);
},set_block:function(f){IMO.MouseManager.get().handled(f,"convprofw-block-button");
this.buddy.set_blocked(!this.buddy.blocked);
},delete_buddy:function(f){IMO.MouseManager.get().handled(f,"convprofw-delete-button");
if(this.buddy.account.proto===e.PROTO_NEWFACEBOOK){return;
}if(this.buddy.gid&&this.buddy instanceof IMO.IMBuddy){return;
}var h=null;
var g=null;
if(this.buddy instanceof IMO.SharedGroup){this.buddy.account.del_buddy(this.buddy);
return;
}h="Delete Contact?";
g=d("Deleting [BUDDY_ALIAS].\n\nAre you sure?",{BUDDY_ALIAS:this.buddy.displaylias});
this.del_buddy_conf=new IMO.REUI.ConfirmModalPopup(h,g,[[b("Yes"),"blue"],[b("No"),"grey"]],this.handle_delete_buddy_confirm,this);
},handle_delete_buddy_confirm:function(f){Y.log("got button "+f);
if(f===0){this.buddy.account.del_buddy(this.buddy);
}this.del_buddy_conf.destroy();
delete this.del_buddy_conf;
},set_group_image:function(f){IMO.MouseManager.get().handled(f,"convprofw-group-icon-click");
if(!(this.buddy instanceof IMO.SharedGroup)){return;
}IMO.REUI.IconPanel.show("Set group image",d("This image will be visible to all users in the group"),this.buddy.get_buddy_icon(),"im","set_group_image",{uid:this.buddy.account.uid,proto:this.buddy.account.proto,gid:this.buddy.gid,ssid:IMO.Network.get().ssid},this,this.set_group_image_complete);
},set_group_image_complete:function(f){},get_min_size:function(){if(this.is_imo_buddy){return[680,262];
}return[380,150];
}});
}());
(function(){var a=IMO.Utils;
var d=IMO.Utils.HTML;
var c=a.sprintf;
var g=IMO.Constants;
IMO.REUI.ReTooltip=function(h){h=a.dfl(h,{});
this.conf={direction:a.dfl(h.direction,IMO.REUI.ReTooltip.LEFT),sprite:a.dfl(h.sprite,"profile_popover_arrow"),max_overflow:a.dfl(h.max_overflow,15),do_scroll:a.dfl(h.do_scroll,true),sprite_overlap:a.dfl(h.sprite_overlap,5)};
this.dom=null;
this.content=d.div();
this.shown=false;
this.arrow=null;
this.last_showed_content=null;
this.content_container=null;
this._decorate();
};
var b=IMO.REUI.ReTooltip;
b.UP=1;
b.RIGHT=2;
b.DOWN=4;
b.LEFT=8;
b.SIDE=b.LEFT|b.RIGHT;
b.VERT=b.UP|b.DOWN;
var e=[[b.UP,"bottom"],[b.DOWN,"top"],[b.LEFT,"right"],[b.RIGHT,"left"]];
var f={};
a.foreach(e,function(h){f[h[0]]=h[1];
});
Y.mix(IMO.REUI.ReTooltip.prototype,{update:function(h){throw"not_implemented_error update";
},show:function(m,l){if(this.last_showed_content===null){d.dom("imo").appendChild(this.dom);
}if(this.content===null){throw"tooltip content is null";
}if(this.last_showed_content!==this.content){d.replace_content(this.content_container,this.content);
this.last_showed_content=this.content;
}var h=Y.DOM.getXY(m);
var j=d.get_size(m);
d.cshow(this.dom);
var k=[this.dom.clientWidth,this.dom.clientHeight];
var i=this._handle_position_tt(h,j,[0,0],k,l);
var o=i.tt_pos;
var n=i.arr_pos;
d.css(this.dom,o);
d.css(this.dom,{z_index:IMO.Constants.reui_buddyhover_zindex});
d.css(this.arrow,n);
this.shown=true;
},hide:function(){d.chide(this.dom);
this.shown=false;
},_decorate:function(){var j=this.conf.direction;
var i=this.conf.sprite;
var k=this.conf.sprite_overlap;
this.dom=d.cdiv("tooltip",this.content_container=d.cdiv("tooltip-content",this.content),this.arrow=d.cdiv("tooltip-arrow",{cls:"sprite_"+i}));
var h={};
h["margin-"+f[j]]=c("%dpx",d.sprite_size(i)[j&b.SIDE?0:1]-k);
d.css(this.content_container,h);
h={};
h[f[j]]="0px";
d.css(this.arrow,h);
d.chide(this.dom);
},_handle_position_tt:function(x,C,F,w,q){var Q=this.conf.direction;
var J=d.sprite_size(this.conf.sprite);
var l=J[0];
var o=J[1];
var P=w[0];
var m=w[1];
var i=x[0];
var h=x[1];
var j=C[0];
var n=C[1];
var r=-1;
var s=-1;
var y=-1;
var z=-1;
if(Q===IMO.REUI.ReTooltip.RIGHT){y=Math.floor((m-o)/2);
r=Math.floor(h+((n-m)/2));
s=i+j;
}else{if(Q===IMO.REUI.ReTooltip.LEFT){y=Math.floor((m-o)/2);
r=Math.floor(h+((n-m)/2));
s=i-P;
}else{if(Q===IMO.REUI.ReTooltip.UP){y=m-o;
r=h-m;
z=Math.floor((P-l)/2);
s=Math.floor(i+(j-P)/2);
}else{if(Q===IMO.REUI.ReTooltip.DOWN){y=0;
r=h;
z=Math.floor((P-l)/2);
s=Math.floor(i+(j-P)/2);
}}}}if(q){var E=Y.DOM.getXY(q);
var u=E[0];
var t=E[1];
var D=d.get_size(q);
var v=D[0];
var A=D[1];
var B=Y.DOM.getXY(d.dom("imo"));
var N=B[0];
var L=B[1];
var R=d.get_size(d.dom("imo"));
var O=R[0];
var k=R[1];
var H=0;
var M=this.conf.max_overflow;
var K=this.conf.max_overflow;
var G=true;
if(Q===IMO.REUI.ReTooltip.RIGHT||Q===IMO.REUI.ReTooltip.LEFT){G=(A>n);
H=r+m-(t+A+K);
if(G&&H>0){r-=H;
y+=H;
}H=r+m-(L+k);
if(H>0){r-=H;
y+=H;
}H=t-r-K;
if(G&&H>0){r+=H;
y-=H;
}H=L-r;
if(H>0){r+=H;
y-=H;
}}else{if(Q===IMO.REUI.ReTooltip.UP||Q===IMO.REUI.ReTooltip.DOWN){G=(v>j);
H=s+P-(u-v-M);
if(G&&H>0){s-=H;
z+=H;
}H=s+P-(N+O);
if(H>0){s-=H;
z+=H;
}H=u-s-M;
if(G&&H>0){s+=H;
z-=H;
}H=N-s;
if(H>0){s+=H;
z-=H;
}}}}var I={arr_pos:{},tt_pos:{}};
if(y!==-1){I.arr_pos.top=y+"px";
}if(z!==-1){I.arr_pos.left=z+"px";
}if(r!==-1){I.tt_pos.top=r+"px";
}if(s!==-1){I.tt_pos.left=s+"px";
}return I;
}});
IMO.REUI.HoverableContainer=function(j,i,h){this.dom=j;
this.tooltip=i;
h=a.dfl(h,{});
this.conf={tooltip_hide_timeout:a.dfl(h.tooltip_hide_timeout,10),inout_treshold:a.dfl(h.inout_treshold,15)};
this.timer=null;
this.out_timer=null;
this.hovering_dom=null;
this.enabled=true;
this.need_reenter=false;
this.ev=new IMO.Event();
d.on("mouseover",this._handle_mouse_over,this.dom,this);
d.on("mouseout",this._handle_mouse_out,this.dom,this);
d.on("mouseover",this._handle_tt_over,this.tooltip.dom,this);
d.on("mouseout",this._handle_tt_out,this.tooltip.dom,this);
d.on("click",this._handle_tt_click,this.tooltip.dom,this);
d.on("mousedown",this._handle_tt_md,this.tooltip.dom,this);
};
Y.mix(IMO.REUI.HoverableContainer.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.HoverableContainer.prototype,{is_an_item:function(h){throw"not_implemented_error is_an_item";
},get_data_for_node:function(h){throw"not_implemented_error get_data_for_node";
},handle_tooltip_mousedown:function(){throw"not_implemented_error handle_tooltip_mousedown";
},disable_hover:function(h){this.enabled=false;
if(!h&&this.tooltip.shown){this.tooltip.hide();
}},enable_hover:function(){this.enabled=true;
},hide_current:function(h){if(this.tooltip.shown){this.tooltip.hide();
if(h){this.need_reenter=true;
}}},_handle_mouse_over:function(i){if(!this.enabled){return;
}var h;
for(h=i.target._node;
h&&h!==this.dom&&!this.is_an_item(h);
h=h.parentNode){}if(!h||!this.is_an_item(h)){return;
}this._stop_timer();
if(h!==this.hovering_dom){this.need_reenter=false;
if(this.tooltip.shown){this.tooltip.hide();
}this.tooltip.update(this.get_data_for_node(h));
this.hovering_dom=h;
this._handle_scroll();
this.tooltip.show(h,this.dom);
}else{if(!this.need_reenter){if(!this.tooltip.shown){this._handle_scroll();
this.tooltip.show(h,this.dom);
}}else{this._stop_out_timer();
}}},_handle_scroll:function(){var h=this.tooltip.conf;
var i=h.direction;
if((i===IMO.REUI.ReTooltip.RIGHT||i===IMO.REUI.ReTooltip.LEFT)&&h.do_scroll){d.scroll_to_child(this.dom,this.hovering_dom);
}},_handle_mouse_out:function(h){this._reset_timer();
if(this.need_reenter){this._reset_out_timer();
}},_handle_tt_over:function(h){this._stop_timer();
},_handle_tt_out:function(h){this._reset_timer();
},_handle_tt_md:function(h){if(this.handle_tooltip_mousedown()){this.skip_tt_click=true;
}},_handle_tt_click:function(h){if(this.skip_tt_click){this.skip_tt_click=false;
return;
}if(a.get_text_selection()!==""){return;
}if(IMO.MouseManager.get().check_handled("hover*")){return;
}IMO.MouseManager.get().handled(h,"hover");
this.ev.fire("on_tt_click",this);
if(this.tooltip.shown){this.tooltip.hide();
}},_stop_timer:function(){if(this.timer!==null){this.timer.cancel();
this.timer=null;
}},_reset_timer:function(){this._stop_timer();
this.timer=Y.later(this.conf.tooltip_hide_timeout,this,this._handle_timer);
},_handle_timer:function(){if(!this.enabled){return;
}if(this.tooltip.shown){this.tooltip.hide();
}},_stop_out_timer:function(){if(this.out_timer!==null){this.out_timer.cancel();
this.out_timer=null;
}},_reset_out_timer:function(){this._stop_out_timer();
this.out_timer=Y.later(this.conf.inout_treshold,this,this._handle_out_timer);
},_handle_out_timer:function(){this.need_reenter=false;
}});
IMO.REUI.ElementTooltip=function(i,h){IMO.REUI.ElementTooltip.superclass.constructor.call(this,h);
this.tooltip_content=i;
};
Y.extend(IMO.REUI.ElementTooltip,IMO.REUI.ReTooltip);
Y.mix(IMO.REUI.ElementTooltip.prototype,{update:function(h){this.content=this.tooltip_content;
}},true);
IMO.REUI.HoverableElement=function(l,h,k,j){var i=new IMO.REUI.ElementTooltip(h,k);
IMO.REUI.HoverableElement.superclass.constructor.call(this,l,i,j);
};
Y.extend(IMO.REUI.HoverableElement,IMO.REUI.HoverableContainer);
Y.mix(IMO.REUI.HoverableElement.prototype,{is_an_item:function(h){Y.log(["is_an_item",h]);
return(h===this.dom);
},get_data_for_node:function(h){return null;
},handle_tooltip_mousedown:function(){return false;
}},true);
}());
(function(){var c=IMO.Utils;
var e=c.sprintf;
var m=IMO.Utils.HTML;
var o=IMO.Constants;
var t=IMO.Utils.TranslateDom;
var f=IMO.Utils.TranslateTxt;
var u=IMO.MoveNet.mouse_event_filter_creator(1);
var p=5000;
var s=250;
var r=250;
var h=130;
var a=50;
var n=335;
var l=1000*30;
var b=1;
var d=2;
var g=3;
var q=4;
var v="Voice IM: ";
var j=function(y,w,x){return m.cdiv("convbutton",x,m.sprite("convbutton_img sprite_"+w),y);
};
function i(z){var y=0;
var x=0;
for(var w=0;
w<z.length;
w++){var A=z.charCodeAt(w);
if(A>=1536&&A<=1791||A>=1872&&A<=1919||A>=2208&&A<=2303||A>=64336&&A<=65023||A>=65136&&A<=65279||A>=126464&&A<=126719||A>=1424&&A<=1535||A>=64285&&A<=64335||A>=1792&&A<=1871||A>=1984&&A<=2047||A>=1920&&A<=1983){y++;
}else{x++;
}}if(x===0&&y===0){return false;
}return y/(x+y)>0.6;
}var k=IMO.MoveNet.mouse_event_filter_creator(1);
IMO.REUI.ConversationPanel=function(I){this.typing_timer=null;
this.mark_read_timer=null;
this.comm_points_timer=null;
this.need_comm_point_timer=null;
this.__sending_ims={};
this.conv=I;
this.needs_point_shown=0;
I.ui=this;
I.ev.fire("on_create_ui",I,this);
this.account_offline_dom_elements=[];
this.ev=new IMO.Event();
this.active_top_widget=null;
var B=["ar","az","fa","he","ks","ku","pa","tk","ur","yi"];
var H=false;
for(var z in B){H=H||(IMO.Translate.language.to==B[z]);
}this.text_direction_status=H?null:"ltr";
this.message_transformers=[];
this.add_message_transformer(IMO.VW.message_transformer);
this.add_message_transformer(IMO.REUI.APITransformer.message_transformer);
this.profile_widget=new IMO.REUI.ConvProfilePanel(I.buddy);
this.profile_widget.set_conv_panel(this);
this.games_widget=new IMO.REUI.ConvGamesPanel(I,this);
this.games_widget.set_conv_panel(this);
var x=(this.conv.buddy instanceof IMO.SharedGroup);
var w=x&&!this.conv.buddy.is_native;
if(this.conv.av_conv.ui===undefined){Y.log("initing avtest widget");
var G=new IMO.REUI.AVWidget(this.conv.av_conv,this.conv);
}this.call_widget=this.conv.av_conv.ui;
this.call_widget.set_conv_panel(this);
if(w){var E=this.conv.buddy.account.uid;
var A=this.conv.buddy.account.proto;
var D=this.conv.buddy.gid;
this.photo_manager=IMO.GetPhotoManager(E,A,D);
this.photo_widget=IMO.REUI.GetPhotoWidget(this.photo_manager,this);
}this.send_file_widget=new IMO.REUI.FileTransfer(I,this);
this.last_color=0;
this.buddy_colors={};
this.last_author=null;
this.background=1;
this.typing_members={};
this.convtop_cont=m.cdiv("convtop-container",{cls:"resizable"},this.convtop=m.cdiv("convtop",this.call_widget.dom,this.send_file_widget.dom,this.profile_widget.dom,this.games_widget.dom),this.convtop_resize=m.cdiv("convtop-resize",m.cdiv("sprite_icn_expand_horiz")));
c.foreach([this.call_widget.dom,this.send_file_widget.dom,this.profile_widget.dom,this.games_widget.dom],m.chide,m);
m.chide(this.convtop_cont);
m.on("mousedown",this.handle_resize,this.convtop_resize,this);
m.on("mouseup",this.handle_resize,this.convtop_resize,this);
this.conv_message=m.cdiv("conv-message");
this.convbuttons=m.cdiv("convbuttons",this.call_btn=x?null:j(t("Call"),"icn_voice",{alt:f("Call"),title:f("Call"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-call-button");
this.start_call(IMO.AVConv.AUDIO_CHAT);
},onmouseenter:this.show_avhover,onmouseleave:this.decay_avhover}),this.send_file_btn=j(t("Send File"),"icn_sendfile",{alt:f("Send file"),title:f("Send file"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-sendfile-button");
this.toggle_widget_visibility(IMO.REUI.ConversationPanel.SEND_FILE);
}}),this.profile_btn=j(t("Profile"),"icn_profile",{alt:f("Profile"),title:f("Profile"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-profile-button");
this.toggle_widget_visibility(IMO.REUI.ConversationPanel.PROFILE);
}}),this.history_btn=j(t("History"),"icn_chathistory_clock",{id:"history",alt:f("History"),title:f("History"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-history-button");
if(this.photo_widget&&this.photo_widget.visible){this.photo_widget.hide();
}this.handle_history_click();
J.halt();
}}),this.play_btn=j(t("Games"),"icn_games_grey",{id:"play",alt:f("Applications and Games"),title:f("Applications and Games"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-play-button");
this.toggle_widget_visibility(IMO.REUI.ConversationPanel.GAMES);
}}),this.inv_btn=x&&this.conv.buddy.type!=="temp"?j(t("Invite"),"icn_invite_plus",{alt:f("Invite Buddy"),title:f("Invite Buddy"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-invite-button");
if(this.photo_widget&&this.photo_widget.visible){this.photo_widget.hide();
}this.show_invite_widget();
}}):j(t("Add"),"icn_invite_plus",{alt:f("Add to Conference"),title:f("Add to Conference"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-skype-invite-button");
this.show_invite_widget();
},onmouseenter:this.show_gchover,onmouseleave:this.decay_gchover}),this.leave_btn=j(t("Leave"),"",{alt:f("Leave"),title:f("Leave"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-leave-button");
this.conv.buddy.account.del_buddy(this.conv.buddy);
}}),this.photo_btn=w?j(t("Photos"),"",{alt:f("Photos"),title:f("Photos"),context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-photo-button");
Y.later(10,this,function(){if(!this.photo_widget.visible){this.photo_widget.show();
}else{this.photo_widget.hide();
}});
}}):null,this.direction_btn=j(t("Text"),"icn_dir",{alt:f("Toggle text direction"),title:f("Toggle text direction"),id:"toggle-ltr-rtl",context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-text-direction-button");
m.remove_class(this.dom,this.text_direction_status);
this.text_direction_status=(this.text_direction_status=="ltr")?"rtl":"ltr";
this.input.dir="";
m.add_class(this.dom,this.text_direction_status);
}}),m.cdiv("convbuttons_end"),this.mark_spam_btn=j(t("Report"),"icn_mark_spam",{alt:f("Spam"),title:f("Report as Spam"),cls:"right",context:this,onclick:function(J){this.handle_mark_spam_click(J);
J.halt();
}}),this.block_btn=j("Block","icn_block",{alt:f("Block"),title:f("Block"),cls:"right",context:this,onclick:function(J){this.handle_block_click(J);
J.halt();
}}));
if(x&&this.conv.buddy.type===o.GROUP_TYPE.DISCUSSION){m.cshow(this.leave_btn);
}else{m.chide(this.leave_btn);
}if(this.conv.is_imo_user){this.audio_button_cp=IMO.REUI.Button("blue",m.sprite("icn_voice"),this.audio_cp_cost=t("audio (20 CP)"),{cls:"avhover-button",context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-audio");
this.start_call(IMO.AVConv.AUDIO_CHAT);
}});
this.video_button_cp=IMO.REUI.Button("blue",m.sprite("icn_video"),this.video_cp_cost=t("video (20 CP)"),{cls:"avhover-button last",context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-video");
this.start_call(IMO.AVConv.VIDEO_CHAT);
}});
}else{m.hide(this.block_btn);
m.hide(this.mark_spam_btn);
}if(this.conv.is_imo_user||this.conv.buddy.is_imo_discussion()){this.ask_need_comm_point();
this.need_comm_point_timer=Y.later(5*60*1000,this,this.ask_need_comm_point,null,true);
this.hide_needs_point();
}else{m.hide(this.conv_message);
}this.avhover=m.cdiv("avhover-outer",{context:this,onmouseenter:this.show_avhover,onmouseleave:this.decay_avhover},this.avhover_inner=m.cdiv("avhover-inner",this.audio_button=IMO.REUI.Button("blue",m.sprite("icn_voice"),t("audio"),{cls:"avhover-button",context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-audio");
this.start_call(IMO.AVConv.AUDIO_CHAT);
}}),this.video_button=IMO.REUI.Button("blue",m.sprite("icn_video"),t("video"),{cls:"avhover-button last",context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-video");
this.start_call(IMO.AVConv.VIDEO_CHAT);
}})));
IMO.REUI.Button.align([this.audio_button,this.video_button]);
m.chide(this.avhover);
this.avhover_visible=false;
var C,F;
this.gchover=m.cdiv("avhover-outer",{style:{left:"180px"},context:this,onmouseenter:this.show_gchover,onmouseleave:this.decay_gchover},m.cdiv("avhover-inner",C=IMO.REUI.Button("blue",m.sprite(this.conv.account.get_proto_icon(),{cls:"account-icon"}),t("to [PROTO] Group",{PROTO:o.PROTO_TO_UI[this.conv.account.proto]}),{cls:"avhover-button",context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-skypegroup");
this.show_invite_widget(true);
}}),F=IMO.REUI.Button("blue",m.sprite("groups_available"),t(" to Imo Group"),{cls:"avhover-button last",context:this,onclick:function(J){IMO.MouseManager.get().handled(J,"convw-imogroup");
this.show_invite_widget();
}})));
IMO.REUI.Button.align([C,F]);
m.chide(this.gchover);
this.gchover_visible=false;
this.convlog_widget=new IMO.REUI.ConvLog(this.conv);
this.convlog=m.cdiv("convlog",this.convlog_buffer=m.cdiv("top-buffer"),this.convlog_msgs=this.convlog_widget.dom);
this.convtyping=m.cdiv("convtyping");
this.input=m.textarea();
if(H&&window.navigator.userAgent.indexOf("MSIE")===-1){this.input.dir="auto";
}this.send=m.cdiv("primary-button sprite_btn_send","Send",{alt:f("Send"),title:f("Send")});
this.volume=new IMO.REUI.VolumeIndicator(0,100,50,"up");
this.voicerecord=m.cdiv("voicerecord",{alt:f("Record voice"),title:f("Record voice"),context:this,onmousedown:this.handle_record_mousedown});
this.toggles=m.cdiv("toggles",m.cdiv("sprite_btn_chat_toggle",{alt:f("Toggle chat"),title:f("Toggle chat"),onclick:this.stop_voiceim,context:this}),m.cdiv("sprite_btn_voiceim_toggle",{alt:f("Toggle VoiceIM"),title:f("Toggle VoiceIM"),onclick:this.start_voiceim,context:this}));
this.update_voiceim_button();
this.convmain=m.cdiv("convmain",this.convlog,this.conv_message,this.convbottom=m.cdiv("convbottom",m.cdiv("convinput inner-shadow",m.cdiv("convinput-text-container",this.input),m.sprite("btn_voiceim_toggle voiceim_toggle",{onclick:function(J){this.toggle_voiceim();
},context:this})),this.convtyping,this.voicerecord,m.cdiv("microphone_activity",this.volume.dom),this.voiceim_settings=m.sprite("icn_settings voiceim_settings",{onclick:function(J){IMO.VW.show_options();
},context:this}),this.send));
this.update_voiceim_button();
this.dom=m.cdiv("convpanel",this.convbuttons,this.convtop_cont,this.convmain,{context:this,onclick:function(K){var L=c.get_text_selection();
if(L!==""){IMO.MouseManager.get().handled(K,"conv-panel-selection");
return;
}IMO.MouseManager.get().handled(K,"conv-panel");
if(!IMO.MouseManager.get().check_handled("convprofw-delete-button")){var J=IMO.MouseManager.get().check_handled("convprofw-alias-edit");
this.focus(J);
}},ondragover:function(J){J.halt();
},ondragend:function(J){J.halt();
},ondragenter:function(J){J.halt();
Y.log("dragenter");
m.add_class(this.dom,"dragenter");
},ondragleave:function(J){J.halt();
Y.log("dragleave");
m.remove_class(this.dom,"dragenter");
},ondragstart:function(J){J.halt();
Y.log("dragstart");
},ondrop:function(K){K.halt();
Y.log("drop");
m.remove_class(this.dom,"dragenter");
var J=K._event.dataTransfer.files;
this.show_top_widget(IMO.REUI.ConversationPanel.SEND_FILE);
this.send_file_widget.handle_drag_drop_files(J);
}});
this.dom.appendChild(this.avhover);
this.dom.appendChild(this.gchover);
this.populate_from_history();
if(I.entered_text){this.input.value=I.entered_text;
delete I.entered_text;
}var y=function(){var L=Y.one(this.input);
var K=L.get("value");
L.set("value","");
if(K&&K.length>0){Y.log("send_im");
if(this.conv.is_imo_user){var J={max_points:this.needs_point_shown};
this.conv.send_im(K,J);
}else{this.conv.send_im(K);
}}};
m.on("scroll",this.on_convlog_scroll,this.convlog,this);
m.on("key",function(J){if(!J.shiftKey){J.halt();
y.call(this);
}},this.input,"press:13",this);
m.on("keypress",function(J){Y.later(0,this,this.update_typing_state,J);
},this.input,this);
m.on("keydown",function(J){Y.later(0,this,this.update_typing_state,J);
},this.input,this);
m.on("keyup",function(J){Y.later(0,this,this.update_typing_state,J);
},this.input,this);
m.on("click",function(J){IMO.MouseManager.get().handled(J,"conversation-send-button");
Y.later(0,this,y);
},this.send,this);
this.win=new IMO.WM.Window();
this.win.set_content(this.dom);
this.win.set_title(I.buddy.displaylias);
this.use_emoticons=!IMO.Session.get().get_pref("impref","noEmoticons",IMO.PreferenceDefaults.noEmoticons);
this.auto_voice_im=IMO.Session.get().get_pref("impref","auto_voice_im",IMO.PreferenceDefaults.auto_voice_im);
this.itemdom=null;
if(this.conv.buddy.ui){this.itemdom=this.conv.buddy.ui.dom;
}m.add_class(this.itemdom,"active");
this.on(IMO.Session.get());
this.on(I);
this.on(I.buddy);
this.on(this.win);
this.on(this.conv.av_conv);
this.on(this.call_widget);
if(this.conv.is_imo_user){this.on(I.account);
}this.on_buddy_update(I.buddy);
this.win.size.min[0]=n;
this.win.size.min[1]=r;
this.win.open();
this.update_scroll();
this.update_convlog_buffer();
};
IMO.REUI.ConversationPanel.CALL=b;
IMO.REUI.ConversationPanel.SEND_FILE=g;
IMO.REUI.ConversationPanel.PROFILE=d;
IMO.REUI.ConversationPanel.GAMES=q;
Y.mix(IMO.REUI.ConversationPanel.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.ConversationPanel.prototype,{populate_from_history:function(){m.empty(this.convlog_msgs);
if(this.conv.history.length>0){this.update_scroll=function(){};
for(var A=0;
A<this.conv.history.length;
A++){var x=this.conv.history[A];
var B=x.timestamp;
var z=null;
if(x.author){z=c.groups_shorten_buddy_name(this.conv.account.uid,this.conv.account.proto,this.conv.buddy.gid,x.author_alias||x.author);
}var w=null;
if(x.who==="me"){z=t("me");
w="me";
}else{if(x.who==="system"){w="system";
}else{if(x.author){w=this.get_buddy_style(x.author+";"+x.proto);
}else{z=c.shorten_buddy_name(this.conv.buddy.displaylias);
w="bk0";
}}}if(this.conv.buddy.gid&&this._should_skip(this.conv.buddy.type,x.mode)){continue;
}if(w==="system"){this.add_sys_line(x.msg,B,z,x.author,x.proto);
}else{this.add_im_line(B,z,x.msg,w+" bk_old ",false,null,x.author,x.proto);
}}this.update_convlog_buffer();
delete this.update_scroll;
this.convlog.scrollTop=(1<<20);
}var y=this.conv.buddy;
if(y instanceof IMO.SharedGroup&&y.type===o.GROUP_TYPE.DISCUSSION){this.add_sys_line(f("Broadcast discussions are public"));
}},add_message_transformer:function(x,w){this.message_transformers.push({fn:x,context:w?w:this});
},hide_needs_point:function(){if(this.needs_point_shown===0){m.hide(this.conv_message);
return;
}if(this.conv.is_imo_user){this.avhover_inner.replaceChild(this.audio_button,this.audio_button_cp);
this.avhover_inner.replaceChild(this.video_button,this.video_button_cp);
IMO.REUI.Button.align([this.audio_button,this.video_button]);
}this.needs_point_shown=0;
m.replace_content(this.conv_message,t(""));
m.hide(this.conv_message);
m.css(this.conv_message,{height:"auto"});
m.css(this.convlog,{bottom:IMO.Constants.reui_convbottom_height});
this.update_convlog_buffer();
},show_needs_point:function(z){if(this.conv.is_imo_user&&this.needs_point_shown===0){this.avhover_inner.replaceChild(this.audio_button_cp,this.audio_button);
this.avhover_inner.replaceChild(this.video_button_cp,this.video_button);
IMO.REUI.Button.align([this.audio_button_cp,this.video_button_cp]);
}var D=IMO.Session.get().get_imo_account();
var C=D.cnt_comm_points_left;
this.needs_point_shown=z;
var w;
if(this.conv.buddy.is_imo_discussion()){w="The first message costs [CP] CP.";
}else{w="You have [CPL] CP. Messaging this person costs [CP] CP.";
}var A=null;
m.replace_content(this.conv_message,m.cdiv("messages",m.cdiv("msg-body",t(w,{CP:z,CPL:C})," ",A=m.cspan("more-cp",t("Get more CP.")))));
if(this.more_cp_tooltip){m.destroy(this.more_cp_tooltip);
this.more_cp_tooltip=null;
}var y="";
if(!D.premium){y=m.cdiv("tip",t("Get a premium account"),{onclick:function(F){IMO.REUI.PremiumAccount.show();
}});
}var B=m.cdiv("more-cp-tooltip",y,m.cdiv("tip",t("Invite your friends"),{onclick:function(F){IMO.REUI.MNP_PANEL.invite_friends_clicked();
}}),m.cdiv("tip",t("Complete your profile"),{onclick:function(F){IMO.REUI.MNP_PANEL.edit_profile_clicked();
}}),m.cdiv("tip",t("Learn more about CP"),{onclick:function(F){IMO.REUI.PIN.CPHelpPopup.show();
}}));
var x={direction:IMO.REUI.ReTooltip.UP,sprite:"profile_popover_arrow_up"};
this.more_cp_tooltip=new IMO.REUI.HoverableElement(A,B,x,this.conv_message);
m.show(this.conv_message,"block");
var E=parseInt(Y.DOM.getComputedStyle(this.conv_message,"height"),10);
m.css(this.conv_message,{height:e("%dpx",E)});
m.css(this.convlog,{bottom:e("%dpx",this.conv_message.offsetHeight+IMO.Constants.reui_convbottom_height)});
this.update_convlog_buffer();
},get_buddy_style:function(x){var w=false;
if(this.last_author!==x){this.last_author=x;
this.background=1-this.background;
w=true;
}if(this.buddy_colors[x]===undefined){this.buddy_colors[x]=c.imohash(x)%20;
}var y="buddy"+this.buddy_colors[x]+" bk"+this.background;
if(w){y+=" spacing";
}return y;
},stop_voiceim:function(){if(this.voiceim){Y.log("shutdown voiceim");
IMO.VIM.unprepare();
this.unsubscribe(IMO.VIM);
m.remove_class(this.convbottom,"voiceim");
this.voiceim=false;
}this.update_voiceim_button();
},start_voiceim:function(){if(!this.voiceim){if(IMO.VIM.state===IMO.VIM.ERROR){IMO.NM.add_notification(t(IMO.VIM.error_msg),IMO.REUI.Notification.types.error);
return;
}Y.log("startup voiceim");
Y.log(IMO.VIM);
this.on(IMO.VIM);
m.add_class(this.convbottom,"voiceim");
this.voiceim=true;
Y.later(0,IMO.VIM,IMO.VIM.prepare,null,false);
}this.update_voiceim_button();
},toggle_voiceim:function(){if(this.voiceim){this.stop_voiceim();
}else{this.start_voiceim();
}},update_voiceim_button:function(){c.log("Update button, state: %d",IMO.VIM.state);
m.replace_content(this.voicerecord,t(IMO.VIM.get_state_str(this)));
m.remove_class(this.voicerecord,"sprite_btn_record_red");
m.remove_class(this.voicerecord,"sprite_btn_record_green");
m.remove_class(this.voicerecord,"sprite_btn_record_grey");
if(IMO.VIM.state===IMO.VIM.RECORDING||IMO.VIM.state===IMO.VIM.PREPARED){m.cshow(this.volume.dom);
}else{m.chide(this.volume.dom);
}if(this.voiceim&&IMO.VIM.state===IMO.VIM.PREPARED){m.cshow(this.voiceim_settings);
}else{m.chide(this.voiceim_settings);
}if(IMO.VIM.state===IMO.VIM.RECORDING){m.add_class(this.voicerecord,"sprite_btn_record_red");
}else{if(IMO.VIM.state===IMO.VIM.PREPARED){m.add_class(this.voicerecord,"sprite_btn_record_green");
}else{m.add_class(this.voicerecord,"sprite_btn_record_grey");
}}},handle_record_mousedown:function(w){c.clear_selection();
IMO.MoveNet.attach_move_net(this.handle_record_movenet,this);
this.record_button_position_on_click=Y.DOM.getXY(this.voicerecord);
Y.log("Got a mouse down on a button");
if(IMO.VIM.is_prepared()){var x=[IMO.Network.get().ssid,this.conv.account.uid,this.conv.account.proto,this.conv.buddy.buid].join("#");
IMO.VIM.start(this,x);
}this.update_voiceim_button();
},handle_record_mouseup:function(){Y.log("Got a mouse up with state "+IMO.VIM.state);
if(IMO.VIM.is_recording()){IMO.VIM.stop();
}this.update_voiceim_button();
},handle_record_click:function(w){Y.log("Got a click on record with state "+IMO.VIM.state);
if(IMO.VIM.state===IMO.VIM.DISCONNECTED){IMO.VIM.unprepare();
IMO.VIM.prepare();
}},handle_record_movenet:function(z){c.clear_selection();
var y=u(z);
if(y==="smartup"){IMO.MoveNet.detach_move_net(this.on_move,this);
this.handle_record_mouseup();
var w=[z.clientX,z.clientY];
var x=m.get_size(this.voicerecord);
var A=this.record_button_position_on_click;
delete this.record_button_position_on_click;
if(w[0]>=A[0]&&w[0]<=A[0]+x[0]&&w[1]>=A[1]&&w[1]<=A[1]+x[1]){this.handle_record_click();
}}},handle_block_click:function(w){IMO.MouseManager.get().handled(w,"convw-block-button");
this.conv.buddy.set_blocked(true);
},handle_mark_spam_click:function(w){IMO.MouseManager.get().handled(w,"convw-mark-spam-button");
if(!this.conv.is_imo_user){return;
}this.spam_widget=new IMO.REUI.SpamReportWidget(this.conv.buddy.buid,this.conv.buddy.displaylias,this.conv);
},on_vim_state_change:function(w,x){this.update_voiceim_button();
},on_vim_msg_denied_permission:function(){this.stop_voiceim();
},on_vim_error:function(){this.stop_voiceim();
},on_vim_mic_level:function(w,x){this.volume.set_value(x);
},start_call:function(w){this.hide_avhover();
this.ev.fire("on_call_button_pressed",this.call_widget,w);
this.toggle_widget_visibility(IMO.REUI.ConversationPanel.CALL);
},show_avhover:function(){if(this.avhover_timer){this.avhover_timer.cancel();
delete this.avhover_timer;
}if(!this.avhover_visible&&this.conv.av_conv.state===IMO.AVConv.state_idle){m.cshow(this.avhover);
this.avhover_visible=true;
}},decay_avhover:function(){if(!this.avhover_timer){this.avhover_timer=Y.later(200,this,this.hide_avhover,null,false);
}},hide_avhover:function(){if(this.avhover_timer){this.avhover_timer.cancel();
delete this.avhover_timer;
}if(this.avhover_visible){m.chide(this.avhover);
this.avhover_visible=false;
}},show_gchover:function(){if((this.conv.account.proto===o.PROTO_SKYPE||this.conv.account.proto===o.PROTO_XMPP||this.conv.account.proto===o.PROTO_GTALK)&&!(this.conv.buddy instanceof IMO.SharedGroup)){if(this.gchover_timer){this.gchover_timer.cancel();
delete this.gchover_timer;
}if(!this.gchover_visible){m.cshow(this.gchover);
this.gchover_visible=true;
}}},decay_gchover:function(){if(!this.gchover_timer){this.gchover_timer=Y.later(200,this,this.hide_gchover,null,false);
}},hide_gchover:function(){if(this.gchover_timer){this.gchover_timer.cancel();
delete this.gchover_timer;
}if(this.gchover_visible){m.chide(this.gchover);
this.gchover_visible=false;
}},show_invite_widget:function(w){var x=IMO.REUI.GetGroupInviteWidget();
x.set_group(this.conv.buddy,w);
Y.later(10,this,function(){x.show();
});
},focus:function(w){this.win.set_focus();
},before_add_line:function(){var x=!(this.scroll_state&&this.scroll_state.t+this.scroll_state.vh<this.scroll_state.th-5);
var w=m.has_scroll(this.convlog)[1];
if(!w){m.css(this.convlog,{overflow_y:"hidden"});
}return{scroll_to_bottom:x,has_vertical_scroll:w};
},after_add_line:function(w){this.update_scroll(!w.scroll_to_bottom);
if(!w.has_vertical_scroll){this.update_convlog_buffer();
m.css(this.convlog,{overflow_y:"auto"});
this.convlog.scrollTop=1<<20;
}},emoticonify_msg:function(x,w){Y.later(50,this,function(){var y=false;
c.foreach(x.childNodes,function(z,A){if(z.nodeType===3){var B=c.emoticonify(z);
if(B!==z){y=true;
x.replaceChild(B,z);
}}},this);
if(y){this.after_add_line(w);
}});
},ask_need_comm_point:function(){IMO.Network.get().send("pin","subscribe_to_cp_cost",{ssid:IMO.Network.get().ssid,uid:this.conv.account.uid,proto:this.conv.account.proto,recv_id:this.conv.buddy.buid});
},add_im_line:function(G,x,B,J,H,z,F,D){Y.log(["IM:",B,J,H,z]);
var A=this.before_add_line();
var I=this.convlog_widget.add_im_line(G,x,B,J,F,D);
var w=I[0];
var y=I[1];
if(this.text_direction_status===null){if(window.navigator.userAgent.indexOf("MSIE")!==-1){this.text_direction_status=i(B)?"rtl":"ltr";
m.add_class(this.dom,this.text_direction_status);
this.input.dir=this.text_direction_status;
}else{if(window.getComputedStyle){var E=m.div({style:"display: none;"});
E.innerText=B;
E.dir="auto";
document.body.appendChild(E);
this.text_direction_status=window.getComputedStyle(E).direction;
m.add_class(this.dom,this.text_direction_status);
this.input.dir=this.text_direction_status;
}else{this.text_direction_status="ltr";
}}}if(this.text_direction_status===null){this.text_direction_status="ltr";
}var C={msg:B,msg_dom:w,imdata:z,received_from_buddy:H};
c.foreach(this.message_transformers,function(K){K.fn.call(K.context,C);
});
this.after_add_line(A);
if(this.use_emoticons){this.emoticonify_msg(w,A);
}return I;
},add_sys_line:function(z,F,x,E,C){var A=this.before_add_line();
var D=c.args(arguments,5);
var G=this.convlog_widget.add_sys_line(z,F,x,E,C,D);
var w=G[0];
var y=G[1];
if(typeof z==="string"){var B={msg:z,msg_dom:w,imdata:null,received_from_buddy:false};
c.foreach(this.message_transformers,function(H){H.fn.call(H.context,B);
});
}this.after_add_line(A);
return y;
},hide_top_widget:function(){if(!this.win){return;
}if(this.active_top_widget===null){return;
}if(this.win.visible){this.ev.fire("on_before_top_widget_visibility_change",this.active_top_widget,false);
}c.foreach(this.convbuttons.childNodes,function(w){m.remove_class(w,"active");
});
m.chide(this.get_top_widget(this.active_top_widget).dom);
if(this.win.visible){this.ev.fire("on_after_top_widget_visibility_change",this.active_top_widget,false,true);
}m.chide(this.convtop_cont);
m.css(this.convmain,{top:IMO.Constants.reui_conv_buttons_height});
this.update_convlog_buffer();
this.active_top_widget=null;
this.win.size.min=this.get_min_size();
this.win.resize();
if(IMO.MoveNet.is_attached()&&this.move_net_attached){IMO.MoveNet.detach_move_net(this.handle_resize,this);
this.move_net_attached=false;
}},show_top_widget:function(y,B){var x=this.get_top_widget(y);
var A=x.get_min_size();
if(this.win.visible){this.ev.fire("on_before_top_widget_visibility_change",y,true);
}var z=this.get_widget_button(y);
m.add_class(z,"active");
m.css(this.convtop_cont,{height:e("%dpx",A[1])});
if(this.is_av_widget(y)){m.remove_class(this.call_btn,"running");
m.add_class(z,"running");
if(x.last_height){m.css(this.convtop_cont,{height:e("%dpx",x.last_height)});
}else{m.css(this.convtop_cont,{height:e("%dpx",A[1])});
}}m.cshow(x.dom);
m.cshow(this.convtop_cont);
if(this.win.visible){this.ev.fire("on_after_top_widget_visibility_change",y,true,true);
}var w=parseInt(Y.DOM.getComputedStyle(this.convtop_cont,"height"),10);
m.css(this.convmain,{top:e("%dpx",w+IMO.Constants.reui_conv_buttons_height+1)});
this.active_top_widget=y;
m.toggle_class(this.convtop_cont,"resizable",x.resizable);
this.win.size.min=this.get_min_size();
this.win.resize();
this.update_convlog_buffer();
},is_av_widget:function(w){return(w===IMO.REUI.ConversationPanel.CALL);
},get_top_widget:function(w){switch(w){case IMO.REUI.ConversationPanel.CALL:return this.call_widget;
case IMO.REUI.ConversationPanel.PROFILE:return this.profile_widget;
case IMO.REUI.ConversationPanel.SEND_FILE:return this.send_file_widget;
case IMO.REUI.ConversationPanel.GAMES:return this.games_widget;
default:return null;
}},get_widget_button:function(w){switch(w){case IMO.REUI.ConversationPanel.PROFILE:return this.profile_btn;
case IMO.REUI.ConversationPanel.CALL:return this.call_btn;
case IMO.REUI.ConversationPanel.SEND_FILE:return this.send_file_btn;
case IMO.REUI.ConversationPanel.GAMES:return this.play_btn;
default:return null;
}},handle_resize:function(C){c.clear_selection();
var z=k(C);
if(z==="smartdown"){this.fix_y=-Y.one(this.convtop_cont).getY()+Y.one(this.convtop_resize).getY()+this.convtop_resize.offsetHeight-C.clientY;
IMO.MoveNet.attach_move_net(this.handle_resize,this);
this.move_net_attached=true;
}else{if(z==="smartmove"){var y=C.clientY+this.fix_y;
var x=this.get_top_widget(this.active_top_widget);
var B=x.get_min_size(this.active_top_widget)[1];
var A=this.get_convlog_min_height();
y=c.cap(y,B,this.dom.offsetHeight-A);
this.resize_widget(y);
this.ev.fire("on_pos_size_change");
if(y===B){m.css(this.convtop_resize,{cursor:"s-resize"});
}else{m.css(this.convtop_resize,{cursor:"n-resize"});
}}else{if(z==="smartup"){if(IMO.MoveNet.is_attached()){IMO.MoveNet.detach_move_net(this.handle_resize,this);
this.move_net_attached=false;
}}}}},get_convlog_min_height:function(){var w=this.active_top_widget?h:r;
if(this.needs_point_shown>0){w+=a;
}return w;
},on_set_prefs:function(w){c.foreach(w,function(y,x){this.handle_pref(y.kind,y.pref,y.value);
},this);
},on_recv_pref:function(x,w,y){this.handle_pref(x,w,y);
},handle_pref:function(x,w,y){if(x==="impref"){if(w==="noEmoticons"){this.use_emoticons=!y;
}else{if(w==="auto_voice_im"){this.auto_voice_im=y;
}}}},on_resize:function(){this.update_scroll();
this.update_convlog_buffer();
var x=this.get_top_widget(this.active_top_widget);
if(x===null){return;
}var z=x.get_min_size(this.active_top_widget)[1];
var w=Y.DOM.getComputedStyle(this.convtop_cont,"height");
w=parseInt(w.slice(0,w.length-2),10);
var y=this.get_convlog_min_height();
w=c.cap(w,z,this.dom.offsetHeight-y);
this.resize_widget(w);
this.ev.fire("on_pos_size_change");
},on_widget_request_resize:function(){this.win.size.min=this.get_min_size();
this.win.resize();
},get_min_size:function(){var y=[0,0];
var w=this.get_top_widget(this.active_top_widget);
var z=[0,0];
if(w){z=w.get_min_size();
}Y.log(z);
var x=this.get_convlog_min_height();
y[0]=c.max(n,z[0]);
y[1]=x+z[1];
return y;
},on_move:function(){this.ev.fire("on_pos_size_change");
},on_zindex:function(x,w){this.ev.fire("on_zindex",w);
},on_before_content_visibility_change:function(w,x){if(this.active_top_widget){this.ev.fire("on_before_top_widget_visibility_change",this.active_top_widget,x);
}if(x===false){this.update_scroll(true);
}},on_after_content_visibility_change:function(w,x){if(this.active_top_widget){this.ev.fire("on_after_top_widget_visibility_change",this.active_top_widget,x,false);
}if(x){Y.later(0,this,this.update_scroll);
if(this.needs_point_shown){Y.later(0,this,this.show_needs_point,this.needs_point_shown);
}}},on_date_changed:function(w){this.add_sys_line(w);
},resize_widget:function(x){m.css(this.convtop_cont,{height:e("%dpx",x)});
if(this.is_av_widget(this.active_top_widget)){var w=this.get_top_widget(this.active_top_widget);
w.last_height=x;
}m.css(this.convmain,{top:e("%dpx",x+1+IMO.Constants.reui_conv_buttons_height)});
this.update_convlog_buffer();
},toggle_widget_visibility:function(w,x){x=c.dfl(x,false);
if(this.active_top_widget!==w){this.hide_top_widget();
this.show_top_widget(w,x);
}else{if(this.active_top_widget!==null){if(!x){this.hide_top_widget();
}}}},on_buddy_update:function(y,C,x){this.win.set_title(y.displaylias);
this.win.set_icon(y.protoicon);
if(!C||!x){return;
}var A=(this.conv.buddy instanceof IMO.SharedGroup);
if(A&&this.conv.buddy.type===o.GROUP_TYPE.DISCUSSION){m.cshow(this.leave_btn);
}else{m.chide(this.leave_btn);
}var B=C.primitive;
var z=x.primitive;
if(B===undefined){return;
}if(B===o.PRIM_OFFLINE&&z!==o.PRIM_OFFLINE){this.add_sys_line(f("[BUDDY] is offline",{BUDDY:y.displaylias}),null,null,null,null,{cls:"sys_offline"});
}if(B!==o.PRIM_OFFLINE&&z===o.PRIM_OFFLINE){var w=(new Date()).getTime();
if(w-this.conv.account.signed_on_time>=l||y.has_been_online){this.add_sys_line(f("[BUDDY] is online",{BUDDY:y.displaylias}),null,null,null,null,{cls:"sys_online"});
}}},on_account_online:function(w){this.input.removeAttribute("disabled");
c.foreach(this.account_offline_dom_elements,function(x,y){m.remove(x);
});
this.account_offline_dom_elements=[];
},on_account_offline:function(w){var y=f("You are offline.");
var x=this.add_sys_line(y);
this.account_offline_dom_elements.push(x);
Y.DOM.setAttribute(this.input,"disabled",true);
},on_send_im:function(z,y,x,A){var w=this.add_im_line("Sending","me",y,"me",false,x);
this.__sending_ims[A]=w;
},on_send_im_confirm:function(A,y){var z=this.__sending_ims[y.id];
if(!z){return;
}delete this.__sending_ims[y.id];
var w=m.get_elements_by_class(z[1],"ts")[0];
var x=this.convlog_widget.timestamp(y.timestamp);
m.replace_content(w,m(x));
},on_reflect_send_im:function(x,w){this.add_im_line(w.timestamp,"me",w.msg,"me "+w.mode,false,w.imdata);
},on_marked_msgs_as_read:function(x,w){this.win.set_attention(0);
},on_have_unread_msgs:function(x){var w=this.before_add_line();
this.convlog_widget.add_have_unread_msgs_line();
this.after_add_line(w);
},on_recv_unread_msg:function(x,w){w.unread_msg=true;
this.on_recv_im(this.conv,w);
},mark_msgs_as_read_later:function(w){this.mark_read_timer=Y.later(w,IMO.IMBox.get(),IMO.IMBox.get().mark_msgs_as_read,this.conv);
},cancel_mark_msgs_as_read:function(){if(this.mark_read_timer!==null){Y.log("imbox cancel read timer");
this.mark_read_timer.cancel();
}},mark_msgs_as_read_now:function(){IMO.IMBox.get().do_mark_msgs_as_read(this.conv);
},on_exist_unsent_msgs:function(y,x){var w=this.before_add_line();
this.convlog_widget.add_exist_unsent_msgs_line(x);
this.after_add_line(w);
},on_needs_comm_point:function(y,w){this.conv.buddy.cp_costs=w;
var x="send_im";
if(this.conv.buddy instanceof IMO.SharedGroup&&this.conv.buddy.type===o.GROUP_TYPE.DISCUSSION){x="discussion_im";
}m.replace_content(this.audio_cp_cost,t("audio ([COST] CP)",{COST:w.audio_call}));
m.replace_content(this.video_cp_cost,t("video ([COST] CP)",{COST:w.video_call}));
if(w[x]===0){this.hide_needs_point();
}else{this.show_needs_point(w[x]);
}},on_comm_points_left_changed:function(w,y){var x=this.needs_point_shown;
if(x>0){this.hide_needs_point();
this.show_needs_point(x);
}},on_not_enough_comm_points:function(y,x){var w=x.points_needed;
var z=IMO.Session.get().get_imo_account().cnt_comm_points_left;
this.add_im_line(null,f("System"),f("Sorry, to send this message you need [CP] CP. You have [CPL] CP.",{CP:w,CPL:z}),"system",true);
this.show_needs_point(w);
},on_comm_point_missing:function(A,x){var w=x.points_needed;
this.add_im_line(null,f("System"),f("Messaging this contact will cost you [CP] CP. Your message has not been sent yet, please try again.",{CP:w}),"system",true);
this.show_needs_point(w);
var B=Y.one(this.input);
var z=B.get("value");
if(z.length===0){B.set("value",x.msg);
}},on_new_mnp_conv:function(w){this.show_top_widget(d,true);
},on_recv_im:function(B,A){if(this.win.get_focus()){this.mark_msgs_as_read_later(s);
}Y.log("conversation.recv_im");
var z=A.msg;
var y;
if(A.author){var w=c.groups_shorten_buddy_name(this.conv.account.uid,this.conv.account.proto,B.buddy.gid,A.author_alias||A.author);
if(A.mode){y=A.mode;
}else{y=this.get_buddy_style(A.author);
}var x=[null,null];
if(A.author){x=c.groups_split(A.author);
}if(this._should_skip(this.conv.buddy.type,A.mode)){return;
}this.add_im_line(A.timestamp,w,A.msg,y,true,A.imdata,x[0],x[1]);
z=(w.innerText||w.data||w.textContent)+": "+z;
if(A.mode==="notify"){return;
}}else{y="bk0";
if(A.mode){y=A.mode;
}this.add_im_line(A.timestamp,c.shorten_buddy_name(this.conv.buddy.displaylias),A.msg,y,true,A.imdata);
}if(!this.conv.buddy.muted){this.win.set_preview(c.word_breaker(c.linkify_string(z)));
}if(!this.win.get_focus()){this.win.set_attention(this.win.att_data.messages+1);
}if(A.unread_msg||this.conv.buddy.muted){return;
}if(IMO.Session.get().primitive===IMO.Constants.PRIM_AWAY||!this.win.get_focus()){if(!A.is_silent){IMO.Sound.get().play("beep");
}}if(IMO.BrowserFocus.current_focus_state===IMO.BrowserFocus.BLUR){IMO.H5.notify(this.conv.buddy.get_buddy_icon(),this.conv.buddy.displaylias,z,function(){if(typeof this.focus==="function"){this.focus();
}IMO.WM.B.active_wm.window_focus(null);
},this);
}},on_system_im:function(x,w){this.add_sys_line(w);
},get_group_typing_notification:function(){var A="";
var y=0;
var z="";
for(var x in this.typing_members){if(y<3){if(y>0){z+=", ";
}z+=this.typing_members[x];
}++y;
}if(y===0){return null;
}if(y>3){var w="other";
if(y>4){w+="s";
}A+=f("[BUDDIES] and [COUNT] other(s) are typing...",{COUNT:y-3,BUDDIES:z});
}else{if(y===1){A+=f("[BUDDY] is typing...",{BUDDY:z});
}else{A+=f("[BUDDIES] are typing...",{BUDDIES:z});
}}return m.span(A);
},on_typing:function(z,x){var y=null;
if(this.conv.buddy instanceof IMO.SharedGroup){var A=x.author;
var w=this.conv.buddy.account.groups.get_target(this.conv.buddy.gid,A);
if(w){this.typing_members[A]=w.displaylias;
y=this.get_group_typing_notification();
}else{return;
}}else{y=m.span(this.conv.buddy.displaylias,t(" is typing..."));
}m.empty(this.convtyping).appendChild(y);
},on_typed:function(x,w){if(this.conv.buddy instanceof IMO.SharedGroup){this.on_not_typing(x,w);
return;
}m.empty(this.convtyping).appendChild(m.span(this.conv.buddy.displaylias,t(" has entered text")));
},on_not_typing:function(y,w){if(this.conv.buddy instanceof IMO.SharedGroup){delete this.typing_members[w.author];
var x=this.get_group_typing_notification();
if(x){m.empty(this.convtyping).appendChild(x);
return;
}}m.empty(this.convtyping);
},on_av_conv_state_change:function(w){switch(w){case IMO.AVConv.state_noflash:case IMO.AVConv.state_idle:this.win.set_attention_icon(null);
m.remove_class(this.call_btn,"running");
break;
case IMO.AVConv.state_ringing:case IMO.AVConv.state_active:case IMO.AVConv.state_init:this.win.set_attention_icon(m.sprite("badge_cam"));
break;
default:break;
}},on_close_request:function(x){this.conv.entered_text=this.input.value;
var w=(this.conv.av_conv.state!==IMO.AVConv.state_idle);
this.conv.av_conv.close_conv("hangup",w);
this.win.close();
},on_clear:function(){this.conv.history=[];
m.empty(this.convlog_msgs);
},on_close:function(w){m.remove_class(this.itemdom,"active");
m.remove_class(this.itemdom,"focused");
m.remove_class(this.itemdom,"attention");
this.mark_msgs_as_read_now();
this.destroy();
},on_set_attention:function(y,w){var x=w.messages?m.add_class:m.remove_class;
x(this.itemdom,"attention");
},on_focus_change:function(w,x){if(x===true){if(!this.is_focused){this.mark_msgs_as_read_now();
}c.log("window focused (%s)",this.conv.buddy.displaylias);
m.add_class(this.itemdom,"focused");
this.is_focused=true;
this.conv.title_notification=null;
w.set_attention(0);
if(!IMO.MouseManager.get().check_handled("convprofw-alias-edit","conv-panel-selection")){Y.later(10,this.input,function(){try{this.focus();
}catch(y){}});
}}else{this.cancel_mark_msgs_as_read();
m.remove_class(this.itemdom,"focused");
this.is_focused=false;
Y.later(10,this.input,function(){this.blur();
});
}if(Y.UA.opera){this.convlog.scrollTop=1<<20;
}},on_buddy_destroy:function(w){this.on_close_request(this.win);
},update_scroll:function(w){var x=this.scroll_state;
var y={t:this.convlog.scrollTop,vh:this.convlog.offsetHeight,th:this.convlog.scrollHeight};
if(x===undefined||w){this.scroll_state=y;
return;
}if(x.t+x.vh>=x.th-5){y.t=y.th-y.vh+1;
}else{y.t=x.t+x.vh-y.vh;
}this.convlog.scrollTop=y.t;
this.scroll_state=y;
this.last_update_scroll=new Date();
},update_convlog_buffer:function(){var w=this.convlog.offsetHeight;
var x=this.convlog_msgs.offsetHeight;
var y=this.convlog_buffer.offsetHeight;
if(x>=w){y=0;
}else{y=w-x;
}m.css(this.convlog_buffer,{height:e("%dpx",y)});
this.update_scroll();
},on_convlog_scroll:function(w){Y.log("on scroll");
this.update_scroll(true);
},destroy:function(){this.input.value="";
this.update_typing_state();
if(this.voiceim){this.voiceim=false;
this.unsubscribe(IMO.VIM);
IMO.VIM.unprepare();
}if(this.need_comm_point_timer){this.need_comm_point_timer.cancel();
delete this.need_comm_point_timer;
}this.conv.ev.fire("on_destroy_ui",this.conv,this);
c.log("%s convpanel destroyed",this.conv.buddy.buid);
this.unsubscribe_all();
this.win.destroy();
this.send_file_widget.destroy();
delete this.conv.ui;
delete this.win;
},update_typing_state:function(w){if(this.typing_timer!==null){this.typing_timer.cancel();
this.typing_timer=null;
}if(!this.input.value){this.conv.send_typing_state("not_typing");
}else{this.conv.send_typing_state("typing");
this.typing_timer=Y.later(p,this.conv,this.conv.send_typing_state,"typed");
}},handle_history_click:function(){var w=IMO.REUI.get_history_search_widget();
w.show_previews(this.conv.buddy);
},_should_skip:function(w,x){return(w===o.GROUP_TYPE.DISCUSSION&&x==="notify"&&!IMO.Session.get().get_pref("impref","show_discussion_join_leave",false));
}});
}());
(function(){var a=IMO.Utils;
var b=IMO.Utils.HTML;
var c=IMO.Utils.TranslateTxt;
var d=IMO.Constants;
IMO.REUI.ConvLog=function(e){this.conv=e;
this.has_past_im={};
this.dom=b.cdiv("convlog-msgs");
};
Y.mix(IMO.REUI.ConvLog.prototype,{timestamp:function(e){var f;
if(typeof e==="number"){f=new Date(e*1000);
}else{if(e instanceof Date){f=e;
}else{if(!e){f=new Date();
}else{return e;
}}}return f.toLocaleTimeString();
},add_im_line:function(l,f,g,n,k,i){var j=(i===d.PROTO_IMO)?k:null;
var e=a.linkify_string(g);
var m=new Date();
m.setHours(11);
m.setMinutes(59);
m.setSeconds(59);
var h=b.div(b.cspan("ts-container",b.span({cls:"ts"},this.timestamp(l)),b.span({cls:"ts-dummy"},"."+this.timestamp(m))),this.name_span=b.span({cls:"na",onclick:function(o){this._lookup_user(j);
},context:this}," ",f," "),b.div({cls:"ms"},e),{cls:"convlogitem "+(n?n:"")});
if(j){b.add_class(this.name_span,"clickable");
if(this.conv.buddy.is_imo_discussion()){if(!this.has_past_im[j]){this.has_past_im[j]=true;
if(this.conv.is_group_admin()){h.appendChild(b.cspan("action","ban",{context:this,onclick:function(o){this._ban_member(k,i);
}}));
}h.appendChild(b.cspan("action","off-topic",{context:this,onclick:function(o){this._off_topic(k);
}}));
}}}this.add_line(h);
return[e,h];
},add_have_unread_msgs_line:function(){var e=b.div(b.span({cls:"end_unread_msgs_text"},"end of unread messages"),b.span({cls:"end_unread_msgs_line"}));
this.add_line(e);
},add_exist_unsent_msgs_line:function(f){var g=(f===1)?"message":"messages";
var e="You have "+f+" additional unread "+g+". You can view them in your chat history.";
var h=b.div(b.span({cls:"exist_unsent_msgs_text"},e));
this.add_line(h);
},add_sys_line:function(g,m,f,l,i,k){var j=(i===d.PROTO_IMO)?l:null;
var e=g;
if(typeof g==="string"){e=a.linkify_string(g);
}var h=b.div(b.span({cls:"ts"},this.timestamp(m)),this.name_span=b.span({cls:"na convlogitem_notify",onclick:function(n){this._lookup_user(j);
},context:this}," ",f," "),b.span({cls:"ms sys"},e),k);
if(j){b.add_class(this.name_span,"clickable");
}this.add_line(h);
return[e,h];
},clear_messages:function(){while(this.dom.childNodes.length>=1){this.dom.removeChild(this.dom.firstChild);
}this.has_past_im={};
},add_line:function(e){this.dom.appendChild(e);
},_lookup_user:function(e){if(e){var f='user:"'+e+'"';
IMO.REUI.PIN.Directory.show(f,false);
}},_ban_member:function(f,e){this.conv.ban_member(f,e);
},_off_topic:function(e){this.conv.off_topic(e);
}});
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var f=IMO.Constants;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
var e="We are sorry. We currently don't support chat history export for any of your protocols. We are working on it.";
IMO.REUI.ExportConvHistoryWidget=function(){this.build_dom();
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[500,NaN]);
this.popup.set_title(d("Export Chat History"));
this.popup.prepare();
};
Y.mix(IMO.REUI.ExportConvHistoryWidget.prototype,{build_dom:function(){this.dom=c.form({id:"export-conv-history",onsubmit:function(g){g.preventDefault();
this.export_history(g);
return false;
},context:this});
this._get_history_export_enabled_accounts(function(g){Y.log(["Accounts",g.length,g]);
if(g.length===0){this.dom.appendChild(c.div(b(e)));
}a.foreach(g,function(i){Y.log(["Account: ",i]);
var h=c.input({type:"radio",name:"account_g"});
this.dom.appendChild(c.cdiv("export-account",{onclick:function(){this.select_account(i);
h.checked=true;
},context:this},h,c.sprite(i.get_proto_icon(),{cls:"account-icon"}),c.span(i.get_display_name())));
},this);
this.popup.adjust_size();
});
},build_verify_dom:function(h){this.selected_account=h;
if(this.export_verify_dom){c.remove(this.export_verify_dom);
c.destroy(this.export_verify_dom);
}var g=new IMO.UIWidgets.Button2("Export Chat History",{onclick:this.export_history,context:this});
if(h.proto===f.PROTO_SKYPE){this.export_verify_dom=c.cdiv("export-verify",c.hr(),c.idiv("export-verify-help",b("Export history for the following account")),c.cdiv("export-verify-line",c.label(b("Account")),c.cdiv("export-verify-account",c.sprite(h.get_proto_icon(),{cls:"account-icon"}),c.span(h.get_display_name()))),g.dom,c.a({id:"export-history",href:"#",cls:"fr",onclick:this.get_past_exports,context:this},b("Past Exports")),c.cdiv("clear"));
}else{this.export_verify_dom=c.cdiv("export-verify",c.hr(),c.idiv("export-verify-help",b("Please verify the password for this account")),c.cdiv("export-verify-line",c.label(b("Account")),c.cdiv("export-verify-account",c.sprite(h.get_proto_icon(),{cls:"account-icon"}),c.span(h.get_display_name()))),c.cdiv("export-verify-line",c.label(b("Password")),this.passwd_input=c.input({id:"export-verify-password",type:"password"})),g.dom,c.a({id:"export-history",href:"#",cls:"fr",onclick:this.get_past_exports,context:this},b("Past Exports")),c.cdiv("clear"));
}this.dom.appendChild(this.export_verify_dom);
this.popup.adjust_size();
},select_account:function(g){this._clean_up_temp_divs();
this.build_verify_dom(g);
},show:function(){this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide}},bottom:true,context:this});
this.popup.show();
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.popup.hide();
},export_history:function(h){this.dom.appendChild(c.idiv("export-loading",c.span(b("Please wait while we prepare your history for export.")),c.img({src:"assets/loader_32.gif"})));
this.popup.adjust_size();
var g,i;
if(this.selected_account.proto===f.PROTO_SKYPE){g=null;
i="skype_export_history";
}else{g=this.passwd_input.value;
i="export_history";
}IMO.Network.get().send("convhistory_export",i,{uid:this.selected_account.uid,proto:this.selected_account.proto,passwd:g},true,function(j){Y.log(["convhistory_export:",j]);
this._clean_up_temp_divs();
if(j.status=="wrong_password"){this.dom.appendChild(c.idiv("export-error",b("Wrong Password")));
}if(j.status==="ok"){document.location=j.url;
}},this);
if(this.selected_account.proto!==f.PROTO_SKYPE){this.passwd_input.value="";
}},get_past_exports:function(g){this.selected_account.send("show_takeouts",{},"convhistory_export",this._show_takeouts,this);
},_show_takeouts:function(i){this._clean_up_temp_divs();
var h=c.table({id:"takeouts"});
h.appendChild(c.tr(c.th(b("Date")),c.th(b("Account")),c.th(b("Item")),c.th(b("IP address"))));
var g=this.selected_account.get_display_text_with_proto();
a.foreach(i,function(l){var k=new Date(l.timestamp*1000);
var j=k.toLocaleDateString()+" "+k.toLocaleTimeString();
h.appendChild(c.tr(c.td(j),c.td(g),c.td(l.item),c.td(l.ip)));
},this);
this.dom.appendChild(c.idiv("takeouts-container",h));
this.popup.adjust_size();
},_get_history_export_enabled_accounts:function(g){IMO.Network.get().send("convhistory_export","get_extra_accounts",{ssid:IMO.Network.get().ssid},true,function(i){if(i===null){return;
}var h=IMO.Session.get().get_accounts();
Y.log(["Session accounts",h]);
Y.log(["Extra Accounts",i]);
a.foreach(i,function(l){var k=false;
if(l.proto!==f.PROTO_NEWFACEBOOK){for(var j=0;
j<h.length;
j++){if(h[j].uid===l.uid&&h[j].proto===l.proto){k=true;
break;
}}if(!k){h.push(new IMO.IMAccount(l.uid,l.proto));
}}},this);
Y.log(["Acount available for export",h]);
g.apply(this,[h]);
},this);
},_clean_up_temp_divs:function(){if(c.dom("export-loading")){c.remove(c.dom("export-loading"));
}if(c.dom("export-error")){c.remove(c.dom("export-error"));
}if(c.dom("takeouts")){c.remove(c.dom("takeouts"));
}}});
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var h=IMO.Constants;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
var d=IMO.REUI.Feedback={};
var g=function(){this.email_address="";
this.message="";
this.build_dom();
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[350,NaN]);
this.popup.set_title(e("Feedback"));
};
Y.mix(g.prototype,{show:function(j){this.popup.prepare();
this.popup.show();
if(j===true){this.popup.hide=function(){};
this.hide=function(){};
}else{this.shortcuts=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide}},bottom:true,context:this});
}var i=this.guess_email_address();
if(i===""){this.email_address.focus();
}else{this.email_address.value=i;
this.message.focus();
}},clear:function(){this.email_address.value="";
this.message.value="";
},hide:function(){IMO.KeyboardManager.get().pop(this.shortcuts);
delete this.shortcuts;
this.popup.hide();
},guess_email_address:function(){var k={};
a.foreach(h.PROTO_TO_UI,function(i,o){k[o]=99;
});
k[h.PROTO_GTALK]=1;
k[h.PROTO_XMPP]=2;
k[h.PROTO_MSN]=3;
k[h.PROTO_YAHOO]=4;
k[h.PROTO_MYSPACE]=5;
k[h.PROTO_AIM]=6;
var m=IMO.Session.get().get_accounts();
m.sort(function(o,i){return k[o.proto]-k[i.proto];
});
for(var j=0;
j<m.length;
j++){var n=m[j];
var l=n.proto;
if(l===h.PROTO_MSN){return n.uid;
}else{if(l===h.PROTO_GTALK||l===h.PROTO_MYSPACE||l===h.PROTO_XMPP){return n.uid;
}else{if(l===h.PROTO_YAHOO){return n.uid+(n.uid.indexOf("@")<0?"@yahoo.com":"");
}else{if(l===h.PROTO_AIM){return n.uid+(n.uid.indexOf("@")<0?"@aim.com":"");
}}}}}return"";
},send_feedback:function(i){IMO.MouseManager.get().handled(i,"feedback-send-button");
if(Y.Lang.trim(this.message.value)!==""){IMO.Session.get().send_feedback(this.email_address.value,this.message.value);
}this.clear();
this.hide();
if(IMO.NM){IMO.NM.add_notification(c.div(b("Thanks for your feedback!")),IMO.REUI.Notification.types.info);
}else{alert(e("Thanks for your feedback!"));
}},build_dom:function(){this.dom=c.div({cls:"feedback"},c.form(c.div({cls:"feedback_label"},b("Your email:")),this.email_address=c.input({cls:"feedback_from",name:"from"}),c.div({cls:"feedback_label"},b("Message:")),this.message=c.textarea({"class":"feedback_message",name:"message"}),IMO.REUI.Button("blue",{cls:"feedback_send",onclick:this.send_feedback,context:this},b("Send")),c.div({cls:"feedback_disclaimer"},b("For debugging purposes your feedback will include your username and browser version.")),c.div({cls:"feedback_clear"})));
}});
var f=null;
d.show=function(i){if(f===null){f=new g();
}IMO.Stats.increment_counter("show_feedback");
f.show(i);
};
}());
(function(){var U=IMO.Utils;
var H=U.HTML;
var _=IMO.Utils.TranslateDom;
var __=IMO.Utils.TranslateTxt;
var error_messages={size:_("Sorry, your upload exceeded 100 MB, please use a smaller file."),quota:_("Sorry, you have been uploading too many files, please try again in a few hours."),"disk space":_("Sorry, demand for our file transfer service is too high right now."),"file name":_("Sorry, your file name is too long."),auth:_("Sorry, your upload failed, please reload the page."),"io error":_("Server error (a) -- please try again."),"bad request":_("Server error (b) -- please try again.")};
var friendly_size=function(bytes){var i=0;
while(bytes>=1024&&i<5){bytes/=1024;
i++;
}return bytes.toFixed(2)+" "+["bytes","KB","MB","GB","TB"][i];
};
IMO.REUI.FileTransfer=function(conv,parent){this.build_dom();
this.conv=conv;
this.parent=parent;
IMO.EventDispatcher.get().subscribe(this,"filetransfer","filetransfer");
};
Y.mix(IMO.REUI.FileTransfer.prototype,{build_dom:function(){this.dom=H.div({cls:"filetransfer"},H.div({cls:"filetransfer-instruction"},_("Choose a file (or drag from your desktop) to send")),this.form=H.form({enctype:"multipart/form-data"},this.fname=H.input({type:"file",name:"file_data",size:30,context:this,onchange:function(){H.empty(this.error);
}}),this.file_name=H.input({type:"hidden",name:"file_name"}),this.input_uid=H.input({type:"hidden",name:"uid"}),this.input_proto=H.input({type:"hidden",name:"proto"}),this.input_ssid=H.input({type:"hidden",name:"ssid"}),H.div({cls:"filetransfer-fineprint"},H.div({cls:"filetransfer-print"},_("Your friend will be given a url to download the file. The url will be valid for 24 hours. Files can be at most 100 MB. Do not send copyrighted files."))),this.file_info_remove=H.cdiv("filetransfer-fileinfo-container",this.file_info=H.cdiv("filetransfer-fileinfo"),this.remove=H.a(_("remove"),{context:this,href:"#",onclick:this.remove_drag_file})),this.send_file_button=IMO.REUI.Button("blue",{onclick:this.send_file,context:this},_("Send file")),this.sending_status=H.cdiv("sending-status",this.spinner=H.img({cls:"sending-spinner",src:"assets/loading_16.gif"}),H.div(_("Sending file, please wait..."),{cls:"sending-label"}),this.progress_bar_container=H.cdiv("progress-bar-container",this.progress_bar=H.cdiv("progress-bar"))),this.error=H.div({cls:"filetransfer-error"})));
this.hide_progress_bar();
H.hide(this.file_info_remove);
},remove_drag_file:function(){delete this.drag_drop_file;
H.hide(this.file_info_remove);
},set_error:function(translated_text){H.replace_content(this.error,translated_text);
},send_file:function(e,o){this.show_progress_bar(0,100);
IMO.MouseManager.get().handled(e,"ftw-send-button");
if(this.fname.value===""&&this.drag_drop_file===undefined){this.hide_progress_bar();
this.set_error(_("Please choose a file."));
return;
}H.empty(this.error);
this.file_name.value=this.fname.value||this.drag_drop_file.name;
this.input_uid.value=this.conv.account.uid;
this.input_proto.value=this.conv.account.proto;
this.input_ssid.value=IMO.Network.get().ssid;
if(this.drag_drop_file){this.upload_file(this.drag_drop_file);
}else{var cfg={method:"POST",form:{id:this.form,upload:true},on:{complete:this.on_complete,failure:this.on_failure},context:this};
Y.io(this.get_request_uri(),cfg);
}},upload_file:function(file){Y.log(["upload_file",file]);
var xhr=new XMLHttpRequest();
xhr.open("POST",this.get_request_uri(),true);
var that=this;
xhr.onreadystatechange=function(){Y.log("xhr.readyState "+xhr.readyState);
if(xhr.readyState==4){Y.log("xhr.status: "+xhr.status);
if(xhr.status==200){Y.log(xhr);
var o={responseText:xhr.responseText};
that.on_complete(null,o,null);
}else{that.on_failure();
}}};
var reader=new window.FileReader();
reader.onload=function(e){var bin=e.target.result;
Y.log(["len bin",bin.length]);
var boundary="BROWSERS_ARE_TERRIBLE!!!";
var contentType="multipart/form-data; boundary="+boundary;
xhr.setRequestHeader("Content-Type",contentType);
var CRLF="\r\n";
var parts=[];
var part="Content-Disposition: form-data; ";
part+='name="file_data"'+CRLF;
part+="Content-Type: application/octet-stream";
part+=CRLF+CRLF;
part+=bin+CRLF;
parts.push(part);
var elements={file_name:file.name,ssid:that.input_ssid.value,uid:that.input_uid.value,proto:that.input_proto.value};
for(var element_name in elements){part="Content-Disposition: form-data; ";
part+='name="'+element_name+'"'+CRLF+CRLF;
part+=elements[element_name]+CRLF;
parts.push(part);
}var request="--"+boundary+CRLF;
request+=parts.join("--"+boundary+CRLF);
request+="--"+boundary+"--"+CRLF;
Y.log(["xhr",xhr]);
if(xhr.sendAsBinary===undefined){Y.log("we do not have it");
XMLHttpRequest.prototype.sendAsBinary=function(datastr){function byteValue(x){return x.charCodeAt(0)&255;
}var ords=Array.prototype.map.call(datastr,byteValue);
var ui8a=new window.Uint8Array(ords);
this.send(ui8a.buffer);
};
}xhr.sendAsBinary(request);
Y.log("send done");
};
reader.readAsBinaryString(file);
Y.log(["reader",reader]);
},get_request_uri:function(){this.request_id=U.random_string();
var uri="/fu/imofileuploader/"+IMO.Network.get().ssid+"/"+this.request_id+"/";
return uri;
},on_complete:function(id,o,args){this.request_id="";
this.hide_progress_bar();
var r;
try{r=eval("("+o.responseText+")");
}catch(e){this.set_error(_("Server error (c) -- please try again."));
return;
}if(r===undefined){this.set_error(_("Server error (d) -- please try again."));
}else{if(r.result==="success"&&r.file_id!==undefined&&r.file_url!==undefined){this.conv.send_im(__("I sent you a file through imo: [URL]",{URL:r.file_url}));
if(this.parent.active_top_widget===IMO.REUI.ConversationPanel.SEND_FILE){this.parent.hide_top_widget();
}return;
}else{if(r.error!==undefined&&error_messages[r.error]!==undefined){this.set_error(error_messages[r.error]);
}else{this.set_error(_("Server error (e) -- please try again."));
}}}},on_failure:function(o){this.request_id="";
this.hide_progress_bar();
this.set_error(_("Server error (f) -- please try again."));
},handle_drag_drop_files:function(files){var file=files[0];
this.drag_drop_file=file;
var file_name=file.name.substring(0,50);
var file_info_text=U.sprintf("%s (%s)",file_name,friendly_size(file.size));
H.show(this.file_info_remove);
H.text(this.file_info,file_info_text);
},get_min_size:function(){return[360,200];
},hide_progress_bar:function(){H.hide(this.sending_status);
H.show(this.send_file_button);
},show_progress_bar:function(done,total){H.hide(this.send_file_button);
H.show(this.sending_status);
var percentage=done*100/total;
this.progress_bar.style.width=""+percentage+"%";
},progress:function(msg){if(this.request_id===msg.edata.request_id){this.show_progress_bar(msg.edata.done,msg.edata.total);
}},destroy:function(){IMO.EventDispatcher.get().unsubscribe(this,"filetransfer","filetransfer");
}});
}());
(function(){var b=IMO.Utils;
var h=IMO.Utils.HTML;
var i=IMO.Utils.TranslateDom;
var f=IMO.Utils.TranslateTxt;
var a=IMO.Constants;
var c=300;
var d=50;
var e="";
var g=null;
IMO.REUI.GetGroupInviteWidget=function(){if(g===null){g=new IMO.REUI.GroupInviteWidget();
}return g;
};
IMO.REUI.GroupInviteWidget=function(){this.build_dom();
this.win=new IMO.WM.Window();
this.win.set_content(this.dom);
this.win.size.min=[c,d];
this.on(this.win);
this.win.set_title(f("Invite People to [NAME]",{NAME:"group"}));
this.group=null;
this.search_result=[];
};
Y.mix(IMO.REUI.GroupInviteWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.GroupInviteWidget.prototype,{build_dom:function(){var j={cls:"textline_input",type:"text"};
this.input=new IMO.REUI.SuggestionWidget(j);
this.on(this.input);
this.dom=h.cdiv("group_invite_widget",h.form({cls:"search_form",onsubmit:function(k){k.preventDefault();
this.send_invite(k);
return false;
},context:this},h.cdiv("fields",this.input.input_dom,IMO.REUI.Button("blue",{onmousedown:this.send_invite,context:this},i("Invite")))),{onclick:this.focus_win,context:this});
},set_group:function(k,j){if(j===undefined){j=false;
}this.group=k;
this.is_skype_group=k.is_native||j;
this.win.set_title(f(k instanceof IMO.SharedGroup?"[NAME] - Invite":this.is_skype_group?"[NAME] - add to new Skype group":"[NAME] - add to new Imo group",{NAME:k.displaylias}));
if(this.group.type!==a.GROUP_TYPE.DISCUSSION){this.input.initial_value=f(e);
}else{this.input.initial_value="";
}this.input.set_value(this.input.initial_value);
},focus_win:function(){this.win.set_focus();
},show:function(){this.win.open();
this.win.set_focus();
},on_close_request:function(j){this.win.close();
},send_invite:function(){if(this.input.value()===""||this.input.value()==e){return;
}var k=null;
if(this.input.clicked_suggestion){k=this.input.clicked_suggestion[2];
}else{if(this.search_result.length>0){var l=this.input.current_suggestion;
var j=(l&&l>0)?l:0;
k=this.search_result[j][2];
this.search_result=[];
}}if(this.group instanceof IMO.SharedGroup){if(!k){if(b.verify_email(this.input.value())){this.group.invite_non_user(this.input.value(),"mail");
}}else{this.group.invite_buddy(k);
}this.input.set_value(this.input.initial_value);
return;
}if(k){this.group.add_to_conversation(k,this.is_skype_group);
}this.input.set_value(this.input.initial_value);
this.win.close();
},on_input_changed:function(k,j){if(k!==this.input){return;
}if(j){return;
}Y.later(0,this,function(){var o=this.input.value();
var n=IMO.BuddyList.get().search([o],true,true);
var l=this.is_skype_group;
var m=(this.group.type===a.GROUP_TYPE.DISCUSSION);
n=b.filter(n,function(p){return p&&!p.gid&&(!l||p.account.proto===this.group.proto)&&(!m||p.account.proto===a.PROTO_IMO);
},this);
n=b.map(n,function(p){return[p.get_full_display_text(),p.get_display_buid(),p];
},this);
this.search_result=n;
this.input.create_suggestion_hover(o,n);
});
},on_enter_key:function(k,j){if(k===this.input&&j){this.send_invite();
}}});
}());
(function(){var b=IMO.Utils.HTML;
var d=5*1000;
var c=20*1000;
var a=30*1000;
IMO.MNPResultTracker=function(e){this.panel=e;
this.results_in_view_since={};
this.results_to_send={};
this.results_sent={};
this.tracker_system="imo_aggregatelogger";
this.on(this.panel);
b.on("blur",this.on_panel_inactivity,document,this);
b.on("focus",this.on_panel_activity,document,this);
Y.later(c,this,this.send_results_seen,null,true);
};
Y.mix(IMO.MNPResultTracker.prototype,IMO.EventTarget);
Y.mix(IMO.MNPResultTracker.prototype,{update_results_in_view:function(){var f=(new Date).getTime();
var e=this.panel.find_visible_results();
for(var h in this.results_in_view_since){if(f-this.results_in_view_since[h]>d){this.add_interaction(h,"seen");
}if(!this.panel.is_in_view(h)){delete this.results_in_view_since[h];
}}for(var g=0;
g<e.length;
g++){if(!this.results_in_view_since[e[g]]){this.results_in_view_since[e[g]]=f;
}}},add_interaction:function(f,e,g){if(this.results_sent[f]&&e==="seen"&&!g){return;
}if(!this.results_to_send[f]){this.results_to_send[f]={};
}this.results_to_send[f][e]=1;
this.results_to_send[f]["seen"]=1;
},send_results_seen:function(){if(IMO.ActivityMonitor.get().has_activity(a)){this.update_results_in_view();
}else{this.results_in_view_since={};
}var e=[];
var g=new Date().getTime()/1000;
for(var f in this.results_to_send){e.push({rid:f,client_ts:g,interactions:this.results_to_send[f]});
delete this.results_to_send[f];
this.results_sent[f]=true;
}var h=IMO.Session.get().get_imo_account();
if(!h||e.length<1){return;
}h.send("report_interactions_client",{reports:e},this.tracker_system);
},on_panel_inactivity:function(){this.update_results_in_view();
this.results_in_view_since={};
},on_panel_activity:function(){this.update_results_in_view();
},on_interaction:function(f,e){this.add_interaction(f,e,true);
},on_results_changed:function(){if(IMO.ActivityMonitor.get().has_activity(a)){this.update_results_in_view();
}},on_results_cleared:function(){this.results_sent={};
this.on_results_changed();
}});
}());
(function(){var b=IMO.Utils;
var i=b.HTML;
var d=b.sprintf;
var j=b.TranslateDom;
var g=b.TranslateTxt;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.Platform){IMO.REUI.Platform={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var h=IMO.REUI.PIN.FORM;
function c(){return i.form(i.h3("To submit your app for approval, you must fill out the following (* required):"),i.table(i.tr(i.td({cls:"left"},i.label({"for":"appname"},"Application name*:")),i.td(i.input({type:"text",name:"appname",id:"appname",required:""}))),i.tr(i.td({cls:"left"},i.label({"for":"appdesc"},"Description*:")),i.td(i.textarea({rows:"5",cols:"50",name:"appdesc",id:"appdesc"}))),i.tr(i.td({cls:"left"},"Select a source license:"),i.td(i.div(i.input({type:"radio",name:"applicense",value:"none",id:"applicense-none"}),i.label({"for":"applicense-none"},"Allow others only to use your application")),i.div(i.input({type:"radio",name:"applicense",value:"bsd",id:"applicense-bsd"}),i.label({"for":"applicense-bsd"},"BSD (Redistribtion and use, with or without modification)")," ",i.a({target:"_blank",href:"http://www.opensource.org/licenses/bsd-license.php"},"(Read license)")),i.div(i.input({type:"radio",name:"applicense",value:"gpl2",id:"applicense-gpl2"}),i.label({"for":"applicense-gpl2"},"GNU Public License v2")," ",i.a({target:"_blank",href:"http://www.opensource.org/licenses/gpl-2.0.php"},"(Read license)")))),i.tr(i.td({colspan:"2"},i.h3("And you must acknowledge the following:"))),i.tr(i.td({cls:"left"},i.input({required:"",type:"checkbox",name:"appagree",id:"appagree"})),i.td(i.label({"for":"appagree"},"I have read and understood the ",i.a({href:"/developer-tos",target:"_blank"},"Developer Terms of Service")," and ",i.a({href:"/policies/privacy_policy.html",target:"_blank"},"Privacy Policy"),".*")))));
}function e(k,l){return function(){k.apply(l,arguments);
return false;
};
}function a(k){return function(l){if(l.keyCode===8||l.keyCode===46){k.apply(this,arguments);
l.stopPropagation();
}};
}function f(l,k){return function(m){if(m.keyCode===13){l.apply(this,arguments);
}else{if(m.keyCode==27){k.apply(this,arguments);
}}m.stopPropagation();
};
}IMO.REUI.Platform.ImoUploaderWidget=function(k){this.ev=new IMO.Event();
this.picture_id=null;
this.filedivs={};
this.current_dir=null;
var l=null;
this.upload_div=i.cdiv("action",this.form=i.form({enctype:"multipart/form-data"},i.cdiv("fileinput",l=i.button({cls:"fileoverlay",tabindex:-1},"Upload files or zip"),this.input=i.input({cls:"file",type:"file",min:"1",max:"100",multiple:"",name:"file",context:this,onfocus:function(m){l.style.borderColor="black";
},onblur:function(m){l.style.borderColor="";
},onmousedown:function(m){l.style.borderStyle="inset";
},onmouseup:function(m){l.style.borderStyle="";
},onmouseout:function(m){l.style.borderStyle="";
},onchange:function(){l.style.borderStyle="";
Y.later(0,this,this.upload);
}}))));
this.dirlist_container=i.cdiv("apps-dirlist-outer",this.dirlist=i.cdiv("apps-dirlist",{onkeydown:a(this.handle_delete_dir),context:this}));
this.filelist_container=i.cdiv("apps-filelist-outer",this.filelist=i.cdiv("apps-filelist",{onkeydown:a(this.handle_delete_file),context:this}));
this.create_dir_div=i.cdiv("upload");
this.error_div=i.div();
this.current_dir="";
this.current_file=null;
this.renaming_file=false;
this.renaming_dir=false;
this.current_dir_div=i.div();
this.submission_form_container=i.div({style:{position:"relative"}});
this.actions_div=i.cdiv("apps-file-actions",this.delete_btn=i.button({cls:"action",context:this,onclick:this.handle_delete_file},i.div(i.sprite("icn_redcheck",{style:{marginRight:"3px"}}),j("Delete"))),this.preview_btn=i.button({cls:"action",context:this,onclick:this.preview_tab},i.div(i.sprite("icn_search_12",{style:{marginRight:"3px"}}),j("Preview"))),this.preview_multiple_btn=i.button({cls:"action",context:this,onclick:this.preview_multiple},i.div(i.sprite("icn_windowview",{style:{marginRight:"3px"}}),j("Run in split screen"))),this.submit_btn=i.button({cls:"action",context:this,onclick:this.open_submission_form},i.div(j("Submit for approval"))),this.upload_div);
i.replace_content(this.create_dir_div,this.mkdir_input=i.input({cls:"createfolder",onfocus:this.focus_create_dir_cb,onblur:this.blur_create_dir_cb,onkeydown:f(this.handle_mkdir,this.abort_renaming),context:this}));
};
Y.mix(IMO.REUI.Platform.ImoUploaderWidget.prototype,{init:function(l){function k(m){if(m.error){if(m.error=="not authenticated"||m.error=="no imo account"){l(null);
}else{this.show_error(m.error);
}}else{this.uid=m.result.uid;
this.root_url=m.result.root_url;
if(!m.show_license_agreement){this.refresh();
}l(m.result);
}}this.appsrpc("web_get_user_info",{},k,this);
},accept_license_cb:function(k){this.refresh();
},accept_license:function(k){this.appsrpc("accept_license_agreement",{uid:this.uid,agreed_version:k},this.accept_license_cb,this);
},appsrpc:function(n,m,k,l){if(IMO.Network.get()){IMO.Network.get().send("appsmanager",n,m,undefined,k,l);
}else{IMO.HTTPRPC.call("appsmanager",n,m,k,l);
}},open:function(){},refresh:function(){this.appsrpc("web_list_files",{uid:this.uid},this.list_files_cb,this);
},get_elements:function(){return{create_dir:this.create_dir_div,actions:this.actions_div,filelist:this.filelist_container,current_dir:this.current_dir_div,submission_form:this.submission_form_container};
},handle_mkdir:function(){var k=this.current_dir;
if(this.current_dir){this.current_dir+="/";
}this.current_dir+=this.mkdir_input.value;
this.appsrpc("web_mkdir",{uid:this.uid,dirname:this.current_dir},function(l){if(l.error){this.current_dir=k;
}this.action_cb(l);
},this);
},show_error:function(k){new IMO.REUI.ConfirmModalPopup(g("Error"),k,[[j("OK"),"blue"]],function(){},this);
},handle_delete_dir:function(p,r){var o=0;
var n=[];
var k=r;
for(var l in this.dirs){if(l.indexOf(k)===0){var q=this.dirs[l];
for(var m=0;
m<q.length;
m++){n.push(l+"/"+q[m].file);
o++;
}n.push(l);
}}new IMO.REUI.ConfirmModalPopup(g("Delete?"),g("Are you sure you want to permanently delete [FILE] and [NUMBER] files and folders within?",{FILE:"\n            /"+k+"\n",NUMBER:o}),[[j("Yes"),"blue"],[j("No"),"grey"]],function(s){if(s===0){n.push(k);
this.on_select_file(null);
this.appsrpc("web_delete_file",{uid:this.uid,filenames:n},this.action_cb,this);
}},this);
},handle_delete_file:function(m,k){if(k){this.current_file=k;
}if(!this.current_file){return;
}var l=this.current_dir+"/"+this.current_file;
new IMO.REUI.ConfirmModalPopup(g("Delete?"),g("Are you sure you want to permanently delete [FILE]?",{FILE:l}),[[j("Yes"),"blue"],[j("No"),"grey"]],function(n){if(n===0){this.on_select_file(null);
this.appsrpc("web_delete_file",{uid:this.uid,filenames:[l]},this.action_cb,this);
}},this);
},abort_renaming:function(){if(this.renaming_file){var k=this.filedivs[this.renaming_file];
this.renaming_file=false;
i.show(k.firstChild.firstChild.nextSibling);
i.hide(k.firstChild.firstChild);
this.filelist.focus();
}},handle_rename_file:function(){if(!this.renaming_file){return;
}var n=this.current_dir+"/"+this.renaming_file;
var k=this.filedivs[this.renaming_file];
var m=k.firstChild.firstChild.value;
var l=this.current_dir+"/"+m;
this.renaming_file=false;
i.show(k.firstChild.firstChild.nextSibling);
i.hide(k.firstChild.firstChild);
if(n!=l){this.on_select_file(null);
this.current_file=m;
if(n.charAt(n.length-1)=="/"){this.current_file=m+"/";
}this.appsrpc("web_rename_file",{uid:this.uid,filename:n,filenameTo:l},this.action_cb,this);
}this.filelist.focus();
},start_renaming_file:function(m,n){if(!this.current_file||n!=this.current_file){this.current_file=n;
this.on_select_file(n);
}if(this.renaming_file){this.abort_renaming();
}var k=this.filedivs[this.current_file];
if(!k){return;
}this.renaming_file=this.current_file;
var l=this.renaming_file;
if(l.charAt(l.length-1)=="/"){l=l.substr(0,l.length-1);
}k.firstChild.firstChild.value=l;
i.show(k.firstChild.firstChild);
i.hide(k.firstChild.firstChild.nextSibling);
k.firstChild.firstChild.focus();
},handle_file_onclick:function(k,l){this.on_select_file(l);
},handle_file_mousedown:function(k,l){k.preventDefault();
},handle_file_open:function(l,m){Y.log(["Opening dir!",m]);
if(m.charAt(m.length-1)=="/"){m=m.substr(0,m.length-1);
}if(m==".."){var k=this.current_dir.lastIndexOf("/");
if(k==-1){m="";
}else{m=this.current_dir.substr(0,k);
}}else{if(this.current_dir){m=this.current_dir+"/"+m;
}}Y.log(["Really opening dir!",m]);
this.current_dir=m;
this.on_open_dir();
},on_select_file:function(k){if(k===this.current_file&&k===this.renaming_file){return;
}if(this.current_file!==null&&this.filedivs[this.current_file]){var o=this.filedivs[this.current_file];
i.remove_class(o,"selected");
this.abort_renaming();
}this.current_file=k;
if(!k){return;
}this.start_renaming_file(null,k);
this.abort_renaming();
i.add_class(this.filedivs[this.current_file],"selected");
var n=null;
var m=this.dirs[this.current_dir];
for(var l=0;
l<m.length;
l++){if(m[l].file==k){n=m[l];
}}var p=(k.charAt(k.length-1)=="/");
var q=(k.indexOf(".htm")!=-1);
this.delete_btn.disabled=(k=="../");
this.preview_btn.disabled=p;
this.preview_multiple_btn.disabled=!q;
this.submit_btn.disabled=!q;
this.blur_create_dir_cb();
},_two_digits:function(k){return((k<10)?"0":"")+k;
},on_open_dir:function(){var p=this.current_dir;
i.replace_content(this.current_dir_div,i("Current URL: "+this.root_url+this.current_dir));
i.empty(this.filelist);
this.blur_create_dir_cb();
var q=this.dirs[p];
var x=0;
if(p){x=-1;
}for(;
x<q.length;
x++){var v=q[x];
if(x==-1){v={file:"../"};
}var r="result";
if((x%2)===0){r+=" even";
}else{r+=" odd";
}var m=(v.size+1023)>>10;
var A=m+"K";
if(m>=1000){A=(Math.ceil(m/102.4)/10)+"M";
}var B=v.timestamp;
var n="";
if(B){var s=new Date(B);
n=s.getFullYear()+"-"+this._two_digits(s.getMonth()+1)+"-"+this._two_digits(s.getDate())+" "+this._two_digits(s.getHours())+":"+this._two_digits(s.getMinutes())+":"+this._two_digits(s.getSeconds());
}var o="file";
var z=v.file;
if(z.charAt(z.length-1)=="/"){o="dir";
z=z.substr(0,z.length-1);
}var u;
var t=[];
if(o=="dir"){A="<DIR>";
}var l={context:this};
var k={};
if(v.file=="../"){z="Up one level";
}l.onclick={func:this.handle_file_onclick,args:v.file};
l.onmousedown={func:this.handle_file_mousedown,args:v.file};
if(o=="dir"){l.ondblclick={func:this.handle_file_open,args:v.file};
z="["+z+"]";
}else{l.ondblclick={func:this.preview_tab,args:v.file};
}var y=" ";
if(v.file!="../"){y=i.sprite("icn_edit",{context:this,onclick:{func:this.start_renaming_file,args:v.file},style:{cursor:"pointer",marginRight:"5px"}});
}this.filelist.appendChild(u=i.cdiv(r,l,i.cspan("filename",i.input({value:v.file,onkeydown:f(this.handle_rename_file,this.abort_renaming),onblur:this.handle_rename_file,context:this}),i.div(y,z)),i.cspan("modified",n),i.cspan("size",A)));
for(var w=0;
w<t.length;
w++){u.appendChild(t[w]);
}this.filedivs[v.file]=u;
i.hide(u.firstChild.firstChild);
}this.filelist.appendChild(i.cdiv("result"));
if(this.current_file){this.on_select_file(this.current_file);
}else{this.delete_btn.disabled=true;
this.preview_btn.disabled=true;
this.preview_multiple_btn.disabled=true;
this.submit_btn.disabled=true;
}},focus_create_dir_cb:function(){this.mkdir_input.value="";
this.mkdir_input.style.color="black";
},blur_create_dir_cb:function(){this.mkdir_input.value="";
this.mkdir_input.style.color="grey";
if(this.current_dir){this.mkdir_input.value=g("Create folder in [FOLDER]",{FOLDER:this.current_dir});
}else{this.mkdir_input.value="Create a new application";
}this.mkdir_input.style.display="inline-block";
},list_files_cb:function(k){i.empty(this.dirlist);
if(k.result&&k.result.dirs){this.dirs=k.result.dirs;
var n;
for(n in k.result.dirs){if(n){var l=n.lastIndexOf("/");
var m="";
var o=n+"/";
if(l!=-1){m=n.substr(0,l);
o=n.substr(l+1)+"/";
}k.result.dirs[m].unshift({file:o});
}}this.blur_create_dir_cb();
if(!(this.current_dir in k.result.dirs)){this.current_dir="";
this.current_file=null;
}this.on_open_dir();
}},action_cb:function(k){if(k.error){this.show_error(k.error);
}else{i.empty(this.error_div);
this.list_files_cb(k);
}},upload_cb:function(k){Y.log(["Received ",k]);
this.form.reset();
if(k.error){this.show_error(k.error);
this.refresh();
}else{if(k.result){i.empty(this.error_div);
this.current_dir=k.result.dirname;
this.current_file=k.result.filename;
this.list_files_cb(k);
}}},upload:function(){this.on_select_file(null);
IMO.HTTPRPC.upload("appsmanager","webup_upload_file",{uid:this.uid,dirname:this.current_dir},this.form,this.upload_cb,this);
},make_bare_url:function(k){return this.root_url+k;
},make_url:function(m){var k=this.root_url+m;
var l=((Math.random()*(1<<32))^new Date().getTime());
return k+"?ch_id=p"+l;
},preview_multiple:function(s,k){if(k){this.on_select_file(k);
}var m=this.current_dir+"/"+this.current_file;
var r=this.make_url(m);
var l=(screen.width-100)>>1;
var t=30+(window.innerHeight||document.body.offsetHeight||screen.height);
if(t>screen.height-20){t=screen.height-20;
}var n=l+20;
var q;
var p=window.open("about:blank","preview1","location=yes,resizable=yes,scrollbars=yes,status=yes,width="+l+",height="+t+",left="+n+",top=0");
var o=window.open("about:blank","preview2","location=yes,resizable=yes,scrollbars=yes,status=yes,width="+l+",height="+t+",left=0,top=0");
Y.later(0,this,function(){try{p.moveTo(n+1,0);
}catch(u){Y.log(["Exception in preview",u]);
}Y.later(0,this,function(){p.location=r;
o.location=r;
});
});
},preview_tab:function(m,k){if(k){this.on_select_file(k);
}var n=this.current_dir+"/"+this.current_file;
var l=this.make_url(n);
window.open(l,"_blank");
},open_submission_form:function(l,k){if(k){this.on_select_file(k);
}this.submission_path=this.current_dir+"/"+this.current_file;
if(this.submission_popup){this.submission_popup.close();
}this.submission_popup=new IMO.REUI.Platform.ImoSubmissionWidget(this);
this.submission_popup.open();
this.submission_form_container.appendChild(this.submission_popup.dom);
}});
IMO.REUI.Platform.ImoSubmissionWidget=function(k){this.owner=k;
this.uid=k.uid;
this.inited=false;
this.dom=this.default_dom;
};
Y.mix(IMO.REUI.Platform.ImoSubmissionWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.Platform.ImoSubmissionWidget.prototype,{close:function(){if(this.inited){this.dom.parentNode.removeChild(this.dom);
}this.inited=false;
},open:function(){this.default_dom=i.div({id:"submit-app"},this.title_div=i.div(),this.form_div=i.div(),this.error_div=i.div());
i.replace_content(this.error_div,i.span());
this.inited=true;
i.replace_content(this.title_div,i.h2(j("Submitting application:"),i.br(),i.a({href:this.owner.make_url(this.owner.submission_path),target:"_blank"},this.owner.make_bare_url(this.owner.submission_path))));
i.replace_content(this.form_div,this.form=c());
this.form.onsubmit=e(this.submit,this);
this.form.reset();
this.header_dom=i.cdiv("pin_form_header",i.cspan("text",j("Submission")));
this.apps_footer_widget=new h.FooterWidget("Submit","Cancel",null,this,this.submit,this.close);
this.footer_dom=i.div(this.apps_footer_widget.dom);
this.body_dom=i.cdiv("apps_inner",this.default_dom);
var k=i.div(this.header_dom,this.body_dom,this.footer_dom);
this.dom=i.cdiv("apps_form_border",i.cdiv("pin_form_border_inner",k));
},show_error:function(k){new IMO.REUI.ConfirmModalPopup(g("Error"),k,[[j("OK"),"blue"]],function(){},this);
},submit_cb:function(k){if(k.error){this.show_error(k.error);
}else{this.show_error(g("We will review your submission and notify you if we approve your application."));
this.owner.submission_popup.hide();
}},submit:function(){var n=this.form;
var k=n.appname.value;
var p=n.appdesc.value;
var o="none";
var m=n.applicense;
for(var l=0;
l<m.length;
l++){if(m[l].checked){o=m[l].value;
}}var q=n.appagree.checked;
if(!k||!p){this.show_error(g("Your application needs a name and description."));
return;
}if(!q){this.show_error(g("Agree to the terms of service or choose cancel."));
return;
}this.show_error("loading...");
this.appsrpc("web_submit_app",{uid:this.uid,data:{name:k,desc:p,license:o,path:this.owner.submission_path}},this.submit_cb,this);
}},true);
}());
(function(){var a=IMO.Utils;
var b=IMO.Utils.HTML;
var c=0;
var d=1;
IMO.REUI.iCarousel=function(g,e,f,h){this.name=g;
this.conf=f;
this.render_func=h;
this.init(e);
};
Y.mix(IMO.REUI.iCarousel.prototype,{init:function(e){this.ev=new IMO.Event();
this.dom=null;
this.current_index=-1;
this.dom_items=[];
this.dom_start=-1;
this.dom_end=-1;
this.visible_start=-1;
this.visible_end=-1;
this.browser_dom_items_to_remove=[];
this.browser_dom_items_to_prepend=[];
this.browser_dom_items_to_append=[];
this.conf.max_display_num=a.dfl(this.conf.max_display_num,0);
this.set_items(e);
this.build_dom();
},build_dom:function(){this.dom=b.cdiv("carousel "+this.name,this.wdom=b.cdiv("wrapper",this.idom=b.cdiv("items")));
},get_item_size:function(){var f=null;
for(var e=0;
e<this.items.length;
e++){if(this.items[e]){f=this.items[e];
break;
}}var g=this.render_func(f,this.dom);
return b.measure(g,this.idom,true);
},get_buffer_size:function(){return this.get_num_to_display();
},get_num_to_display:function(){var g=this.get_item_size();
var f=b.get_size(this.dom)[c];
var h=Math.floor(f/g[c]);
var e=this.conf.max_display_num;
if(e!==0){h=a.cap(h,1,e);
}return h;
},add_dom_items:function(j,e,f){if(j>this.dom_items.length-1||e<0){return;
}j=a.cap(j,0,this.dom_items.length-1);
e=a.cap(e,0,this.dom_items.length-1);
for(var g=j;
g<=e;
g++){var h=this.render_func(this.items[g],this.dom,this,g);
this.dom_items[g]=h;
if(f){this.browser_dom_items_to_prepend.push(h);
}else{this.browser_dom_items_to_append.push(h);
}}},remove_dom_items:function(h,e){if(h>this.dom_items.length-1||e<0){return;
}h=a.cap(h,0,this.dom_items.length-1);
e=a.cap(e,0,this.dom_items.length-1);
for(var f=h;
f<=e;
f++){var g=this.dom_items[f];
if(g){this.dom_items[f]=null;
this.browser_dom_items_to_remove.push(g);
}}},update_indices:function(k){var m=this.get_buffer_size();
var h=this.get_num_to_display();
var p=false;
if(this.visible_start!==-1&&this.visible_end!==-1){this.visible_start=a.cap(this.dom_start+m,0,this.dom_items.length-1);
this.visible_end=a.cap(this.dom_end-m,0,this.dom_items.length-1);
}var o,e,g,n,l,f;
if(k<this.dom_start||k>this.dom_end){o=this.dom_start;
e=this.dom_end;
g=k-m;
n=g+(2*m)+h-1;
l=g;
f=n;
}else{if(k>=this.dom_start&&k<this.visible_start){o=this.dom_end-m+1;
e=this.dom_end;
g=this.dom_start-m;
n=this.dom_end-m;
l=g;
f=g+m-1;
p=true;
}else{if(k<=this.dom_end&&k>this.visible_end){o=this.dom_start;
e=this.dom_start+m-1;
g=this.dom_start+m;
n=this.dom_end+m;
l=n-m+1;
f=n;
}}}if(o!==undefined){this.remove_dom_items(o,e);
this.dom_start=g;
this.dom_end=n;
this.add_dom_items(l,f,p);
}this.visible_start=a.cap(this.dom_start+m,0,this.dom_items.length-1);
this.visible_end=a.cap(this.dom_end-m,0,this.dom_items.length-1);
Y.log(["exit",this.name,"index: ",k,"visible_start: ",this.visible_start,"visible_end: ",this.visible_end,"this.dom_start: ",this.dom_start,"this.dom_end: ",this.dom_end,"buffer_size: ",m,"num_to_display: ",h,"dom_items: ",this.dom_items.length,"items: ",this.items.length]);
for(var j=0;
j<this.dom_items.length;
j++){Y.log(["item ",j,this.dom_items[j]]);
}},update_ui:function(j,e){var h=this.get_num_to_display();
if(j>=0){b.remove_class(this.dom_items[j],"selected");
}b.add_class(this.dom_items[e],"selected");
a.foreach(this.browser_dom_items_to_remove,function(k){b.destroy(k);
b.remove(k);
},this);
this.browser_dom_items_to_remove=[];
a.foreach(this.browser_dom_items_to_append,function(k){this.idom.appendChild(k);
},this);
this.browser_dom_items_to_append=[];
a.foreach(this.browser_dom_items_to_prepend,function(k){this.idom.insertBefore(k,this.idom.firstChild);
},this);
this.browser_dom_items_to_prepend=[];
var g=this.get_item_size();
b.css(this.wdom,{width:h*g[c],height:g[d]});
var i=this.dom_end-this.dom_start+1;
b.css(this.idom,{width:i*g[c],height:g[d]});
var f=0;
if(e>=h){f=-g[c]*this.get_buffer_size();
}b.css(this.idom,{marginLeft:f});
},navigate_to:function(e){if(this.items.length===0){return;
}e=a.cap(e,0,this.items.length-1);
var f=this.current_index;
this.current_index=e;
this.update_indices(this.current_index);
this.update_ui(f,this.current_index);
this.ev.fire("on_item_selected",this.name,this.current_index,this.dom_items[this.current_index]);
},set_items:function(e){if(this.items){this.remove_dom_items(0,this.dom_items.length-1);
b.empty(this.idom);
this.dom_start=-1;
this.dom_end=-1;
this.visible_start=-1;
this.visible_end=-1;
this.current_index=-1;
}this.items=e;
this.dom_items=[];
this.dom_items.length=this.items.length;
},select_item:function(e){Y.log("carousel select item "+this.name);
this.navigate_to(e);
},delete_item:function(e){Y.log("carousel delete item "+this.name);
},next_item:function(){Y.log("carousel next item "+this.name);
this.navigate_to(this.current_index+1);
},prev_item:function(){Y.log("carousel prev item: "+this.name);
this.navigate_to(this.current_index-1);
},refresh_ui:function(){b.empty(this.idom);
this.dom_start=-1;
this.dom_end=-1;
this.visible_start=-1;
this.visible_end=-1;
this.select_item(this.current_index);
},resize:function(){this.refresh_ui();
}});
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var d=function(g,f,i,m){var k=null;
var n=f.offsetWidth;
var l=f.offsetHeight;
var o="/o/"+g;
var e=a.sprintf(o+"[W]x[H]",{W:n,H:l});
var j=c.cdiv("mnp-photo-viewer-photo",k=c.img({src:e,cls:"",onclick:function(){window.open(o);
},context:i}));
c.css(j,{width:f.offsetWidth,height:f.offsetHeight});
return j;
};
IMO.REUI.PIN.PHOTO_VIEWER=function(){this.init();
};
Y.mix(IMO.REUI.PIN.PHOTO_VIEWER.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.PHOTO_VIEWER.prototype,{init:function(){this.photo_ids=[];
this.dom=null;
this.build_dom();
},build_dom:function(){var e={max_display_num:1};
this.carousel=new IMO.REUI.iCarousel("mnp-photo-viewer-body",[],e,d);
this.dom=c.cdiv("mnp-photo-viewer",c.cdiv("mnp-photo-viewer-header",c.cdiv("mnp-photo-viewer-nav",this.prev=c.cdiv("mnp-photo-viewer-nav-prev",c.span(b("prev"),{onclick:this.prev_photo,context:this})),this.next=c.cdiv("mnp-photo-viewer-nav-next",c.span(b("next"),{onclick:this.next_photo,context:this}))),c.cdiv("mnp-photo-viewer-close",b("close"),{onclick:this.hide,context:this})),this.carousel.dom);
c.dom("imo").appendChild(this.dom);
this.on(this.carousel);
},attach_event_listeners:function(){this.window_resize_event_id=c.on("resize",this.on_window_resize,window,this);
this.key_event_id=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},"left arrow":{cb:this.prev_photo},"right arrow":{cb:this.next_photo}},bottom:true,context:this});
},remove_event_listeners:function(){this.window_resize_event_id.detach();
delete this.window_resize_event_id;
IMO.KeyboardManager.get().pop(this.key_event_id);
delete this.key_event_id;
},next_photo:function(){this.carousel.next_item();
},prev_photo:function(){this.carousel.prev_item();
},on_window_resize:function(){if(this.window_resize_obj){this.window_resize_obj.cancel();
}this.window_resize_obj=Y.later(10,this,function(){this.window_resize_obj=null;
this.carousel.resize();
});
},on_item_selected:function(g,f,h){var e="mnp-photo-viewer-nav-disabled";
c.remove_class(this.prev,e);
c.remove_class(this.next,e);
if(f===0){c.add_class(this.prev,e);
}if(f===this.photo_ids.length-1){c.add_class(this.next,e);
}},show:function(f,e){this.photo_ids=f;
this.attach_event_listeners();
this.carousel.set_items(this.photo_ids);
c.show(this.dom);
this.carousel.refresh_ui();
this.carousel.select_item(e);
},hide:function(){this.remove_event_listeners();
c.hide(this.dom);
}});
}());
(function(){var c=IMO.Utils;
var j=IMO.Utils.HTML;
var t=IMO.Utils.TranslateDom;
var f=IMO.Utils.TranslateTxt;
var m=IMO.Constants;
var l=IMO.AggregateLogger;
var q="people and broadcasts";
var h=function(v,u){v.value=f(u);
};
var o="broadcast what's on your mind";
var a=function(v,u){Y.log([v,u]);
j.replace_content(v,j(f(u)));
};
if(!IMO.REUI.APP){IMO.REUI.APP={};
}var s=1;
var e=60000;
var i=10000;
var g=function(){this.ev=new IMO.Event();
IMO.REUI.GamesPanel.call(this,"broadcast");
};
Y.mix(g.prototype,IMO.REUI.GamesPanel.prototype);
Y.mix(g.prototype,{play:function(v,u){this.ev.fire("on_selected_app",u);
}});
var p=function(u){this.parent=u;
this.games_panel=new g();
this.visible=false;
this.options_container=j.cspan("dropdown",this.options=j.cdiv("options-container",j.cdiv("options shadow",this.games_panel.dom)));
j.hide(this.options);
};
Y.mix(p.prototype,{open:function(u){this.parent.appendChild(this.options_container);
j.show(this.options);
this.visible=true;
},close:function(){if(this.visible){this.parent.removeChild(this.options_container);
j.hide(this.options);
this.visible=false;
}},toggle:function(u){if(this.visible){this.close();
}else{this.open(u);
}},destroy:function(){this.close();
}});
function r(v,u){Y.log(["Creating result",v,u]);
this.id=v;
this.data=c.dfl(u,{});
this.rtype=u.rtype;
this.ev=new IMO.Event();
}Y.mix(r.prototype,IMO.EventTarget);
Y.mix(r.prototype,{build_dom:function(){},prepare:function(){},destroy:function(){}});
function k(v,u){Y.log(["Creating result",v,u]);
k.superclass.constructor.apply(this,arguments);
this.promo=u.promo;
this.html=this.promo.html;
this.build_dom();
}Y.extend(k,r);
Y.mix(k.prototype,{build_dom:function(){this.dom=j.cdiv("mnp-result",{id:"mnp-result#"+this.id});
this.dom.innerHTML=this.html;
},destroy:function(){}},true);
function d(v,u){d.superclass.constructor.apply(this,arguments);
this.user=u.user;
this.broadcast=u.broadcast;
this.extract_app_link();
if(this.is_broadcast()){this.update_internal_state_from_broadcast(u.broadcast);
}this.relevance_info={};
Y.mix(this.relevance_info,u.relevance_info);
Y.mix(this.relevance_info,u.user_relevance_info);
this.build_dom();
}Y.extend(d,r);
var b={facebook:{"short":"fb"},twitter:{"short":"tw"},linkedin:{"short":"in"}};
c.foreach(b,function(w,u){w.pref="broadcast_"+u;
w.kind="impref";
w.queued_bid=null;
w.value=false;
w.btn=null;
w.authorizing=false;
w.btn_name_on="sprite_btn_"+w["short"]+"_on";
w.btn_name_off="sprite_btn_"+w["short"]+"_off";
});
Y.mix(d.prototype,{update_internal_state_from_broadcast:function(v){this._recent_messages=[];
for(var u=0;
u<v.messages.length;
++u){this._recent_messages.push({alias:v.messages[u][2]+": ",message:v.messages[u][1]});
}this._num_discussing=v.users.length;
this._top_tag=v.top_tag;
},extract_app_link:function(){if(!this.is_broadcast()){return;
}var u=this.data.broadcast.text;
var w=u.indexOf("\nhttps://apps.imoapi.com");
if(w!=-1){var v=u.indexOf(" ",w);
if(v==-1){this.data.app={link:u.substr(w+1)};
if(this.data.app.link.indexOf("https://apps.imoapi.com/imo.im/suduoku")!=-1){this.data.app.type="suduoku";
}if(this.data.app.link.indexOf("https://apps.imoapi.com/imo.im/whiteboard")!=-1){this.data.app.type="whiteboard";
}this.data.broadcast.text=u.substr(0,w);
this.data.rtype="app";
}}},format_rel_info:function(w){var v="";
for(var u in w){if(w.hasOwnProperty(u)){v+=u+" "+w[u].toFixed(3)+"; ";
}}return v;
},delete_broadcast:function(){var u=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
Y.log(["broadcast to delete",this.data.broadcast]);
u.send("delete_broadcast",{bid:this.data.broadcast.id},"imo_broadcasts",function(){},this);
},populate_menu:function(){var u=IMO.Session.get().get_imo_account();
if(this.is_broadcast()||this.is_app()){if(u&&this.user.uid===u.uid){this.edit_menu.add_option(t("Delete"),function(){this.delete_broadcast();
},this);
}}if(u&&this.user.uid!==u.uid){this.edit_menu.add_option(t("Report"),function(){this.spam_widget=new IMO.REUI.SpamReportWidget(this.user.uid,this.get_name(),null,((this.is_broadcast())?this.broadcast.id:null));
},this);
}if(this.edit_menu.options.childNodes.length===0){j.chide(this.edit_menu.dom);
}},build_dom:function(){var u=IMO.U.query.hasOwnProperty("relinfo")&&(this.relevance_info!==undefined);
var w=u?j.cdiv("mnp-rel-info",this.format_rel_info(this.relevance_info)):j.div();
this.edit_menu=new IMO.UIWidgets.Menu({context:this},j.sprite("icn_new_arrow"));
this.populate_menu();
var v=null;
if(this.is_broadcast()){v=this.discuss;
}else{v=this.start_chat;
}this.premium_badge=null;
if(this.is_premium()){this.premium_badge=j.sprite("premium_account",{title:"Premium Account",context:this,onclick:function(x){x.stopPropagation();
IMO.REUI.PremiumAccount.show();
}});
}this.dom=j.cdiv("mnp-result",{id:"mnp-result#"+this.data.rid},j.cdiv("mnp-result-header",{id:"mnp-result-header#"+this.data.rid,onclick:v,context:this},j.cdiv("mnp-result-avatar-container",j.img({cls:"mnp-result-avatar",src:this.get_avatar()})),j.cdiv("mnp-result-name-location",this.premium_cdiv=j.cdiv("broadcast-result-premium-badge",this.premium_badge),this.name_div=j.cdiv("mnp-result-name",this.get_name()),IMO.REUI.APP.MeetUtils.question_mark(document.querySelector("input#mnp-panel-search"),this.id.split(".")[1],this.id.split(".")[0],"mnp"),j.cdiv("clear"),j.cdiv("mnp-result-location",IMO.REUI.APP.MeetUtils.shorten_location(this.user.location)))),j.cdiv("clear"),this._specific_dom=j.div(this.build_type_specific_dom()),w);
},start_chat:function(u){IMO.MouseManager.get().handled(u,"app-meet-new-people-chat");
IMO.REUI.APP.MeetUtils.start_chat(this.user.uid,this.user.display_name,this.user.profile_photo_id);
IMO.REUI.MNP_PANEL.result_interacted(this.id,"start_chat");
},update_types_specific_dom:function(){j.replace_content(this._specific_dom,this.build_type_specific_dom());
if(!j.has_class(this.tags_div_container,"hidden")){var v=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
var u=(IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im"?"imo_broadcasts":"imo_directory");
v.send("get_broadcast_tags",{bid:this.data.broadcast.id},u,this._broadcast_tags_arrived,this);
}this.prepare();
},prepare:function(){if(this.broadcast_text_dom){Y.DOM.setAttribute(this.broadcast_text_dom,"data-max-lines","4");
var u=this;
j.ellipsis(this.broadcast_text_dom,true,function(w,v){v.stopImmediatePropagation();
u.broadcast_link_clicked(w);
},"\u2026 more");
}},build_type_specific_dom:function(){var u;
if(this.is_broadcast()||this.is_app()){this.broadcast_timestamp=this.data.broadcast.timestamp*1000;
if(this.broadcast_timestamp){this.timestamp_timer=Y.later(0,this,this.update_timestamp);
}}if(this.is_broadcast()){return this.build_broadcast_dom();
}else{if(this.is_app()){return this.build_app_dom();
}else{if(this.user.best_matches instanceof Array&&this.user.best_matches.length>0){return j.cdiv("mnp-result-details",this.get_interests_dom());
}else{return j.cdiv("mnp-result-details");
}}}},build_photo_previews:function(){var w="";
var u="";
var v=this.data.broadcast.photos;
if(!v||v.length===0){return w;
}w=j.cdiv("mnp-result-broadcast-photos-container",u=j.cdiv("mnp-result-broadcast-photos"));
c.foreach(v.slice(0,3),function(A,y){var x="/o/"+A+"100x100";
var z=j.cdiv("mnp-result-broadcast-photo",j.img({src:x,onclick:function(B){B.preventDefault();
B.stopPropagation();
this.ev.fire("on_photo_preview_click",v,y);
},context:this}));
u.appendChild(z);
},this);
return w;
},build_video_dom:function(){var x=null;
var u=this.data.broadcast.video_preview;
if(!u){return x;
}var w=u.video_embed_url;
if(!w){return x;
}w=w.replace("http://","https://");
var v="?";
if(w.indexOf("?")!=-1){v="&";
}return j.cdiv("mnp-result-broadcast-video-container",j.iframe("mnp-result-video-iframe",{width:270,src:w+v+"wmode=transparent",frameborder:0}));
},build_broadcast_dom:function(){var y=null;
var u=this.data.broadcast.text;
this.broadcast_text_dom=j.cspan("mnp-result-broadcast-text",u);
this.preview_dom=this.build_photo_previews();
if(!this.preview_dom){this.preview_dom=this.build_video_dom();
}var w=j.cdiv("mnp-result-last-msgs");
for(var v=0;
v<this._recent_messages.length;
++v){w.appendChild(j.cdiv("mnp-result-last-msg",j.sprite("icn_reply"),j.cspan("mnp-result-last-msg-alias",this._recent_messages[v]["alias"]),this._recent_messages[v]["message"]));
}var x=this._top_tag[1]?this._top_tag[0]:"Tag it";
y=j.cdiv("mnp-result-details",j.cdiv("mnp-result-broadcast",{onclick:this.discuss,context:this},this.broadcast_text_dom,this.preview_dom),j.cdiv("mnp-result-discuss-container",j.a({cls:"mnp-result-discuss"},"Discuss",{onclick:this.discuss,context:this}),this.people_cnt=j.cspan("mnp-result-people",j(c.sprintf("(%s)",this._num_discussing||0))),this.top_tag=j.a({cls:"tag-name"},j.cspan("tag-text",x),j.cspan("tag-cnt",String(this._top_tag[1]||"")),{onclick:this.rate_broadcast_clicked,context:this},this.rate_arrow=this.rate_arrow?this.rate_arrow:j.sprite("arrow_up rate-arrow-up hidden")),this.edit_menu.dom,this.mnp_broadcast_timestamp_span=j.cspan("mnp-result-broadcast-timestamp"),j.cdiv("clear"),this.tags_div_container=this.tags_div_container?this.tags_div_container:j.cdiv("tags-div-container hidden",this.tags_div=j.cdiv("tags-div"),j.cdiv("line"),this.add_tag_text=j.cspan("add-tag-text","+ "+f("Add your own (1CP)"),{onclick:function(z){z.halt();
j.chide(this.add_tag_text);
j.cshow(this.add_tag_input);
j.focus(this.add_tag_input);
},context:this}),this.add_tag_input=this.add_tag_input?this.add_tag_input:j.input({id:"add-tag",type:"text",cls:"add-tag-input blurred inner-shadow hidden",onkeyup:this.add_tag_input_changed,onclick:function(z){z.halt();
},context:this}))),w);
if(this._num_discussing<2){j.chide(this.people_cnt);
}return y;
},build_app_dom:function(){var x=null;
var v=this.data.broadcast.text;
this.broadcast_text_dom=j.cspan("mnp-result-broadcast-text",v);
var w=IMO.Games.get().get_game_info(this.data.app.type);
var u;
if(!w){w={img:"icn_games_grey",sprite_hack:true,title:""};
}if(w.sprite_hack){u=j.sprite(w.img,{cls:"app-attachment",alt:w.title});
}else{u=j.img({src:w.img,cls:"app-attachment",alt:w.title});
}x=j.cdiv("mnp-result-details",j.cdiv("mnp-result-broadcast",{onclick:this.discuss,context:this},u,this.broadcast_text_dom),j.cdiv("clear"),j.cdiv("mnp-result-discuss-container",j.a({cls:"mnp-result-discuss"},"Play",{href:this.data.app.link,target:"_blank",onclick:this.discuss,context:this}),this.edit_menu.dom,this.mnp_broadcast_timestamp_span=j.cspan("mnp-result-broadcast-timestamp"),j.cdiv("clear")));
return x;
},broadcast_link_clicked:function(u){l.broadcast_link_clicked(this.data.broadcast.id,this.data.broadcast.uid,u);
IMO.REUI.MNP_PANEL.result_interacted(this.id,"link_clicked");
},update_timestamp:function(){var u=c.timestamp_to_delta(this.broadcast_timestamp);
j.replace_content(this.mnp_broadcast_timestamp_span,t(u.template,u.dict));
this.timestamp_timer=Y.later(u.next,this,this.update_timestamp);
},is_broadcast:function(){return(this.data.rtype==="broadcast");
},is_app:function(){return(this.data.rtype==="app");
},get_avatar:function(){var u=m.DEFAULT_BICON;
if(this.user.profile_photo_id){u="/b/"+c.imo_icon(this.user.profile_photo_id);
}return u;
},get_name:function(){return this.user.first_name+" "+this.user.last_name;
},is_premium:function(){if(this.user.premium){return true;
}return false;
},get_interests_dom:function(){var u=j.cdiv("mnp-result-interests");
c.foreach(this.user.best_matches,function(w,v){var x=j.cspan("mnp-result-clickable",w.item_name,{onclick:function(y){this.item_clicked(y,w.item_name,w.item_type);
},context:this});
if(w.is_common){j.add_class(x,"mnp-common");
}if(w.matches_full){j.add_class(x,"mnp-match");
}if(v!==0){u.appendChild(j(", "));
}u.appendChild(x);
},this);
return u;
},get_user:function(){return this.user;
},discuss:function(v){Y.log("discuss");
v.preventDefault();
if(this.is_app()){var w=IMO.Games.get().get_game_info(this.data.app.type);
if(w){IMO.REUI.APITransformer.show_api_widget(this.data.app.link,w.title);
}else{window.open(this.data.app.link,"_blank");
}return false;
}var u=IMO.REUI.APP.MeetUtils.join_discussion(this.broadcast.id,this.broadcast.text);
IMO.REUI.MNP_PANEL.result_interacted(this.id,"start_discuss");
return u;
},rate_broadcast_clicked:function(w){IMO.MouseManager.get().handled(w,"app-meet-new-people-rate-broadcast#"+this.id);
if(j.has_class(this.tags_div_container,"hidden")){j.cshow(this.rate_arrow);
j.cshow(this.tags_div_container);
j.cshow(this.add_tag_text);
IMO.MouseManager.get().register(this._mouse_clicked,this);
var v=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
var u=(IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im"?"imo_broadcasts":"imo_directory");
v.send("get_broadcast_tags",{bid:this.data.broadcast.id},u,this._broadcast_tags_arrived,this);
}else{this._hide_tags_div();
}},_broadcast_tags_arrived:function(u){j.empty(this.tags_div);
c.foreach(u,function(v){var w=j.a({cls:"tag-name"},j.cspan("tag-text",v[0]),j.cspan("tag-cnt",""+(v[1]||"")),{onclick:function(x){this.tag_clicked(v[0],v[2]);
},context:this});
if(v[2]){j.add_class(w,"tag-voted");
}this.tags_div.appendChild(w);
},this);
if(!j.has_class(this.add_tag_input,"hidden")){j.focus(this.add_tag_input);
}},_mouse_clicked:function(u){if(!IMO.MouseManager.get().check_handled("app-meet-new-people-rate-broadcast#"+this.id)){this._hide_tags_div();
}},_hide_tags_div:function(){j.chide(this.rate_arrow);
j.chide(this.tags_div_container);
this.add_tag_input.value="";
j.chide(this.add_tag_input);
IMO.MouseManager.get().unregister(this._mouse_clicked,this);
},tag_clicked:function(u,w){var v=w?"remove_tag":"add_tag";
var y=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
y.send(v,{bid:this.data.broadcast.id,tag:u},"imo_broadcasts");
IMO.REUI.MNP_PANEL.result_interacted(this.id,"tagged");
var x=(IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im"?"imo_broadcasts":"imo_directory");
y.send("get_broadcast_tags",{bid:this.data.broadcast.id},x,this._broadcast_tags_arrived,this);
},add_tag_input_changed:function(u){switch(u.keyCode){case IMO.KeyboardManager.name2code.enter:this.tag_clicked(this.add_tag_input.value);
this._hide_tags_div();
break;
case IMO.KeyboardManager.name2code.esc:this._hide_tags_div();
break;
default:break;
}},item_clicked:function(x,v,u){var w=u+':"'+v+'"';
IMO.REUI.MNP_PANEL.update_search(w);
},destroy:function(){if(this.timestamp_timer){this.timestamp_timer.cancel();
}j.destroy(this.dom);
}},true);
function n(v,u){if(u.rtype==="promo"){return new k(v,u);
}else{if(u.rtype==="user"||u.rtype==="broadcast"){return new d(v,u);
}}return null;
}IMO.REUI.APP.MNPPanel=function(){this.account=null;
this.results={};
this.analyzed_urls={};
this.alpha_pin=true;
this.last_qseq_no=0;
this.last_query="";
this.need_resend_query=false;
this.build_dom();
this.ev=new IMO.Event();
this.result_tracker=new IMO.MNPResultTracker(this);
this.ev.fire("on_panel_activity");
this.use_imodirectory2=(IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im");
IMO.EventDispatcher.get().subscribe(this,"imo_directory","imo_directory");
if(this.use_imodirectory2){IMO.EventDispatcher.get().subscribe(this,"im","pin");
this.to_system="query_engine";
}else{this.to_system="imo_directory";
}IMO.EventDispatcher.get().subscribe(this,"im","imo_directory");
IMO.ResizeManager.register(this.on_resize,this);
this.on(IMO.Session.get());
this.on(IMO.Alpha.get());
var u=IMO.Session.get().get_imo_account();
if(u){this.on_create_account(u);
}return this;
};
Y.mix(IMO.REUI.APP.MNPPanel.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.APP.MNPPanel.prototype,{on_create_account:function(u){if(u.account_type==="im"&&u.proto==="imo"){this.account=u;
this.imo_profile=u.profile;
this.imo_profile.profile_uid_call("get_profile",{},this,this.profile_loaded);
this.on(this.imo_profile);
this.on_comm_points_left_changed(u.cnt_comm_points_left,u.cnt_max_comm_points);
this.on_premium(u.premium);
}this.on(u);
if(u.state===m.IM_STATE_ONLINE){this.on_signed_on(u);
}},on_picture_upload_success:function(u){this.profile_image_url=m.DEFAULT_BICON;
if(u){this.profile_image_url="/b/"+c.imo_icon(u);
}if(this.profile_image_loader){this.profile_image_loader.cancel();
}this.profile_image_loader=new IMO.REUI.ImageLoader(this.profile_img,this.profile_image_url,20,false,false,false);
},on_premium:function(u){if(u){j.hide(this.get_premium_badge);
j.hide(this.get_premium_text);
j.cshow(this.premium_badge);
j.add_class(this.broadcast_box,"premium");
j.add_class(this.header_dom,"premium");
j.add_class(this.results_dom,"premium");
}else{j.chide(this.premium_badge);
j.show(this.get_premium_badge);
j.show(this.get_premium_text);
j.remove_class(this.broadcast_box,"premium");
j.remove_class(this.header_dom,"premium");
j.remove_class(this.results_dom,"premium");
}},profile_loaded:function(u){Y.log(["read profile: ",u]);
if(!u.error){this.profile_image_url=m.DEFAULT_BICON;
if(u.result.profile_photo_id){this.profile_image_url="/b/"+c.imo_icon(u.result.profile_photo_id);
}if(this.profile_image_loader){this.profile_image_loader.cancel();
}this.profile_image_loader=new IMO.REUI.ImageLoader(this.profile_img,this.profile_image_url,20,false,false,false);
if(IMO.Session.get().get_imo_account()&&c.parse_query().hasOwnProperty("buddy_join")){IMO.REUI.PIN.FFPopup().show();
}}},on_signed_on:function(v){if(this.account===v){var u=this.use_imodirectory2?"pin":"imo_directory";
this.account.send("get_wants_to_meet",{},u);
Y.log(["mini signed_on",v]);
}if(this.need_resend_query){this.send_and_schedule_update();
}},on_prefs_loaded:function(){this.pref_show_mnp_panel=IMO.Session.get().get_pref("reui","mnp_panel",true);
this.try_to_show();
},on_comm_points_left_changed:function(w,u){var v=(w===undefined||w===null)?"?":w;
var x=(u===undefined||u===null)?"?":u;
j.replace_content(this.cp,j(c.sprintf("%s/%s",v,x)));
},try_to_show:function(){var u=IMO.Session.get().get_imo_account();
if(u){return;
}if(this.pref_show_mnp_panel&&this.alpha_pin){IMO.U.toggle_mnp(true,false);
}},set_wants_to_meet_value:function(v){var u=v.edata.wants_to_meet;
IMO.U.toggle_mnp(u,false);
},on_show_mnp:function(u){IMO.U.toggle_mnp(u,true);
},invite_friends_clicked:function(v){IMO.MouseManager.get().handled(v,"mnp-panel-invite");
var u=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!u){return;
}IMO.REUI.PIN.InvitePopup().show();
},find_friends_clicked:function(v){IMO.MouseManager.get().handled(v,"mnp-panel-find");
var u=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!u){return;
}IMO.REUI.PIN.FFPopup().show();
this.update_friends_finder_number(0);
},on_photo_preview_click:function(v,u){if(!this.broadcast_photo_viewer){this.broadcast_photo_viewer=new IMO.REUI.PIN.PHOTO_VIEWER();
}this.broadcast_photo_viewer.show(v,u);
},build_dom:function(){this.ignore_search_input=true;
this.search_input=j.input({id:"mnp-panel-search",type:"text",cls:"inner-shadow",onkeypress:this.search_changed,onkeyup:this.search_changed,onblur:this.search_blur,onfocus:this.search_focus,context:this});
this.search_input.value=f(q,{},"",this,h,[this.search_input,q]);
this.broadcast_box=j.div({id:"mnp-panel-broadcast",cls:"inner-shadow"},j.cdiv("abs-container",this.broadcast_input=j.textarea({id:"mnp-broadcast-input",context:this,onfocus:this.broadcast_focus,onkeypress:this.broadcast_key_press,onkeyup:this.broadcast_key_up})),j.div({id:"mnp-broadcast-extras"},j.div({id:"mnp-broadcast-apps",cls:"mnp-broadcast-btn",title:f("Applications and Games"),onclick:this.broadcast_btn_apps,context:this},j.sprite("icn_games_grey")," ",t("Games")," ",j.sprite("icn_arrdown_s"))),this.broadcast_attach=j.div({id:"mnp-broadcast-attach"}));
j.replace_content(this.broadcast_input,j(f(o,{},"",this,a,[this.broadcast_input,o])));
this.mnp_tabs=new Array();
this.broadcast_actions_div=j.div({id:"mnp-broadcast-actions"});
c.foreach(b,function(w,u){w.btn=j.sprite(w.btn_name_off.slice(7),{onclick:{func:this.switch_forward_button,args:u},context:this});
this.broadcast_actions_div.appendChild(w.btn);
},this);
this.broadcast_actions_div.appendChild(j.a({id:"post_broadcast",cls:"btn_norm",href:"#",onclick:this.broadcast_btn_submit,context:this},t("Post")));
this.broadcast_actions_div.appendChild(j.a({id:"cancel_broadcast",href:"#",onclick:this.broadcast_btn_cancel,context:this},t("Cancel")));
this.header_dom=j.idiv("mnp-panel-header",this.broadcast_input_container=j.div({id:"mnp-panel-avatar-share",onclick:this._handle_broadcast_click,context:this},this.profile_img=j.img({id:"mnp-panel-avatar",alt:f("Edit Profile"),title:f("Edit Profile"),context:this,onclick:this.edit_profile_clicked,src:m.DEFAULT_BICON}),this.premium_badge=j.sprite("premium_account",{id:"mnp-header-premium-badge",title:"Premium Account",context:this,onclick:function(u){IMO.REUI.PremiumAccount.show();
}}),this.broadcast_box,this.broadcast_loading=j.img({id:"mnp-panel-loading",src:"assets/loader_32.gif"}),j.sprite("icn_close",{id:"mnp-panel-close",onclick:this.close,context:this}),j.cdiv("clear"),this.get_premium_badge=j.sprite("premium_account",{id:"mnp-header-get-premium-badge",title:"Premium Account",context:this,onclick:function(u){IMO.REUI.PremiumAccount.show();
}}),this.get_premium_text=j.span({id:"mnp-header-get-premium-text",onclick:function(u){IMO.REUI.PremiumAccount.show();
}},"Upgrade to a Premium Account!"),j.cdiv("clear"),j.cdiv("mnp-tabs",this.mnp_tabs[0]=j.a({id:"mnp-tab0",cls:"mnp-tab network selected",href:"#",onclick:{func:this._show_mnp_tab,args:0},context:this},t("Network")),this.mnp_tabs[1]=j.a({id:"mnp-tab1",cls:"mnp-tab",href:"#",onclick:{func:this._show_mnp_tab,args:1},context:this},t("Activity"))),j.cdiv("clear"),this.broadcast_dropdown_container=j.cdiv("dropdown-container"),this.broadcast_actions_div,j.cdiv("clear"),this.panel_search_div=j.idiv("mnp-panel-search-div",{cls:"blurred"},this.search_input,j.sprite("icn_search_2"),this.clear_search_btn=j.sprite("icn_clear",{id:"mnp-search-clear",onclick:this._clear_search,context:this}))));
this.games_popup=new p(this.broadcast_dropdown_container);
this.on(this.games_popup.games_panel);
this.footer_dom=j.idiv("mnp-panel-footer",j.a({id:"mnp-cp",onclick:function(u){IMO.MouseManager.get().handled("mnp-cp-help");
IMO.REUI.PIN.CPHelpPopup.show();
}},this.cp=j.span(),this.cp_text=j.span({id:"mnp-cp-points"},"CP")),(new IMO.UIWidgets.Button2(t("Invite Friends"),{context:this,onclick:this.invite_friends_clicked})).dom,this.find_friends_dom=this.build_friend_finder_dom(0),j.cdiv("clear"));
this.results_dom=j.cdiv("searching",{id:"mnp-panel-results",onscroll:function(){this.scrolled();
},context:this},this.loading_results=j.img({src:"assets/loader_16.gif",id:"loading-results"}));
this.hoverable_container=new IMO.REUI.APP.MNPResults(this.results_dom);
this.dom=j.div({id:"mnp-panel",cls:"shadow blurred no-app"},this.header_dom,this.results_dom,this.footer_dom);
this.start_oauth_listening();
j.chide(this.clear_search_btn);
j.hide(this.broadcast_loading);
j.chide(this.premium_badge);
if(this.account){this.on_premium(this.account.premium);
}},get_verified_account:function(){return IMO.REUI.APP.MeetUtils.verify_imo_account_online();
},forward_change_status:function(v,w){this.set_forward_button(v,w);
var u=b[v];
IMO.Session.get().set_prefs([{kind:u.kind,pref:u.pref,value:w}]);
},update_forward_status:function(u,w,v){if(!v){v="";
}this.update_forwarding(u,w,v);
},update_forward_status_and_forward_to:function(v,w,u){var x={};
x[v]=true;
b[v].queued_bid=null;
this.update_forwarding(v,true,w,function(){this.forward_broadcast(u,x);
});
},update_forwarding:function(u,x,v,y){var w=this.get_verified_account();
if(!w){return;
}w.send("update_forwarding",{website:u,token:v,value:x},"imo_broadcasts",function(z){if(z=="Success"||z=="Already set"){this.forward_change_status(u,x);
if(y){y.apply(this);
}}if(z=="Authorize"){this.open_broadcast_popup(this,u);
}},this);
},load_forward_preferences:function(){c.foreach(b,function(x,w){var u=IMO.Session.get().get_pref(x.kind,x.pref,false);
this.set_forward_button(w,u);
},this);
},set_forward_button:function(v,x){var u=b[v];
u.value=x;
var w=u.btn_name_on;
if(!u.value){w=u.btn_name_off;
}j.mex_class(u.btn,w,[u.btn_name_on,u.btn_name_off]);
},open_broadcast_popup:function(z,v){var y=v;
if(y=="facebook"){y="prpl-newfacebook";
}var A=m.PROTO_TO_UI[y];
var w=Y.DOM.docHeight()-20;
var u=(w<700)?Math.max(10,(w-500)/2):200;
var x={hide:function(C){this.popup.destroy();
IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.popup;
}};
x.popup=new IMO.ModalPopup(x);
x.popup.set_title(j.span("Share on "+A));
x.popup.set_content(j.div({id:"broadcast_popup"},x.dom=j.div(),x.msg=j.div({cls:""})),[310,NaN]);
x.popup.prepare();
j.css(x.popup.popup_dom,{top:u+"px",maxHeight:(w-40)+"px"});
x.popup.show();
x.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:x.hide}},bottom:true,context:x});
var B={twitter:"Sign in to Tweet your broadcasts.",facebook:"Sign in to share your broadcasts on your Facebook wall.",linkedin:"Sign in to share your broadcasts on your LinkedIn network."};
x.dom.appendChild(t(B[v]));
x.dom.appendChild(j.div({id:"broadcast_popup_button"},j.sprite(v+"_use",{onclick:{func:function(D,C){this.oauth_authorize(C);
x.hide();
},args:v},context:this})));
return;
},switch_forward_button:function(w,v){var u=b[v];
u.value=j.has_class(u.btn,u.btn_name_on);
u.queued_bid=null;
this.update_forward_status(v,!u.value);
},start_oauth_listening:function(){IMO.OAuth.get().init();
this.on(IMO.OAuth.get());
},run_oauth:function(v,u){this.oauth_authorize(u);
},oauth_authorize:function(u){b[u].authorizing=true;
var v=IMO.REUI.APP.MeetUtils.get_uid_proto(true);
if(v.uid){IMO.OAuth.get().post_connect(u,v.uid);
}},oauth:function(x,v,w){if((v in b)&&b[v].authorizing){b[v].authorizing=false;
var u=b[v].queued_bid;
if(u!==null){this.update_forward_status_and_forward_to(v,w,u);
}else{this.update_forward_status(v,true,w);
}}},forward_broadcast:function(v,u){var w=this.get_verified_account();
if(!w){return;
}var x={bid:v,forward_to:u};
w.send("forward_broadcast",x,"imo_broadcasts",function(y){if(y){c.foreach(u,function(B,C){var z=y[C];
if(z=="Authorize"){this.forward_change_status(C,false);
b[C].queued_bid=v;
this.open_broadcast_popup(this,C);
}else{if(z!="Accepted"){var A=C.charAt(0).toUpperCase()+C.slice(1);
IMO.NM.add_notification(f(A)+": "+f(z),IMO.REUI.Notification.types.error,{momentary:true});
b[C].queued_bid=null;
}}},this);
}},this);
},build_friend_finder_dom:function(u){return j.a({id:"mnp-panel-find-friends",context:this,onclick:this.find_friends_clicked},t("Find Friends"),u?(c.sprintf(" (%s)",u)):null);
},update_friends_finder_number:function(v){var u=this.build_friend_finder_dom(v);
this.find_friends_dom.parentNode.replaceChild(u,this.find_friends_dom);
this.find_friends_dom=u;
},edit_profile_clicked:function(u){IMO.MouseManager.get().handled(null,"mnp-panel-edit-profile");
IMO.REUI.PIN.ProfileEdit.show();
},close:function(u){Y.log("Close MNP Panel");
IMO.U.toggle_mnp(false,true);
this.ev.fire("on_panel_inactivity");
},show:function(u){j.show(this.dom);
this.available_changed(true,u);
this.perform_search(this.last_query);
this.ev.fire("on_panel_activity");
},hide:function(u){j.hide(this.dom);
this.available_changed(false,u);
if(this.update_event){this.update_event.cancel();
}this.ev.fire("on_panel_inactivity");
},update_search:function(u){this.search_input.value=u;
this.search_focus();
j.cshow(this.clear_search_btn);
this.search(u,true);
},available_changed:function(v,w){var u=IMO.Session.get().get_imo_account();
if(w){IMO.Session.get().set_pref("reui","mnp_panel",v);
}if(u){u.set_wants_to_meet(v,w);
}},get_person:function(u){return this.results[u].get_user();
},initiate_broadcast:function(){var u={};
c.foreach(b,function(x,w){if(x.value){u[w]=true;
}x.queued_bid=null;
});
if(this.broadcast(this.broadcast_input.value,u)){this._clear_broadcast();
}},broadcast:function(x,u){if(!x||x.length===0){return true;
}var v=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!v){return false;
}this._disable_broadcast();
var w,y;
if(this._broadcasting_app){w={text:x,app:this._broadcasting_app};
y="publish_app";
}else{w={text:x};
y="post_broadcast";
}v.send(y,w,"imo_broadcasts",function(z){Y.log(["Broadcast :",z]);
var A=z.bid;
Y.log(["Broadcast ID:",A]);
if(!A){IMO.NM.add_notification(f("Broadcast failed."),IMO.REUI.Notification.types.error,{momentary:false});
this._enable_broadcast();
}else{this.forward_broadcast(A,u);
}this.broadcast_id=A;
if("broadcast."+A in this.results){this._enable_broadcast();
}},this);
this.broadcast_timer=Y.later(i,this,this._broadcast_timeout);
if(IMO.Constants.PRIMS_IN_MNP.indexOf(IMO.Session.get().primitive)===-1){IMO.NM.add_notification(f("Your broadcasts won't be displayed until your status changes to available!"),IMO.REUI.Notification.types.error,{momentary:false});
this._enable_broadcast();
}return true;
},analyze:function(u){var v=IMO.REUI.APP.MeetUtils.verify_imo_account_online(true);
if(!v){return;
}if(this.analyzed_urls[u]){return;
}this.analyzed_urls[u]="temp_title";
v.send("analyze_broadcast",{url:u},"imo_broadcasts",this.broadcast_analyzed,this);
},toggle_dom_state:function(w,v){j.mex_class(this.dom,w,[w,v]);
for(var u=this.dom.firstChild;
u;
u=u.nextSibling){u.className=u.className;
}},on_selected_app:function(w){Y.log("App name: "+w);
this.hide_games_popup();
var v=this.games_popup.games_panel.get_image(w);
var u=IMO.Games.get().get_game_info(w);
v.className="app-attachment";
this._broadcasting_app=w;
j.replace_content(this.broadcast_attach,j.sprite("icn_clear",{id:"mnp-attach-clear",context:this,onclick:this._clear_broadcasting_app}),v,j.cspan("app-title",u.title));
this.broadcast_input.focus();
var x=u.broadcast_text;
if(this.broadcast_input.value.length===0){this.broadcast_input.value=x;
this.broadcast_input.select();
}this.toggle_dom_state("app","no-app");
},_clear_broadcasting_app:function(){if(this._broadcasting_app){var u=IMO.Games.get().get_game_info(this._broadcasting_app);
this._broadcasting_app=null;
this.toggle_dom_state("no-app","app");
j.replace_content(this.broadcast_attach);
if(this.broadcast_input.value==u.broadcast_text){this.broadcast_input.value="";
this.broadcast_input.blur();
}}},broadcast_btn_apps:function(u){IMO.MouseManager.get().handled(u,"games-popup");
this.games_popup.toggle(u);
u.target.blur();
IMO.MouseManager.get().register(this._handle_games_mouseup,this);
},_handle_broadcast_click:function(u){IMO.MouseManager.get().handled(u,"mnp-broadcast");
},_handle_broadcast_mouseup:function(u){if(!IMO.MouseManager.get().check_handled("mnp-broadcast")){this.broadcast_blur();
}},_handle_games_mouseup:function(){if(!IMO.MouseManager.get().check_handled("games-popup")){this.hide_games_popup();
}},hide_games_popup:function(){if(this.games_popup.visible){IMO.MouseManager.get().unregister(this._handle_games_mouseup,this);
this.games_popup.close();
}},broadcast_btn_cancel:function(u){this._clear_broadcast();
u.preventDefault();
u.returnValue=false;
return false;
},broadcast_btn_submit:function(u){this.initiate_broadcast();
u.preventDefault();
u.returnValue=false;
return false;
},broadcast_focus:function(){if(!this._broadcast_open){this.input_focus(this.broadcast_input,o);
this.toggle_dom_state("broadcasting","blurred");
this.load_forward_preferences();
this._broadcast_open=true;
IMO.MouseManager.get().register(this._handle_broadcast_mouseup,this);
IMO.MouseManager.get().handled("broadcast-button");
}},broadcast_blur:function(){if(this._broadcast_open){if(this.input_blur(this.broadcast_input,o,a)){this._clear_broadcasting_app();
this.toggle_dom_state("blurred","broadcasting");
this.analyzed_urls={};
this._broadcast_open=false;
IMO.MouseManager.get().unregister(this._handle_broadcast_mouseup,this);
}}},broadcast_key_press:function(u){this._handle_key_push(u);
},broadcast_key_up:function(u){this._handle_key_push(u);
},_handle_key_push:function(y){switch(y.keyCode){case IMO.KeyboardManager.name2code.enter:y.halt();
this.initiate_broadcast();
break;
case IMO.KeyboardManager.name2code.esc:y.halt();
this._clear_broadcast();
break;
default:var z=["ctrl","tab","space","command left","command right"];
for(var v=0;
v<z.length;
v++){if(y.keyCode===IMO.KeyboardManager.name2code[z[v]]){var x=this.broadcast_input.value.split(" ");
for(var u=0;
u<x.length;
u++){var w=/^((http|https):\/\/)([a-zA-Z0-9\-\.])+(\.)([a-zA-Z0-9\-])+((:[0-9]+)?\/([a-zA-Z0-9\/+=%&_\.~?\-;,]*))?$/;
if(x[u].match(w)){this.analyze(x[u]);
}}break;
}}break;
}},search_blur:function(){if(this.input_blur(this.search_input,q,h)){j.mex_class(this.search_input.parentNode,"blurred",["focused","blurred"]);
}},search_focus:function(){this.input_focus(this.search_input,q);
j.mex_class(this.search_input.parentNode,"focused",["focused","blurred"]);
},search_changed:function(v){if(v.keyCode===IMO.KeyboardManager.name2code.esc){v.halt();
this._clear_search();
return;
}if(this.search_event){this.search_event.cancel();
}if(this.search_input.value.length>0){j.cshow(this.clear_search_btn);
}else{j.chide(this.clear_search_btn);
}var u=IMO.REUI.APP.MeetUtils.search_delay(v);
this.search_event=Y.later(u,this,this.search,this.search_input.value);
},input_blur:function(u,v){if(u.value===""){this.ignore_search_input=true;
u.value=f(v);
u.defaultValue=f(v);
return true;
}return false;
},input_focus:function(u,v){this.ignore_search_input=false;
if(u.value===f(v)){u.value="";
u.defaultValue="";
return true;
}return false;
},search:function(v,u){if(!u&&this.ignore_search_input){return;
}if(this.last_query!==v){this.perform_search(v);
}},perform_search:function(u){Y.log(["mini_search",u]);
this.last_query=u;
this.last_qseq_no=this.last_qseq_no+1;
this.send_and_schedule_update();
},send_and_schedule_update:function(){if(!this.send_query()){this.need_resend_query=true;
return;
}this.need_resend_query=false;
if(this.update_event){this.update_event.cancel();
}this.update_event=Y.later(e,this,this.update);
},update:function(){Y.log("update");
var v=IMO.REUI.APP.MeetUtils.get_uid_proto();
if(v.uid){var u=0;
if(IMO.ActivityMonitor.get().user_is_active()||Math.random()<0.1){u=1;
}IMO.Network.get().send(this.to_system,"mnp_update_results",{ssid:IMO.Network.get().ssid,uid:v.uid,proto:v.proto,qseq_no:this.last_qseq_no,query:this.last_query,num_results:u});
}else{Y.log("No account","error","meet_mini.js");
}if(this.update_event){this.update_event.cancel();
}this.update_event=Y.later(e,this,this.update);
},on_resize:function(u){this.scrolled();
},scrolled:function(){this.ev.fire("on_panel_activity");
this.infinite_scroll();
},infinite_scroll:function(){if(!this.has_more_results){return;
}if(this.results_dom.offsetHeight>0&&this.results_dom.scrollTop+this.results_dom.offsetHeight+10>this.results_dom.scrollHeight){this.need_resend_query=!this.send_query();
}},send_query:function(){var u=IMO.REUI.APP.MeetUtils.get_uid_proto();
if(!u.uid){Y.log("No account","error","meet_mini.js");
return false;
}this.has_more_results=false;
j.cshow(this.loading_results);
IMO.Network.get().send(this.to_system,"mnp_search",{ssid:IMO.Network.get().ssid,uid:u.uid,proto:u.proto,qseq_no:this.last_qseq_no,query:this.last_query});
return true;
},is_valid_result:function(u){if(u.qseq_no!==this.last_qseq_no){return false;
}return true;
},mnp_search_result:function(w){var v=w.edata;
Y.log(["search results: ",w]);
if(!this.is_valid_result(v)){Y.log(["result not valid"]);
return;
}if(v.rtype==="initial"){this.clear_results();
}var u=v.results;
c.foreach(u,function(x,y){this.add_result(x,v.rtype==="prepend");
},this);
if(v.has_more_results!==undefined){this.has_more_results=v.has_more_results;
}j.chide(this.loading_results);
this.infinite_scroll();
this.ev.fire("on_results_changed");
},broadcast_analyzed:function(u){if(u){if(this.broadcast_input.value.indexOf(u.url)>-1&&u.title){this.broadcast_input.value=this.broadcast_input.value.replace(u.url,u.title+" - "+u.url);
this.analyzed_urls[u.url]=u.title;
}}},mnp_broadcast_update:function(z){var w=z.edata.results;
for(var v=0;
v<w.length;
++v){var u=w[v];
var x=u.broadcast;
var y=this.results[u.rid];
if(!y){IMO.Stats.log_event("unknown_broadcast_update",{ssid:IMO.Network.get().ssid,rid:u.rid});
}else{y.update_internal_state_from_broadcast(x);
y.update_types_specific_dom();
}}},update_primitive:function(w){Y.log(["update primitive: ",w]);
var v=w.edata;
if(!this.is_valid_result(v)){return;
}var u=v.rid;
if(this.results[u]){this.results[u].user.primitive=v.primitive;
}},remove_from_mnp:function(w){Y.log(["remove from mnp: ",w]);
var v=w.edata;
if(!this.is_valid_result(v)){return;
}var u=v.rid;
if(this.results[u]){j.remove(this.results[u].dom);
this.results[u].destroy();
delete this.results[u];
}},clear_results:function(){j.empty(this.results_dom);
c.foreach(this.results,function(u){u.destroy();
});
this.results={};
this.results_dom.appendChild(this.loading_results);
this.ev.fire("on_results_cleared");
},add_result:function(u,v){Y.log(["add_result:",u]);
this._check_pending_broadcast(u);
if(u.rid in this.results){Y.log(["Tried to add uid a second time:",u]);
return;
}if(!this._check_result_type(u)){Y.log(["Unsupported result type",u.rtype]);
return;
}var w=n(u.rid,u);
this.on(w);
Y.log(["MNP result:",w]);
this.results[u.rid]=w;
if(v&&this.results_dom.firstChild){this.results_dom.insertBefore(w.dom,this.results_dom.firstChild);
}else{this.results_dom.insertBefore(w.dom,this.loading_results);
}w.prepare();
},handle_available_change_cb:function(u){IMO.MouseManager.get().handled(null,"meet-new-people-available-box");
this.available_changed();
},_clear_search:function(){this.search_input.value="";
j.chide(this.clear_search_btn);
this.search("");
this.search_input.blur();
},_clear_broadcast:function(){this.broadcast_input.value="";
this.broadcast_input.blur();
this._clear_broadcasting_app();
this.broadcast_blur();
},_disable_broadcast:function(){j.show(this.broadcast_loading);
this.broadcast_input.disabled=true;
},_enable_broadcast:function(){j.hide(this.broadcast_loading);
this.broadcast_input.disabled=false;
if(this.broadcast_timer){this.broadcast_timer.cancel();
delete this.broadcast_timer;
}delete this.broadcast_id;
},_broadcast_timeout:function(){if(!this.broadcast_id){IMO.NM.add_notification(f("Broadcast failed."),IMO.REUI.Notification.types.error,{momentary:false});
}this._enable_broadcast();
},_check_pending_broadcast:function(u){if(this.broadcast_id&&u.rid==="broadcast."+this.broadcast_id){this.results_dom.scrollTop=0;
this._enable_broadcast();
}},_check_result_type:function(u){if(u.rtype==="broadcast"||u.rtype==="user"||u.rtype==="promo"){return true;
}return false;
},_show_mnp_tab:function(w,u){if(u===1&&!IMO.REUI.APP.MeetUtils.verify_imo_account_online()){return;
}for(var v=0;
v<2;
v++){if(v==u){j.add_class(this.mnp_tabs[v],"selected");
}else{j.remove_class(this.mnp_tabs[v],"selected");
}}switch(u){case 0:j.add_class(this.results_dom,"searching");
j.cshow(this.panel_search_div);
this.search_input.value="";
j.chide(this.clear_search_btn);
this.search("",true);
break;
case 1:j.remove_class(this.results_dom,"searching");
j.chide(this.panel_search_div);
this.search("mnp_activity:",true);
this.update_event.cancel();
break;
default:break;
}},panel_visible:function(){var u=(document.getElementById("mnp-panel-results")&&this.dom.style.display!="none"&&document.hasFocus());
return u;
},rid_from_node:function(u){if(u&&u.className==" mnp-result"){return u.id.split("#")[1];
}else{return null;
}},find_visible_results:function(){if(!this.panel_visible()){Y.log("panel not active?");
return[];
}var w=document.getElementById("mnp-panel-results").childNodes;
var y=[];
var x=this.results_dom;
var v=Math.floor((w.length-1)/2);
var z=0;
var A=w.length-1;
if(!w[v]){Y.log("bad index?");
return[];
}while(A>=z&&!this.is_in_view(this.rid_from_node(w[v]))){if(w[v].offsetTop+w[v].offsetHeight>x.scrollTop+x.offsetHeight){A=v-1;
v=Math.floor((z+v)/2);
}else{z=v+1;
v=Math.floor((v+A)/2)+1;
}}var u=v;
if(!this.is_in_view(this.rid_from_node(w[u]))){Y.log("search failed? found "+this.rid_from_node(w[u]));
return[];
}while(v>=z&&w[v]&&this.is_in_view(this.rid_from_node(w[v]))){y.push(this.rid_from_node(w[v]));
v-=1;
}v=u+1;
while(v<=A&&w[v]&&this.is_in_view(this.rid_from_node(w[v]))){y.push(this.rid_from_node(w[v]));
v+=1;
}return y;
},is_in_view:function(w){if(!this.results[w]){return false;
}var u=this.results[w].dom;
var v=this.results_dom;
if(u.offsetTop>=v.scrollTop&&u.offsetTop+u.offsetHeight<=v.scrollTop+v.offsetHeight){return true;
}else{return false;
}},result_interacted:function(v,u){this.ev.fire("on_interaction",v,"seen");
},result_hovered:function(u,v){if(v>0.7){this.ev.fire("on_interaction",u,"seen");
}if(v>3){this.ev.fire("on_interaction",u,"hovered");
}}});
}());
(function(){var a=IMO.Utils;
var d=IMO.Constants;
var c=IMO.Utils.HTML;
var b=a.TranslateDom;
IMO.REUI.Header=function(){this.dom=c.div({id:"header"},c.sprite("logo_small_2"),c.ul(this.directory_button=c.li(c.imo_a(c.sprite("icn_search_white"),b("Directory"),{id:"directory_button",onclick:function(f){f.preventDefault();
IMO.REUI.PIN.Directory.show();
},href:"#"})),this.mnp_button=c.li(c.imo_a(b("Broadcasts"),{id:"header-mnp-btn",onclick:function(f){f.preventDefault();
IMO.U.toggle_mnp(undefined,true);
}})),c.li(c.a(b("Mobile"),{href:"/iphone",target:"_blank"}))),(this.account_console=new IMO.REUI.AccountBar()).dom,(new IMO.REUI.HistorySearchBar()).dom,(new IMO.REUI.PromoDisplay()).dom);
IMO.U.refresh_mnp();
this.on(IMO.Session.get());
this.on(IMO.Alpha.get());
};
Y.mix(IMO.REUI.Header.prototype,IMO.EventTarget);
IMO.REUI.Body=function(){IMO.REUI.MNP_PANEL=new IMO.REUI.APP.MNPPanel();
c.hide(IMO.REUI.MNP_PANEL.dom);
var f=new IMO.REUI.BuddyPanel();
var e=c.div({id:"main"});
var g=c.div({id:"body"},IMO.REUI.MNP_PANEL.dom,f.dom,e);
return g;
};
IMO.REUI.Footer=function(){var f=new IMO.REUI.LanguageSelector();
var g;
var e=c.div({id:"footer"},c.div({id:"footer-apps"}),c.div({id:"footer-right"},c.div({id:"footer-langs"},f.dom),c.div({id:"footer-links"},g=c.a(b("Developers"),{href:"/developers/",target:"_blank"}),c.a(b("Feedback"),{href:"#",onclick:function(h){IMO.MouseManager.get().handled(h,"footer-feedback-link");
h.preventDefault();
IMO.REUI.Feedback.show();
}}),c.a(b("About"),{target:"about:blank",href:"/about"}),c.a(b("Help"),{target:"about:blank",href:"/help"}),c.a(b("Policies"),{target:"about:blank",href:"/policies/"}))));
return e;
};
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var c=a.sprintf;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
var f=function(g,h,j){var i=IMO.Session.get().get_account("im",g,h);
return IMO.BuddyList.get().get_buddy(i,j);
};
IMO.REUI.HistorySearchBar=function(){var g="Search messages with";
var h="Conversation results";
this.dom=d.div({cls:"history-search-container"},this.inp=d.input({type:"text",cls:"history-search-input blurred inner-shadow",value:e("Search Chat History..."),context:this,onkeydown:this.handle_search_key,onblur:this.handle_search_box_blur}),this.btn=d.cdiv("history-search-button",d.sprite("icn_search_2")));
this.container=d.div({cls:"history-suggestion-container"},this.buddy_title=d.div(IMO.REUI.Bar("grey",{context:this},this.bt_text=d.span({cls:"title"},g))),this.buddy_suggestions=d.cdiv("history-buddy-suggestions"),this.message_title=d.div(IMO.REUI.Bar("grey",{context:this},this.mt_text=d.span({cls:"title"},h))),this.message_suggestions=d.cdiv("history-message-suggestions"));
this.on(IMO.ConvHistory.get());
d.on("click",this.handle_suggestion_click,this.container,this);
d.on("focus",this.handle_search_box_focus,this.inp,this);
d.on("click",this.handle_btn_click,this.btn,this);
d.on("mouseout",this.handle_btn_mouseout,this.btn,this.btn,this);
d.on("mouseover",this.handle_btn_mouseover,this.btn,this.btn,this);
this.buddy_matches=[];
this.message_results=[];
this.buddy_results=[];
this.selected_item=null;
this.over_element=null;
this.cur_buddy=null;
this.lose_focus=null;
this.over_btn=false;
this.init_results(10,10);
};
Y.mix(IMO.REUI.HistorySearchBar.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.HistorySearchBar.prototype,{show_container:function(){d.dom("imo").appendChild(this.container);
},hide_container:function(){d.remove(this.container);
},on_get_suggestion_list:function(l){if(!d.has_class(this.inp,"focused")){return;
}d.add_class(this.dom,"history-searching-mode");
var s=(typeof window.innerHeight!=="undefined"?window.innerHeight:document.body.offsetHeight)-50;
var q=this.aggregate_results(l.edata);
var u=q.results;
var h=q.query;
var A=this.get_buddies(h);
var y=this.message_results;
var g=u.length;
var o=this.buddy_results;
var n=A.length;
this.init_results(g,n);
var t,r;
this.num_message_results=g;
this.num_buddy_results=n;
if(this.cur_buddy){d.replace_content(this.mt_text,d("Results with "),d(this.cur_buddy.get_displaylias()));
}else{d.replace_content(this.mt_text,d("Conversation results"));
}for(var z=0;
z<n;
z++){d.replace_content(o[z],d(this.format_buddy_suggestion(A[z],h)));
o[z].buddy=A[z];
d.show(o[z]);
o[z].result=null;
if(z>0){r=o[z-1];
}else{r=o[z];
}if(z+1<n){t=o[z+1];
}else{if(g>0){t=y[0];
}else{t=o[z];
}}o[z].next=t;
o[z].prev=r;
}var p;
var B;
for(var x=0;
x<g;
x++){var v=f(u[x].uid,u[x].proto,u[x].buid);
var m=v?v.get_displaylias():u[x].buid;
B=this.format_message(h,u[x]);
p=this.format_buddy(m);
d.replace_content(y[x].name_div,d(p));
d.replace_content(y[x].message_div,B);
y[x].result=u[x];
d.show(y[x]);
y[x].buddy=null;
if(x>0){r=y[x-1];
}else{if(n>0){r=o[n-1];
}else{r=y[x];
}}if(x+1<g){t=y[x+1];
}else{t=y[x];
}y[x].next=t;
y[x].prev=r;
}var w;
for(w=this.buddy_results.length-1;
w>=n;
w--){d.hide(o[w]);
}for(w=this.message_results.length-1;
w>=g;
w--){d.hide(y[w]);
}this.clear_selected_item();
this.selected_item=null;
this.first_item=null;
if(n+g===0){this.hide_container();
}else{if(g===0){d.mex_class(this.message_title,"hidden",["visible","hidden"]);
}else{d.mex_class(this.message_title,"visible",["visible","hidden"]);
}if(n===0){d.mex_class(this.buddy_title,"hidden",["visible","hidden"]);
this.first_item=y[0];
}else{d.mex_class(this.buddy_title,"visible",["visible","hidden"]);
this.first_item=o[0];
}this.show_container();
}},aggregate_results:function(m){var k=[];
var l;
var n=0;
if(m.uid){var h={};
h[m.uid+"#"+m.proto]={query:"dogs",uid:m.uid,proto:m.proto,results:m.results};
m=h;
}for(var p in m){if(!m.hasOwnProperty(p)){continue;
}l=m[p].query;
var o=m[p].results;
var q=p.split("#");
var g=o.length;
for(var j=0;
j<g;
j++){var r=o[j];
k[n]={message:r[0],timestamp:r[1],buid:r[2],sent:r[3],msgid:r[4],uid:q[0],proto:q[1]};
n++;
}}k.sort(function(s,i){return i.timestamp-s.timestamp;
});
return{results:k,query:l};
},get_buddies:function(k){if(this.cur_buddy){return[];
}var j,h;
var g=IMO.BuddyList.get().get_buddies();
var l=[];
k=k.toLowerCase();
var m=k.length;
var i=0;
for(j in g){h=g[j];
if(h.get_displaylias().toLowerCase().substring(0,m)==k){i++;
if(i>5){return[];
}if(l.length<3){l.push(h);
}}}return l;
},remove_bad_characters:function(j){var g=j.length;
var k="";
for(var h=0;
h<g;
h++){if(j.charCodeAt(h)>=3){k+=j.charAt(h);
}}return k;
},truncate_and_boldify:function(s,m){var C=s.length;
var u="";
var y=[];
var v=0;
for(var A=0;
A<C;
A++){if(s.charCodeAt(A)>=3){u+=s.charAt(A);
y[v]=m[A];
v++;
}}m=y;
s=u;
C=s.length;
var B=20;
var h=1000000;
var p=[];
for(var z=0;
z<C;
z++){if(m[z]){h=0;
}else{h++;
}p[z]=h;
}var o=1000000;
var r=[];
for(var x=C-1;
x>=0;
x--){if(m[x]){o=0;
}else{o++;
}r[x]=o;
}var D=d.span();
var F="";
var n=false;
var E=false;
var t=false;
var g=false;
var q;
if(C>30){g=true;
}for(var w=0;
w<C;
w++){q=s.charAt(w);
if(q==="&"&&(!t||Math.min(r[Math.min(w+5,C-1)],p[Math.min(w+5,C-1)])<=B)){E=true;
}else{if(E&&q===";"){E=false;
}}if(g&&Math.min(r[w],p[w])>B&&!E){t=true;
}if(m[w]){if(n===false){D.appendChild(d.span(F));
F="";
n=true;
}}else{if(n){D.appendChild(d.span(F,{cls:"hilight"}));
F="";
n=false;
}}if(g&&E&&t){F+="...";
t=false;
}if(!g||Math.min(r[w],p[w])<=B){if(g&&t){F+="...";
t=false;
}F+=q;
}}if(n){D.appendChild(d.span(F,{cls:"hilight"}));
F="";
}if(g&&t){D.appendChild(d.span("..."));
F="";
}D.appendChild(d.span(F));
return D;
},init_results:function(m,p){this.over_element=null;
if(this.selected_item){d.remove_class(this.selected_item,"history-selected-element");
this.selected_item=null;
}var o=this.message_suggestions;
var h=this.message_results;
var g=h.length;
var j;
var s;
for(j=g;
j<m;
j++){var q=(j%2===0)?"history-suggestion-name-even-element":"history-suggestion-name-odd-element";
var k=(j%2===0)?"history-suggestion-even-element":"history-suggestion-odd-element";
q+=" history-suggestion-part history-suggestion-name";
k+=" history-suggestion-part history-suggestion-message";
s=d.div(d.span({cls:q}),d.span({cls:k}));
d.hide(s);
s.name_div=s.firstChild;
s.message_div=s.lastChild;
s.type="message";
d.add_class(s,"history-message-suggestion-result");
d.on("mouseout",this.handle_result_mouseout,s,s,this);
d.on("mouseover",this.handle_result_mouseover,s,s,this);
o.appendChild(s);
h[j]=s;
}var r=this.buddy_suggestions;
var l=this.buddy_results;
var n=l.length;
for(j=n;
j<p;
j++){s=d.div();
d.hide(s);
d.add_class(s,"history-buddy-suggestion-result");
if(j%2===0){d.add_class(s,"history-suggestion-even-element");
}else{d.add_class(s,"history-suggestion-odd-element");
}s.type="buddy";
d.on("mouseout",this.handle_result_mouseout,s,s,this);
d.on("mouseover",this.handle_result_mouseover,s,s,this);
r.appendChild(s);
l[j]=s;
}},format_buddy_suggestion:function(g,h){return g.get_displaylias();
},format_buddy:function(g){return g;
},format_message:function(n,r){var s=r.message;
var h=r.timestamp;
var u=r.buid||r.buddyid;
var D=r.sent;
var E=r.msgid;
var p=r.uid;
var t=r.proto;
if(a.is_group_target(u)){s=s.substring(s.indexOf(" "));
}var m=[];
var F=String.fromCharCode(1)+" "+s.toUpperCase();
var q=n.split(/[\s\.\,\*\+\?\^!@#&]/);
var B=q.length;
var g=F.length;
var y,z,x,w;
for(z=0;
z<B;
z++){var A=q[z].toUpperCase();
if(A.length===0){continue;
}var C=A.length;
var o=false;
for(w=0;
w<=1&&!o;
w++){for(x=0;
x<g;
x++){if(F.charCodeAt(x)<3+w*100000&&x+2+C<=g){for(y=0;
y<C;
y++){if(F.charAt(x+2+y)!==A.charAt(y)){break;
}}if(y===C){o=true;
}if(y<C||m[x]){continue;
}for(var v=0;
v<C;
v++){m[x+v]=true;
}break;
}}}}return this.truncate_and_boldify(s,m);
},handle_result_mouseover:function(g,h){h.over_element=this;
h.select_item(this);
},handle_result_mouseout:function(g,h){h.over_element=null;
h.unselect_item(this);
},handle_btn_mouseover:function(g,h){h.over_btn=true;
},handle_btn_mouseout:function(g,h){h.over_btn=false;
},handle_search_box_blur:function(i,h){if((this.over_element||this.over_btn)&&!h){this.inp.focus();
return;
}var g=this;
this.cur_buddy=null;
d.remove_class(this.dom,"history-searching-mode");
this.clear_selected_item();
this.selected_item=null;
this.over_element=null;
g.hide_container();
d.mex_class(g.inp,"blurred",["focused","blurred"]);
d.remove_class(this.dom,"focused");
g.lastInput="";
g.inp.value=e("Search Chat History...");
},handle_search_box_focus:function(g){if(d.has_class(this.inp,"focused")){return;
}IMO.ConvHistory.get().prepare_for_query();
d.mex_class(this.inp,"focused",["focused","blurred"]);
d.add_class(this.dom,"focused");
this.inp.value="";
},handle_search_key:function(g){switch(g.keyCode){case IMO.KeyboardManager.name2code.enter:g.halt();
this.handle_enter_press();
break;
case IMO.KeyboardManager.name2code["down arrow"]:g.halt();
this.select_next_element();
break;
case IMO.KeyboardManager.name2code["up arrow"]:g.halt();
this.select_prev_element();
break;
case IMO.KeyboardManager.name2code.esc:g.halt();
this.handle_esc_press();
break;
case IMO.KeyboardManager.name2code.tab:g.halt();
this.handle_tab_press();
break;
default:this.handle_key_press();
break;
}},handle_enter_press:function(){var h=false;
if(!this.selected_item||this.selected_item.type==="message"){if(!this.selected_item&&!(this.inp.value.length===0||!d.has_class(this.inp,"focused"))){var g=this.inp.value;
var i=IMO.REUI.get_history_search_widget();
i.show_messages(g,this.cur_buddy);
}h=true;
}if(this.selected_item&&this.selected_item.type==="buddy"){this.select_buddy(this.selected_item.buddy);
}else{if(this.selected_item&&this.selected_item.type==="message"){this.handle_message_click(this.selected_item);
}}if(h){this.inp.blur();
this.handle_search_box_blur(null,true);
}},handle_tab_press:function(){if(!this.selected_item){return;
}if(this.selected_item.type==="buddy"){Y.log("WERE");
this.select_buddy(this.selected_item.buddy);
}else{this.complete_message(this.selected_element.message);
}},handle_esc_press:function(){this.inp.blur();
},handle_key_press:function(){var g=this;
Y.later(0,g,function(){var h=g.inp.value;
if(!g.cur_buddy){IMO.ConvHistory.get().get_suggestion(h,IMO.Session.get().get_accounts(),"");
}else{IMO.ConvHistory.get().get_suggestion(h,[g.cur_buddy.account],g.cur_buddy.buid);
}});
},clear_selected_item:function(){if(this.selected_item){this.unselect_item(this.selected_item);
}},unselect_item:function(g){if(g.type==="message"){d.remove_class(g.firstChild,"history-selected-element");
d.remove_class(g.lastChild,"history-selected-element");
}else{d.remove_class(g,"history-selected-element");
}},select_item:function(g){this.selected_item=g;
if(g.type==="message"){d.add_class(g.firstChild,"history-selected-element");
d.add_class(g.lastChild,"history-selected-element");
}else{d.add_class(g,"history-selected-element");
}},select_next_element:function(){this.clear_selected_item();
if(this.selected_item){this.selected_item=this.selected_item.next;
}else{this.selected_item=this.first_item;
}if(this.selected_item){this.select_item(this.selected_item);
}},select_prev_element:function(){this.clear_selected_item();
if(!this.selected_item){return;
}this.selected_item=this.selected_item.prev;
this.select_item(this.selected_item);
},handle_suggestion_click:function(j){Y.log("???");
IMO.MouseManager.get().handled(j,"history-suggestion-container");
var h=Y.one(j.target);
var g=h.get("tagName").toLowerCase();
while(h&&(g!=="table")){switch(g){case"body":return;
case"div":var i=Y.Node.getDOMNode(h);
if(i.type==="message"){this.handle_message_click(i);
}else{this.handle_buddy_click(i);
}return;
default:break;
}h=h.get("parentNode");
if(h){g=h.get("tagName").toLowerCase();
}}},select_buddy:function(g){a.log("BUDDY SELECT");
this.cur_buddy=g;
var h=g.account.uid;
var i=g.account.proto;
var j=g.buid;
this.inp.value="";
if(this.selected_item){this.unselect_item(this.selected_item);
this.selected_item=null;
}IMO.ConvHistory.get().get_recent_message_suggestions(h,i,j);
},handle_buddy_click:function(g){this.inp.focus();
this.select_buddy(g.buddy);
},handle_message_click:function(h){this.inp.blur();
this.handle_search_box_blur(null,true);
var g=IMO.REUI.get_history_search_widget();
g.show_one_result(h.result);
},handle_adv_click:function(g){IMO.MouseManager.get().handled(g,"history-advanced");
IMO.REUI.get_history_search_widget().show();
},handle_btn_click:function(g){IMO.MouseManager.get().handled(g,"history-search-button");
this.handle_enter_press();
this.inp.blur();
this.handle_search_box_blur(null,true);
},destroy:function(){return;
}});
}());
(function(){var g=IMO.Utils;
var p=g.HTML;
var h=g.sprintf;
var E=IMO.Utils.TranslateDom;
var l=IMO.Utils.TranslateTxt;
var t=IMO.Constants;
var f=50;
var q=200;
var A=300;
var a=400;
var j=q+A+50;
var B=0;
var F=1;
var n=200;
var D=47;
var d=function(C){return C;
};
var y=function(G){var I=new Date(G*1000);
var H=I.getFullYear();
var J=I.getMonth()+1;
var C=I.getDate();
return J+"/"+C+"/"+H;
};
var w=function(C){var H=[C.message,C.timestamp,C.buid,C.sent,C.msgid];
var G={results:[H],uid:C.uid,proto:C.proto};
return G;
};
var m=function(H){var G=[];
var I;
var C=0;
if(H.uid){var J={};
J[H.uid+"#"+H.proto]={query:"dogs",uid:H.uid,proto:H.proto,results:H.results};
H=J;
}g.foreach(H,function(N,P){I=H[P].query;
var Q=H[P].results;
var M=P.split("#");
var L=Q.length;
for(var O=0;
O<L&&C<f;
O++){var K=Q[O];
G[C]={message:K[0],start_timestamp:K[1],end_timestamp:K[2],buid:K[3],sent:K[4],uid:M[0],pos:O,proto:M[1]};
C++;
}},this);
G.sort(function(L,K){if(L.end_timestamp===K.end_timestamp){return L.pos-K.pos;
}return K.end_timestamp-L.end_timestamp;
});
return{results:G,query:I};
};
var z=function(H){var G=[];
var I;
var C=0;
if(H.uid){var J={};
J[H.uid+"#"+H.proto]={query:"dogs",uid:H.uid,proto:H.proto,results:H.results};
H=J;
}g.foreach(H,function(N,P){I=H[P].query;
var Q=H[P].results;
var M=P.split("#");
var L=Q.length;
for(var O=0;
O<L&&C<f;
O++){var K=Q[O];
G[C]={message:K[0],timestamp:K[1],buid:K[2],sent:K[3],msgid:K[4],uid:M[0],pos:O,proto:M[1]};
C++;
}},this);
G.sort(function(L,K){if(L.end_timestamp===K.end_timestamp){return L.pos-K.pos;
}return K.end_timestamp-L.end_timestamp;
});
return{results:G,query:I};
};
var i=function(C,G,I){var H=IMO.Session.get().get_account("im",C,G);
return IMO.BuddyList.get().get_buddy(H,I);
};
var u=function(H){var C=H.length;
var I="";
for(var G=0;
G<C;
G++){if(H.charCodeAt(G)>=3){I+=H.charAt(G);
}}return I;
};
var v=function(K,H,G){K=u(K);
var I="me: ";
var C=H;
if(H instanceof IMO.MessageTarget){C=H.get_displaylias();
}C=d(C);
if(!G){if(H.gid||(!H.buid&&g.is_group_target(H))){var L=g.groups_split(K," ");
K=L[1];
var J=L[0];
I=J;
if(H instanceof IMO.SharedGroup){H=i(H.account.uid,H.account.proto,H.buid+J);
I=(H?H.get_displaylias():I)+": ";
}}else{I=C+": ";
}}return I+K;
};
var c=function(){};
Y.mix(c.prototype,{sort_results:function(G){var C=this;
this.cur_results_indices.sort(function(I,H){var K=C.cur_results[I][G];
var J=C.cur_results[H][G];
if(K===J){return 0;
}else{if(K<J){return -1;
}else{return 1;
}}});
},fill_table:function(){var H=this.cur_results.length;
var G;
for(G=0;
G<H;
G++){var C=this.cur_results_indices[G];
this.insert_result(G,this.cur_results[C]);
}for(G=H;
G<f;
G++){p.hide(this.results[G]);
}if(H===0){p.hide(this.title);
}else{p.show(this.title);
}},gen_init_index:function(){var C=[];
for(var G=0;
G<this.cur_results.length;
G++){C.push(G);
}this.cur_results_indices=C;
this.selected=null;
},handle_result_click:function(I){IMO.MouseManager.get().handled(I,"history-search-widget");
var G=Y.one(I.target);
var C=G.get("tagName").toLowerCase();
while(G&&(C!=="table")){switch(C){case"body":return;
case"div":var H=Y.Node.getDOMNode(G);
if(H.result){this.handle_result_select(H);
return;
}break;
default:break;
}G=G.get("parentNode");
if(G){C=G.get("tagName").toLowerCase();
}}}});
var e=function(C){this.dom=p.cdiv("results-browser",this.title=p.cdiv("title",IMO.REUI.Bar("superwide_grey sprite_superwide_grey_bar",{context:this},p.span({cls:"contact"},"Contact"),p.span({cls:"date"},"Date"),p.span({cls:"message"},"Message"))),this.no_results_text=p.span("No conversations to display"),this.results_container=p.cdiv("results-container"));
this.parent=C;
this.cur_results=[];
this.cur_results_indices=[];
this.results=[];
this.selected=null;
this.init_results();
p.on("click",this.handle_result_click,this.results_container,this);
};
Y.extend(e,c);
Y.mix(e.prototype,{show_messages:function(H,C){this.clear_results();
this.parent.win.set_title("Search Chat History");
var G="";
if(C){G=C.buid;
}IMO.ConvHistory.get().get_messages(IMO.Session.get().get_accounts(),H,G,-1,-1);
},on_get_messages:function(G){if(this.selected){p.remove_class(this.selected,"selected");
this.selected=null;
}var C=z(G.edata);
if(C.results.length===0){if(this.cur_results.length===0){this.handle_no_results();
}else{return;
}}else{p.hide(this.no_results_text);
}this.cur_results=C.results;
this.gen_init_index();
this.fill_table();
if(this.cur_results.length>0){this.handle_result_select(this.results[0]);
}},clear_results:function(){this.cur_results=[];
},init_results:function(){this.results=[];
var H,J,I;
for(H=0;
H<f;
H++){var G,C,K;
J=p.cdiv("result",G=p.div({cls:"contact"}),C=p.div({cls:"date"}),K=p.div({cls:"message"}));
I=(H%2===0)?"even":"odd";
p.add_class(G,I);
p.add_class(C,I);
p.add_class(K,I);
p.add_class(J,I);
p.hide(J.style);
J.contact=G;
J.date=C;
J.message=K;
this.results_container.appendChild(J);
this.results.push(J);
}p.hide(this.title);
},insert_result:function(K,G){var I=i(G.uid,G.proto,G.buid);
I=I||G.buid;
var H=y(G.timestamp);
var J=v(G.message,I,G.sent);
var C=I;
if(I instanceof IMO.MessageTarget){C=I.get_displaylias();
}C=d(C);
p.replace_content(this.results[K].contact,p(C));
p.replace_content(this.results[K].date,p(H));
p.replace_content(this.results[K].message,p(J));
this.results[K].result=G;
p.show(this.results[K]);
},handle_result_select:function(G){var C=G.result;
if(this.selected){p.remove_class(this.selected,"selected");
}this.selected=G;
p.add_class(this.selected,"selected");
this.parent.viewer.get_conversation(C.uid,C.proto,C.buid,C.msgid,C.timestamp);
},delete_selected:function(){var G=this.cur_buddy;
var I=this.cur_buddy.account;
var C=this.selected.result;
IMO.ConvHistory.get().delete_conversation(I.uid,I.proto,G.buid,C.timestamp);
var J=[];
for(var H=0;
H<this.cur_results.length;
H++){if(this.results[H]!==this.selected){J.push(this.cur_results[H]);
}}this.cur_results=J;
this.fill_table();
},delete_conversation:function(){this.delete_selected();
if(this.cur_results.length>0){this.handle_result_select(this.results[0]);
}else{this.handle_no_results();
}},handle_no_results:function(){if(this.nav){p.hide(this.nav);
}p.show(this.no_results_text);
this.parent.viewer.no_conversation();
}});
var k=function(C){this.parent=C;
this.dom=p.cdiv("preview-browser",this.title=p.cdiv("title",IMO.REUI.Bar("superwide_grey sprite_superwide_grey_bar",{context:this},p.span({cls:"date"},"Date"),p.span({cls:"preview"},"Conversation Preview"))),this.no_results_text=p.span("No conversations to display"),this.loading_text=p.span("loading..."),this.previews_container=p.cdiv("previews-container"),this.nav=p.cdiv("nav-container",this.prev=p.span({cls:"previous"},p.span({cls:"arrows"}," "),"Previous"),this.next=p.span({cls:"next"},"Next ",p.span({cls:"arrows"},""))));
this.results=[];
this.cur_results=[];
this.cur_results_indices=[];
this.cur_buddy=null;
this.init_results();
this.mode=F;
p.hide(this.no_results_text);
p.hide(this.loading_text);
p.on("click",this.handle_result_click,this.previews_container,this);
p.on("click",this.handle_previous_click,this.prev,this);
p.on("click",this.handle_next_click,this.next,this);
};
Y.extend(k,c);
Y.mix(k.prototype,{show_previews:function(C){this.display_loading();
if(C){if(this.cur_buddy&&this.cur_buddy.buid!==C.buid){this.clear_results();
}this.cur_buddy=C;
this.parent.win.set_title(C.get_displaylias());
}var G=this.cur_buddy.account;
IMO.ConvHistory.get().get_conversation_previews(G.uid,G.proto,this.cur_buddy.buid,-1,-1,f,true);
},handle_previous_click:function(){if(this.cur_results.length===0){return;
}var G=this.cur_buddy.account;
var H=-1;
var C=this.results[this.cur_results.length-1].result.start_timestamp-1;
IMO.ConvHistory.get().get_conversation_previews(G.uid,G.proto,this.cur_buddy.buid,H,C,f,true);
},handle_next_click:function(){if(this.cur_results.length===0){return;
}var G=this.cur_buddy.account;
var H=this.results[0].result.end_timestamp+1;
var C=-1;
IMO.ConvHistory.get().get_conversation_previews(G.uid,G.proto,this.cur_buddy.buid,H,C,f,false);
},init_results:function(){this.results=[];
var H,J,I;
for(H=0;
H<f;
H++){var G,C;
J=p.cdiv("result",G=p.div({cls:"date"}),C=p.div({cls:"message"}));
I=(H%2===0)?"even":"odd";
p.add_class(G,I);
p.add_class(C,I);
p.add_class(J,I);
p.hide(J);
J.date=G;
J.message=C;
this.previews_container.appendChild(J);
this.results.push(J);
}p.hide(this.title);
},insert_result:function(J,C){var H,I;
if(this.mode===F){H=y(C.start_timestamp);
}else{H=y(C.timestamp);
}var G=this.cur_buddy;
if(!(G instanceof IMO.MessageTarget)){G=G.buid;
}I=v(C.message,G,C.sent);
p.replace_content(this.results[J].date,p(H));
p.replace_content(this.results[J].message,p(I));
this.results[J].result=C;
p.remove_class(this.nav,"hidden");
p.show(this.results[J]);
},clear_results:function(){this.cur_results=[];
},on_get_previews:function(G){if(this.selected){p.remove_class(this.selected,"selected");
this.selected=null;
}this.not_loading();
p.show(this.nav);
this.mode=F;
var C=m(G.edata);
if(C.results.length===0){if(this.cur_results.length===0){this.handle_no_results();
}else{return;
}}else{p.hide(this.no_results_text);
}this.cur_results=C.results;
this.gen_init_index();
this.fill_table();
if(this.cur_results.length>0){this.handle_result_select(this.results[0]);
}},on_get_one_result:function(C){var I={edata:w(C)};
var G=i(C.uid,C.proto,C.buid);
var H=G?G.get_displaylias():C.buid;
this.cur_buddy=G?G:{buid:C.buid,account:IMO.Session.get().get_account(C.uid,C.proto)};
this.parent.win.set_title(H);
this.on_get_messages(I);
},on_get_messages:function(G){if(this.selected){p.remove_class(this.selected,"selected");
this.selected=null;
}this.not_loading();
p.hide(this.nav);
this.mode=B;
var C=z(G.edata);
if(C.results.length===0){this.handle_no_results();
}else{p.hide(this.no_results_text);
}this.cur_results=C.results;
this.gen_init_index();
this.fill_table();
if(this.cur_results.length>0){this.handle_result_select(this.results[0]);
}},handle_result_select:function(G){var C=G.result;
if(this.selected){p.remove_class(this.selected,"selected");
}this.selected=G;
p.add_class(this.selected,"selected");
if(this.mode===F){this.parent.viewer.get_conversation(C.uid,C.proto,C.buid,-1,C.start_timestamp,C.end_timestamp);
}else{this.parent.viewer.get_conversation(C.uid,C.proto,C.buid,C.msgid,C.timestamp);
}},do_search:function(H){this.display_loading();
var C=this.cur_buddy;
var G=C.account;
IMO.ConvHistory.get().get_messages([G],H,C.buid,-1,-1);
},delete_selected:function(){var G=this.cur_buddy;
var I=this.cur_buddy.account;
var C=this.selected.result;
if(this.mode===F){IMO.ConvHistory.get().delete_conversation(I.uid,I.proto,G.buid,C.start_timestamp,C.end_timestamp);
}else{IMO.ConvHistory.get().delete_conversation(I.uid,I.proto,G.buid,C.timestamp);
}var J=[];
for(var H=0;
H<this.cur_results.length;
H++){if(this.results[H]!==this.selected){J.push(this.cur_results[H]);
}}this.cur_results=J;
this.fill_table();
},delete_conversation:function(){this.delete_selected();
if(this.cur_results.length>0){this.handle_result_select(this.results[0]);
}else{this.handle_no_results();
}},handle_no_results:function(){p.hide(this.nav);
p.show(this.no_results_text);
this.parent.viewer.no_conversation();
},display_loading:function(){p.show(this.loading_text);
},not_loading:function(){p.hide(this.loading_text);
}});
var b=function(C){this.preview_browser=new k(C);
this.results_browser=new e(C);
this.dom=p.cdiv("browser",this.inner_dom=this.preview_browser.dom);
this.browsing_mode=F;
};
Y.mix(b.prototype,{set_width:function(C){p.css(this.dom,{width:h("%dpx",C)});
},enter_preview_mode:function(){if(this.browsing_mode!==F){this.dom.removeChild(this.dom.firstChild);
this.dom.appendChild(this.preview_browser.dom);
this.inner_dom=this.preview_browser.dom;
this.browsing_mode=F;
}},enter_search_mode:function(){if(this.browsing_mode!==B){this.dom.removeChild(this.dom.firstChild);
this.dom.appendChild(this.results_browser.dom);
this.inner_dom=this.results_browser.dom;
this.browsing_mode=B;
}},show_previews:function(C){this.enter_preview_mode();
this.preview_browser.show_previews(C);
},show_messages:function(G,C){this.enter_search_mode();
this.results_browser.show_messages(G,C);
},on_get_one_result:function(C){this.enter_preview_mode();
this.preview_browser.on_get_one_result(C);
},on_get_previews:function(C){this.enter_preview_mode();
this.preview_browser.on_get_previews(C);
},on_get_messages:function(C){this.enter_search_mode();
this.results_browser.on_get_messages(C);
}});
var s=function(C){this.parent=C;
this.convlog_widget=new IMO.REUI.ConvLog();
this.dom=p.cdiv("viewer",this.convmain=p.cdiv("convmain",this.no_conv1=p.span("No conversation selected"),this.no_conv2=p.span("No conversation selected.  You may consider enabling chat history in the preferences panel to see future conversations."),this.loading_text=p.span("loading..."),this.deleter=p.cdiv("delete",p.sprite("icn_delete"),p.span("Delete This Conversation")),this.convlog=p.cdiv("convlog",this.convlog_widget.dom)));
p.on("click",this.handle_delete_click,this.deleter,this);
p.hide(this.loading_text);
p.hide(this.no_conv1);
p.hide(this.no_conv2);
};
Y.mix(s.prototype,{get_conversation:function(G,I,J,H,K,C){IMO.ConvHistory.get().get_conversation(G,I,J,H,K,C);
},set_width:function(C){p.css(this.dom,{width:h("%dpx",C)});
},on_get_conversation:function(C){this.set_convlog(C.edata);
},no_conversation:function(){var C=IMO.Session.get().get_pref("impref","saveHistory");
this.clear_convlog();
if(C){p.show(this.no_conv1);
}else{p.show(this.no_conv2);
}p.hide(this.deleter);
},clear_convlog:function(){p.hide(this.no_conv1);
p.hide(this.no_conv2);
p.show(this.deleter);
this.convlog_widget.clear_messages();
},set_convlog:function(S){this.clear_convlog();
var K=S.uid;
var R=S.proto;
var ac=S.buddyid;
var T=i(K,R,ac);
var Q=ac.charAt(ac.length-1)===";";
var ae=IMO.Session.get().get_account("im",K,R);
this.account=ae;
var ah=ae.get_display_name();
var L=T?T.get_displaylias():ac;
var ab=S.results;
var X=ab.length;
var ad=null;
var U=null;
var Z=1;
var O={};
for(var V=0;
V<X;
V++){var N=ab[V];
var M=N[0];
var C=N[1];
var ag=N[2]?"me":"bk0_old";
var ai=N[2]?ah:L;
var G=N[3];
if(Q&&!N[2]){var P=g.groups_split(M," ");
M=P[1];
var H=P[0];
T=i(K,R,ac+H);
ai=T?T.get_displaylias():H;
var J=false;
if(U!==H){U=H;
Z=1-Z;
J=true;
}if(O[H]===undefined){O[H]=g.imohash(H)%20;
}var W="buddy"+O[H]+" bk"+Z;
if(J){W+=" spacing";
}ag=W;
}var aa=this.convlog_widget.add_im_line(C,ai,M,ag,true);
if(G){p.add_class(this.convlog_widget.dom.lastChild,"highlighted");
ad=this.convlog_widget.dom.lastChild;
}var af={msg:M,msg_dom:aa[0],uid:K,proto:R,history:true};
IMO.REUI.APITransformer.message_transformer.call(this,af);
}if(ad){var I=Y.one(ad).getXY()[1]-Y.one(this.convlog).getXY()[1];
this.convmain.scrollTop=I-3*ad.offsetHeight;
}},handle_delete_click:function(C){IMO.MouseManager.get().handled(C,"history-search-widget-delete");
var G=p.cdiv("history-search-delete",p.span({cls:"top"},"This will PERMANENTLY delete this conversation.  Are you sure you wish to continue?"));
this.del_history_conf=new IMO.REUI.ConfirmModalPopup("Delete Conversation?",G,[[E("Yes"),"blue"],[E("No"),"grey"]],this.handle_delete_history_confirm,this);
},handle_delete_history_confirm:function(C){Y.log("got button "+C);
if(C===0){this.handle_deleted_history();
}this.del_history_conf.destroy();
delete this.del_history_conf;
},handle_deleted_history:function(){this.clear_convlog();
this.parent.browser.preview_browser.delete_conversation();
}});
var r=function(C){this.parent=C;
this.dom=p.cdiv("input-controls",p.span({cls:"phrase-lbl"},"Search for:"),this.phrase_inp=p.input({cls:"phrase-inp",type:"text"}),this.btn=p.cdiv("search-button",{cls:"sprite_frm_search_dropdown",onclick:this.handle_btn_click,context:this}));
p.on("key",this.handle_enter,this.phrase_inp,"press:13",this);
};
Y.mix(r.prototype,{handle_enter:function(){if(this.phrase_inp.value.length>0){this.parent.browser.preview_browser.do_search(this.phrase_inp.value);
}else{this.parent.browser.preview_browser.show_previews();
}},handle_btn_click:function(){this.handle_enter();
}});
var x=function(C){this.parent=C;
this.dom=p.cdiv("resize",p.cdiv("sprite_icn_expand_vert"));
p.on("mousedown",this.handle_resize,this.dom,this);
};
var o=IMO.MoveNet.mouse_event_filter_creator(1);
Y.mix(x.prototype,{init_size:function(){Y.log(["init_size() height",this.parent.dom.offsetHeight,this.parent.input_controls.dom.offsetHeight]);
var C=this.parent.dom.offsetHeight-this.parent.input_controls.dom.offsetHeight-1;
p.css(this.parent.view_dom,{height:C+"px"});
p.css(this.parent.viewer.dom,{height:C+"px"});
p.css(this.parent.resize.dom,{height:C+"px"});
var G=p.get_size(this.parent.browser.dom)[0];
this.resize_widget(G);
},handle_resize:function(I){g.clear_selection();
var G=o(I);
switch(o(I)){case"smartdown":var H=p.get_rect(this.parent.browser.dom);
this.fix_x=H.x+H.w-I.clientX;
g.log("fix_x: %d",this.fix_x);
IMO.MoveNet.attach_move_net(this.handle_resize,this);
break;
case"smartmove":var C=I.clientX+this.fix_x;
g.log("smartmove %d %d",I.clientX,C);
this.resize_widget(C);
if(C===q){p.css(this.dom,{cursor:"e-resize"});
}else{p.css(this.dom,{cursor:"w-resize"});
}break;
case"smartup":IMO.MoveNet.detach_move_net(this.handle_resize,this);
break;
default:break;
}},resize_widget:function(C){C=g.cap(C,q,this.dom.parentNode.offsetWidth-A-this.dom.offsetWidth-2);
this.parent.browser.set_width(C);
var G=this.dom.parentNode.offsetWidth-C-this.dom.offsetWidth-8;
this.parent.viewer.set_width(G);
}});
IMO.REUI.HistorySearchWidget=function(){this.input_controls=new r(this);
this.browser=new b(this);
this.resize=new x(this);
this.viewer=new s(this);
this.dom=p.cdiv("history-search-widget",this.input_controls.dom,this.view_dom=p.cdiv("bottom",this.browser.dom,this.resize.dom,this.viewer.dom),{onclick:function(C){IMO.MouseManager.get().handled(C,"convhistory-panel");
this.win.set_focus();
},context:this});
this.win=new IMO.WM.Window();
this.win.set_content(this.dom);
this.win.size.min[0]=j;
this.win.size.min[1]=a;
this.on(this.win);
this.on(IMO.ConvHistory.get());
this.win.set_title("Search chat history");
this.win.set_icon("icn_chathistory_clock");
this.show();
};
Y.mix(IMO.REUI.HistorySearchWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.HistorySearchWidget.prototype,{show_one_result:function(C){this.browser.on_get_one_result(C);
},show_previews:function(C){this.browser.show_previews(C);
},show_messages:function(G,C){this.browser.show_messages(G,C);
},on_get_previews:function(C){this.show();
this.browser.on_get_previews(C);
},on_get_messages:function(C){this.show();
this.browser.on_get_messages(C);
},on_get_conversation:function(C){this.show();
this.viewer.on_get_conversation(C);
},show:function(){if(this.is_open){this.win.set_focus();
return;
}this.is_open=true;
this.win.open();
this.win.set_focus();
this.resize.init_size();
this.input_controls.phrase_inp.focus();
},on_close_request:function(C){this.win.close();
},on_close:function(C){this.is_open=false;
this.viewer.clear_convlog();
this.browser.preview_browser.clear_results();
},on_focus_change:function(C,G){if(G===true){Y.log("set focus convhistory");
}},on_after_wm_switch:function(){this.resize.init_size();
},on_resize:function(){this.resize.init_size();
},destroy:function(){g.log("historypanel destroyed");
}});
IMO.REUI.get_history_search_widget=function(){if(!IMO.REUI.history_search_widget){IMO.REUI.history_search_widget=new IMO.REUI.HistorySearchWidget();
}return IMO.REUI.history_search_widget;
};
}());
(function(){var a=IMO.Utils;
var g=a.HTML;
var h=IMO.Utils.TranslateDom;
var f=IMO.Utils.TranslateTxt;
var d=IMO.REUI.IconPanel={};
var e=["jpg","gif","png","jpeg","bmp"];
var b=["upload","submit","cancel"];
var i=function(n,k,m,l,j,o){this.imo_service=m;
this.imo_function=l;
this.context=j;
this.callback=o;
this.build_dom(k);
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[300,NaN]);
this.popup.set_title(f(n));
this.popup.prepare();
this.on(IMO.AccountManager.get());
};
Y.mix(i.prototype,IMO.EventTarget);
Y.mix(i.prototype,{on_set_account_icon:function(j){this.set_upload_widget_image(j);
},show:function(k,j){this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.canceled}},bottom:true,context:this});
this.imo_data=k;
this.current_icon=j;
this.set_upload_widget_image();
this.popup.show();
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.upForm.reset();
this.popup.hide();
},canceled:function(j){IMO.MouseManager.get().handled(j,"iconupload-cancel-button");
this.hide();
},upload_click:function(n){IMO.MouseManager.get().handled(n,"iconupload-upload-button");
n.preventDefault();
var k=this.picField.value;
var j=k.lastIndexOf(".");
if(j===-1){IMO.NM.add_notification(g.div(h("File type was not recognized - please try another file!")),IMO.REUI.Notification.types.error);
this.hide();
return;
}j+=1;
var m=k.substring(j,k.length).toLowerCase();
for(var l=0;
l<e.length;
l++){if(m===e[l]){break;
}}if(l===e.length){IMO.NM.add_notification(g.div(h("Sorry, we don't support that type of file - please try another file!")),IMO.REUI.Notification.types.error);
this.hide();
return;
}this.fileNameField.value=k;
Y.log("uploading picture: "+this.fileNameField.value);
IMO.UploadManager.get().upload(this.imo_service,this.imo_function,this.imo_data,this.upForm,this,this.initial_upload_complete);
},initial_upload_complete:function(j){this.hide();
this.callback.call(this.context,j);
},try_to_display_selected_image:function(){var k;
try{k=this.picField.files[0].getAsDataURL();
}catch(j){return;
}this.set_upload_widget_image(k);
},set_upload_widget_image:function(k){var j=this;
k=a.dfl(k,this.current_icon);
var l=new Image();
l.onload=function(){var r=l.width;
var n=l.height;
var q={"padding-top":"0px","padding-bottom":"0px"};
g.remove_class(j.current_icon_img,"wide-img");
g.remove_class(j.current_icon_img,"tall-img");
g.css(j.current_icon_img,q);
if(n>r){g.add_class(j.current_icon_img,"tall-img");
}else{var m=IMO.Constants.reui_account_icon_upload_container_size;
var o=IMO.Constants.reui_account_icon_upload_container_size;
var s=m*n/r;
g.add_class(j.current_icon_img,"wide-img");
var t=Math.floor((o-s)/2);
var p={paddingTop:t,paddingBottom:t};
g.css(j.current_icon_img,p);
}j.current_icon_img.src=k;
};
l.src=k;
},click_on_img:function(j){IMO.MouseManager.get().handled(j,"acciconupload-img");
this.picField.click();
},build_dom:function(k){var j;
this.dom=g.cdiv("account-icon-upload-widget",g.div({cls:"account-icon-upload-text"},h(k)),g.div({cls:"current-icon-container"},this.current_icon_img=g.img({cls:"account-icon-img",src:this.current_icon,onclick:this.click_on_img,context:this})),this.upForm=g.form({enctype:"multipart/form-data"},this.picField=g.input({cls:"file-select-form",type:"file",name:"file",value:"",context:this,onchange:function(){this.upload_button.disabled=false;
this.try_to_display_selected_image(this);
}}),this.fileNameField=g.input({type:"hidden",name:"filename",value:""})),j=g.div({cls:"account-icon-controls"},IMO.REUI.Button("grey",h("Cancel"),{onclick:this.canceled,context:this}),this.upload_button=IMO.REUI.Button("blue",h("Upload icon"),{onclick:this.upload_click,context:this}),g.cdiv("clear")));
g.css(j,{width:IMO.REUI.Button.sizes[0]+IMO.REUI.Button.sizes[1]+20});
}});
var c={};
d.show=function(o,k,l,n,m,q,j,p){if(c[o]===undefined){c[o]=new i(o,k,n,m,j,p);
}c[o].show(q,l);
};
}());
(function(){var c=IMO.Utils;
var d=c.HTML;
var a=740;
var b=500;
IMO.REUI.IFramePopup=function(j,i,f){f=c.dfl(f,[a,b]);
var g=f[0];
var e=f[1];
this.popup=new IMO.ModalPopup(this);
var h=document.createElement("IFRAME");
h.setAttribute("src",j);
h.setAttribute("width",g+"px");
h.setAttribute("height",e+"px");
h.setAttribute("style","background-color: white; border: 0");
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(h,[g,e]);
this.popup.set_title(i);
};
Y.mix(IMO.REUI.IFramePopup.prototype,{show:function(){this.popup.prepare();
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:function(){this.close();
}}},bottom:true,context:this});
this.popup.show();
},close:function(){this.hide();
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.popup.hide();
}});
}());
(function(){var a=IMO.Utils;
var d=function(f){var e=new Image();
e.src=f;
return e;
};
var c=d("assets/loading_54.gif");
var b=d("assets/icn_no_picture.png");
IMO.REUI.ImageLoader=function(i,h,j,f,g,e){this.img_dom=i;
this.url=h;
this.attempts=a.dfl(j,20);
this.stretch=a.dfl(f,true);
this.resize=a.dfl(g,true);
this.center=a.dfl(e,true);
this.cancelled=false;
this.start_loading_image();
this.display_image(c);
};
Y.mix(IMO.REUI.ImageLoader.prototype,{start_loading_image:function(){this.image=new Image();
var e=this;
this.image.onload=function(){e.onload();
};
this.image.onerror=function(){e.onerror();
};
this.image.src=this.url;
},display_image:function(e){if(this.resize){IMO.REUI.resize_image(this.img_dom,e.width,e.height,this.stretch);
}if(this.center){IMO.REUI.center_dom_in_parent(this.img_dom);
}this.img_dom.src=e.src;
},onload:function(){if(this.cancelled){return;
}this.display_image(this.image);
},onerror:function(){if(this.cancelled){return;
}if(!this.attempts){this.display_image(b);
return;
}--this.attempts;
Y.later(1000,this,this.start_loading_image);
},cancel:function(){this.cancelled=true;
}});
}());
(function(){var d=IMO.Utils;
var h=d.HTML;
var c=IMO.Constants;
var i=IMO.Utils.TranslateDom;
var f=IMO.Utils.TranslateTxt;
var g=IMO.REUI.Wizard={};
var b=function(l,m,j){var n=IMO.REUI.Button("blue",{context:m,onclick:j},i(l));
var k=IMO.REUI.Button("grey",i(l));
return new IMO.REUI.EDButton(n,k);
};
var a=function(){this.popup=new IMO.ModalPopup(this);
};
Y.mix(a.prototype,IMO.EventTarget);
Y.mix(a.prototype,{reset:function(){this.current_step=-1;
this.active_widget=null;
this.move_to_next_step();
},show:function(){this.build_dom();
this.steps=[this.info,this.picture];
this.popup.set_content(this.dom,[600,600]);
this.popup.prepare();
this.popup.show();
IMO.ResizeManager.register(this.on_resize,this);
this.reset();
this.shortcuts=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide}},bottom:true,context:this});
},hide:function(){this.close_step();
delete this.info;
delete this.picture;
delete this.steps;
this.popup.hide();
IMO.KeyboardManager.get().pop(this.shortcuts);
IMO.ResizeManager.unregister(this.on_resize,this);
},build_dom:function(){this.account=IMO.Session.get().get_imo_account();
this.profile_core=this.account.profile;
this.info=new IMO.REUI.ImoProfileWidget(this.profile_core);
this.picture=new IMO.REUI.ImoProfilePictureUploadWidget(this.profile_core);
this.skip_button=b("Skip",this,this.on_skip);
this.cancel_button=b("Cancel",this,this.on_cancel);
this.next_button=b("Next",this,this.on_next);
this.dom=h.cdiv("imo_wizard",h.cdiv("wizard_title",this.title_dom=h.div()),h.cdiv("wizard_content",this.content_dom=h.div()),h.cdiv("wizard_control",this.control_dom=h.div(h.cdiv("control_buttons",h.cdiv("control_button",this.skip_button.dom),h.cdiv("control_button",this.cancel_button.dom),h.cdiv("control_button",this.next_button.dom),h.cdiv("clear")),h.cdiv("clear"))));
},on_skip:function(){this.move_to_next_step();
},on_cancel:function(){this.hide();
},on_next:function(){this.active_widget.submit();
},close_step:function(){if(this.active_widget){this.active_widget.close();
this.unsubscribe(this.active_widget);
this.active_widget=null;
}h.replace_content(this.content_dom,h.div());
this.on_resize(null);
},open_step:function(){if(this.active_widget){this.on(this.active_widget);
h.replace_content(this.content_dom,this.active_widget.dom);
this.active_widget.open();
}var j=(this.current_step===this.steps.length-1);
this.skip_button.set_visible(!j);
this.on_resize(this.active_widget);
},move_to_next_step:function(){this.close_step();
this.current_step+=1;
this.active_widget=this.steps[this.current_step];
if(this.current_step<this.steps.length){this.open_step();
}else{this.hide();
}},on_resize:function(j){this.popup.adjust_size();
},on_change_validity:function(k,j){if(k===this.active_widget){this.next_button.set_enabled(j);
}},on_submit_done:function(k,j){if(k===this.active_widget){if(j){this.move_to_next_step();
}}}});
var e=null;
g.show=function(){if(e===null){e=new a();
}e.show();
};
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.REUI.InfoBox=function(f,c,e){this.context=c;
this.hide_callback=e;
var d=b.cdiv("message-content extended",f);
this.infobox=b.cdiv("message-preview",d,b.cdiv("bg",{cls:"sprite_tooltip2_1"}),b.cdiv("bg",{cls:"sprite_tooltip2_2"}),b.cdiv("bg",{cls:"sprite_tooltip2_3"}),b.cdiv("bg",{cls:"sprite_tooltip2_4"}),b.cdiv("bg",{cls:"sprite_tooltip2_6"}),b.cdiv("bg",{cls:"sprite_tooltip2_7"}),b.cdiv("bg",{cls:"sprite_tooltip2_8"}),b.cdiv("bg",{cls:"sprite_tooltip2_9"}),this.left_arrow=b.cdiv("tooltip-arrow",{cls:"sprite_tooltip_left_arrow"}),this.right_arrow=b.cdiv("tooltip-arrow",{cls:"sprite_tooltip_right_arrow"}),this.left_close=b.cdiv("n_close sprite_icn_close",{cls:"close_left"},{onclick:this.hide,context:this}),this.right_close=b.cdiv("n_close sprite_icn_close",{cls:"close_right"},{onclick:this.hide,context:this}),{onclick:function(g){this.hide(g,true);
},context:this});
b.chide(this.left_close);
b.chide(this.right_close);
b.chide(this.left_arrow);
b.chide(this.right_arrow);
b.chide(this.infobox);
};
Y.mix(IMO.REUI.InfoBox.prototype,{show:function(h){var j=12;
var d=22;
var f=Y.DOM.getXY(h);
var l=b.get_size(h);
var n=[b.dom("imo").clientWidth,b.dom("imo").clientHeight];
var c;
if(f[0]>n[0]-f[0]+l[0]){c=true;
}else{c=false;
}b.dom("imo").appendChild(this.infobox);
b.cshow(this.infobox);
var e=[this.infobox.clientWidth,this.infobox.clientHeight];
var k=f[1]+(l[1]-e[1])/2;
if(k+e[1]>n[1]){k=n[1]-e[1];
}if(k<0){k=0;
}var m=f[1]-k+(l[1]-d)/2;
Y.log([f,k,l,d]);
if(m<0){m=0;
}if(m+d>e[1]){m=e[1]-d;
}if(c){var g=n[0]-f[0]+j;
b.css(this.infobox,{top:k+"px",right:g+"px",z_index:IMO.Constants.reui_infobox_zindex});
b.css(this.right_arrow,{position:"absolute",top:m+"px",right:(-j)+"px",z_index:IMO.Constants.reui_infobox_zindex+1});
b.cshow(this.right_arrow);
b.cshow(this.left_close);
}else{var i=f[0]+l[0]+j;
b.css(this.infobox,{top:k+"px",left:i+"px",z_index:IMO.Constants.reui_infobox_zindex});
b.css(this.left_arrow,{position:"absolute",top:m+"px",left:(-j)+"px",z_index:IMO.Constants.reui_infobox_zindex+1});
b.cshow(this.left_arrow);
b.cshow(this.right_close);
}},hide:function(c){b.chide(this.infobox);
if(this.hide_callback){this.hide_callback.apply(this.context,a.args(arguments,0));
}}});
}());
(function(){var c=IMO.Utils;
var f=c.HTML;
var e=c.sprintf;
var d=IMO.Utils.TranslateDom;
var g=IMO.Utils.TranslateTxt;
IMO.REUI.KeyboardHelpWidget={};
var a=[{title:"Conversation",shortcuts:[{comb:["esc"],text:d("Close conversation")},{comb:["tab"],text:d("Next conversation")},{comb:["shift","tab"],text:d("Previous conversation")},{comb:["ctrl","y"],text:d("Organize conversation windows")},{comb:["ctrl","l"],text:d("Clear conversation text")}]},{title:"Account login",shortcuts:[{comb:["ctrl","a"],text:d("Display account login")},{comb:["esc"],text:d("Close login dialog")},{comb:["enter"],text:d("Login")}]},{title:"Buddy list",shortcuts:[{comb:[["ctrl","s"],["/"]],text:"Search buddies"}]},{title:"Preferences",shortcuts:[{comb:["esc"],text:d("Cancel changes")},{comb:["enter"],text:d("Save changes")}]}];
var b=function(){var i;
this.dom=f.cdiv("keyboard-shortcuts",i=f.table());
var j=function(l,k){c.foreach(k,function(n,m){if(m!==0){l.appendChild(f.span("+"));
}if(n.length>1){n=e("<%s>",n);
}l.appendChild(f.span({cls:"kb-comb-el"},n));
});
};
c.foreach(a,function(k){i.appendChild(f.tr(f.th(),f.th({cls:"section-title"},k.title)));
c.foreach(k.shortcuts,function(l){var n=f.tr();
var m=f.td({cls:"kb-comb"});
if(Y.Array.test(l.comb[0])===0){j(m,l.comb);
}else{c.foreach(l.comb,function(p,o){if(o!==0){m.appendChild(f.span("or"));
}j(m,p);
});
}m.appendChild(f(":"));
n.appendChild(m);
n.appendChild(f.td({cls:"kb-expl"},l.text));
i.appendChild(n);
});
});
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[400,500]);
this.popup.prepare();
};
Y.mix(b.prototype,{show:function(){this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide}},bottom:true,context:this});
this.popup.show();
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.popup.hide();
}});
var h=null;
IMO.REUI.KeyboardHelpWidget.show=function(){if(h===null){h=new b();
}h.show();
};
}());
(function(){var c=IMO.Utils;
var e=IMO.Utils.HTML;
var d=IMO.Utils.TranslateDom;
var g=IMO.Utils.TranslateTxt;
var h=IMO.Constants;
var b=["en-US"];
var a=2,f=5;
IMO.REUI.LanguageButton=function(j,i,k){this.context=j;
this.selected=k;
this.lang_code=i;
this.build_dom();
};
Y.mix(IMO.REUI.LanguageButton.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.LanguageButton.prototype,{build_dom:function(){if(IMO.Translate.language.data[this.lang_code]){this.lang_name=IMO.Translate.language.data[this.lang_code].name;
}else{this.lang_name="English (US)";
}this.text=e.a(this.lang_name,{context:this,onclick:function(i){i.preventDefault();
this.context.select_language(this.lang_code);
}});
this.dom=(this.selected?e.cspan("button-selected",this.lang_name):e.cspan("button-normal",this.text));
}});
IMO.REUI.LanguageSelector=function(){this.suggested=[];
this.build_dom();
this.on(IMO.Session.get());
this.load_languages();
};
Y.mix(IMO.REUI.LanguageSelector.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.LanguageSelector.prototype,{build_dom:function(){this.buttons=[];
this.notified={};
this.list=[];
this.dropdown=e.select("dropdown",{id:"lang_dropdown",cls:"dropdown",context:this,onchange:this.dropdown_select,onmousedown:function(){if(Y.UA.ie>0){e.dom("lang_dropdown").style.width="auto";
}},onblur:function(){e.dom("lang_dropdown").style.width="20px";
}});
this.dom=e.cspan("language_selector");
e.hide(this.dom);
},append_button:function(k,j){if(!k){return;
}var i=new IMO.REUI.LanguageButton(this,k,(j===true));
this.dom.appendChild(i.dom);
this.buttons.push(i);
},load_languages:function(){IMO.Translate.get_languages(this,this.get_suggested);
},get_suggested:function(){IMO.Translate.suggested_languages(this,this.update_suggested,a);
},update_suggested:function(i){this.suggested=i;
this.selected=this.get_pref_lang();
this.prepare_list();
this.select_language(this.selected?this.selected:this.list[0]);
},prepare_list:function(){this.list=[].concat(b);
if(this.selected&&c.array_find(b,this.selected)<0){this.list.push(this.selected);
}var i=c.array_difference(this.suggested,this.list);
this.list=this.list.concat(i);
},push_to_list:function(i){var j=c.array_find(this.list,i);
if(j!==-1){this.list.splice(j,1);
}if(this.list.length<f){this.list.unshift(i);
}},update_dom:function(){e.empty(this.dom);
this.buttons=[];
this.prepare_list();
c.foreach(this.list,function(i){if(this.buttons.length<a){this.append_button(i,i===this.selected);
}},this);
this.dom.appendChild(this.dropdown);
this.update_dropdown();
e.show(this.dom);
},update_dropdown:function(){e.empty(this.dropdown);
c.foreach(IMO.Translate.language.list,function(m){if(IMO.Translate.language.data[m]){var j=IMO.Translate.language.data[m].name;
var l=IMO.Translate.language.data[m].complete;
var k={value:m};
var i=j+" - "+Math.round(l)+"%";
this.dropdown.appendChild(e.option(k,i));
}},this);
},get_pref_lang:function(){return IMO.Session.get().get_pref("impref","LanguageSelected");
},set_pref_lang:function(i){IMO.Session.get().set_pref("impref","LanguageSelected",i);
},on_recv_pref:function(j,i,k){if(j==="impref"&&i==="LanguageSelected"){this.select(k);
}},on_set_prefs:function(i){c.foreach(i,function(j){if(j.pref==="LanguageSelected"&&j.kind==="impref"){this.select(j.value);
}},this);
},select_language:function(i){if(!i){return;
}this.set_pref_lang(i);
},select:function(j){if(!j){return;
}var i=document.getElementsByTagName("html")[0];
e.remove_class(i,"lang_"+IMO.Translate.language.to);
e.add_class(i,"lang_"+j);
IMO.Translate.language.to=j;
IMO.Translate.get_strings(IMO.Translate.Platform.WEB);
this.suggested.unshift(this.selected);
this.selected=j;
this.update_dom();
this.ask_to_translate();
},dropdown_select:function(){var j=this.dropdown.selectedIndex;
var i=this.dropdown.options[j].value;
if(i!==IMO.Translate.language.to){this.select_language(i);
e.dom("lang_dropdown").style.width="20px";
}},ask_to_translate:function(){var m=IMO.Translate.language.to;
var o=IMO.Translate.language.from;
if(m===o){return;
}if(!IMO.Translate.language.data[m]){return;
}var j=IMO.Translate.language.data[m].orig;
var k=IMO.Translate.language.data[m].complete;
if(k===100){return;
}this.notified[m]=true;
var i=e.a(d("Help translate!"),{target:"about:blank",href:"/translate?lang_code="+m});
var n={LANGUAGE:j,PERCENT:parseInt(k,10),LINK:i};
var l=(k<5?d("[LANGUAGE] is not translated at all! [LINK]",n):d("[LANGUAGE] is only [PERCENT]% translated. [LINK]",n));
IMO.NM.add_notification(l,IMO.REUI.Notification.types.info,{on_time:30*1000});
}});
})();
(function(){var a=IMO.Utils;
var d=IMO.Utils.sprintf;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
var f=IMO.Constants;
IMO.REUI.LinkTooltipManager=function(j,i,g){this.cls=g;
IMO.REUI.LinkTooltipManager.superclass.constructor.call(this,j);
var h=c.cdiv("message-content",b(i));
this.tt_content=c.cdiv("message-preview link_hover",h,c.cdiv("bg",{cls:"sprite_tooltip2_1"}),c.cdiv("bg",{cls:"sprite_tooltip2_2"}),c.cdiv("bg",{cls:"sprite_tooltip2_3"}),c.cdiv("bg",{cls:"sprite_tooltip2_4"}),c.cdiv("bg",{cls:"sprite_tooltip2_6"}),c.cdiv("bg",{cls:"sprite_tooltip2_7"}),c.cdiv("bg",{cls:"sprite_tooltip2_8"}),c.cdiv("bg",{cls:"sprite_tooltip2_9"}));
};
Y.extend(IMO.REUI.LinkTooltipManager,IMO.REUI.TooltipManager);
Y.mix(IMO.REUI.LinkTooltipManager.prototype,{tooltip_arrow_sprite:"tooltip_left_arrow",is_an_item:function(g){return Y.DOM.hasClass(g,this.cls);
},handle_hover:function(g){this.tooltip.set_content(this.tt_content);
},handle_tooltip_mousedown:function(){return true;
},handle_position_tt:function(j,g,k,i,h){return{arr_pos:{top:25+"px",left:"-11px"},tt_pos:{top:(j[1]-25)+"px",left:(j[0]+g[0]+10)+"px"}};
}},true);
}());
(function(){var e=IMO.Constants;
var a=IMO.Utils;
var d=IMO.Utils.HTML;
var c=IMO.Utils.sprintf;
var b=IMO.Utils.TranslateDom;
IMO.REUI.resize_image=function(k,p,i,f){if(f===undefined){f=true;
}var g=k.parentNode.offsetWidth;
var q=k.parentNode.offsetHeight;
var n=g/p;
var m=q/i;
var j=Math.min(n,m);
var o=p;
var l=i;
if(f||j<1){o*=j;
l*=j;
}k.style.height=l+"px";
k.style.width=o+"px";
};
IMO.REUI.center_dom_in_parent=function(j){var g=j.offsetWidth;
var m=j.offsetHeight;
var o=j.parentNode.offsetWidth;
var l=j.parentNode.offsetHeight;
var p=o-g;
var i=p/2;
var h=p-i;
var n=l-m;
var f=n/2;
var k=n-f;
j.style.marginLeft=i+"px";
j.style.marginRight=h+"px";
j.style.marginTop=f+"px";
j.style.marginBottom=k+"px";
};
IMO.REUI.header_body_footer_widget=function(i,g,h,f){f=f?f+"_":"";
return d.cdiv(f+"header_body_footer",d.cdiv("header",i),d.cdiv("body",g),d.cdiv("footer",h));
};
IMO.REUI.PopDownWidget=function(f,h,g){this.dom=d.select(f);
this.choices=h;
this.opt_doms=[];
a.foreach(h,function(k,l){var j=d.option({value:l},k);
if(k===g){j.selected=true;
}this.opt_doms.push(j);
this.dom.appendChild(j);
},this);
};
Y.mix(IMO.REUI.PopDownWidget.prototype,{value:function(){return this.choices[this.dom.value];
},set_value:function(f){a.foreach(this.opt_doms,function(h,g){if(this.choices[g]===f){h.selected=true;
}},this);
}});
IMO.REUI.EDButton=function(i,f,g,h){this.enable_dom=i;
this.disable_dom=f;
this.dom=d.div();
this.enabled=(g===undefined)||g;
this.visible=(h===undefined)||h;
this.set_enabled(this.enabled);
this.set_visible(this.visible);
this.update_dom();
};
Y.mix(IMO.REUI.EDButton.prototype,{update_dom:function(){d.replace_content(this.dom,this.enabled?this.enable_dom:this.disable_dom);
if(!this.visible){d.chide(this.dom);
}else{d.cshow(this.dom);
}},set_enabled:function(f){this.enabled=f;
this.update_dom();
},set_visible:function(f){this.visible=f;
this.update_dom();
},destroy:function(){d.destroy(this.enable_dom);
d.destroy(this.disable_dom);
d.destroy(this.dom);
delete this.enable_dom;
delete this.disable_dom;
delete this.dom;
}});
IMO.REUI.make_EDButton=function(h,g,f,i){return new IMO.REUI.EDButton(h,g,f,i);
};
IMO.REUI.DButton=function(h,f){var i=IMO.REUI.Button("blue",{context:f.context,onclick:f.onclick},b(h));
var g=IMO.REUI.Button("grey",b(h));
return new IMO.REUI.EDButton(i,g);
};
IMO.REUI.VKHover=function(){this.vk_hover=d.div({id:"vk_help_hover",onmouseover:this.stop_timer,onmouseleave:this.hide,context:this},"     ID  .      ",d.a({href:"http://vk.com/settings",target:"_blank"},"http://vk.com/settings"),". ID    id135551782.");
this.dom=d.div({id:"vk_help"},d.sprite("icn_question",{onmouseover:this.show,onmouseleave:this.start_timer,context:this}),this.vk_hover);
};
Y.mix(IMO.REUI.VKHover.prototype,{show:function(f){d.show(this.vk_hover,"block");
},hide:function(f){d.hide(this.vk_hover);
},start_timer:function(f){this.timer=Y.later(200,this,this.hide);
},stop_timer:function(f){if(this.timer){this.timer.cancel();
this.timer=null;
}}});
IMO.REUI.create_oauth_button=function(i,l,f){var j;
var n;
if(i===IMO.Constants.PROTO_GTALK){var g="sprite_google_sign_in_press";
var h="sprite_google_sign_in_hover";
var k="sprite_google_sign_in_base";
j=d.a({href:"#",id:"oauth_login_btn_inner",onclick:l,context:f,onmousedown:function(){d.mex_class(n,g,[h,k]);
},onmouseover:function(){d.mex_class(n,h,[k,g]);
},onmouseout:function(){d.mex_class(n,k,[h,g]);
},onmouseup:function(){d.mex_class(n,k,[h,g]);
}},n=d.sprite("google_sign_in_base"));
}else{if(i===IMO.Constants.PROTO_NEWFACEBOOK){j=d.a({href:"#",id:"oauth_login_btn_inner",onclick:l,context:f},n=d.sprite("fb_login_button_large"));
}else{var o="/images/logo_google_light.png";
var m="Sign in to";
if(i===IMO.Constants.PROTO_YAHOO){o="/images/logo_yahoo_light.png";
}else{if(i===IMO.Constants.PROTO_MSN){o="/images/logo_msn_light.png";
}}j=d.a({href:"#",cls:"btn_norm "+i,id:"oauth_login_btn_inner",onclick:l,context:f},b(m),d.img({src:o,align:"middle"}));
}}return j;
};
Y.mix(IMO.REUI.prototype,{clear_splash:function(){d.empty(this.imo);
d.set_class(this.imo,"");
},hide_main_ui:function(){d.hide(d.dom("header"));
d.hide(d.dom("body"));
d.hide(d.dom("footer"));
if(d.dom("desktop")){d.hide(d.dom("desktop"));
}if(d.dom("window_container")){d.hide(d.dom("window_container"));
}},show_main_ui:function(){d.show(d.dom("header"));
d.show(d.dom("body"));
d.show(d.dom("footer"));
if(d.dom("desktop")){d.show(d.dom("desktop"));
}if(d.dom("window_container")){d.show(d.dom("window_container"));
}},request_imo_signup_window:function(g,f){if(IMO.Session.get().get_imo_account()){IMO.NM.add_notification(b("You are already signed in with an imo account. Please Sign Out All first."),IMO.REUI.Notification.types.error,{momentary:false});
return;
}this.build_main_ui2();
this.hide_main_ui();
IMO.ANNOUNCEMENTS.show(true,g,f);
},show_imo_signup:function(i,f,g){if(IMO.Session.get().get_imo_account()){IMO.NM.add_notification(b("You are already signed in with an imo account. Please Sign Out All first."),IMO.REUI.Notification.types.error,{momentary:false});
return;
}if(!d.dom("header")){this.build_main_ui2();
}this.hide_main_ui();
var h=IMO.REUI.Signup.show(f,g);
d.dom("imo").appendChild(h.dom);
h.set_invite_id(i);
},build_chat_window:function(j){IMO.FlashWidget.init();
IMO.AVManager.av_chat_only=true;
var i="fake";
var h=IMO.Session.get().add("im","fake","fake");
var f=h.get_buddy(i,true);
var l=f.get_im_conversation();
var g=new IMO.AVConv(h,f,l);
var k=new IMO.REUI.AVWidget(g,l);
k.no_wm_mode=true;
this.imo.appendChild(k.dom);
k.unprotect();
if(j.av){g.initiate_from_url(j.av);
}else{if(j.achat){g.initiate_anon_chat(j.achat);
}}IMO.ResizeManager.register(k.adjust_flash_placement,k);
},build_simple_chat:function(){this.clear_splash();
this.build_chat_window({achat:IMO.AVConv.AUDIO_CHAT});
this.set_state("av_chat");
},build_main_ui:function(){IMO.H5=new IMO.WebkitNotifications();
IMO.NM=new IMO.REUI.Notification.Manager();
IMO.ANNOUNCEMENTS=new IMO.REUI.Announcements();
IMO.BIP=new IMO.REUI.BuddyIconPriorityManager();
IMO.BIP.set_download_manager(IMO.BuddyIconDownloader.get());
IMO.BuddyIconDownloader.get().priority_manager=IMO.BIP;
this.main.header=(new IMO.REUI.Header()).dom;
this.main.footer=IMO.REUI.Footer();
this.main.body=IMO.REUI.Body();
},build_thin_ui:function(){IMO.H5=new IMO.WebkitNotifications();
IMO.NM=new IMO.REUI.Notification.Manager();
IMO.BIP=new IMO.REUI.BuddyIconPriorityManager();
IMO.BIP.set_download_manager(IMO.BuddyIconDownloader.get());
IMO.BuddyIconDownloader.get().priority_manager=IMO.BIP;
this.main.header=IMO.REUI.ThinUIHeader();
this.main.footer=d.div({},d(""));
this.main.body=IMO.REUI.ThinUI();
},build_main_ui2:function(){var f=false;
if(this.query.hasOwnProperty("thinui")){f=true;
}if(this.main_flag){return;
}this.main_flag=true;
this.clear_splash();
this.main.header.appendChild(IMO.NM.dom);
this.imo.appendChild(this.main.body);
this.imo.appendChild(this.main.footer);
this.imo.appendChild(this.main.header);
IMO.FlashWidget.init();
IMO.VIM.init();
IMO.VW=new IMO.REUI.VimWidget();
var g=775;
var h=425;
IMO.BrowserFocus.init();
IMO.BrowserResize.init();
IMO.WM.B=new IMO.WM.BaseWindowManager(d.dom("main"));
if(!f){IMO.WM.TWM=new IMO.WM.Tabbed.WindowManager();
IMO.WM.FWM=new IMO.WM.Floating.WindowManager();
IMO.WM.B.set_wm(IMO.WM.TWM);
}else{IMO.WM.ThinWM=new IMO.WM.Thin.WindowManager();
IMO.WM.B.set_wm(IMO.WM.ThinWM);
}document.title="imo";
IMO.KeyboardManager.get().push({bindings:{"C-s":{alt:"/",cb:function(j){j.halt();
j.preventDefault();
var i=d.dom("buddysearch_input");
i.value="";
i.focus();
IMO.Stats.increment_counter("buddysearch_kb_s");
return false;
}},"C-a":{cb:function(i){i.halt();
IMO.REUI.Accounts.show_account_login();
IMO.Stats.increment_counter("addaccount_kb_a");
}},"?":{cb:function(i){i.halt();
IMO.REUI.KeyboardHelpWidget.show();
IMO.Stats.increment_counter("buddysearch_kb_questionmark");
}}},weight:IMO.KeyboardManager.exec_weight.global});
IMO.EventTarget.on(IMO.Session.get(),{on_signingoff_all:function(){d.empty(IMO.U.imo);
IMO.U.imo.appendChild(d.cdiv("splash_loading",d.img({src:"assets/loading_54.gif"})));
},on_system_message:function(i){IMO.NM.add_notification(IMO.Utils.linkify_string(i.message),IMO.REUI.Notification.types.error,{momentary:false});
}});
IMO.EventTarget.on(IMO.EventGateway.get(),{on_get_conversation:function(i){if(!i.ui){var j=new IMO.REUI.ConversationPanel(i);
}}});
this.refresh_mnp();
},connect_splash:function(){var f=0;
var j=function(n){var l;
var m={proto:"imo",username:d.dom("splash_imo_username"),password:d.dom("splash_imo_password"),remember:d.dom("splash_imo_remember"),msg:d.dom("splash_imo_msg"),captcha:d.dom("splash_imo_captcha"),signin:d.dom("splash_imo_signin_p"),on_login_fail:function(){f++;
if(f>=2){var o=m.username.value;
if(/.+@hotmail\..+/.test(o)){m.msg.appendChild(d.span("Are you trying to log into MSN?"));
d.add_class(d.dom("splash_proto_box_prpl-msn"),"hilight");
}}},on_login_succeed:function(){IMO.EventTarget.unsubscribe(l,m);
}};
l=new IMO.Login(m);
l.login();
};
IMO.Splash.imo_submit=function(l){if(l){l.halt();
}j();
return false;
};
var h=function(){Y.later(10,this,function(){IMO.Session.get().set_remember_me(this.checked);
});
};
var i={hide:function(l){if(l){l.halt();
}this.popup.hide();
IMO.Captcha.hide_captcha("splash_other_captcha");
this.popup.destroy();
IMO.EventTarget.unsubscribe(this.login,this);
IMO.KeyboardManager.get().pop(this.sc_uid);
IMO.on_main_imo_page=false;
delete this.popup;
delete this.login;
},submit:function(l){if(l){l.halt();
}this.login.login();
return false;
},oauth_login:function(l){if(l){l.halt();
}IMO.OAuth.get().login(this.proto,this.login.login,this,true);
return false;
},on_login_succeed:function(){this.hide();
},show_steamguard:function(){if(this.steamguard){return;
}this.steam_dom.appendChild(this.steamguard=d.input({id:"splash_other_steamguard",type:"text"}));
d.show(this.steam_dom);
this.steamguard.focus();
},captcha:d.div({id:"splash_other_captcha",cls:"captcha",style:{display:"none"}})};
IMO.Splash.show_login=function(p){var o=Y.DOM.docHeight()-20;
var n=(o<700)?Math.max(10,(o-500)/2):200;
d.remove(i.captcha);
IMO.Stats.report_user_flow("page_login_other",{proto:p});
IMO.on_main_imo_page=true;
function m(){var r=d.div({id:"login_popup"},(p==="prpl-vkontakte"?d.p("     ID  .      ",d.a({href:"http://vk.com/settings",target:"_blank"},"http://vk.com/settings"),". ID    id135551782."):null),d.form({context:i,onsubmit:i.submit},d.input({type:"submit"}),d.p(i.username=d.input({type:"text",id:"splash_other_usermame",placeholder:"Username"})),d.p(i.password=d.input({type:"password",id:"splash_other_password",placeholder:"Password"})),d.p(i.remember=d.input({type:"checkbox",id:"splash_other_remember",onclick:h}),d.label(" Remember me",{"for":"splash_other_remember"})),i.msg,i.captcha,i.steam_dom=d.div({id:"splash_other_steam",cls:"steamguard",style:{display:"none"}}),i.signin=d.p({cls:"signin"},d.a("Sign In",{href:"#",cls:"btn_norm",id:"splash_imo_signin",context:i,onclick:i.submit}),d.a("Cancel",{href:"#",context:i,onclick:i.hide}))),d.hr(),d.p("By clicking sign in you agree to the ",d.a("Terms of Service",{href:"/policies/terms_of_service.html"})," and ",d.a("Privacy Policy",{href:"/policies/privacy_policy.html"})));
IMO.Input(i.username,"text","Username");
IMO.Input(i.password,"password","Password");
return r;
}function q(){var r=d.div({id:"splash_oauth"});
i.dom=d.div(r,d.hr(),i.captcha,d.p("By clicking sign in you agree to the ",d.a("Terms of Service",{href:"/policies/terms_of_service.html"})," and ",d.a("Privacy Policy",{href:"/policies/privacy_policy.html"})));
var s=IMO.REUI.create_oauth_button(p,i.oauth_login,i);
r.appendChild(s);
r.appendChild(i.msg);
return i.dom;
}i.proto=p;
i.login=new IMO.Login(i);
i.popup=new IMO.ModalPopup(i);
i.msg=d.div({id:"splash_other_msg",cls:"message"});
d.hide(i.msg);
i.popup.set_title(d.span(d.sprite("logo_"+p.replace("-","_")),"Sign in to "+e.PROTO_TO_UI[p]));
var l=IMO.OAuth.get().proto_has_oauth(p)?q():m();
i.popup.set_content(l,[470,NaN]);
i.popup.prepare();
d.css(i.popup.popup_dom,{top:n+"px",maxHeight:(o-40)+"px"});
i.popup.show();
if(i.username){i.username.focus();
}i.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:i.hide}},bottom:true,context:i});
};
IMO.Splash.forgot_password=function(){IMO.REUI.PIN.ForgotPasswordPopup.show();
};
IMO.Splash.imo_signup=function(){IMO.U.show_imo_signup(IMO.pin_invite_id,true);
IMO.Stats.report_user_flow("page_register_attempt");
};
IMO.Splash.show_feedback=function(){IMO.REUI.Feedback.show();
};
IMO.Splash.set_remember_me=h;
d.dom("splash_imo_remember").onclick=h;
h.call(d.dom("splash_imo_remember"));
IMO.Splash.play_video=function(){d.empty("splash_video_inner");
swfobject.embedSWF("https://www.youtube.com/v/UBvznXJ_LV8?version=3&list=UUPrjIrmHbMswE77ijW4B1zw&index=1&feature=player_profilepage&enablejsapi=1&rel=0&autoplay=1&controls=1","splash_video_inner",580,280,"8","expressInstall.swf",{allowfullscreen:true},{allowFullScreen:true,allowscriptaccess:"always",wmode:"opaque"},{});
};
IMO.Splash.social_click=function(l){if(!l){return;
}var m={};
m[l]=1;
IMO.Stats.log_event("social_follow",m,null,null,false);
};
IMO.Splash.social_click(IMO.Splash.social_clicked);
if(d.dom("splash_imo_username")&&!d.dom("splash_imo_username").value&&!d.dom("splash_imo_password").value){try{d.dom("splash_imo_username").focus();
}catch(k){}}var g=["forgot_password","imo_signup","show_feedback","imo_submit","show_login","play_video"];
a.foreach(g,function(m){var l=IMO.Splash[m+"_called"];
if(l){IMO.Splash[m](l);
}});
IMO.Splash.press_carousel=new IMO.REUI.Carousel(d.dom("splash_press"));
},parse_query:function(){this.query=a.parse_query();
var f=document.location.pathname;
if(f.match(/\/now$/)){this.query={schat:""};
}},on_iid_success:function(){var f=d.dom("splash_console");
if(!f){return;
}d.empty(f);
d.remove_class(f,"error");
f.appendChild(d(c("Sign in any account to chat in this group")));
},on_iid_fail:function(g){var f=d.dom("splash_console");
if(!f){return;
}d.empty(f);
d.add_class(f,"error");
f.appendChild(d.sprite("error_icn"));
f.appendChild(b(g.msg));
},init_pin:function(){IMO.REUI.PIN.NotificationInit();
},init:function(){if(this.init_flag){return;
}this.init_flag=true;
this.imo=d.dom("imo");
this.parse_query();
try{window.addEventListener("hashchange",this.onhashchange,false);
}catch(h){}if(this.query.ydebug){Y.config.debug=true;
}this.init_pin();
var g;
if(this.query.hasOwnProperty("schat")){g="schat";
}else{if(this.query.av||this.query.achat){g="avchat";
}else{if(this.query.hasOwnProperty("feedback")){g="feedback";
}else{if(this.query.hasOwnProperty("password_reset")){g="password_reset";
}else{if(IMO.Network.get().cookie_login){g="cookie";
}else{g="splash";
}}}}}a.log("next=%s, domready=%s, splash=%s, spinning=%s",g,IMO.Splash.domready,IMO.Splash.splash,IMO.Splash.spinning);
var f;
if(g==="splash"||g==="cookie"){if(this.query.hasOwnProperty("thinui")){this.build_thin_ui();
}else{this.build_main_ui();
}f=function(i){if(i.authorized){IMO.U.build_main_ui2();
}IMO.EventTarget.on(i,{on_state_change:function(){if(i.authorized){IMO.U.build_main_ui2();
}}});
};
a.foreach(IMO.Session.get().get_accounts(),f);
IMO.EventTarget.on(IMO.Session.get(),{on_create_account:f});
}if(g==="splash"){this.connect_splash();
}if(g==="password_reset"){this.clear_splash();
IMO.REUI.PIN.ResetPasswordPopup.init_and_show(this.query.password_reset);
}if(g==="schat"){this.build_simple_chat();
}if(this.query.groupchat){IMO.Session.get().group_invitation=new IMO.GroupInvitation(this.query.groupchat);
this.on(IMO.Session.get().group_invitation);
return;
}if(g==="avchat"){this.clear_splash();
this.build_chat_window(this.query);
this.set_state("av_chat");
return;
}if(this.query.hasOwnProperty("signup")||this.query.hasOwnProperty("jg")){this.request_imo_signup_window(this.query.t,this.query.email);
return;
}if(g==="feedback"){this.clear_splash();
IMO.REUI.Feedback.show(true);
return;
}},onhashchange:function(g){Y.log(["onhashchange",g.newURL,g.oldURL],"debug");
var h=a.parse_query(document.location.hash);
if(g.newURL.indexOf("#inviter")>=0){IMO.REUI.PIN.InvitePopup().show();
}else{if(g.newURL.indexOf("#my_profile")>=0){IMO.REUI.PIN.ProfileEdit.show();
}else{if(g.newURL.indexOf("#find_friend")>=0){IMO.REUI.PIN.FFPopup().show();
}else{if(g.newURL.indexOf("#imo_news")>=0){IMO.REUI.PIN.NewsUpload.show();
}else{Y.log(["Unhandled hash change",g],"warn");
}}}}if(h.feedpromo){var f=document.location.hash.split("?")[0];
f=f.substr(1);
try{IMO.Network.get().send("feedpromo","report_promo_clicked",{uid:IMO.Session.get().get_imo_account().uid,promo_type:f});
}catch(i){Y.log(["unable to report promo",i],"error");
}}},toggle_mnp:function(g,f){Y.log(["toggle_mnp",g,f,this._mnp_shown]);
if(g===undefined){g=!this._mnp_shown;
}if(g===this._mnp_shown){return;
}this._mnp_shown=g;
this.refresh_mnp();
if(g){IMO.REUI.MNP_PANEL.show(f);
}else{IMO.REUI.MNP_PANEL.hide(f);
}},refresh_mnp:function(){if(this._mnp_shown){d.add_class(d.dom("main"),"with_mnp");
d.add_class(d.dom("header-mnp-btn"),"active");
}else{d.remove_class(d.dom("main"),"with_mnp");
d.remove_class(d.dom("header-mnp-btn"),"active");
}},is_mnp_shown:function(){return this._mnp_shown;
}});
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.REUI.MessagePreview=function(c){return b.cdiv("message-preview",b.cdiv("message-content",c),b.cdiv("bg",{cls:"sprite_tooltip2_1"}),b.cdiv("bg",{cls:"sprite_tooltip2_2"}),b.cdiv("bg",{cls:"sprite_tooltip2_3"}),b.cdiv("bg",{cls:"sprite_tooltip2_4"}),b.cdiv("bg",{cls:"sprite_tooltip2_6"}),b.cdiv("bg",{cls:"sprite_tooltip2_7"}),b.cdiv("bg",{cls:"sprite_tooltip2_8"}),b.cdiv("bg",{cls:"sprite_tooltip2_9"}),b.cdiv("bg",{cls:"sprite_tooltip2_arrow"}));
};
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
var e=IMO.Constants;
IMO.REUI.MiniApp=function(){this.opened=undefined;
var f=c.cdiv("mini_app_title bar darkblue sprite_accounts",{onclick:this.toggle,context:this},c.span({cls:"title"},b("Broadcasts")),this.title_toggle_img=c.sprite("icn_collapse",{cls:"accounts_right_icn"}));
this.app_content=c.div({id:"mini_app_content"});
this.dom=c.div({id:"mini_app"},f,this.app_content);
this.on(IMO.Session.get());
return this;
};
Y.mix(IMO.REUI.MiniApp.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.MiniApp.prototype,{toggle:function(){var f=this.opened;
this.set_state(f);
},set_state:function(h,f){if(this.opened===(!h)){return;
}f=a.dfl(f,true);
this.opened=!h;
var g=null;
if(h){c.hide(this.app_content);
g="sprite_icn_collapse";
}else{c.show(this.app_content,"block");
g="sprite_icn_expand";
IMO.REUI.A.set_accounts_list_state(true);
}c.mex_class(this.title_toggle_img,g,["sprite_icn_expand","sprite_icn_collapse"]);
if(f){IMO.Session.get().set_pref(e.UI_PREF_KIND,IMO.SharedConstants.Preferences.COLLAPSE_MNP,h);
}},set_app:function(f){c.show(this.dom,"block");
c.replace_content(this.app_content,f.dom);
},on_prefs_loaded:function(){var f=IMO.Session.get().get_pref(e.UI_PREF_KIND,IMO.SharedConstants.Preferences.COLLAPSE_MNP,null);
if(f!==null){this.set_state(f,false);
}}});
}());
(function(){var a=IMO.Utils;
var d=IMO.Constants;
var c=a.HTML;
var b=a.TranslateDom;
IMO.REUI.MP3Player=function(e){this.idle_dom=c.cdiv("idle",{context:this,onclick:this.on_click_start},c.sprite("btn_mp3_player_play"));
this.pause_dom=c.sprite("btn_mp3_player_pause",{context:this,onclick:this.on_click_pause});
this.resume_dom=c.sprite("btn_mp3_player_resume",{context:this,onclick:this.on_click_resume});
this.playing_dom=c.cdiv("playing",c.sprite("btn_mp3_player_stop",{context:this,onclick:this.on_click_stop}),this.pauseresume_dom=c.span(),c.span({cls:"text"},this.offset_dom=c("0"),c("/"),this.length_dom=c("0")));
this.dom=c.cdiv("mp3player");
this.url=e;
this.set_state(IMO.REUI.MP3Player.STATE_IDLE);
};
IMO.REUI.MP3Player.STATE_IDLE="IDLE";
IMO.REUI.MP3Player.STATE_PLAYING="PLAYING";
IMO.REUI.MP3Player.STATE_PAUSED="PAUSED";
Y.mix(IMO.REUI.MP3Player.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.MP3Player.prototype,{set_state:function(e){this.state=e;
this.update_dom();
},update_dom:function(){var e;
switch(this.state){case IMO.REUI.MP3Player.STATE_IDLE:e=this.idle_dom;
break;
case IMO.REUI.MP3Player.STATE_PLAYING:e=this.playing_dom;
c.replace_content(this.pauseresume_dom,this.pause_dom);
break;
case IMO.REUI.MP3Player.STATE_PAUSED:e=this.playing_dom;
c.replace_content(this.pauseresume_dom,this.resume_dom);
break;
default:break;
}c.replace_content(this.dom,e);
},start:function(){try{this.core=new IMO.MP3Player(this.url);
this.on(this.core);
}catch(f){return;
}this.set_state(IMO.REUI.MP3Player.STATE_PLAYING);
},stop:function(){this.set_state(IMO.REUI.MP3Player.STATE_IDLE);
this.offset_dom.nodeValue="0";
if(this.core){this.unsubscribe(this.core);
this.core.stop();
delete this.code;
}},pause:function(){if(this.core&&this.state===IMO.REUI.MP3Player.STATE_PLAYING){this.core.pause();
this.set_state(IMO.REUI.MP3Player.STATE_PAUSED);
}},resume:function(){if(this.core&&this.state===IMO.REUI.MP3Player.STATE_PAUSED){this.core.resume();
this.set_state(IMO.REUI.MP3Player.STATE_PLAYING);
}},on_click_resume:function(){this.resume();
},on_click_pause:function(){this.pause();
},on_click_start:function(){this.start();
},on_click_stop:function(){this.stop();
},on_mp3_player_stream_end:function(){this.stop();
},on_mp3_player_position_change:function(e,f){this.offset_dom.nodeValue=""+Math.floor(f/1000);
},on_mp3_player_length_known:function(e,f){this.length_dom.nodeValue=""+Math.floor(f/1000);
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var b=IMO.Utils.TranslateDom;
IMO.REUI.Notification={};
IMO.REUI.Notification.types={info:"info",error:"error"};
var e=5000;
var c=["one","many","toone","tomany"];
IMO.REUI.Notification.Manager=function(){this.notifications=[];
this.notifs_dom=d.cdiv("notifications",{context:this});
d.mex_class(this.notifs_dom,"many",c);
this.on(IMO.Network.get());
this.on(IMO.Session.get());
this.dom=d.cdiv("notification-container",this.notifs_dom);
};
Y.mix(IMO.REUI.Notification.Manager.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.Notification.Manager.prototype,{add_notification:function(l,j,i){j=j||IMO.REUI.Notification.types.info;
i=i||{};
if(!i.hasOwnProperty("momentary")){i.momentary=true;
}var f=d.cdiv("notification",{cls:j});
var h={dom:l,type:j,timestamp:new Date(),wrapper:f,visible:true};
f.appendChild(d.cdiv("n_close sprite_icn_close",{onclick:function(){this.remove_notification(h);
},context:this}));
this.notifications.push(h);
d.add_class(f,"fadein");
this.notifs_dom.appendChild(f);
Y.later(0,this,function(){d.remove_class(f,"fadein");
});
var k=d.cdiv("notification_content",l);
f.appendChild(k);
this.scroll_to_bottom();
if(i.momentary){var g=i.on_time||e;
h.timer=Y.later(g,this,this.remove_notification,h,false);
}return h;
},remove_notification:function(f){Y.later(1000,this,function(){d.remove(f.wrapper);
});
d.add_class(f.wrapper,"fadeaway");
for(var g=0;
g<this.notifications.lenght;
g++){if(this.notifications[g]===f){this.notifications.splice(g,1);
break;
}}f.visible=false;
},scroll_to_bottom:function(){this.notifs_dom.scrollTop=(1<<20);
},on_network_problem:function(){if(!this.network_notification){this.network_notification=this.add_notification(b("We are experiencing network problems"),IMO.REUI.Notification.types.error,{momentary:false});
}},on_network_reconnected:function(){if(this.network_notification){this.remove_notification(this.network_notification);
this.add_notification(b("Network connected"),IMO.REUI.Notification.types.info,{momentary:true});
this.network_notification=null;
}},on_network_unsleep:function(){if(this.network_notification){this.remove_notification(this.network_notification);
}this.network_notification=this.add_notification(b("Network reconnecting.."),IMO.REUI.Notification.types.info,{momentary:false});
},on_link_success:function(){this.add_notification(b("Your passwords have been encrypted and saved. Your accounts are now linked."),IMO.REUI.Notification.types.info);
},on_unlink_success:function(){this.add_notification(b("Your password has been deleted. Your account is no longer linked."),IMO.REUI.Notification.types.info);
},on_linked_accounts_failed:function(j){var g=j.edata.accounts;
var i="Your linked accounts on";
var f=d.div(d.p(b(i),{style:{"margin-bottom":"5px"}}));
var h=true;
a.foreach(g,function(k){var l="";
if(h===false){l+=" |";
}l+=" "+IMO.Constants.PROTO_TO_UI[k.proto];
h=false;
f.appendChild(d.span(b(l),{style:{"font-weight":"bold"}}));
},this);
f.appendChild(d.p(b("could not be logged in automatically."),{style:{"margin-top":"5px"}}));
f.appendChild(d.p(b("In order to fix this, please log into one of your other linked accounts. We recommend using an imo account to link all your other accounts."),{style:{"margin-top":"5px","margin-bottom":"5px"}}));
f.appendChild(d.p(d.span(b("Register today!"),{cls:"action"}),{style:{"text-align":"center"},onclick:IMO.Splash.imo_signup}));
this.add_notification(f,IMO.REUI.Notification.types.info,{momentary:false});
}});
}());
(function(){var b=IMO.Utils;
var d=IMO.Utils.HTML;
var c=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
var f=IMO.Constants;
var g="%b %d, %Y at %I:%M %p";
var a=e("Comment photo");
IMO.REUI.PhotoCommentsWidget=function(j,h,i){this.manager=j;
this.on(this.manager);
this.photo=h;
this.close_comments=i;
this.dom=this._build_dom();
this.manager.get_comments(h.photoID);
};
Y.mix(IMO.REUI.PhotoCommentsWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PhotoCommentsWidget.prototype,{_add_comment:function(){var h=this.textarea.get("value");
if(!this.textarea.getData("empty")){this.manager.add_comment(this.photo.photoID,h);
this.textarea.set("value",a);
this.textarea.setData("empty",true);
this.textarea.setStyle("color","#888");
}},_input_blur:function(i){var h=this.textarea;
var j=h.get("value").length===0;
if(j){h.set("value",a);
h.setStyle("color","#888");
}h.setData("empty",j);
},_input_focus:function(i){var h=this.textarea;
if(h.getData("empty")){h.set("value","");
}h.setStyle("color","#000");
},_build_dom:function(){var i=this.photo.sizes.length>1?1:0;
var k=this.manager.get_photo_url(this.photo,i);
var h=d.img({src:k,cls:"comment-img"});
var j=this.photo.sizes[i][0];
this.comments=d.cdiv("comments");
this.textarea=new Y.Node(d.textarea(a,{onblur:this._input_blur,onfocus:this._input_focus,context:this}));
this.textarea.setData("empty",true);
return d.cdiv("comments-widget",d.cdiv("photo-holder",{style:{width:j+"px"}},h,d.cspan("back",d.sprite("icn_comments"),e("Back to photo"),{onclick:this.close_comments})),d.cdiv("comments-caption",e("Comments")),this.comments,d.cdiv("input-div",this.textarea._node,d.cspan("button","Add",{onclick:this._add_comment,context:this})));
},on_comments_received:function(h,j){if(h!==this.photo.photoID){return;
}d.empty(this.comments);
var i=this.manager.acc;
b.foreach(j,function(o){var m=o.uid+";"+o.proto;
var n=b.groups_shorten_buddy_name(i.uid,i.proto,i.gid,m);
var k=new Date(o.timestamp*1000);
var l=b.get_buddy_icon_from_group(i.uid,i.proto,i.gid,m);
k=Y.DataType.Date.format(k,{format:g});
this.comments.appendChild(d.cdiv("comment",d.cdiv("buddy_icon",d.img({cls:"buddy_icon",src:l})),d.cdiv("right-container",d.cdiv("info",d.cspan("author",n),d.cspan("date",k)),d.cdiv("text",o.text))));
},this);
},on_comment_added:function(h,i){if(this.photo.photoID!==h){return;
}if(i){this.manager.get_comments(h);
}}});
}());
(function(){var c=IMO.Utils;
var e=IMO.Utils.HTML;
var d=IMO.Utils.TranslateDom;
var g=IMO.Utils.TranslateTxt;
var h=IMO.Constants;
var b=3;
var f=g("Please, upload at least 1 photo.");
var a=g("Wait, until all photos are uploaded.");
IMO.REUI.PhotoUploadWidget=function(i){this.manager=i;
this.active_uploading=false;
this.num_of_photos=0;
this.num_of_uploaded=0;
this.upload_photos={};
this.deleted={};
this._build_dom();
this.on(this.manager);
};
Y.mix(IMO.REUI.PhotoUploadWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PhotoUploadWidget.prototype,{init:function(i){this.conv=i;
},_add_file_row:function(j){var i=this.manager.get_filename(j);
if(!this.upload_photos[i]){var k=e.cdiv("row",e.sprite("icn_empty"),e.span(i));
this.upload_photos[i]={row:k};
this.file_list.appendChild(k);
return true;
}else{return false;
}},_update_finish_row:function(){var i;
if(this.num_of_photos===this.num_of_uploaded+this.num_of_failed){i="";
}else{i=e.span(a);
}e.replace_content(this.finish_row,i);
},_update_total:function(){var i=g("[UPLOADED] of [TOTAL] photos uploaded",{TOTAL:this.num_of_photos,UPLOADED:this.num_of_uploaded});
if(this.num_of_failed>0){i+=g(", [NUMBER] failed",{NUMBER:this.num_of_failed});
}e.replace_content(this.num,e(i));
},_set_active:function(){if(!this.active_uploading){this.active_uploading=true;
this.num_of_photos=0;
this.num_of_uploaded=0;
this.num_of_failed=0;
this.upload_photos={};
this.timestamp=new Date().getTime();
}},_clear_all:function(){this.active_uploading=false;
e.empty(this.file_list);
this.num_of_photos=0;
this.num_of_uploaded=0;
this.num_of_failed=0;
this._update_total();
this._update_finish_row();
},_delete_all_photos:function(){c.foreach(this.upload_photos,function(j,i){this._delete_photo(i);
},this);
e.empty(this.file_list);
this.active_uploading=false;
e.empty(this.file_list);
this.num_of_photos=0;
this.num_of_uploaded=0;
this._update_total();
this._update_finish_row();
},_delete_photo:function(j){var i=this.upload_photos[j];
var k=this.manager.streams[0].streamID;
new Y.Node(i.row).remove();
this.num_of_photos--;
if(i.hasOwnProperty("photoID")){this.num_of_uploaded--;
this.manager.delete_photo(k,i.photoID);
}else{if(i.failed){this.num_of_failed--;
}else{if(i.upload_started){this.deleted[j]=true;
}else{this.manager.delete_photo_from_upload_queue(j);
}}}delete this.upload_photos[j];
this._update_total();
this._update_finish_row();
},_add_photos_from_file_list:function(i){var j=[];
c.foreach(i,function(k){if(this._add_file_row(k)){j.push(k);
}},this);
this.num_of_photos+=j.length;
this._update_total();
this.manager.upload_photos(j,this.manager.streams[0].streamID,this.timestamp);
},_add_photo_from_input:function(j){this._set_active();
var i=j.target.replace(e.input(this.input_conf));
i=Y.Node.getDOMNode(i);
if(this.manager.can_upload_with_file_reader()&&i.files){this._add_photos_from_file_list(i.files);
}else{if(!this._add_file_row(i)){return;
}this.num_of_photos++;
this._update_total();
this.manager.upload_photos([i],this.manager.streams[0].streamID,this.timestamp);
}this._update_finish_row();
},_add_photo_from_drop:function(j){this._set_active();
j.halt();
e.remove_class(this.dom,"dragenter");
var i=j._event.dataTransfer.files;
this._add_photos_from_file_list(i);
this._update_finish_row();
},_build_upload_row:function(){this.input_conf={type:"file",context:this,onchange:this._add_photo_from_input};
if(this.manager.can_upload_with_file_reader()){this.input_conf.multiple="multiple";
}return e.cdiv("upload-row",e.input(this.input_conf),d("Or drag and drop photos here."));
},_build_total_row:function(){return e.cdiv("row",this.num=e.span({style:{color:"#FFF","float":"left"}}),e.cdiv("remove",e.span(d("Clear all")),e.sprite("icn_ph_trash"),{onclick:this._clear_all,context:this}));
},_build_dom:function(){this.finish_button=IMO.REUI.Button("blue",{onclick:this._commit_photos,context:this},d("Upload"));
this.finish_row=e.div(e.span(f));
var j=e.cdiv("holder",e.cspan("title",d("Upload photo")),this._build_upload_row(),this.finish_row,this._build_total_row(),this.file_list=e.div());
var i={ondragover:function(k){k.halt();
},ondragend:function(k){k.halt();
},ondragenter:function(k){k.halt();
e.add_class(this.dom,"dragenter");
},ondragleave:function(k){k.halt();
e.remove_class(this.dom,"dragenter");
},ondragstart:function(k){k.halt();
},ondrop:this._add_photo_from_drop,context:this};
this.dom=e.cdiv("body-full upload",i,j);
e.chide(this.dom);
this._update_total();
},_commit_photos:function(){this.manager.commit_photos(this.manager.streams[0].streamID,this.timestamp);
},_build_notify_message:function(){var i=c.filter(this.upload_photos,function(n){return n.failed!==true;
});
if(i.length===0){return undefined;
}var k=c.map(i,function(n){var o=this.manager.get_photo_size_to_cover(n,70,70);
return this.manager.get_photo_url(n,o);
},this);
k.sort();
k.reverse();
var j=Math.min(this.num_of_photos,b);
var l=k.slice(0,j);
var m=i.length===1?"uploaded photo.":c.sprintf("uploaded [NUMBER] photos.",{NUMBER:i.length});
return[m,l];
},on_photos_committed:function(j,i){var l=this._build_notify_message();
if(l!==undefined){var k={type:"photo_uploaded",photo_urls:l[1]};
this.conv.send_im(l[0],k);
}this.active_uploading=false;
e.empty(this.file_list);
this.num_of_photos=0;
this.num_of_uploaded=0;
this.num_of_failed=0;
this._update_total();
this._update_finish_row();
},on_photo_uploaded:function(l,k){var j=k.filename;
if(this.deleted[j]){this.manager.delete_photo(l,k.photoID);
delete this.deleted[j];
this._update_finish_row();
}else{if(this.upload_photos[j]){var i=this.upload_photos[j];
Y.mix(i,k);
new Y.Node(i.row.children[0]).replace(e.sprite("icn_ok status"));
this.num_of_uploaded++;
this._update_total();
this._update_finish_row();
}}},on_photo_failed:function(j,l){if(this.deleted[j]){delete this.deleted[j];
return;
}var k=this.upload_photos[j];
k.failed=true;
new Y.Node(k.row.children[0]).replace(e.sprite("icn_fail"));
var i=e.cspan("error",l);
k.row.appendChild(i);
this.num_of_failed++;
this._update_finish_row();
this._update_total();
},on_photo_upload_started:function(i){var j=this.upload_photos[i];
if(j!==undefined){j.upload_started=true;
new Y.Node(j.row.children[0]).replace(e.img({src:"/assets/photo/spinner.gif",cls:"status",style:{width:"20px"}}));
}}});
}());
(function(){var e=IMO.Utils;
var k=IMO.Utils.HTML;
var l=IMO.Utils.TranslateDom;
var i=IMO.Utils.TranslateTxt;
var b=IMO.Constants;
var a="conv-window";
var j=82;
var g=i("Adding photos to a group allows all group members to view your photos in a live photostream. Group photo sharing is free and provides two gigabytes of free storage");
var d=60*60;
var m=900;
var f=1;
var c=-1;
var h={};
IMO.REUI.GetPhotoWidget=function(p,o){var n=p.acc.uid+";"+p.acc.proto;
if(p.acc.gid!==undefined){n+=";"+p.acc.gid;
}if(!h[n]){h[n]=new IMO.REUI.PhotoWidget(p,o);
}h[n].init(o);
return h[n];
};
IMO.REUI.PhotoWidget=function(n){this.manager=n;
this.upload_widget=new IMO.REUI.PhotoUploadWidget(n);
this.photos={};
this.sessions={};
this.photo_ids=[];
this.num_of_selected_photos=0;
this._build_dom();
this.buttons_text_visible=true;
this.anim=new Y.Anim({node:new Y.Node(this.photo_bar),duration:0.3});
this.fade_out_anim=new Y.Anim({duration:0.15,to:{opacity:0}});
this.fade_out_anim.on("end",this._toggle_comment_fade_in,this);
this.fade_in_anim=new Y.Anim({duration:0.15,to:{opacity:1}});
this.visible=false;
this.ui_dirty=true;
this.manager.refresh_streams();
this.on(this.manager);
this.photo_bar_left=0;
};
Y.mix(IMO.REUI.PhotoWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PhotoWidget.prototype,{init:function(n){this.conv=n;
e.foreach(this.message_transformers,function(o){n.add_message_transformer(o,this);
},this);
this.upload_widget.init(n.conv);
},show:function(p){p=e.dfl(p,true);
this.browser_resize_evt_id=k.on("resize",this._handle_window_resize,window,this);
this.conv_window_parent=this.conv.dom.parentNode;
k.add_class(this.conv.dom,a);
k.show(this.dom);
this.dom.appendChild(this.conv.dom);
Y.one("body").addClass("no-scroll");
this.conv.update_convlog_buffer();
this.visible=true;
this._manage_header_buttons();
Y.later(5000,this,function(){var q=this.manager.streams[0].streamID;
IMO.Stats.log_event("open_photo_widget",{ssid:IMO.Network.get().ssid,stream_id:q});
});
IMO.MouseManager.get().unregister(IMO.WM.B.handle_window_click,IMO.WM.B);
var n=function(q){if(q.target.get("type")!=="textarea"){this._show_next_photo(f);
}};
var o=function(q){if(q.target.get("type")!=="textarea"){this._show_next_photo(c);
}};
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},"left arrow":{cb:o},"right arrow":{cb:n}},bottom:true,context:this});
this.wheel_handler=k.on("mousewheel",this._handle_mouse_wheel,this);
if(p){this._prepare_preview();
}},hide:function(){Y.one("body").removeClass("no-scroll");
new Y.Node(this.conv_window_parent).insert(this.conv.dom,0);
k.remove_class(this.conv.dom,a);
k.hide(this.dom);
this.browser_resize_evt_id.detach();
delete this.browser_resize_evt_id;
this.conv.update_convlog_buffer();
this.visible=false;
if(k.has_class(this.dom,"hide-chat")){this._toggle_chat();
}IMO.MouseManager.get().register(IMO.WM.B.handle_window_click,IMO.WM.B);
IMO.KeyboardManager.get().pop(this.sc_uid);
k.detach(this.wheel_handler);
delete this.sc_uid;
},create_smallest_img:function(n,v,o){n=n+"100x100";
var p=this.manager.get_photo_id_from_url(n);
var w=this.manager.get_photo_size_from_url(n);
var s=function(){this.show_full_photo(p);
};
var t=function(x){this.conv.update_convlog_buffer();
};
var u=k.cdiv(o?"smallest-photo thumbnail-photo":"smallest-photo",k.img({src:n,cls:"photo",onclick:s,onload:t,context:this}));
var r=!v?"hidden":"";
var q=function(){this._show_photo_comments(p);
};
u.appendChild(k.cspan("comments "+r,{onclick:q,context:this},k.sprite("icn_comments"),k.span(""+v)));
return u;
},show_album:function(n){if(!this.visible){this.show();
}this._show_album();
},show_full_photo:function(o){var n=this.photos[o];
if(n===undefined){return;
}if(!this.visible){this.show(false);
}if(!n.comments){this._add_comments_widget(n);
}k.replace_content(this.comments_holder,n.comments.dom);
k.empty(this.full_photo);
this.full_photo.appendChild(n.full_img_holder);
if(this.active_photo){this._load_smallest_img(this.active_photo);
k.toggle_class(this.active_photo.smallest_img,"toggled");
}this.active_photo=n;
this._load_smallest_img(n);
k.toggle_class(n.smallest_img,"toggled");
this._manage_navigation_buttons(n.ind);
this._show_view();
this._resize_photo(n);
this._scroll_photo_bar_to_photo(n.ind);
Y.later(5,this,function(){var q=n.ind+1;
var r;
if(q<this.photo_ids.length){r=this.photo_ids[q];
this._resize_photo(this.photos[r]);
}var p=n.ind-1;
if(p>=0){r=this.photo_ids[p];
this._resize_photo(this.photos[r]);
}});
},_show_photo_comments:function(n,o){this.show_full_photo(n);
if(!k.has_class(this.full_photo,"hidden")){this._toggle_comments(true);
}if(o){new Y.Node(this.comments_holder).one("textarea").scrollIntoView();
}},_add_comments_widget:function(n){var o=Y.bind(this._toggle_comments,this);
n.comments=new IMO.REUI.PhotoCommentsWidget(this.manager,n,o);
},_manage_navigation_buttons:function(o){var n=o===0?k.chide:k.cshow;
n.call(k,this.buttons.next_photo);
n=o===this.photo_ids.length-1?k.chide:k.cshow;
n.call(k,this.buttons.prev_photo);
},_manage_scroll_buttons:function(p,o){var n=p===0?k.chide:k.cshow;
n.call(k,this.buttons.scroll_left);
n=p===o-1?k.chide:k.cshow;
n.call(k,this.buttons.scroll_right);
},_send_delete_request:function(n){this.manager.delete_photos(this.manager.streams[0].streamID,n);
},_show_next_photo:function(n){if(document.activeElement===this.conv.input){return;
}var o=this.active_photo.ind;
o-=n;
o=Math.max(0,o);
o=Math.min(this.photo_ids.length-1,o);
this.show_full_photo(this.photo_ids[o]);
},_scroll_photo_bar_to_photo:function(t){t=this.photo_ids.length-t-1;
var q=this.photo_bar.parentNode.clientWidth;
var r=Math.floor(q/j);
var s=r*j;
var p=Math.floor(t/r);
var n=-s*p;
if(this.photo_bar_left!==n){this.photo_bar_left=n;
this.anim.set("to",{marginLeft:n});
this.anim.run();
}var o=Math.ceil(this.photo_ids.length/r);
this._manage_scroll_buttons(p,o);
},_scroll_photo_bar:function(p){var s=new Y.Node(this.photo_bar);
var n=s.get("parentNode").get("clientWidth");
var t=Math.floor(n/j);
var u=t*j;
var o=s.getComputedStyle("marginLeft");
o=parseInt(o,10);
var v=-o/u;
v+=p;
v=Math.max(0,v);
var q=Math.ceil(this.photo_ids.length/t);
v=Math.min(v,q-1);
var r=-u*v;
if(this.photo_bar_left!==r){this.photo_bar_left=r;
this.anim.set("to",{marginLeft:r});
this.anim.run();
}this._manage_scroll_buttons(v,q);
},_get_good_size:function(o,q,n){for(var p=0;
p<o.sizes.length;
p++){if(o.sizes[p][0]>=q||o.sizes[p][1]>=n){return p;
}}return o.sizes.length-1;
},_resize_photo:function(o){if(o===undefined){return;
}var v=!k.has_class(this.full_photo,"hidden");
var q=(v?this.full_photo:this.comments_holder).clientWidth;
var t=(v?this.full_photo:this.comments_holder).clientHeight;
var r=this._get_good_size(o,q,t);
if(o.full_size!==r){var n=this.manager.get_photo_url(o,r);
var s=new Y.Node(o.full_img_holder).one("img");
s.set("src",n);
o.full_size=r;
}var w=o.sizes[r][1];
var p=o.sizes[r][0];
var u=Math.min(q/p,t/w,1);
k.css(o.full_img_holder,{height:Math.min(u*w,t),width:Math.min(u*p,q)});
k.valign_middle(o.full_img_holder,w*u);
},_manage_header_buttons:function(){var n=this.view_dom.parentNode.clientWidth;
if((n<m&&this.buttons_text_visible)||(n>=m&&!this.buttons_text_visible)){this.buttons_text_visible^=true;
var o=["chat","album","upload","close"];
e.foreach(o,function(p){k.toggle_class(this.buttons[p],"hide-text");
},this);
}},_handle_mouse_wheel:function(o){if((Y.UA.ie===0||Y.UA.ie>8)&&(o.target.ancestor(".view",true)!==null)&&(o.target.ancestor(".comments-holder",true)===null)){var n=o.wheelDelta>0?f:c;
this._show_next_photo(n);
}},_handle_window_resize:function(n){this.conv.update_convlog_buffer();
this._resize_photo(this.active_photo);
this._manage_header_buttons();
},_toggle_chat:function(){k.toggle_class(this.dom,"hide-chat");
this._resize_photo(this.active_photo);
this._manage_header_buttons();
this.conv.update_convlog_buffer();
},_show_upload:function(){k.chide(this.preview_dom);
k.chide(this.view_dom);
k.chide(this.buttons.navigation);
k.cshow(this.upload_dom);
k.chide(this.actions_panel_dom);
},_show_album:function(){this._prepare_preview();
k.chide(this.upload_dom);
k.chide(this.view_dom);
k.chide(this.buttons.navigation);
k.cshow(this.preview_dom);
this._manage_actions_panel();
},_show_view:function(){Y.later(100,this,function(){this._prepare_preview();
});
k.chide(this.upload_dom);
k.chide(this.preview_dom);
k.cshow(this.view_dom);
k.cshow(this.buttons.navigation);
k.chide(this.actions_panel_dom);
},_toggle_comment_fade_out:function(){var o=k.has_class(this.comments_holder,"hidden");
var n=new Y.Node(o?this.full_photo:this.comments_holder);
n.setStyle("opacity",1);
this.fade_out_anim.set("to",{opacity:0});
this.fade_out_anim.set("node",n);
this.fade_out_anim.run();
},_toggle_comment_fade_in:function(){var p=k.has_class(this.comments_holder,"hidden");
var o=new Y.Node(p?this.full_photo:this.comments_holder);
var n=new Y.Node(p?this.comments_holder:this.full_photo);
n.setStyle("opacity",0);
n.removeClass("hidden");
o.addClass("hidden");
this.fade_in_anim.set("node",n);
this.fade_in_anim.set("to",{opacity:1});
this.fade_in_anim.run();
},_toggle_comments:function(p){var r=Y.UA.ie>0&&Y.UA.ie<9;
if((Y.Lang.isBoolean(p)&&p)||r){var q=k.has_class(this.comments_holder,"hidden");
var o=new Y.Node(q?this.full_photo:this.comments_holder);
var n=new Y.Node(q?this.comments_holder:this.full_photo);
k.toggle_class(this.full_photo,"hidden");
k.toggle_class(this.comments_holder,"hidden");
if(!r){o.setStyle("opacity",0);
n.setStyle("opacity",1);
}if(!k.has_class(this.full_photo,"hidden")){this._resize_photo(this.active_photo);
}}else{this._toggle_comment_fade_out();
}},_build_header:function(){var o=function(){this._show_next_photo(f);
};
var s=function(){this._show_next_photo(c);
};
var p=k.cdiv("photo-button",k.span("Next"),k.sprite("icn_arr_right"),{onclick:o,context:this,style:{"float":"right"}});
var r=k.cdiv("photo-button",k.sprite("icn_arr_left"),k.span("Prev"),{onclick:s,context:this});
var n=k.cdiv("navigation hidden",r,p);
this.actions_panel_dom=k.cdiv("actions-panel hidden",k.cspan("caption"),k.cspan("action-button",l("Delete"),{onclick:this._show_delete_dialog,context:this}),k.cspan("action-button",l("Download"),{onclick:this._download_selected_photos,context:this}));
var q={chat:k.sprite("icn_toggle",{cls:"photo-button",onclick:this._toggle_chat,context:this,alt:i("Hide chat"),title:i("Hide chat")}),album:k.sprite("icn_album",{cls:"photo-button",onclick:this._show_album,context:this,alt:i("Show photos"),title:i("Show photos")}),upload:k.sprite("icn_upload",{cls:"photo-button",onclick:this._show_upload,context:this,alt:i("Upload photo"),title:i("Upload photo")}),close:k.cdiv("photo-button",{style:{"float":"right"},onclick:this.hide,context:this},k.span(l("Close")),k.sprite("icn_ph_close",{alt:""})),navigation:n,next_photo:p,prev_photo:r};
this.buttons=q;
return k.cdiv("header",q.chat,q.album,q.upload,this.actions_panel_dom,q.navigation,q.close);
},_build_preview:function(){this.greeting_message=k.cdiv("greeting-message",k.div({style:{"font-size":"20px","font-weight":"bold"}},l("Group photo sharing on imo!")),k.div({style:{"text-align":"justify"}},g));
this.preview_dom=k.cdiv("preview body-full",this.greeting_message);
return this.preview_dom;
},_build_view:function(){this.photo_bar=k.cdiv("photo-bar",{style:{"margin-left":"0px"}});
var o=k.cdiv("photo-bar-holder",{style:{"float":"left"}},this.photo_bar);
this.full_photo=k.cdiv("full-photo");
this.comments_holder=k.cdiv("comments-holder hidden");
var p=function(){this._scroll_photo_bar(c);
};
var n=function(){this._scroll_photo_bar(f);
};
this.buttons.scroll_left=k.sprite("btn_slide_left",{style:{"float":"left",cursor:"pointer"},onclick:p,context:this});
this.buttons.scroll_right=k.sprite("btn_slide_right",{style:{"float":"right",cursor:"pointer"},onclick:n,context:this});
var q=k.cdiv("footer",this.buttons.scroll_left,o,this.buttons.scroll_right);
this.view_dom=k.cdiv("body-full view",this.full_photo,this.comments_holder,q);
k.chide(this.view_dom);
return this.view_dom;
},_build_upload:function(){this.upload_dom=this.upload_widget.dom;
return this.upload_widget.dom;
},_build_dom:function(){this.dialog_holder=k.cdiv("dialog-holder hidden",{onclick:this._hide_dialog,context:this});
this.dom=k.cdiv("photo-widget",k.cdiv("photo-window",this._build_header(),this._build_preview(),this._build_upload(),this._build_view(),this.dialog_holder));
k.hide(this.dom);
Y.one("body").appendChild(this.dom);
},_get_num_of_selected_photos_caption:function(){return this.num_of_selected_photos+" "+(this.num_of_selected_photos===1?i("photo"):i("photos"));
},_create_dialog:function(o,n){k.add_class(n,"body");
return k.cdiv("dialog",k.cdiv("header",o),n,{onclick:function(p){p.halt();
}});
},_show_dialog:function(n){k.empty(this.dialog_holder);
this.dialog_holder.appendChild(n);
k.cshow(this.dialog_holder);
},_hide_dialog:function(){k.chide(this.dialog_holder);
},_show_delete_dialog:function(){var n=i("Are you sure you want to delete ")+this._get_num_of_selected_photos_caption()+"?";
var o=k.cdiv("delete-dialog",k.cspan("caption",n),k.cspan("dialog-button",i("No"),{onclick:this._hide_dialog,context:this}),k.cspan("dialog-button",i("Yes"),{onclick:this._delete_selected_photos,context:this}));
o=this._create_dialog(i("Delete photos"),o);
this._show_dialog(o);
},_delete_selected_photos:function(){var n=e.filter(this.photo_ids,function(p){var o=this.photos[p];
return k.has_class(o.preview_img,"selected");
},this);
if(n.length===0){return;
}this._send_delete_request(n);
e.foreach(n,this._delete_photo,this);
e.foreach(this.sessions,function(p){var o=p.dom.children[0];
k.remove_class(o,"sprite_icn_checkbox_yes");
k.add_class(o,"sprite_icn_checkbox");
});
this._hide_dialog();
},_download_selected_photos:function(){var o=e.filter(this.photo_ids,function(r){var q=this.photos[r];
return k.has_class(q.preview_img,"selected");
},this);
if(o.length===0){return;
}this.manager.download_photos(this.manager.streams[0].streamID,o);
var p=i("You added")+" "+this._get_num_of_selected_photos_caption()+" "+i("to download");
var n=k.cdiv("download-dialog",k.img({src:"/assets/photo/big_spinner.gif"}),k.cspan("captions",k.cdiv("prep-archive",i("Preparing archive")),k.cdiv("num_of_photos",p)),k.cspan("dialog-button",i("Cancel"),{onclick:this._hide_dialog,context:this}));
n=this._create_dialog(i("Download photos"),n);
this._show_dialog(n);
},_show_original_size:function(p){var q=p.target.get("src");
var o=this.manager.get_photo_id_from_url(q);
var n="/o/"+o;
window.open(n);
},_manage_session_checkbox:function(n){var p=this.sessions[n];
var q=e.filter(p.photos,function(t){var s=this.photos[t];
this._load_preview(s);
var r=s.preview_img;
return k.has_class(r,"selected");
},this).length;
var o=p.dom.children[0];
if(q===0){k.remove_class(o,"sprite_icn_checkbox_yes");
k.add_class(o,"sprite_icn_checkbox");
}else{k.add_class(o,"sprite_icn_checkbox_yes");
k.remove_class(o,"sprite_icn_checkbox");
}},_manage_actions_panel:function(){var n=new Y.Node(this.actions_panel_dom);
if(this.num_of_selected_photos===0){n.addClass("hidden");
}else{if(k.has_class(this.actions_panel_dom,"hidden")){n.removeClass("hidden");
}}var o=i("You selected ")+this._get_num_of_selected_photos_caption();
n.one(".caption").set("innerHTML",o);
},_select_preview_img:function(p){var o=this.photos[p];
this._load_preview(o);
var n=o.preview_img;
k.toggle_class(n,"selected");
var q=new Y.Node(n);
var r=q.one(".checkbox-header img")._node;
k.toggle_class(r,"sprite_icn_checkbox");
k.toggle_class(r,"sprite_icn_checkbox_yes");
this.num_of_selected_photos+=k.has_class(n,"selected")?1:-1;
this._manage_actions_panel();
},_select_session:function(p,n){var o=!!k.has_class(p,"sprite_icn_checkbox_yes");
e.foreach(this.sessions[n].photos,function(s){var r=this.photos[s];
this._load_preview(r);
var q=r.preview_img;
if(o!==k.has_class(q,"selected")){this._select_preview_img(s);
}},this);
k.toggle_class(p,"sprite_icn_checkbox_yes");
k.toggle_class(p,"sprite_icn_checkbox");
},_create_preview_img:function(p){var n=this.manager.get_photo_url(p,1);
var w=function(){this.show_full_photo(p.photoID);
};
var t=k.img({src:n,onclick:w,context:this,cls:"photo"});
var x=k.cdiv("inner-div");
var o=k.cdiv("photo-div",x);
var v=k.cspan("checkbox-header",{onclick:function(){this._select_preview_img(p.photoID);
this._manage_session_checkbox(p.session_id);
},context:this},k.cdiv("background"),k.sprite("icn_checkbox"));
var r=p.number_of_comments;
var q=r===0?"hidden":"";
var u=function(){this._show_photo_comments(p.photoID);
};
var s=k.cspan("comments "+q,k.sprite("icn_comments"),k.span(""+r),{onclick:u,context:this});
x.appendChild(v);
x.appendChild(t);
x.appendChild(s);
return o;
},_manage_upload_date_on_deletion:function(q,n){var p=q.previous();
var o=q.next();
if((p===null||p.hasClass("upload-date"))&&(o===null||o.hasClass("upload-date"))){if((p===null||p.hasClass("no-margin"))&&o!==null){o.addClass("no-margin");
}if(p!==null){p.remove();
}}},_delete_photo:function(p){var o=this.photos[p];
if(o===undefined){return;
}this._load_preview(o);
this._load_smallest_img(o);
new Y.Node(o.smallest_img).remove();
if(k.has_class(o.preview_img,"selected")){this._select_preview_img(p);
this._manage_session_checkbox(o.session_id);
}var n=new Y.Node(o.preview_img);
this._manage_upload_date_on_deletion(n,o.session_id);
n.remove();
delete this.photos[p];
this.photo_ids.splice(o.ind,1);
e.foreach(this.photo_ids,function(s,r){this.photos[s].ind=r;
},this);
var q=this.sessions[o.session_id];
q.photos=e.filter(q.photos,function(r){return r!==p;
});
if(q.photos.length===0){delete this.sessions[o.session_id];
}if(this.photo_ids.length===0){this.preview_dom.appendChild(this.greeting_message);
}},_synchronize_photos:function(n){for(var o=0;
o<this.photo_ids.length;
o++){if(o===n.length||this.photo_ids[o]!==n[o].photoID){this._delete_photo(this.photo_ids[o]);
o--;
}}},_build_upload_date_span:function(o,p){var n=k.cspan("upload-date",k.sprite("icn_checkbox",{onclick:function(q){this._select_session(q.target._node,p);
},context:this}),l("Uploaded on [DATE]",{DATE:o.toLocaleDateString()}));
return n;
},_repair_session:function(q){var p=q;
var n;
for(var o=this.photo_ids.length-1;
o>=0;
o--){n=this.photos[this.photo_ids[o]];
p=n.session_id>q?n.session_id:p;
if(n.session_id===q){n.session_id=p;
}}if(p===q){return;
}this.sessions[p].photos=this.sessions[p].photos.concat(this.sessions[q].photos);
delete this.sessions[q];
},_create_full_photo_holder:function(p){var n=p===1?i("comment"):i("comments");
n=p+" "+n;
var o=k.cdiv("holder",k.img({onclick:this._show_original_size,context:this}),k.cspan("comments",k.sprite("icn_comments"),k.span(n),{onclick:this._toggle_comments,context:this}));
return o;
},_extend_photo:function(o,n,p){var q=o.number_of_comments;
o=Y.merge(o,{ind:n,session_id:p,full_img_holder:this._create_full_photo_holder(q),full_size:-1});
return o;
},_load_preview:function(n){if(!n.preview_img){n.preview_img=this._create_preview_img(n);
}},_load_smallest_img:function(o){if(!o.smallest_img){var n=this.manager.get_photo_url(o);
o.smallest_img=this.create_smallest_img(n,o.number_of_comments,true);
}},_load_preview_and_smallest_img:function(r,t,s){var o;
var q=this.photos[this.photo_ids[r]];
if(r+1===this.photo_ids.length||this.photos[this.photo_ids[r+1]].session_id!==q.session_id){o=this.photos[this.photo_ids[r]].session_id;
var p=new Date(o*1000);
var n=this._build_upload_date_span(p,o);
if(r+1===this.photo_ids.length){k.add_class(n,"no-margin");
}this.preview_dom.insertBefore(n,t);
this.sessions[o].dom=n;
}this._load_preview(q);
this._load_smallest_img(q);
this.preview_dom.insertBefore(q.preview_img,t);
this.photo_bar.insertBefore(q.smallest_img,s);
},_prepare_preview:function(){if(!this.ui_dirty){return;
}k.empty(this.preview_dom);
k.empty(this.photo_bar);
var q=this.photo_ids.length-1;
if(this.active_photo){q=this.active_photo.ind;
}var p=Math.min(q+40,this.photo_ids.length-1);
var n=Math.max(q-40,0);
for(var o=p;
o>n;
o--){this._load_preview_and_smallest_img(o,null,null);
}Y.later(100,this,function(){for(o=n;
o>=0;
o--){this._load_preview_and_smallest_img(o,null,null);
}var s=this.preview_dom.firstChild;
var r=this.photo_bar.firstChild;
for(o=this.photo_ids.length-1;
o>p;
o--){this._load_preview_and_smallest_img(o,s,r);
}});
k.css(this.photo_bar,{width:e.sprintf("%dpx",j*this.photo_ids.length)});
this.ui_dirty=false;
},on_refreshed_streams:function(w){if(w.length===0){this.manager.create_stream();
}else{this.ui_dirty=true;
var u=w[0].photoObjects;
this._synchronize_photos(u);
if(u.length===this.photo_ids.length){return;
}k.remove(this.greeting_message);
var p=[];
var o;
if(this.photo_ids.length&&this.photo_ids.length<u.length){var r=this.photo_ids.length;
if(u[r].batchID-u[r-1].batchID<=d){o=this.photos[this.photo_ids[r-1]].session_id;
}}var s;
for(var q=u.length-1,t=0,v=0;
q>=this.photo_ids.length;
q--,v++,t++){if(q+1===u.length||u[q+1].batchID-u[q].batchID>d){s=u[q].batchID;
this.sessions[s]={photos:[]};
}var n=this._extend_photo(u[q],q,s);
this.sessions[s].photos.push(n.photoID);
this.photos[n.photoID]=n;
p.push(n.photoID);
}p.reverse();
this.photo_ids=this.photo_ids.concat(p);
if(o){this._repair_session(o);
}if(this.visible){this._prepare_preview();
}}},on_photos_committed:function(o,n){Y.later(500,this,this._show_album);
},on_photos_deleted:function(n){var o=n===1?"deleted photo.":e.sprintf("deleted [NUM] photos.",{NUM:n});
this.conv.conv.send_im(o,{type:"photo_deleted"});
},on_photos_download_ready:function(n){var o=new Y.Node(this.dialog_holder).one(".download-dialog");
if(o&&!k.has_class(this.dialog_holder,"hidden")){window.location=n;
this._hide_dialog();
}},on_comments_received:function(s,t){var r=this.photos[s];
if(t.length===0){return;
}this._load_preview(r);
this._load_smallest_img(r);
r.number_of_comments=t.length;
var n=new Y.Node(r.smallest_img).one(".comments");
n.one("span").set("innerHTML",r.number_of_comments);
n.removeClass("hidden");
var q=r.number_of_comments===1?i("comment"):i("comments");
q=r.number_of_comments+" "+q;
var p=new Y.Node(r.full_img_holder).one(".comments span");
p.set("innerHTML",q);
var o=new Y.Node(r.preview_img).one(".comments");
o.one("span").set("innerHTML",r.number_of_comments);
o.removeClass("hidden");
},on_comment_added:function(p,q,r){if(!q){return;
}var o=this.photos[p];
var n=this.manager.get_photo_url(o);
this.conv.conv.send_im("commented on photo.",{type:"photo_commented",text:r,photo_url:n,photo_id:p});
},message_transformers:{on_delete:function(n){if(n.imdata&&n.imdata.type==="photo_deleted"){this.manager.refresh_streams();
}},on_upload:function(n){if(!n.imdata||n.imdata.type!=="photo_uploaded"){return;
}this.manager.refresh_streams();
var p=n.msg_dom;
p.innerHTML="";
p.appendChild(k.a(n.msg,{onclick:this.show_album,href:"#",context:this}));
p.appendChild(k.br());
var o=n.imdata.photo_urls;
e.foreach(o,function(r){var q=this.create_smallest_img(r);
p.appendChild(q);
},this);
},on_comment:function(p){if(!p.imdata||p.imdata.type!=="photo_commented"){return;
}var o=this.photos[p.imdata.photo_id];
if(o&&!o.comments){this._add_comments_widget(o);
}if(o){this.manager.get_comments(p.imdata.photo_id);
}var n=this.create_smallest_img(p.imdata.photo_url);
k.replace_content(p.msg_dom,k.a(p.msg,{onclick:function(){this._show_photo_comments(p.imdata.photo_id,true);
},context:this,href:"#"}));
e.foreach([k.br(),n,k.br(),k.span(p.imdata.text)],function(q){p.msg_dom.appendChild(q);
});
}}});
}());
(function(){var c=IMO.Constants;
var d=IMO.Utils;
var l=d.HTML;
var h=IMO.REUI.Preferences={};
var m=IMO.Utils.TranslateDom;
var k=IMO.Utils.TranslateTxt;
var e={};
e.bool=1;
e.select=2;
e.radio=3;
e.color=4;
var j=function(){var r=l.cdiv("history-search-delete",l.span({cls:"top"},"This will PERMANENTLY delete ALL your chat history for ALL your accounts.  Are you SURE you wish to continue?"));
var p=IMO.Session.get().get_accounts();
var o=function(s){if(s===0){IMO.ConvHistory.get().clear_history(p);
}else{Y.log("Not deleting chat history");
}};
var q=new IMO.REUI.ConfirmModalPopup("Delete All History?",r,[[m("Yes"),"blue"],[m("No"),"grey"]],o);
};
var b=null;
var a={allowNonBuddies:{pref:"allowNonBuddies",kind:"impref",text:m("Allow individuals not on my buddy list to contact me"),type:e.bool,dfl:IMO.PreferenceDefaults.allowNonBuddies},noEmoticons:{pref:"noEmoticons",kind:"impref",text:m("Display emoticons"),type:e.bool,dfl:IMO.PreferenceDefaults.noEmoticons,invert:true},windowmanager:{pref:"windowmanager",kind:"impref",dfl:IMO.PreferenceDefaults.window_manager,type:e.radio,name:"display_radio",choices:[{value:c.WINDOW_MANAGER.TWM,text:m("Tab view")},{value:c.WINDOW_MANAGER.FWM,text:m("Window view")}]},saveHistory:{pref:"saveHistory",kind:"impref",text:l.span(l.span(m("Allow imo.im to encrypt and store my chat history")),l.br(),l.a({href:"#",onclick:function(o){o.preventDefault();
j();
}},m("Delete chat history")),l.a({id:"begin-export-chat-history",href:"#",cls:"fr",onclick:function(o){o.preventDefault();
h.hide();
(new IMO.REUI.ExportConvHistoryWidget()).show();
}},m("Export chat history")),l.cdiv("clear")),dfl:IMO.PreferenceDefaults.saveHistory,type:e.bool},show_buddy_icons:{pref:"show_buddy_icons",kind:"impref",text:m("Show buddy icons"),dfl:IMO.PreferenceDefaults.show_buddy_icons,type:e.bool},desktop_notifications:{pref:"desktop_notifications",kind:"impref",text:m("Enable desktop notifications"),disabled_text:m("Desktop notifications (not supported by your current browser)"),type:e.bool,dfl:IMO.PreferenceDefaults.desktop_notifications},auto_voice_im:{pref:"auto_voice_im",kind:"impref",text:m("Automatically play voice IM in the focused window"),type:e.bool,dfl:IMO.PreferenceDefaults.auto_voice_im},mute:{pref:"mute",kind:"impref",text_span:true,text:l.span(b=l.span(m("Play a sound for new messages"),l.a({id:"change-sound",href:"#",cls:"fr",onclick:function(o){o.preventDefault();
h.hide();
(new IMO.REUI.ChooseSoundWidget()).show();
}},m("Change Sound")))),type:e.bool,dfl:IMO.PreferenceDefaults.mute,invert:true},allowNonImoContacts:{pref:IMO.SharedConstants.Preferences.ALLOW_NON_IMO_CONTACTS,kind:"impref",text:m("Allow people not in my contacts to message me"),type:e.bool,dfl:IMO.PreferenceDefaults.allowNonImoContacts},showPrimitiveToNonContacts:{pref:IMO.SharedConstants.Preferences.SHOW_PRIMITIVE_TO_NON_CONTACTS,kind:"impref",text:m("Show my availability to people not in my contacts"),type:e.bool,dfl:IMO.PreferenceDefaults.showPrimitiveToNonContacts},show_discussion_join_leave:{pref:"show_discussion_join_leave",kind:"impref",text:l.span(m("Show join/leave discussion notifications"),l.br(),l.a({href:"#imo_news"},m("Import RSS feeds to imo news"))),type:e.bool,dfl:IMO.PreferenceDefaults.show_discussion_join_leave}};
var n={sounds:{title:m("Sounds"),options:[a.mute]},buddy_list:{title:m("Buddy List"),options:[a.show_buddy_icons]},windowmanager:{title:m("Display"),options:[a.windowmanager]},chat:{title:m("Chat"),options:[a.saveHistory,a.allowNonBuddies,a.noEmoticons,a.desktop_notifications,a.auto_voice_im]},imo_public_network:{title:m("imo Public Network"),options:[a.allowNonImoContacts,a.showPrimitiveToNonContacts,a.show_discussion_join_leave]}};
var i=function(o,q,p){this.colors=o;
this.dom=l.cdiv("color-palette");
this.selected_id=null;
this.on_change_cb=d.dfl(q,null);
this.context=d.dfl(p,null);
d.foreach(this.colors,function(r,t){var s=l.cdiv("sample-color",{name:t,onclick:{func:this.handle_mouse_click,args:t},context:this});
if(r.rgb!==undefined){l.css(s,{background_color:"#"+r.rgb});
}else{Y.log("invalid color","warn");
}r.dom=s;
this.dom.appendChild(s);
},this);
this.dom.appendChild(l.div({style:{clear:"both"}}));
};
Y.mix(i.prototype,{change_selected:function(p,o){o=d.dfl(o,true);
if(this.selected_id===p){return;
}if(this.selected_id!==null){l.remove_class(this.colors[this.selected_id].dom,"selected");
}if(p!==null){l.add_class(this.colors[p].dom,"selected");
}this.selected_id=p;
if(o===true&&this.on_change_cb!==null){this.on_change_cb.call(this.context,p,this.selected_id);
}},handle_mouse_click:function(o,p){IMO.MouseManager.get().handled(o,"pref-color");
this.change_selected(p);
}});
var g=function(){this.account=IMO.Session.get().get_imo_account();
this.selected_sound="imo0";
this.sound_option={};
this.build_dom();
this.load_preferences();
this.on(IMO.Session.get());
this.popup=new IMO.ModalPopup(this);
this.popup.set_content(this.dom,[IMO.Constants.preference_popup_width,NaN]);
this.popup.set_title(k("Preferences"));
this.popup.prepare();
};
Y.mix(g.prototype,IMO.EventTarget);
Y.mix(g.prototype,{on_recv_pref:function(p,o,q){this.load_preferences();
},on_set_prefs:function(o){},show:function(){this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.canceled},enter:{cb:this.saved}},bottom:true,context:this});
this.save_start_state();
this.popup.show();
},canceled:function(o){this.hide();
},saved:function(p){var o=[];
o.push({kind:"impref",pref:"beep",value:this.selected_sound});
d.foreach(a,function(r,q){switch(r.type){case e.bool:if(r.idom.checked!==this.start_state[q]){var w=!!r.idom.checked;
var x=r.invert?!w:w;
o.push({kind:r.kind,pref:r.pref,value:x});
}break;
case e.radio:var u=r.idom;
var t=null;
for(var s=0;
s<u.children.length;
s++){if(u.children[s].checked===true){t=u.children[s].value;
}}if(t!==this.start_state[q]){if(r.pref==="windowmanager"){IMO.WM.B.set_wm(t===c.WINDOW_MANAGER.TWM?IMO.WM.TWM:IMO.WM.FWM);
}o.push({kind:r.kind,pref:r.pref,value:t});
}break;
}},this);
if(o.length){IMO.Session.get().set_prefs(o);
}if(p.kb_bottom){p.kb_bottom();
}this.hide(true);
},revert_prefs:function(){this.change_sound(this.originaly_selected_sound||"imo0");
d.foreach(a,function(p,o){switch(p.type){case e.bool:p.idom.checked=this.start_state[o];
break;
case e.radio:var r=p.idom;
for(var q=0;
q<r.children.length;
q++){r.children[q].checked=r.children[q].value===this.start_state[o];
}break;
}},this);
},hide:function(o){if(!o){this.revert_prefs();
}this.start_state={};
IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.popup.hide();
},handle_pref_change:function(p,o){var q=null;
if(o.type===e.bool){q=o.idom.checked;
}else{if(o.type===e.select){q=o.idom.value;
}else{if(o.type===e.color){q=this.color_picker.selected_id;
}}}d.log("got change event for pref %s to %s",o.pref,q);
},save_start_state:function(){this.originaly_selected_sound=this.selected_sound||"imo0";
this.start_state={};
d.foreach(a,function(p,o){switch(p.type){case e.bool:this.start_state[o]=p.idom.checked;
break;
case e.radio:var s=null;
var r=p.idom;
for(var q=0;
q<r.children.length;
q++){if(r.children[q].checked===true){s=r.children[q].value;
}}this.start_state[o]=s;
break;
}},this);
},load_preferences:function(){var o=IMO.Session.get().get_all_prefs();
this.change_sound(o["impref#beep"]||"imo0");
d.foreach(a,function(r,q){var u=[r.kind,q].join("#");
var w=o[u];
if(w===undefined){w=r.dfl;
}switch(r.type){case e.bool:r.idom.checked=r.invert?!w:w;
break;
case e.radio:var t=r.idom;
for(var s=0;
s<t.children.length;
s++){t.children[s].checked=t.children[s].value===w;
}break;
}},this);
},change_sound:function(o){if(!this.account||!this.account.premium){o="imo0";
}l.remove_class(this.sound_option[this.selected_sound],"selected-sound-option");
l.replace_content(this.your_sound,l(c.SOUND_NAME[o]));
l.add_class(this.sound_option[o],"selected-sound-option");
this.selected_sound=o;
},just_play_sound:function(o){Y.log(["JUSTPLAY",o]);
if(this.selected_sound){IMO.Sound.get().stop(this.selected_sound);
}IMO.Sound.get().play(o,true);
},build_dom:function(){a.desktop_notifications.disabled=!IMO.H5.is_supported();
this.dom=l.cdiv("preference-widget");
d.foreach(n,function(s,q){var t=l.cdiv("pref-section");
if(s.title!==undefined){var r=l.div(s.title,{"class":"pref-section-title"});
t.appendChild(r);
}d.foreach(s.options,function(y){var x=l.cdiv("pref-option");
var C=null;
switch(y.type){case e.bool:var u=l.get_unique_id();
var v=l.input({id:u,type:"checkbox",oncbchange:{func:this.handle_pref_change,args:y},context:this});
v.disabled=!!y.disabled;
C=v;
var z;
if(!y.text_span){z=l.label({"for":u},l.span(y.disabled?y.disabled_text:y.text,{"class":"pref-bool-text"}));
}else{z=l.span(y.disabled?y.disabled_text:y.text,{"class":"pref-bool-text"});
}x.appendChild(v);
x.appendChild(z);
break;
case e.radio:var w=l.div();
d.foreach(y.choices,function(D){var G=l.get_unique_id();
var E=l.input({type:"radio",id:G,name:y.name,value:D.value,"class":"pref-option",onclick:{func:this.handle_pref_change,args:D},context:this});
var F=l.label({"for":G},l.span(D.text,{"class":"pref-bool-text"}));
w.appendChild(E);
w.appendChild(F);
w.appendChild(l.br());
},this);
C=w;
x.appendChild(w);
break;
case e.select:var A=l.select({onchange:{func:this.handle_pref_change,args:y},context:this});
C=A;
d.foreach(y.sel,function(E){var D=l.option({value:E.val},E.text);
A.appendChild(D);
},this);
var B=l.span(y.text,{"class":"pref-select-text"});
x.appendChild(B);
x.appendChild(A);
break;
case e.color:this.color_picker=new i(y.colors,function(){this.handle_pref_change(null,y);
},this);
x.appendChild(this.color_picker.dom);
break;
}t.appendChild(x);
y.idom=C;
},this);
this.dom.appendChild(t);
},this);
this.sound_dd=new IMO.UIWidgets.Menu({context:this},l.div(l.div(this.your_sound=l.div({id:"your-sound"},c.SOUND_NAME[this.selected_sound]),l.div(l.sprite("icn_new_arrow"),{cls:"your-sound-down-arrow"}),l.div({cls:"clear"})),{cls:"your-sound-dd"}));
if(!this.account||!this.account.premium){this.sound_dd.add_option(l.div(l.div(l.div(l.sprite("premium_account")),{id:"get-premium-button"}),l.div("Availiable with Premium",{cls:"sound-option-name"}),{cls:"sound-option",id:"premium-option"}),function(){IMO.REUI.PremiumAccount.show();
},this);
}d.foreach(c.SOUND_NAME,function(r,s){var q=function(t){return function(u){this.just_play_sound(t);
this.change_sound(t);
};
};
this.sound_option[s]=l.div(r,{cls:"sound-option-name"});
this.sound_dd.add_option(l.div(l.div(l.div(l.sprite("icn_play"),{cls:"char-play"}),{cls:"play-sound-button",onclick:{func:function(u,t){u.stopPropagation();
this.just_play_sound(t);
},args:s},context:this}),this.sound_option[s],{cls:"sound-option"}),q(s),this);
},this);
l.replace_content(b,l.span(m("Play "),this.sound_dd.dom,m(" sound for new messages"),{id:"sound-dropdown-holder"}));
var o=[IMO.Constants.reui_modal_popup_button_width,IMO.Constants.reui_modal_popup_button_height];
var p;
this.dom.appendChild(p=l.cdiv("pref-controls",IMO.REUI.Button("grey",m("Cancel"),{cls:"cancel-button",onclick:function(q){IMO.MouseManager.get().handled(q,"pref-cancel-button");
this.canceled(q);
},context:this}),IMO.REUI.Button("blue",m("Save"),{cls:"save-button",onclick:function(q){IMO.MouseManager.get().handled(q,"pref-save-button");
this.saved(q);
},context:this}),l.cdiv("clear")));
l.css(p,{width:IMO.REUI.Button.sizes[0]+IMO.REUI.Button.sizes[1]+20});
}});
var f=null;
h.show=function(){if(f===null){f=new g();
}IMO.Stats.increment_counter("show_preferences");
f.show();
};
h.hide=function(){if(f){f.hide();
}};
}());
(function(){var q=IMO.Constants;
var e=IMO.Utils;
var k=e.HTML;
var x=e.TranslateDom;
var h=e.TranslateTxt;
var u=x("We got an unexpected internal error. Feel free to contact support@imo.im for assistance.");
var t=x("You can sign up for a Premium Account after being on the imo Network for 30 days.");
var d=x("Congratulations on becoming an imo Premium Account member! A confirmation email has been sent to you.");
var g=[x("The option to remove ads"),x("A premium account badge next to your profile"),x("Extra communication points per day"),k.a({href:"http://www.youtube.com/watch?v=cPiBp2F9NiU",target:"_blank"},x("12 new sound notification options on the web")),x("More exclusive features to come!")];
var c=x("Stand out on imo by upgrading to a Premium Account.");
var a=x("Benefits:");
var y=x("Thanks for using imo!");
var o=x("Congratulations on upgrading to an imo Premium Account!");
var m=x("We hope you're enjoying:");
var l="Your Premium Account will be renewed and your credit card charged [COST] on [DATE].";
var b=x("If you cancel your Premium Account, you will lose:");
var z="If you choose to cancel your subscription, you will continue to have access to your Premium Account benefits until [DATE].";
var w=x("Before you go, please tell us why:");
var v=x("If you have any additional comments, please enter them here: ");
var n=[h("I don't find the premium account benefits useful."),h("I don't use imo often enough to pay for a premium account."),h("I have a privacy concern."),h("I would rather buy a cup of coffee."),h("Other reason(s): ")];
var s="You will retain your subscription until [DATE].";
var r=x("Until then you will continue to have:");
var p=x("Thank you for supporting imo, and we hope to see you again as a Premium Account member soon!");
var j="Your credit card will be charged [COST].";
var i=x("You will be automatically charged again in one year to renew your Premium Account. You can cancel your renewal at any time.");
var f;
IMO.REUI.PremiumAccount=function(){this.on(IMO.Session.get());
this.account=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!this.account){this.failed=true;
return;
}this.premium_account_price=499;
IMO.Network.get().send("imo_account","get_premium_account_price",{uid:this.account.uid},true,function(A){Y.log(["get_premium_account_price",A]);
this.premium_account_price=A;
if(this.account.premium_subscribed){this.show_already_premium_account();
}else{if(this.account.premium){this.show_cancelled();
}else{this.show_get_premium_account();
}}},this);
};
IMO.REUI.PremiumAccount.show=function(){if(!f){f=new IMO.REUI.PremiumAccount();
if(f.failed){f=null;
}}};
Y.mix(IMO.REUI.PremiumAccount.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PremiumAccount.prototype,{reload_popup:function(B,A){if(this.popup){this.popup.hide();
this.popup.destroy();
this.unsubscribe_all();
this.popup=null;
IMO.KeyboardManager.get().pop(this.sc_uid);
}this.popup=new IMO.ModalPopup(this);
if(A===undefined){this.popup.set_content(this.dom,[500,NaN]);
}else{this.popup.set_content(this.dom,[A,NaN]);
}if(B===null){this.popup.set_title(null);
}else{this.popup.set_title(h(B));
}this.popup.prepare();
this.popup.show();
this.payment_form_showing=false;
},hide:function(){this.payment_form_showing=false;
if(this.message_listener){this.message_listener.detach();
this.message_listener=null;
}this.popup.hide();
this.popup.destroy();
this.unsubscribe_all();
this.popup=null;
IMO.KeyboardManager.get().pop(this.sc_uid);
f=null;
},availability_response_handler:function(A){this.is_available=A;
if(A===false&&this.payment_form_showing){k.replace_content(k.dom("new-user-error"),t);
k.replace_content(this.dom,k.cdiv("premium-form-text",x("You must use imo a bit more before you are eligible for a premium account.")),k.cdiv("premium-form-text",x("Check back here after you have had an imo Network account for one month!")),k.cdiv("premium-form-text"),k.idiv("premium-submit-button",{style:{"text-align":"center"}},new IMO.UIWidgets.Button2(x("Close"),{onclick:this.hide,context:this}).dom));
this.reload_popup("Check back soon...");
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.hide}},bottom:true,context:this});
}},show_get_premium_account:function(){if(!window.JSON){this.dom=new IMO.REUI.ConfirmModalPopup("Sorry!",h("Your web browser is not supported. Try Google Chrome or Mozilla Firefox."),[[x("OK"),"blue"]],function(){f=null;
},this);
return;
}var B=k.ul({cls:"go-premium-benefits"});
for(var A=0;
A<g.length;
A++){B.appendChild(k.li({cls:"go-premium-benefit helvetica-neue"},g[A]));
}this.img=null;
this.request_id=this.account.profile.profile_uid_call("get_profile",{},this,function(E){var D=q.imo_profile_picture_width;
var C=q.imo_profile_picture_height;
var F=E.result.profile_photo_id?("/o/"+E.result.profile_photo_id+""+D+"x"+C+"c"):q.DEFAULT_BICON;
this.picture_loader=new IMO.REUI.ImageLoader(this.img,F,20,false);
});
this.dom=k.div(k.sprite("go_premium"),k.sprite("premium_icn_close",{id:"go-premium-close",onclick:this.hide,context:this}),k.idiv("go-premium-two-parts",k.idiv("go-premium-left-side",k.idiv("go-premium-avatar-div",this.img=k.img(),k.div({cls:"sprite_pic_frame",id:"go-premium-avatar-frame"}))),k.div({id:"go-premium-right-side",cls:"helvetica-neue"},k.idiv("go-premium-hey",x("Hey [NAME],",{NAME:this.account.alias.split(" ")[0]})),k.cdiv("go-premium-text-field",c),k.cdiv("go-premium-text-field",a),B,k.cdiv("already-premium-text-field",y),k.div({cls:"sprite_btn_upgrade",id:"upgrade-button",onclick:this.show_payment_form,context:this},k.idiv("upgrade-text",x("UPGRADE")))),k.cdiv("clear")),k.div({id:"go-premium-small-text",cls:"helvetica-neue"}));
this.reload_popup(null,600);
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.show_payment_form}},bottom:true,context:this});
this.is_available=true;
},show_payment_form:function(){this.submit_button=(new IMO.UIWidgets.Button2(x("Buy Premium"),{onclick:this.submit,context:this}));
var B=k.select({name:"Country",id:"address_country"});
for(var C=0;
C<q.COUNTRIES_ARRAY.length;
C++){if(q.COUNTRIES_ARRAY[C]==="United States"){B.appendChild(k.option({value:q.COUNTRIES_ARRAY[C],selected:"selected"},q.COUNTRIES_ARRAY[C]));
}else{B.appendChild(k.option({value:q.COUNTRIES_ARRAY[C]},q.COUNTRIES_ARRAY[C]));
}}var A=new Array(20);
for(C=0;
C<20;
C++){A[C]=k.cspan("premium-required-star","*");
}C=0;
var E="$"+Math.floor(this.premium_account_price/100)+"."+this.premium_account_price%100;
this.dom=k.div(k.cdiv("premium-form-text",x(j,{COST:k.cspan("premium-price",E)})),k.cdiv("premium-form-text",i),k.form({action:"#",id:"payment-form"},k.table({id:"premium-form-table"},k.tr(k.td({cls:"premium-form-headers",colspan:2},"Credit Card")),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("Number:"),A[C++]))),k.td(k.input({cls:"premium-input-field",type:"text",size:"40",autocomplete:"off",id:"number"}))),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("Verification Code:"),A[C++]))),k.td(k.input({cls:"premium-input-field",type:"text",size:"4",autocomplete:"off",id:"cvc"}),k.span({id:"cvc-tooltip"},k.sprite("icn_info"),k.span(k.sprite("card_cvc"))))),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("Expiration Date:"),A[C++]))),k.td(k.input({cls:"premium-input-field",type:"text",size:"3",id:"exp_month",placeholder:"MM"}),k.span("  "),k.input({cls:"premium-input-field",type:"text",size:"5",id:"exp_year",placeholder:"YYYY"}))),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("Cardholder's Name:"),A[C++]))),k.td(k.input({cls:"premium-input-field",type:"text",size:"40",autocomplete:"off",id:"cardholder_name",placeholder:h("As shown on the card")}))),k.tr(k.td({cls:"premium-form-headers",colspan:2},"Billing Information")),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("Address Line:"),A[C++]))),k.td(k.input({cls:"premium-input-field",type:"text",size:"40",autocomplete:"off",id:"address_line1",placeholder:h("Street address, P.O. box, company name, c/o")}))),k.tr(k.td(k.cdiv("premium-form-label","Address Line:")),k.td(k.input({cls:"premium-input-field",type:"text",size:"40",autocomplete:"off",id:"address_line2",placeholder:h("Apartment, suite, unit, building, floor, etc.")}))),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("City:"),A[C++]))),k.td(k.input({cls:"premium-input-field",type:"text",size:"20",autocomplete:"off",id:"address_city"}))),k.tr(k.td(k.cdiv("premium-form-label","State / Province / Region:")),k.td(k.input({cls:"premium-input-field",type:"text",size:"20",autocomplete:"off",id:"address_state"}))),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("ZIP / Postal Code:"),A[C++]))),k.td(k.input({cls:"premium-input-field",type:"text",size:"10",autocomplete:"off",id:"address_zip"}))),k.tr(k.td(k.cdiv("premium-form-label",k.span(x("Country:"),A[C++]))),k.td(B)),k.tr(k.td(),k.td(k.idiv("premium-submit-button",this.submit_button.dom),this.payment_loading=k.img({id:"payment-loading",src:"assets/loader_32.gif"}),this.required_text=k.idiv("required-text",k.span("Fields marked with "),A[C++],k.span(" are required.")),this.payment_errors=k.div({id:"payment-errors",cls:"premium-account-error-messages"}))))),this.new_user_error=k.div({id:"new-user-error",cls:"premium-account-error-messages"}));
k.hide(this.payment_loading);
if(document.getElementById("stripe")===null){var D=document.createElement("iframe");
D.src=q.STRIPE_IFRAME_URL;
D.id="stripe";
D.style.display="none";
document.body.appendChild(D);
}this.message_listener=k.on("message",this.stripe_response_handler,window,this);
this.reload_popup("Upgrade to a Premium Account!");
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.submit}},bottom:true,context:this});
this.payment_form_showing=true;
this.availability_response_handler(this.is_available);
},stripe_response_handler:function(F){var E=F._event;
if(E.origin!==q.STRIPE_IFRAME_DOMAIN){return;
}var B=JSON.parse(E.data);
if(B.error){k.hide(this.payment_loading);
this.submit_button.enable();
k.add_class(k.dom(B.error.param),"premium-highlighted-input");
var D="Your card information seems invalid.";
if(B.error.param==="exp_month"){D="The expiration month seems invalid!";
}if(B.error.param==="exp_year"){D="The expiration year seems invalid!";
}if(B.error.param==="number"){D="Invalid card number!";
}if(B.error.param==="cvc"){D="Invalid verification code!";
}k.replace_content(k.dom("payment-errors"),x(D));
}else{var C=B.id;
var A={token_id:C};
IMO.Network.get().send("imo_account","purchase_premium_account",{uid:this.account.uid,payment_method:q.STRIPE_PAYMENT_METHOD,extra_data:A},true,this.purchase_response_handler,this);
}},submit:function(){if(this.submit_button.enabled===false){return false;
}this.submit_button.disable();
k.hide(this.required_text);
k.show(this.payment_loading);
var C={number:k.dom("number").value,cvc:k.dom("cvc").value,exp_month:k.dom("exp_month").value,exp_year:k.dom("exp_year").value,cardholder_name:k.dom("cardholder_name").value,address_line1:k.dom("address_line1").value,address_line2:k.dom("address_line2").value,address_city:k.dom("address_city").value,address_state:k.dom("address_state").value,address_zip:k.dom("address_zip").value,address_country:k.dom("address_country").value};
for(var B in C){if(C.hasOwnProperty(B)){k.remove_class(k.dom(B),"premium-highlighted-input");
}}var A=false;
for(B in C){if(C.hasOwnProperty(B)&&B!="address_line2"&&B!="address_state"&&C[B]===""){A=true;
k.add_class(k.dom(B),"premium-highlighted-input");
}}if(A){k.hide(this.payment_loading);
this.submit_button.enable();
k.replace_content(k.dom("payment-errors"),x("Please enter all required fields!"));
return false;
}document.getElementById("stripe").contentWindow.postMessage(JSON.stringify(C),q.STRIPE_IFRAME_DOMAIN);
return false;
},purchase_response_handler:function(A){k.hide(this.payment_loading);
Y.log(["response from backend",A]);
if(A.result==="success"){this.show_already_premium_account(true);
}else{this.submit_button.enable();
if(A.reason==="internal_error"){A.reason=u;
}else{if(A.reason==="new_user"){A.reason=t;
}else{if(A.reason==="card_error"){A.reason=A.message;
this.highlight_field_based_on_response(A.message);
}}}k.replace_content(k.dom("payment-errors"),k.span(A.reason));
}},highlight_field_based_on_response:function(A){if(A.search("card number")!==-1){k.add_class(k.dom("number"),"premium-highlighted-input");
}if(A.search("year")!==-1){k.add_class(k.dom("exp_year"),"premium-highlighted-input");
}if(A.search("month")!==-1){k.add_class(k.dom("exp_month"),"premium-highlighted-input");
}if(A.search("security code")!==-1){k.add_class(k.dom("cvc"),"premium-highlighted-input");
}if(A.search("CVC")!==-1){k.add_class(k.dom("cvc"),"premium-highlighted-input");
}if(A.search("ZIP")!==-1){k.add_class(k.dom("address_zip"),"premium-highlighted-input");
}if(A.search("Address line 1")!==-1){k.add_class(k.dom("address_line1"),"premium-highlighted-input");
}},show_already_premium_account:function(A){this.img=null;
this.request_id=this.account.profile.profile_uid_call("get_profile",{},this,function(H){var G=q.imo_profile_picture_width;
var F=q.imo_profile_picture_height;
var I=H.result.profile_photo_id?("/o/"+H.result.profile_photo_id+""+G+"x"+F+"c"):q.DEFAULT_BICON;
this.picture_loader=new IMO.REUI.ImageLoader(this.img,I,20,false);
});
var D=k.ul({cls:"go-premium-benefits"});
for(var C=0;
C<g.length;
C++){D.appendChild(k.li({cls:"go-premium-benefit helvetica-neue"},g[C]));
}var B="";
if(A===true){this.text_par_2=x("We hope you'll enjoy:");
this.text_par_3=x("A confirmation email has been sent to you.");
}else{var E="$"+Math.floor(this.premium_account_price/100)+"."+this.premium_account_price%100;
B=this.readable_date(this.account.premium_exp_date);
this.text_par_2=m;
this.text_par_3=x(l,{DATE:B,COST:k.cspan("premium-price",E)});
}this.dom=k.div(k.idiv("already-premium-top"),k.sprite("icn_close_new",{id:"go-premium-close",onclick:this.hide,context:this}),k.idiv("go-premium-two-parts",k.idiv("go-premium-left-side",k.idiv("go-premium-avatar-div",this.img=k.img(),k.div({cls:"sprite_pic_frame",id:"go-premium-avatar-frame"}))),k.div({id:"go-premium-right-side",cls:"helvetica-neue"},k.idiv("go-premium-hey",x("Hey [NAME],",{NAME:this.account.alias.split(" ")[0]})),k.cdiv("go-premium-text-field",o),k.cdiv("go-premium-text-field",this.text_par_2),D,k.cdiv("already-premium-text-field",this.text_par_3),k.div({id:"unsubscription-errors",cls:"premium-account-error-messages"}),k.div(k.div({cls:"sprite_btn_upgrade",id:"upgrade-button",onclick:this.hide,context:this},k.idiv("upgrade-text",x("OK"))),this.cancel_button=k.a({id:"unsubscribe-button",context:this,onclick:this.show_unsubscribe_form},x("Cancel Premium Account")))),k.cdiv("clear")));
if(A===true){k.hide(this.cancel_button);
}this.reload_popup(null,600);
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.hide}},bottom:true,context:this});
},show_unsubscribe_form:function(){var A=this.readable_date(this.account.premium_exp_date);
var C=k.ul({cls:"go-premium-benefits"});
for(var B=0;
B<g.length;
B++){C.appendChild(k.li({cls:"go-premium-benefit helvetica-neue"},g[B]));
}var E=k.form();
var D=null;
for(B=0;
B<n.length;
B++){E.appendChild(D=k.cdiv("unsubscribe-reason already-premium-text-field",k.input({cls:"unsubscribe-reason-radio-button",type:"radio",name:"reasons",id:"reason#"+B,value:n[B]}),k.label({"for":"reason#"+B,cls:"unsubscribe-reason-label"},n[B])));
}D.appendChild(k.input({type:"text",size:"40",id:"other-reason",onclick:function(){k.dom("reason#"+(n.length-1)).checked=true;
}}));
this.dom=k.span(k.cdiv("already-premium-text-field",b),C,k.cdiv("already-premium-text-field",x(z,{DATE:A})),k.cdiv("reasons-text",{cls:" already-premium-text-field"},w),E,k.cdiv("reasons-text",{cls:" already-premium-text-field"},v,k.textarea({rows:"3",cols:"55",id:"additional-comments"})),k.div((new IMO.UIWidgets.Button2(x("Yes, cancel my subscription"),{context:this,onclick:function(){var G=E.reasons;
for(var F=0;
F<G.length-1;
F++){if(G[F].checked===true){this.unsubscribe_from_premium(G[F].value,k.dom("additional-comments").value);
return;
}}this.unsubscribe_from_premium(k.dom("other-reason").value,k.dom("additional-comments").value);
}})).dom,(new IMO.UIWidgets.Button2(x("Remain subscribed"),{onclick:this.hide,context:this})).dom,this.unsubscribe_loading=k.img({id:"unsubscribe-loading",src:"assets/loader_32.gif"})));
k.hide(this.unsubscribe_loading);
this.reload_popup("Cancel Premium Account");
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide}},bottom:true,context:this});
},unsubscribe_from_premium:function(A,B){if(A===""){A="not given";
}k.show(this.unsubscribe_loading);
IMO.Network.get().send("imo_account","cancel_premium_subscription",{uid:this.account.uid,reason:A,comment:B},true,this.unsubscription_response_handler,this);
},readable_date:function(A){return(new Date(A*1000)).toDateString();
},unsubscription_response_handler:function(A){k.hide(this.unsubscribe_loading);
Y.log(["response to unsubscription",A]);
if(A.result==="success"){this.show_cancelled();
}else{if(A.reason==="internal_error"){A.reason=u;
}k.replace_content(k.dom("unsubscription-errors"),k.span(A.reason));
}},show_cancelled:function(){var A=this.readable_date(this.account.premium_exp_date);
var C=k.ul({cls:"go-premium-benefits"});
for(var B=0;
B<g.length;
B++){C.appendChild(k.li({cls:"go-premium-benefit helvetica-neue"},g[B]));
}this.dom=k.span(k.cdiv("already-premium-text-field",x(s,{DATE:A})),k.cdiv("already-premium-text-field",r),C,k.cdiv("already-premium-text-field",p,k.cdiv("premium-ok-button",(new IMO.UIWidgets.Button2("OK",{onclick:this.hide,context:this})).dom)));
IMO.Network.get().send("pin","get_account_data",{uid:this.account.uid,proto:q.PROTO_IMO});
this.reload_popup("Your Premium Account has been cancelled");
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.hide}},bottom:true,context:this});
}});
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=a.sprintf;
var d=IMO.Constants;
IMO.REUI.PromoDisplay=function(){this.dom=c.cdiv("promo-display",this.content=c.cdiv("promo-content",{onclick:function(){IMO.Stats.log_event("promo_click",{id:this.id,ssid:IMO.Network.get().ssid});
this.on_promo_empty();
IMO.Promo.get().hide(1*24*60*60*1000);
},context:this}),this.close_button=c.sprite("icn_close",{onclick:function(f){IMO.Stats.log_event("promo_close",{id:this.id,ssid:IMO.Network.get().ssid});
this.on_promo_empty();
IMO.Promo.get().hide(1*24*60*60*1000);
},context:this}));
c.hide(this.dom);
this.id=null;
this.on(IMO.Promo.get());
IMO.Promo.get().on_display();
};
Y.mix(IMO.REUI.PromoDisplay.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PromoDisplay.prototype,{on_promo_arrival:function(e,f){Y.log("Promo arrived!");
this.content.innerHTML=e;
c.replace_content(this.dom,this.content,this.close_button);
c.show(this.dom);
this.id=f;
},on_promo_empty:function(){Y.log("Empty promo!");
c.empty(this.content);
c.hide(this.dom);
},display_ad:function(){IMO.Stats.log_event("ad_impression",{ssid:IMO.Network.get().ssid});
c.replace_content(this.content,c.iiframe("ad_iframe",{"class":"ad-iframe",src:"https://ads.imo.im/ad.html",scrolling:"no",frameborder:"no",marginheight:"0px",marginwidth:"0px"}));
c.replace_content(this.dom,this.content);
c.show(this.dom);
}});
}());
(function(){var b=IMO.Utils.HTML;
var a=IMO.Utils;
IMO.REUI.RadioButtonGroup=function(c){this.id=(c===undefined)?a.create_uid():c;
this.ev=new IMO.Event();
this.value="";
this.buttons={};
};
Y.mix(IMO.REUI.RadioButtonGroup.prototype,{set_value:function(c){if(c!==this.value&&this.buttons[c]){this.value=c;
this.buttons[c].checked=true;
this.ev.fire("on_set_value",this,c);
}},create_radio_button:function(e,d){var c=b.input({type:"radio",name:this.id,context:this,oncbchange:function(f){IMO.MouseManager.get().handled(f,"vim-mic-select-radio");
Y.log(["radio button changed",c.checked,this.id]);
if(c.checked){this.set_value(e);
}}});
this.buttons[e]=c;
c.checked=d?true:false;
return c;
}});
}());
(function(){var b=IMO.Utils;
var c=IMO.Utils.HTML;
var d=IMO.Constants;
var a=IMO.MoveNet.mouse_event_filter_creator(1);
IMO.REUI.SliderBar=function(e,o,j,n,f,k,g){this.orientation=e;
this.min=o;
this.max=j;
this.range=j-o;
this.length=f;
this.value=(typeof(n)!=="undefined"?n:(g?g[0]:(o+j)/2));
this.interactible=k;
this.values=g;
var l=[];
if(g){this.discrete_distance=this.length/(this.values.length-1);
for(var h=0;
h<this.values.length;
++h){var m=c.cdiv("tick_placer",c.cdiv("tick",{style:{left:(h*this.discrete_distance)+"px"}}));
l.push(m);
}}this.knob_placer=c.cdiv("knob_placer",c.cdiv(e===IMO.REUI.SliderBar.HORIZONTAL_BAR?"knob sprite_thumb_classic_x":"knob sprite_thumb_classic_y"));
l.push(this.knob_placer);
this.dom=c.cdiv(e===IMO.REUI.SliderBar.HORIZONTAL_BAR?"horiz_slider_bar_outer_area":"vert_slider_bar_outer_area",this.interactible?{onmousedown:function(p){IMO.MoveNet.attach_move_net(this.on_move,this);
var i=Y.DOM.getXY(this.rail);
this.pos_on_click=this.get_position(i);
this.move_cursor_on_event(p);
b.clear_selection();
},onmouseup:function(i){this.disconnect_move_net();
},context:this}:{},this.rail=c.cdiv(e===IMO.REUI.SliderBar.HORIZONTAL_BAR?"inner_area sprite_rail_classic_x":"inner_area sprite_rail_classic_y",l));
this.ev=new IMO.Event();
if(e===IMO.REUI.SliderBar.HORIZONTAL_BAR){this.rail.style.width=this.dom.style.width=f+"px";
}else{this.rail.style.height=this.dom.style.height=f+"px";
}this.set_value(this.value);
};
IMO.REUI.SliderBar.HORIZONTAL_BAR="horizontal";
IMO.REUI.SliderBar.VERTICAL_BAR="vertical";
Y.mix(IMO.REUI.SliderBar.prototype,{get_position:function(e){return this.orientation===IMO.REUI.SliderBar.HORIZONTAL_BAR?e[0]:e[1];
},on_move:function(g){b.clear_selection();
var f=a(g);
if(f==="smartmove"){this.move_cursor_on_event(g);
}if(f==="smartup"){this.disconnect_move_net();
}},move_cursor_on_event:function(f){this.move_cursor_to_position(this.get_position([f.clientX,f.clientY])-this.pos_on_click);
},move_cursor_to_position:function(e){if(this.orientation===IMO.REUI.SliderBar.VERTICAL_BAR){e=this.length-e;
}if(e<0){e=0;
}if(e>this.length){e=this.length;
}var g;
if(this.values){var f=Math.round(e/this.discrete_distance);
g=this.values[f];
}else{g=this.min+(this.range*e/this.length);
}if(g!==this.value){this.set_value(g);
}},disconnect_move_net:function(){if(IMO.MoveNet.is_attached()){IMO.MoveNet.detach_move_net(this.on_move,this);
}},set_value:function(g){var e;
if(this.values){for(var f=0;
f<this.values.length;
++f){if(g===this.values[f]){break;
}}if(f==this.values.length){g=this.values[0];
f=0;
}e=this.discrete_distance*f;
}else{e=(g-this.min)/this.range*this.length;
}this.value=g;
if(this.orientation===IMO.REUI.SliderBar.HORIZONTAL_BAR){this.knob_placer.style.left=e+"px";
}else{this.knob_placer.style.top=(this.length-e)+"px";
}this.ev.fire("on_set_value",this,g);
},get_value:function(){return this.value;
}});
IMO.REUI.VolumeIndicator=function(e,h,f,g){this.min=e;
this.max=h;
this.range=h-e;
this.width=d.sprite_vol_ind_foreground_width;
this.value=(typeof(f)==="undefined"?(e+h)/2:f);
if(g){g="_"+g;
}else{g="";
}this.dom=c.cdiv("volume_indicator volume_indicator_container"+g,c.cdiv("volume_image sprite_vol_ind_background"+g),this.knob=c.cdiv("volume_image sprite_vol_ind_foreground"+g));
this.set_value(this.value);
};
Y.mix(IMO.REUI.VolumeIndicator.prototype,{set_value:function(f){this.value=f;
var e=(f-this.min)/this.range*this.width;
this.knob.style.width=e+"px";
}});
IMO.REUI.ValueListener=function(g,e,f){this.widget=g;
this.cb=e;
if(f){this.on(g);
}};
Y.mix(IMO.REUI.ValueListener.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.ValueListener.prototype,{on_set_value:function(f,e){this.cb(f,e);
},connect:function(){this.on(this.widget);
},disconnect:function(){this.unsubscribe(this.widget);
}});
}());
(function(){var b=IMO.Utils;
var d=b.HTML;
var c=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
var a=20;
IMO.REUI.SpamReportWidget=function(j,h,k,g){this.states=[{value:"spam",label:"This person is sending me spam or scams "},{value:"photo",label:"Inappropriate profile photo"},{value:"harassment",label:"This person is harassing me "},{value:"broadcast",label:"Inappropriate broadcast "},{value:"tags",label:"Inappropriate tags "},{value:"fake",label:"This profile is fake or pretending to be another person"},{value:"under_13",label:"This person is less than 13 years of age"}];
this.xuid=j;
this.displaylias=h;
this.conv=k;
this.bid=g;
if(!k){var i=IMO.Session.get().get_imo_account();
if(i){var f=i.get_buddy(j);
if(f){this.conv=f.conversation;
}}}this.build_dom();
this.popup=new IMO.ModalPopup(this);
this.popup.set_title(e("Report [BUDDY_ALIAS]",{BUDDY_ALIAS:h}));
this.popup.set_content(this.dom,[350,350]);
this.popup.prepare();
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.save}},bottom:true,context:this});
this.popup.show();
};
Y.mix(IMO.REUI.SpamReportWidget.prototype,{build_dom:function(){this.dom=d.cdiv("spam-report-widget");
this.data={spam_state:[]};
var i=d.cdiv("spam-report");
this.dom.appendChild(i);
var h=d.div("Please indicate why you are reporting this profile: ");
i.appendChild(h);
b.foreach(this.states,function(p,m){var n=d.cdiv("spam-type");
var r=d.get_unique_id();
var o=d.input({type:"radio",id:r,name:"spam-states",context:this,value:p.value});
var q=d.label({"for":r},d.span(p.label,{"class":"spam-text"}));
i.appendChild(n);
n.appendChild(o);
n.appendChild(q);
this.data.spam_state.push(o);
},this);
this.data.spam_state[0].checked=true;
if(this.conv){var l=d.cdiv("add-conv");
i.appendChild(l);
var k=d.get_unique_id();
var f=d.input({id:k,type:"checkbox",context:this,checked:true});
this.data.add_conv=f;
var j=d.label({"for":k},d.span("Add last 20 messages from the conversation",{"class":"spam-text"}));
l.appendChild(f);
l.appendChild(j);
}var g;
this.dom.appendChild(g=d.cdiv("spam-controls",IMO.REUI.Button("grey",c("Cancel"),{cls:"cancel-button",onclick:function(m){IMO.MouseManager.get().handled(m,"spam-cancel-button");
this.hide();
},context:this}),IMO.REUI.Button("blue",c("Submit"),{cls:"save-button",onclick:function(m){IMO.MouseManager.get().handled(m,"spam-blame-button");
this.save(m);
},context:this}),d.cdiv("clear")));
d.css(g,{width:IMO.REUI.Button.sizes[0]+IMO.REUI.Button.sizes[1]+20});
},save:function(){var i=null;
b.foreach(this.data.spam_state,function(k){if(k.checked){Y.log(k);
i=k.value;
return k.value;
}},this);
this.hide();
var f=null;
if(i==="broadcast"||i==="tags"){f=this.bid;
}var j=[];
if(this.conv&&this.data.add_conv.checked){j=this.conv.history.length>a?this.conv.history.slice(-a):this.conv.history;
}var h=IMO.Session.get().get_imo_account();
var g={ssid:IMO.Network.get().ssid,uid:h.uid,proto:h.proto,xuid:this.xuid,report_type:i,history:j,item_id:f};
h.send("report",g,"pin");
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.popup.hide();
},destroy:function(){this.popup.destroy();
delete this.popup;
}});
}());
(function(){var c=IMO.Utils;
var h=c.HTML;
var d=c.sprintf;
var a=IMO.Constants;
var i=IMO.Utils.TranslateDom;
var g=IMO.Utils.TranslateTxt;
var e={available:"icn_greenstatus",busy:"icn_redstatus",invisible:"icn_invisiblestatus",away:"icn_orangestatus"};
var b=["status-view","status-edit","status-menu"];
var f=c.map(e,function(j){return"sprite_"+j;
});
IMO.REUI.StatusConsole=function(){this.dom=h.cdiv("status-console",this.box=h.cdiv("status-box",{title:g("Update your status")},this.st_i=h.sprite("icn_greenstatus"),this.st_s=h.span(),this.inp=h.input({type:"text",cls:"status-input"}),this.btn=h.cdiv("dd-button",{cls:"sprite_frm_dropdown"})));
this.menu_container=h.cdiv("status-console dummy",this.menu=h.cdiv("menu"));
h.add_class(this.dom,"status-view");
h.on("click",this.handle_box_click,this.box,this);
h.on("click",this.handle_btn_click,this.btn,this);
h.on("blur",this.handle_status_edit_blurred,this.inp,this);
h.on("key",this.handle_status_edit,this.inp,"press:13,27",this);
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.handle_esc}},context:this,weight:IMO.KeyboardManager.exec_weight.status_console});
this.saved=IMO.Session.get().get_pref("impref","savedStatuses",[]);
if(IMO.Session.get().status!==""){this.saved.push(IMO.Session.get().status);
}this.fill_menu();
this.on(IMO.Session.get());
this.on_status(IMO.Session.get().primitive,IMO.Session.get().status,IMO.Session.get().ad,IMO.Session.get().auto_away);
IMO.MouseManager.get().register(this.handle_window_click,this);
};
Y.mix(IMO.REUI.StatusConsole.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.StatusConsole.prototype,{handle_window_click:function(l,j){var k=IMO.MouseManager.get().check_handled("statusconsole*");
if(!k&&this.get_state()!=="status-view"){this.change_state("status-view");
}},fill_menu:function(){var k=h.cdiv("menu");
var j=[a.PRIM_AVAILABLE,a.PRIM_BUSY];
if(!IMO.Session.get().auto_away){j.splice(1,0,a.PRIM_AWAY);
}var l=h.cdiv("statuses");
k.appendChild(l);
this.saved.unshift("");
c.foreach(j,function(n){c.foreach(this.saved,function(p){var o=p||n;
l.appendChild(h.cdiv("status",{onclick:{func:this.handle_menu_click,args:{prim:n,stat:p}},context:this},h.sprite(e[n]),h.span(o)));
},this);
},this);
this.saved.shift("");
l.appendChild(h.cdiv("status",{onclick:{func:this.handle_menu_click,args:{prim:a.PRIM_INVISIBLE}},context:this},h.sprite(e[a.PRIM_INVISIBLE]),h.span("invisible")));
var m=h.cdiv("actions");
k.appendChild(m);
if(this.saved.length>0){m.appendChild(h.cdiv("action",h.sprite("icn_delete"),h.span(i("Clear saved statuses")),{onclick:{func:this.handle_menu_click,args:{action:"clear-statuses"}},context:this}));
}m.appendChild(h.cdiv("action",this.ad_checkbox=h.input({type:"checkbox",oncbchange:this.handle_ad_change_cb,context:this}),h.span(i("Add imo to your status")),{onclick:this.handle_ad_line_click,context:this}));
m.appendChild(h.cdiv("action",this.away_checkbox=h.input({type:"checkbox",oncbchange:this.handle_away_change_cb,context:this}),h.span(i("Auto set away when idle")),{onclick:this.handle_away_line_click,context:this}));
this.ad_checkbox.checked=(IMO.Session.get().ad!=="");
this.away_checkbox.checked=IMO.Session.get().auto_away;
this.menu_container.replaceChild(k,this.menu);
this.menu=k;
},handle_status_edit:function(j){this.inp.blur();
},handle_status_edit_blurred:function(k){Y.log("status edit");
if(this.get_state()!=="status-edit"){return;
}if(k.kb_bottom){k.kb_bottom();
}if((k.type==="keypress"||k.type==="keydown")&&k.keyCode===IMO.KeyboardManager.name2code.esc){this.inp.value="";
Y.log("doing nothing");
this.change_state("status-view");
return;
}var j=this.inp.value;
Y.log("entered",j);
IMO.Session.get().set_status({status:j});
this.change_state("status-view");
this.update_saved_statuses(j);
},handle_menu_click:function(k,j){IMO.MouseManager.get().handled(k,"statusconsole-menu-item");
Y.log("handle_menu_click");
if(this.get_state()!=="status-menu"){throw"WTF";
}if(j.action==="clear-statuses"){this.saved=[];
if(IMO.Session.get().status!==""){IMO.Session.get().set_status({status:""});
}this.update_saved_statuses();
this.fill_menu();
}else{if(j.prim!==undefined){j.stat=c.dfl(j.stat,"");
IMO.Session.get().set_status({primitive:j.prim,status:j.stat});
}}this.change_state("status-view");
},handle_btn_click:function(l){IMO.MouseManager.get().handled(l,"statusconsole-dd-button");
Y.log("handle_btn_click");
var j=this.get_state();
if(j==="status-edit"){throw"WTF";
}var k=j==="status-menu"?"status-view":"status-menu";
this.change_state(k);
},handle_box_click:function(k){if(k.target._node===this.btn){return;
}IMO.MouseManager.get().handled(k,"statusconsole-box");
var j=this.get_state();
if(j==="status-edit"){return;
}this.inp.value=IMO.Session.get().status;
this.change_state("status-edit");
},handle_ad_line_click:function(j){if(IMO.MouseManager.get().check_handled("statusconsole-menu-item-ad")||j.target._node===this.ad_checkbox){return;
}IMO.MouseManager.get().handled(j,"statusconsole-menu-item-ad-line");
this.ad_checkbox.checked=!this.ad_checkbox.checked;
this.handle_ad_change();
},handle_away_line_click:function(j){if(IMO.MouseManager.get().check_handled("statusconsole-menu-item-away")||j.target._node===this.away_checkbox){return;
}IMO.MouseManager.get().handled(j,"statusconsole-menu-item-away-line");
this.away_checkbox.checked=!this.away_checkbox.checked;
this.handle_away_change();
},handle_ad_change_cb:function(j){IMO.MouseManager.get().handled(null,"statusconsole-menu-item-ad");
this.handle_ad_change();
},handle_away_change_cb:function(j){IMO.MouseManager.get().handled(null,"statusconsole-menu-item-away");
this.handle_away_change();
},handle_ad_change:function(){var j=this.ad_checkbox.checked?a.AD:"";
if(IMO.Session.get().ad===j){return;
}IMO.Session.get().set_status({ad:j});
},handle_away_change:function(){var j=this.away_checkbox.checked;
if(IMO.Session.get().auto_away===j){return;
}var k={auto_away:j};
if(j&&IMO.Session.get().primitive===a.PRIM_AWAY){k.primitive=a.PRIM_AVAILABLE;
}IMO.Session.get().set_status(k);
},handle_esc:function(k){var j=this.get_state();
if(j==="status-edit"){this.handle_status_edit(k);
}else{if(j==="status-menu"){k.kb_bottom();
this.change_state("status-view");
}}},update_saved_statuses:function(j){var k=Y.Array.indexOf(this.saved,j);
if(k===0||j===""){return;
}if(k!==-1){this.saved.splice(k,1);
}if(j!==undefined){this.saved.unshift(j);
}if(this.saved.length>4){this.saved.pop();
}this.fill_menu();
IMO.Session.get().set_prefs([{kind:"impref",pref:"savedStatuses",value:this.saved}]);
},change_state:function(k){var j=this.get_state();
h.mex_class(this.dom,k,b);
h.mex_class(this.menu_container,k,b);
if(this.menu_container.parentNode!=h.dom("imo")){h.dom("imo").appendChild(this.menu_container);
}if(k==="status-edit"){if(this.inp.value){this.inp.select();
}Y.later(10,this,function(){this.inp.focus();
});
}},on_recv_pref:function(k,j,l){if(k==="impref"&&j==="savedStatuses"){this.saved=l;
this.fill_menu();
}else{if(k==="impref"&&j==="imoStatus"){this.fill_menu();
}}},on_status:function(j,n,m,l){h.mex_class(this.st_i,"sprite_"+e[j],f);
var o="";
var k=[];
if(n){k.push(n||"");
}else{k.push(j||"");
}if(m){k.push(m||"");
}o=k.join(" -- ");
h.text(this.st_s,o);
this.ad_checkbox.checked=m?true:false;
this.away_checkbox.checked=l;
this.fill_menu();
},get_state:function(){var j=h.get_class_from(this.dom,b);
if(j===undefined){throw"WTF - no state?";
}return j;
},destroy:function(){this.unsubscribe_all();
IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
}});
}());
(function(){var a=IMO.Utils;
var b=a.HTML;
IMO.REUI.SuggestionWidget=function(h,f,d){this.hack_replace_me=d;
this.prop={};
Y.mix(this.prop,h);
this.suggestion_prop=f||{};
this.suggestion_prop.max_suggestions=a.dfl(this.suggestion_prop.max_suggestions,10);
this.ev=new IMO.Event();
var e={};
this.initial_value=h.value||"";
Y.mix(e,h);
var c=this;
var g=function(i){e[i]=function(){c[i].apply(c,arguments);
};
};
g("onkeydown");
g("onkeypress");
g("onkeyup");
g("onchange");
g("onblur");
g("onfocus");
this.input_dom=b.input(e);
this.last_known_value=null;
this.added_to_dom=false;
this.suggestion_dom=b.cdiv("input_suggestions");
b.chide(this.suggestion_dom);
this.close_suggestion_hover();
};
Y.mix(IMO.REUI.SuggestionWidget.prototype,{create_suggestion_hover:function(e,d){if(e!==this.value()){return;
}this.close_suggestion_hover();
this.suggestion_query=e;
if(!d||!d.length){return;
}if(!this.added_to_dom){b.dom("imo").appendChild(this.suggestion_dom);
this.added_to_dom=true;
}var c=Y.DOM.getXY(this.input_dom);
this.suggestion_dom.style.left=c[0]+"px";
this.suggestion_dom.style.top=(c[1]+this.input_dom.offsetHeight)+"px";
a.foreach(this.suggestion_prop,function(g,f){if(g==="input_width"){g=this.input_dom.offsetWidth+"px";
}this.suggestion_dom.style[f]=g;
},this);
b.cshow(this.suggestion_dom);
b.empty(this.suggestion_dom);
a.foreach(d.slice(0,this.suggestion_prop.max_suggestions),function(g,h){var j=g[0];
var i=g[1];
var f;
var k=b.cdiv("suggested_input "+((h%2===0)?"even_suggestion":"odd_suggestion"),{context:this,onmousedown:function(l){this.on_suggestion_click(l,g);
},onclick:function(l){this.on_suggestion_click(l,g);
}},f=b.div(j));
this.suggestion_dom.appendChild(k);
this.suggestion_doms.push([k,f,i]);
},this);
},schedule_close_suggestion_hover:function(){Y.later(500,this,this.close_suggestion_hover);
},close_suggestion_hover:function(){if(this.suggestion_query!==null){this.suggestion_query=null;
this.suggestion_doms=[];
this.current_suggestion=-1;
b.empty(this.suggestion_dom);
b.chide(this.suggestion_dom);
}},forward_call:function(d,c){if(this.prop[d]){this.prop[d].apply(this.prop.context,c);
}},on_possible_change:function(c){var d=this.input_dom.value;
if(d!==this.suggestion_query){this.close_suggestion_hover();
}if(d!==this.last_known_value){this.clicked_suggestion=null;
this.last_known_value=d;
this.ev.fire("on_input_changed",this,c);
}},value:function(){return this.input_dom.value;
},set_value:function(d,c){this.input_dom.value=d;
this.on_possible_change(c);
},remove_active_suggestion:function(){var c=this.current_suggestion;
if(c>=0&&c<this.suggestion_doms.length){b.remove_class(this.suggestion_doms[c][1],"selected_suggestion");
}},mark_active_suggestion:function(){var d=this.current_suggestion;
if(d>=0&&d<this.suggestion_doms.length){var c=this.suggestion_doms[d][2];
b.add_class(this.suggestion_doms[d][1],"selected_suggestion");
this.suggestion_query=c;
this.set_value(c,true);
}},on_suggestion_click:function(d,c){IMO.MouseManager.get().handled(d,"suggestion-widget-suggestion");
this.set_value(c[1]);
this.clicked_suggestion=c;
this.ev.fire("on_enter_key",this,true);
},on_key_pressed:function(d,f,c){var e=this.value();
Y.later(0,this,function(){var g=this.value();
if(e!==g){c.call(f,true);
return;
}if(d.keyCode===13){this.ev.fire("on_enter_key",this,true);
c.call(f,false);
return;
}this.clicked_suggestion=null;
if(d.keyCode===IMO.KeyboardManager.name2code["down arrow"]){Y.log("down arrow");
this.remove_active_suggestion();
this.current_suggestion+=1;
this.current_suggestion%=this.suggestion_doms.length;
this.mark_active_suggestion();
c.call(f,false);
return;
}if(d.keyCode===IMO.KeyboardManager.name2code["up arrow"]){Y.log("up arrow");
if(this.current_suggestion===-1){this.current_suggestion=0;
}this.remove_active_suggestion();
this.current_suggestion+=this.suggestion_doms.length-1;
this.current_suggestion%=this.suggestion_doms.length;
this.mark_active_suggestion();
c.call(f,false);
}c.call(f,true);
});
},onkeydown:function(c){this.on_key_pressed(c,this,function(d){if(d){this.forward_call("onkeydown",arguments);
}else{this.ignore_next_keypress=true;
}});
},onkeypress:function(c){this.on_key_pressed(c,this,function(d){if(this.ignore_next_keypress||d){this.ignore_next_keypress=false;
this.forward_call("onkeypress",arguments);
}});
},onkeyup:function(c){this.on_possible_change();
this.forward_call("onkeyup",arguments);
},onchange:function(c){this.on_possible_change();
this.forward_call("onchange",arguments);
},onblur:function(c){if(!this.hack_replace_me){Y.later(50,this,function(){b.mex_class(this.input_dom,"blurred",["focused","blurred"]);
this.input_dom.value=this.initial_value;
});
}this.schedule_close_suggestion_hover();
this.forward_call("onblur",arguments);
},onfocus:function(c){if(!this.hack_replace_me){b.mex_class(this.input_dom,"focused",["focused","blurred"]);
this.input_dom.value="";
}this.forward_call("onfocus",arguments);
},open:function(){},close:function(){this.close_suggestion_hover();
if(this.added_to_dom){b.dom("imo").removeChild(this.suggestion_dom);
this.added_to_dom=false;
}}});
}());
(function(){var e=IMO.Constants;
var c=IMO.Utils.HTML;
var a=IMO.Utils;
var b=a.TranslateDom;
var d=a.TranslateTxt;
var f=function(){};
IMO.REUI.TabsWidget=function(){this.dom=c.cdiv("tabswidget",this.tabs_dom=c.cdiv("tabs",this.clean_child=c.cdiv("new_line")),this.panel_dom=c.cdiv("panel"));
this.ev=new IMO.Event();
};
Y.mix(IMO.REUI.TabsWidget.prototype,{open:function(){this.open_panel();
},close:function(){this.close_panel();
},add_panel:function(g){this.tabs_dom.insertBefore(c.div({context:this,onclick:function(h){this.set_panel(g);
}},g.tab_dom),this.clean_child);
c.add_class(g.tab_dom,"tab");
},close_panel:function(){if(this.current_panel){c.remove_class(this.current_panel.tab_dom,"active_tab");
c.add_class(this.current_panel.tab_dom,"idle_tab");
this.current_panel.on_close();
}c.empty(this.panel_dom);
this.current_panel=null;
},open_panel:function(){c.remove_class(this.new_panel.tab_dom,"idle_tab");
c.add_class(this.new_panel.tab_dom,"active_tab");
this.current_panel=this.new_panel;
this.panel_dom.appendChild(this.current_panel.panel_dom);
this.current_panel.on_open();
this.ev.fire("on_tab_open",this,this.current_panel);
},set_panel:function(g){if(g===this.current_panel){return;
}this.close_panel();
this.new_panel=g;
this.open_panel();
}});
IMO.REUI.TabWidget=function(h,g){this.tabs_widget=h;
this.name=g;
this.tab_dom=c.cdiv("idle_tab",d(g));
this.panel_dom=c.div();
this.tabs_widget.add_panel(this);
};
Y.mix(IMO.REUI.TabWidget.prototype,{on_open:f,on_close:f});
}());
(function(){IMO.Texts={COMM_POINTS_HELP:"You may need communication points to message people who don't have you as a contact. Once they reply, messages to them no longer cost points for the rest of the day. You get any used communication points back after a day.",LINKING_HELP:"Linking accounts saves you time. It allows you to automatically sign into all of  your accounts when you sign into any one of them.",DOMAINS_HELP:"Enter your email address if you want your email domain name visible in your profile. Adding your email domain name will help you connect faster with people from the same company, school, etc. You will be required to verify your email.",PIN_TUTORIAL_1:"Use the directory to contact anyone on the imo network instantly.",PIN_TUTORIAL_2:'Open "Broadcasts" when you want to be included in the Broadcasts sidebar.',PIN_TUTORIAL_3:"Invite a few friends because it makes the network more useful."};
}());
(function(){var a=IMO.Utils;
var c=IMO.Utils.HTML;
var f=IMO.Constants;
var b=a.TranslateDom;
var e=a.TranslateTxt;
function g(h){return function(){if(h===null){return;
}var i=c.dom("thinui-container");
c.empty(i);
i.appendChild(h);
Y.DOM.removeClass(c.dom("buddies-tab"),"focused");
Y.DOM.removeClass(c.dom("chats-tab"),"focused");
Y.DOM.removeClass(c.dom("accounts-tab"),"focused");
Y.DOM.addClass(this,"focused");
IMO.WM.ThinWM.focused_window=null;
var j=IMO.WM.ThinWM.opened_windows;
a.foreach(j,function(k){k.fire("on_focus_change",false);
});
if(IMO.WM.ThinWM.preview){c.remove(IMO.WM.ThinWM.preview);
}};
}function d(h){function i(k){var j=c.sprite(k.icon,{cls:"icon"});
var l=c.span(k.title);
return{icon:j,title:l,dom:c.div({cls:"titlebar",onclick:function(m){k.wm.window_focus(k);
}},j,l,c.sprite("icn_close",{cls:"close",onclick:function(m){m.halt();
k.fire("on_close_request");
}})),set_title:function(m){c.replace_content(this.title,c(m));
},set_icon:function(m){c.css(this.icon,{cls:"icon sprite_"+m});
}};
}return{win_bar:i(h),list_bar:i(h),set_title:function(j){this.win_bar.set_title(j);
this.list_bar.set_title(j);
},set_icon:function(j){this.win_bar.set_icon(j);
this.list_bar.set_icon(j);
},set_attention:function(){c.toggle_class(this.list_bar.dom,"attention",h.need_att);
}};
}IMO.WM.Thin={};
IMO.WM.Thin.WindowManager=function(){this.opened_windows=[];
this.focused_window=null;
this.browser_focus=true;
var i=this;
var h=window.onresize;
window.onresize=function(j){if(i.focused_window){i.focused_window.fire("on_resize");
}if(h){h(j);
}};
};
Y.mix(IMO.WM.Thin.WindowManager.prototype,{aquire:function(){},release:function(){},window_focus:function(i){this.browser_focus=(i!==null);
if(!i||!i.content){return;
}i.fire("on_focus_change",true);
this.focused_window=i;
var h=c.dom("thinui-container");
c.empty(h);
h.appendChild(c.div(i.ui.titlebar.win_bar.dom,c.div(i.content)));
i.set_focus();
Y.DOM.removeClass(c.dom("buddies-tab"),"focused");
Y.DOM.removeClass(c.dom("accounts-tab"),"focused");
Y.DOM.addClass(c.dom("chats-tab"),"focused");
i.fire("on_resize");
},window_open:function(h){if(!h||!h.content){return;
}h.fire("on_resize");
h.ui.titlebar=d(h);
h.wm=this;
if(Y.Array.indexOf(this.opened_windows,h)===-1){this.opened_windows.push(h);
IMO.ThinUI.chat_list.add(h);
}},window_refocus:function(){},focus_next:function(){if(!this.browser_focus){this.browser_focus=true;
return;
}var j=null;
var h=this.opened_windows.length;
for(var k=0;
k<h;
k++){var l=this.opened_windows[k];
var m=(h+k-1)%h;
if(l.need_att){l.fire("set_focus");
return;
}else{if(this.opened_windows[m]===this.focused_window){j=l;
}}}if(j){j.fire("set_focus");
}},focus_prev:function(){var j=null;
var h=this.opened_windows.length;
for(var k=0;
k<h;
k++){var l=this.opened_windows[k];
var m=(k+1)%h;
if(l.need_att){j=l;
return;
}else{if(this.opened_windows[m]===this.focused_window){j=l;
}}}if(j){j.fire("set_focus");
}},window_close:function(h){IMO.ThinUI.chat_list.remove(h);
a.remove(this.opened_windows,h);
(g(IMO.ThinUI.chat_list.dom))();
Y.DOM.addClass(c.dom("chats-tab"),"focused");
h.fire("on_close");
},window_get_focus:function(h){return h===this.focused_window;
},window_set_icon:function(i,h){i.ui.titlebar.set_icon(h);
},window_set_title:function(h,i){h.ui.titlebar.set_title(i);
},window_set_attention:function(j,i){j.ui.titlebar.set_attention();
if(j.need_att){c.toggle_class(c.dom("chats-tab"),"needs_attn",true);
}else{var h=false;
a.foreach(this.opened_windows,function(k){if(k.need_att){h=true;
return;
}});
c.toggle_class(c.dom("chats-tab"),"needs_attn",h);
}j.fire("on_set_attention",i);
},window_set_preview:function(i,j){j=c.div(c.strong(i.title),": ",j);
if(this.preview){c.remove(this.preview);
}var h=IMO.REUI.MessagePreview(j);
this.preview=h;
c.set_off(h,[70,60+f.sprite_tooltip2_arrow_height]);
c.dom("imo").appendChild(h);
setTimeout(function(){c.remove(h);
},4000);
}});
IMO.ThinUI={};
IMO.ThinUI.chat_list={chat_list:[],dom:c.div({id:"chat-list"},c.div({cls:"no-open-chats"},b("You have no open chats. Click on a buddy to start chatting!"))),add:function(j,i){c.empty(this.dom);
this.chat_list.push(j);
var h=this;
a.foreach(this.chat_list,function(k){h.dom.appendChild(k.ui.titlebar.list_bar.dom);
});
},remove:function(i){a.remove(this.chat_list,i);
c.empty(this.dom);
var h=this;
a.foreach(this.chat_list,function(j){h.dom.appendChild(j.ui.titlebar.list_bar.dom);
});
if(this.chat_list.length===0){this.dom.appendChild(c.div({cls:"no-open-chats"},b("You have no open chats.")));
}}};
IMO.REUI.ThinUI=function(){IMO.Stats.log_event("popped_out",{popped_out:1});
var j=new IMO.REUI.BuddyPanel();
IMO.REUI.A=new IMO.REUI.Accounts();
var k=new IMO.REUI.StatusConsole();
var i=IMO.ThinUI.chat_list;
var h=new IMO.REUI.AccountIconDisplay();
return c.div({id:"thinui"},c.div({id:"thinui-container"},j.dom),c.sprite("pop_in",{id:"pop-in",onclick:function(){window.open("/");
window.close();
}}),h.dom,c.div({id:"status-console-container"},k.dom),c.div({cls:"tabs"},c.span({id:"buddies-tab",cls:"tab focused",onclick:g(j.dom)},b("Buddies")),c.span({id:"chats-tab",cls:"tab",onclick:g(i.dom)},b("Chats")),c.span({id:"accounts-tab",cls:"tab",onclick:g(IMO.REUI.A.dom)},b("Accounts"))),c.div({id:"main"},"a"));
};
IMO.REUI.ThinUIHeader=function(){return c.div({id:"thinui-header"});
};
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var c=a.sprintf;
IMO.REUI.Tooltip=function(){this.dom=null;
this.arrow=null;
this.content_container=null;
this.shown=false;
this.cbs=[];
this.tcb=null;
};
var b=IMO.REUI.Tooltip;
b.UP=1;
b.RIGHT=2;
b.DOWN=4;
b.LEFT=8;
b.SIDE=b.LEFT|b.RIGHT;
b.VERT=b.UP|b.DOWN;
var e=[[b.UP,"bottom"],[b.DOWN,"top"],[b.LEFT,"right"],[b.RIGHT,"left"]];
var f={};
a.foreach(e,function(g){f[g[0]]=g[1];
});
Y.mix(IMO.REUI.Tooltip.prototype,{decorate:function(i,h,j){this.dom=d.cdiv("tooltip",this.content_container=d.cdiv("tooltip-content shadow",this.content),this.arrow=d.cdiv("tooltip-arrow",{cls:"sprite_"+h}));
var g={};
g["margin-"+f[i]]=c("%dpx",d.sprite_size(h)[i&b.SIDE?0:1]-j);
d.css(this.content_container,g);
g={};
g[f[i]]="0px";
d.css(this.arrow,g);
},set_content:function(g){d.replace_content(this.content_container,this.content=g);
},hide:function(){if(!this.shown){return;
}d.chide(this.dom);
a.foreach(this.cbs,function(g){g.detach();
});
this.cbs=[];
if(this.tcb){this.tcb.cancel();
this.tcb=null;
}this.shown=false;
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var c=a.sprintf;
var b=a.TranslateDom;
IMO.REUI.Tutorial=function(f,e){this.infobox=[];
this.ids=e;
this.pre_show_funcs=[];
this.post_hide_funcs=[];
this.num_steps=f.length;
a.foreach(f,function(h,g){this.infobox.push(this.create_infobox(h,g+1,this.num_steps));
this.pre_show_funcs.push(null);
this.post_hide_funcs.push(null);
},this);
this.current_step=null;
};
Y.mix(IMO.REUI.Tutorial.prototype,{create_infobox:function(j,f,g){var i;
var e;
if(f==1){i=d.cdiv("tutorial-back-button disabled",b("Go back"));
}else{i=d.cdiv("tutorial-back-button enabled",{context:this,onclick:this.on_back},b("Go back"));
}if(f==g){e=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.stop},{cls:"tutorial-next-button"},b("Done"));
}else{e=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.on_next},{cls:"tutorial-next-button"},b("Next"));
}var h=d.cdiv("tutorial-hover",d.cdiv("tutorial-text",b(j)),d.cdiv("tutorial-navigation",d.cdiv("tutorial-page",d.span(c("%d of %d",f,g))),d.cdiv("tutorial-buttons",d.cspan("tutorial-back-container",i),d.cspan("tutorial-next-container",e.dom))));
return new IMO.REUI.InfoBox(h);
},set_action:function(g,f,e){this.pre_show_funcs[g]=f;
this.post_hide_funcs[g]=e;
},start:function(){if(this.current_step){this.hide_current();
}this.current_step=0;
this.show_current();
},stop:function(){this.hide_current();
this.current_step=null;
},show_current:function(){if(this.pre_show_funcs[this.current_step]){this.pre_show_funcs[this.current_step]();
}this.infobox[this.current_step].show(d.dom(this.ids[this.current_step]));
},hide_current:function(){this.infobox[this.current_step].hide();
if(this.post_hide_funcs[this.current_step]){this.post_hide_funcs[this.current_step]();
}},on_next:function(){if(this.current_step+1>=this.num_steps){return;
}this.hide_current();
this.current_step++;
this.show_current();
},on_back:function(){if(this.current_step===0){return;
}this.hide_current();
this.current_step--;
this.show_current();
}});
}());
(function(){var c;
IMO.UserFriendlyReason=c=function(i,h){if(c.reasons[i]===undefined){i="protocol";
}var g=c.reasons[i];
var e=IMO.Utils.TranslateDom;
var f=IMO.Utils.HTML;
var d=e(g,{SERVICE:IMO.Constants.PROTO_TO_UI[h.proto],ACCOUNT:h.uid});
if(i==="uidpassword"&&h.proto===IMO.Constants.PROTO_GTALK&&!h.is_oauth){d=f.span(d,e(" If you use two-factor authentication, please go "),f.a({href:"https://www.google.com/accounts/IssuedAuthSubTokens",target:"_blank"},e("here")),e(" and generate an application specific password for imo."));
}return d;
};
c.gtalk_reasons={access_denied:"Access denied"};
var b="Facebook requires you to sign in periodically in order to use Facebook Chat through imo. imo messenger no longer has access to your Facebook account. To continue to use Facebook Chat, you must sign in to your Facebook account again.";
c.reauth_reasons={};
c.reauth_reasons[IMO.Constants.PROTO_FACEBOOK]={"Token lacks permissions":"imo messenger no longer has access to chat on your Facebook account. Please try to sign in again and allow Access Facebook Chat.","App deauthorized":"imo messenger no longer has access to your Facebook account. To continue to use Facebook Chat, you must allow imo to access your Facebook account.","Password changed":"Your Facebook password has changed. To continue to use Facebook Chat, you must sign in to your Facebook account again.","Other error":b,"Token expired":b,"No token matching scope":b};
var a="imo messenger no longer has access to your Google Talk account. To continue to use Google Talk, you must allow imo to access your account.";
c.reauth_reasons[IMO.Constants.PROTO_GTALK]={access_denied:"imo messenger has no access to your Google Talk account. To use Google Talk, you must allow imo to access your account.","Access was denied":a,"Other error":a,"Grant is invalid":a,"Token is invalid":a,Unauthorized:a,"Error while refreshing token":"Google requires us to periodically request access to Google Talk on your behalf. imo messenger no longer has access to your Google Talk account. To continue to use Google Talk, you must sign in to your account again.","No token matching scope":a};
c.reauth_reasons[IMO.Constants.PROTO_MSN]={"Other error":"imo messenger no longer has access to your Messenger account. To continue to use MSN, you must allow imo to access your account."};
c.reauth_reasons[IMO.Constants.PROTO_YAHOO]={"Other error":"imo messenger no longer has access to your Yahoo! account. To continue to use Yahoo!, you must allow imo to access your account."};
c.reasons={uid:"Please enter a username and password",passwd:"Please enter a username and password",uidpassword:"Incorrect username and/or password.",protocol:"imo is having problems with [SERVICE]. Please try again later.",toooften:"You have been signing in too often to [SERVICE]. Please wait and try again later.",manyfailed:"Account locked: Too many failed login attempts. Logging into the Yahoo website may fix this",ywebsite:"Your account has been locked. Logging in to the Yahoo website may fix this.",location:"[ACCOUNT] on [SERVICE] has been signed off. It's possible you have signed on elsewhere","protocol temporary":"imo is having problems with [SERVICE]. Please try again later.",reconnecting:"imo is having problems with [SERVICE]. Attempting to reconnect...",connect:"imo is having problems with [SERVICE]. Please try again later",capacity:"We are unable to support Skype due to our inability to connect to their servers. We will update users if we are able to support Skype again in the future.",captcha:"Please complete this captcha.",signup_captcha:"Signup not completed yet.",verifyemail:"Please verify your e-mail first",deleted:"Your [SERVICE] account has been deleted",lapw:"We were unable to sign into linked account [ACCOUNT] on [SERVICE]. Please try entering your login credentials manually",steamguard:"This account is protected by SteamGuard. Please check your email for your Steam Access Code and enter it here:",AlreadyLoggedInElsewhere:"Your Steam account is already logged in on another computer. If you attempt to log on again, the other session will be disconnected.",LoggedInElsewhere:"Your Steam account was logged in on another computer.",InvalidLoginAuthCode:"Invalid Steam Access Token. Please try again","invalid credentials":"Invalid username or password, please check your typing and try again",oauth:"imo messenger no longer has access to your account. Please sign in again."};
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=a.TranslateDom;
var d=a.TranslateTxt;
var e="Voice IM: ";
IMO.REUI.VimWidget=function(){var f=this;
this.flash_dom=c.idiv("vim_flash",this.flash_pos=c.cdiv("flash_thing"));
this.flash_popup=new IMO.ModalPopup({hide:function(){f.hide_flash_popup();
}});
this.flash_popup.set_content(this.flash_dom,[220,138]);
this.flash_popup.set_title(d("Microphone access"));
this.flash_popup.prepare();
this.on(IMO.VIM);
};
Y.mix(IMO.REUI.VimWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.VimWidget.prototype,{show_flash_popup:function(){Y.log("Showing flash popup");
this.flash_popup.show();
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide_flash_popup},enter:{cb:this.hide_flash_popup}},context:this,bottom:true});
this.show_flash();
IMO.ResizeManager.register(this.show_flash,this);
},show_flash:function(){IMO.VIM.flash.show(this.flash_pos);
},hide_flash_popup:function(){IMO.VIM.on_panel_closed();
},do_hide_flash_popup:function(){IMO.VIM.flash.hide();
this.flash_popup.hide();
IMO.KeyboardManager.get().pop(this.sc_uid);
IMO.ResizeManager.unregister(this.show_flash,this);
},destroy_flash:function(){this.do_hide_flash_popup();
this.flash_popup.destroy();
this.flash_popup=null;
},show_options:function(){if(!this.options){this.init_options_popup();
}this.options_popup.show();
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide_options},enter:{cb:this.hide_options}},context:this,bottom:true});
this.set_options_microphone_levels();
this.start_options_timer();
},hide_options:function(){this.stop_options_timer();
this.options_popup.hide();
IMO.KeyboardManager.get().pop(this.sc_uid);
},init_options_popup:function(){var k=this;
this.options={mics:IMO.VIM.flash.call("get_mics"),level_indicator:[],radio_group:new IMO.REUI.RadioButtonGroup(),volume_slider:new IMO.REUI.SliderBar(IMO.REUI.SliderBar.HORIZONTAL_BAR,0,100,IMO.VIM.flash.call("get_volume"),100,true)};
this.on(this.options.radio_group);
this.on(this.options.volume_slider);
var m=c.cdiv("volume_select",c.cdiv("slider",this.options.volume_slider.dom),c.cdiv("name",b("Volume")),c.cdiv("clear"));
var g;
var l=c.table(g=c.tbody());
var n=c.cdiv("mic_volumes",l);
var f=IMO.VIM.flash.call("get_active_mic");
for(var j=0;
j<this.options.mics.length;
++j){this.options.level_indicator.push(new IMO.REUI.VolumeIndicator(0,100,50));
var h=this.options.mics[j];
g.appendChild(c.tr(c.td(c.cdiv("radio",this.options.radio_group.create_radio_button(h,h===f))),c.td(c.cdiv("volume",this.options.level_indicator[j].dom)),c.td(c.cdiv("name",h))));
}this.options_dom=c.cdiv("vim_options",m,c.h1("Select Microphone"),n,c.cdiv("buttons",IMO.REUI.Button("blue",b("Ok"),{cls:"save-button",onclick:this.hide_options,context:this})));
this.options_popup=new IMO.ModalPopup({hide:function(){k.hide_options();
}});
this.options_popup.set_content(this.options_dom,[300,NaN]);
this.options_popup.set_title(d("Voice IM settings"));
this.options_popup.prepare();
},stop_options_timer:function(){if(this.options&&this.options.timer){this.options.timer.cancel();
delete this.options.timer;
}},start_options_timer:function(){this.stop_options_timer();
if(this.options){this.options.timer=Y.later(100,this,this.on_options_timer,null,true);
}},on_options_timer:function(){this.set_options_microphone_levels();
},set_options_microphone_levels:function(){if(!this.options){return;
}var g=IMO.VIM.flash.call("all_mic_levels");
for(var f=0;
f<g.length;
++f){this.options.level_indicator[f].set_value(g[f]);
}},on_set_value:function(g,f){if(g===this.options.radio_group){IMO.VIM.flash.call("set_mic",f);
}else{if(g===this.options.volume_slider){IMO.VIM.flash.call("set_volume",f);
}}},on_vim_msg_need_permission:function(){this.show_flash_popup();
IMO.VIM.flash.show(this.flash_pos);
Y.later(20,IMO.VIM.flash.ref,function(){this.showSecurityPanel();
});
},on_vim_msg_denied_permission:function(){IMO.NM.add_notification(b("You need to allow IMO to access your microphone in order to send Voice IMs."));
},on_vim_msg_panel_closed:function(){this.do_hide_flash_popup();
},on_vim_msg_have_permission:function(){this.destroy_flash();
},on_vim_msg_disconnected:function(){IMO.NM.add_notification(b("You got disconnected from the Voice IM server."));
},on_vim_msg_connect_failed:function(){IMO.NM.add_notification(b("Connecting to the Voice IM server failed. Please try again later."));
},on_vim_no_wowza_server:function(){IMO.NM.add_notification(b("Could not find a Voice IM server. Please try again later."));
},on_vim_error:function(){IMO.NM.add_notification(b(IMO.VIM.error_msg),IMO.REUI.Notification.types.error);
},message_transformer:function(h){var j=h.msg;
if(j.substr(0,e.length)!==e||j.substr(j.length-4).toLowerCase()!==".mp3"){return;
}var i=h.msg_dom;
c.replace_content(i,b("Voice IM: "));
var g=j.substr(e.length);
var f=new IMO.REUI.MP3Player(g);
i.appendChild(c.a(b("download"),{href:g,target:"_blank"}));
i.appendChild(c.cdiv("mp3",f.dom));
if(this.is_focused&&h.received_from_buddy&&this.auto_voice_im){f.start();
}}});
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
IMO.REUI.WebcamCaptureWidget=function(){this.dom=c.cdiv("webcam_img",this.swf_dom=c.div());
this.swf_dom.style.height="240px";
this.swf_dom.style.width=" 320px";
this.ev=new IMO.Event();
};
Y.mix(IMO.REUI.WebcamCaptureWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.WebcamCaptureWidget.prototype,{open:function(){this.core=new IMO.WebcamCapture(this.swf_dom);
this.on(this.core);
this.core.open();
this.center_in_parent();
},center_in_parent:function(){IMO.REUI.center_dom_in_parent(this.swf_dom);
this.core.swf.show(this.swf_dom);
},close:function(){this.core.close();
this.unsubscribe(this.core);
delete this.core;
},freeze:function(){this.core.freeze();
},live:function(){this.core.live();
},on_can_capture_change:function(f,e){this.ev.fire("on_can_capture_change",this,e);
},snapshot:function(){return this.core.snapshot;
},on_swf_init:function(){this.ev.fire("on_swf_init",this);
},on_swf_embed:function(){this.ev.fire("on_swf_embed",this);
},on_swf_embed_fail:function(){this.ev.fire("on_swf_embed_fail",this);
}},true);
}());
(function(){var b=IMO.Utils;
var h=IMO.Utils.HTML;
var i=IMO.Utils.TranslateDom;
var e=0;
var a=1;
var c=2;
var g="impref";
var d="desktop_notifications";
var j=10*1000;
var f=3*1000;
IMO.WebkitNotifications=function(){this.on(IMO.Session.get());
this.enabled=IMO.Session.get().get_pref(g,d,undefined);
if(this.enabled!==undefined){Y.later(f,this,this.show_notification);
}};
Y.mix(IMO.WebkitNotifications.prototype,IMO.EventTarget);
Y.mix(IMO.WebkitNotifications.prototype,{notify:function(q,r,n,t,k){if(!this.is_supported()){Y.log("desktop notifications not supported by this browser");
return;
}var p=window.webkitNotifications;
var u=p.checkPermission();
if(u===e&&this.enabled){var l=p.createNotification(q,r,n);
var o=window;
var s;
var m={on_browser_focus:function(){s();
}};
IMO.EventTarget.on(IMO.BrowserFocus,m);
s=function(){if(l){l.cancel();
l=null;
}if(m){IMO.EventTarget.unsubscribe(IMO.BrowserFocus,m);
m=null;
}};
l.onclick=function(){s();
if(o&&o.focus){o.focus();
Y.later(10,o,o.focus);
}if(t){Y.log("HTML5 notification cnclick");
t.apply(k);
}};
l.show();
Y.later(j,this,function(){s();
});
}else{if(u===a){Y.log("permission is undefined");
}else{if(u===c){Y.log("the user has denied permission for notifications");
}else{Y.log("WTF! unknown permission value: "+u);
}}}},set_pref:function(k){IMO.Session.get().set_prefs([{kind:g,pref:d,value:k}]);
},is_supported:function(){return window.webkitNotifications!==undefined;
},show_notification:function(){if(this.enabled===false||!this.is_supported()){return;
}var l=window.webkitNotifications;
var k=l.checkPermission();
if(k!==a){Y.log("also returning");
return;
}if(!this.permission_request){var m=this;
var n=h.div(i("Would you like to enable desktop notifications?"),h.span(i("Yes"),{cls:"action",onclick:function(){m.remove_notification();
m.request_permission();
m.set_pref(true);
}}),h.span(i("No"),{cls:"action",onclick:function(){m.remove_notification();
m.set_pref(false);
}}));
this.permission_request=IMO.NM.add_notification(n,IMO.REUI.Notification.types.info,{momentary:false});
}},remove_notification:function(){if(this.permission_request){IMO.NM.remove_notification(this.permission_request);
delete this.remove_notification;
}},request_permission:function(){var k=window.webkitNotifications;
if(k){k.requestPermission(function(){});
}},on_recv_pref:function(l,k,m){if(l===g&&k===d){this.enabled=m;
if(this.enabled){this.request_permission();
}}},on_prefs_loaded:function(){Y.log("on_prefs_loaded");
Y.later(f,this,this.show_notification);
},on_set_prefs:function(k){b.foreach(k,function(m,l){this.on_recv_pref(m.kind,m.pref,m.value);
},this);
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var f=IMO.Constants;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var c=IMO.REUI.PIN.FORM;
var e=function(h){return function(){throw h+" : not implemented";
};
};
var g=function(i,h){return function(){delete i[h];
};
};
var b=function(i,h){return function(){i.unsubscribe(i[h]);
delete i[h];
};
};
IMO.REUI.PIN.GenericFormPopup=function(){this.popup=new IMO.ModalPopup(this);
this.popup.set_close_on_outside_click(false);
this.cleanup={};
};
Y.mix(IMO.REUI.PIN.GenericFormPopup.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.GenericFormPopup.prototype,{add_field_with_cleanup:function(i,j,h){this[i]=j;
this.cleanup[i]=h;
return this[i];
},add_normal_field:function(h,i){return this.add_field_with_cleanup(h,i,g(this,h));
},add_event_dispatcher_field:function(h,i){this.add_field_with_cleanup(h,i,b(this,h));
this.on(this[h]);
return this[h];
},show:function(){this.pending_request=false;
this.build_widgets();
this.finish_dom();
this.widget_init();
this.popup.set_content(this.dom,[f.pin_form_width+2*f.pin_form_border,NaN]);
this.popup.prepare();
this.popup.show();
this.set_border_size();
IMO.ResizeManager.register(this.on_resize,this);
this.shortcuts=IMO.KeyboardManager.get().push({bindings:{esc:{cb:function(){}}},bottom:true,context:this});
},hide:function(){a.foreach(this.cleanup,function(i,h){i();
},this);
this.cleanup={};
this.popup.hide();
IMO.KeyboardManager.get().pop(this.shortcuts);
IMO.ResizeManager.unregister(this.on_resize,this);
},is_valid:e("is_valid"),set_pending_request:function(h){this.pending_request=h;
this.on_change_validity();
},on_change_validity:function(){this.footer_widget.main_button.set_enabled(this.is_valid());
},close:function(){this.hide();
},try_to_start_request:function(){if(!this.is_valid()){return false;
}if(this.pending_request){return false;
}this.set_pending_request(true);
return true;
},try_to_handle_reply:function(){if(!this.pending_request){return false;
}this.pending_request=false;
return true;
},build_widgets:e("build_widgets"),widget_init:function(){},finish_dom:function(){this.body_dom=d.cdiv("stretch",this.table_dom=d.table({cls:"pin_form_field_list"},this.tbody_dom));
this.dom=d.cdiv("pin_form_border",d.cdiv("pin_form_border_inner",IMO.REUI.header_body_footer_widget(this.header_dom,this.body_dom,this.footer_dom=d.cdiv("stretch",this.footer_widget.dom),"abs")));
},set_border_size:function(){var i=this.table_dom.offsetHeight;
var j=i+f.hbf_header_height+f.hbf_footer_height+2*f.pin_form_border;
var h=f.pin_form_width+2*f.pin_form_border;
d.css(this.dom,{width:h+"px",height:j+"px"});
this.popup.adjust_size();
},on_resize:function(h){this.popup.adjust_size();
}});
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var g=IMO.Constants;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var c=IMO.REUI.PIN.FORM;
var f="Enter the old and the new password.";
IMO.REUI.PIN.ChangePasswordWidgetPopup=function(){IMO.REUI.PIN.ChangePasswordWidgetPopup.superclass.constructor.call(this);
};
Y.extend(IMO.REUI.PIN.ChangePasswordWidgetPopup,IMO.REUI.PIN.GenericFormPopup);
Y.mix(IMO.REUI.PIN.ChangePasswordWidgetPopup.prototype,{is_valid:function(){return !this.pending_request&&this.old_password.is_valid()&&this.new_password.is_valid();
},on_change:function(h){if(h===this.old_password||h===this.new_password){this.stat_widget.set_status(f);
}},on_enter_key:function(h){if(h===this.old_password){this.new_password.focus();
}else{if(h===this.new_password){this.do_change_password();
this.old_password.focus();
}}},on_change_password:function(h){IMO.MouseManager.get().handled(h,"pin-change-password");
this.do_change_password();
},do_change_password:function(){if(!this.is_valid()){return;
}if(this.pending_request){return;
}this.set_pending_request(true);
this.stat_widget.set_status("Request pending ...");
IMO.Network.get().send("imo_account","change_password",{uid:this.account.uid,old_passwd:this.old_password.value(),new_passwd:this.new_password.value()});
},on_change_password_reply:function(h){if(!this.pending_request){return;
}this.set_pending_request(false);
if(h.status==="error"){if(h.reason==="invalid_new_password"){this.stat_widget.set_error("New password was invalid");
}else{if(h.reason==="wrong_old_password"){this.stat_widget.set_error("The old password you entered was wrong");
}else{if(h.reason==="verify_old_password"){this.stat_widget.set_error("Internal server error while validating old password");
}else{if(h.reason==="change_password_db"){this.stat_widget.set_error("Internal server error while setting new password");
}}}}}else{if(h.status==="ok"){this.stat_widget.set_status("Password changed");
this.close();
}else{this.stat_widget.set_error("Unknown server response");
}}},on_cancel:function(h){this.hide();
},build_widgets:function(){this.header_dom=d.cdiv("pin_form_header",d.cspan("text",b("Change password")));
this.footer_widget=new c.FooterWidget("Change password","Cancel",null,this,this.on_change_password,this.on_cancel);
this.add_event_dispatcher_field("account",IMO.Session.get().get_imo_account());
this.add_normal_field("stat_widget",new c.StatusWidget());
this.add_event_dispatcher_field("old_password",new c.PasswordWidget("Old password"));
this.add_event_dispatcher_field("new_password",new c.PasswordWidget("New password"));
this.stat_widget.set_status(f);
this.tbody_dom=d.tbody(this.stat_widget.dom,c.make_delimiter(),this.old_password.dom,this.new_password.dom);
},widget_init:function(){Y.later(0,this,function(){this.old_password.focus();
});
}},true);
IMO.REUI.PIN.ChangePasswordPopup=new IMO.REUI.PIN.ChangePasswordWidgetPopup();
}());
(function(){var c=IMO.Utils;
var j=c.HTML;
var a=IMO.Constants;
var k=IMO.Utils.TranslateDom;
var i=IMO.Utils.TranslateTxt;
var d=700;
var g=400;
var b=2;
if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}var h=IMO.REUI.PIN.Directory={};
var f=function(){this.build_dom();
this.win=new IMO.WM.Window();
this.win.set_content(this.dom);
this.win.size.min=[d,g];
this.on(this.win);
this.win.set_title(i("Imo Directory Search"));
this.last_qseq_no=0;
this.last_query="";
this.prev_queries=[];
this.next_queries=[];
this.query_typing=false;
this.back_button.set_enabled(false);
this.forward_button.set_enabled(false);
this.persons=new Array();
this.has_more_results=false;
this.use_imodirectory2=IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im";
IMO.EventDispatcher.get().subscribe(this,"imo_directory","imo_directory");
if(this.use_imodirectory2){this.to_system="query_engine";
Y.log("Subscribed to query engine");
}else{this.to_system="imo_directory";
Y.log("Subscribed to imo directory");
}};
Y.mix(f.prototype,IMO.EventTarget);
Y.mix(f.prototype,{build_dom:function(){this.header=j.cdiv("dir-header",j.cspan("dir-label",k("Directory")),j.cdiv("dir-input-main-container",this.spinner=j.img({id:"dir-spinner",src:"assets/loader_16.gif"}),j.cdiv("dir-input-container",this.input=j.input({cls:"dir-input",type:"text",context:this,onkeypress:this.keypress,onkeydown:this.keypress})),j.sprite("icn_search_12",{id:"dir-search-icon"})),j.cdiv("navigate",(this.back_button=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.go_back},{cls:"go-back"},k("Back"))).dom),j.cdiv("navigate",(this.forward_button=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.go_forward},{cls:"go-forward"},k("Forward"))).dom));
this.stop_spinner();
if(IMO.REUI.APP.MeetUtils.is_imo_admin()){c.foreach([["Spam","latestspam"],["Name Changes","namechange"],["New","signups"],["Updates","changes"]],function(l){this.header.appendChild(j.cdiv("navigate",(new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:function(){h.show("admin:"+l[1]);
}},{},j(l[0]))).dom));
},this);
}this.no_results_div=j.idiv("dir-no-results",k("No results"));
this.status=j.cdiv("dir-status");
this.results=j.cdiv("dir-results",{onscroll:this.scrolled,context:this});
this.dom=j.cdiv("dir-search",this.header,this.results,this.status,{onclick:this.focus_win,context:this});
},on_resize:function(l){this.scrolled();
},scrolled:function(){if(!this.has_more_results){return;
}if(this.results.scrollTop+this.results.offsetHeight+10>this.results.scrollHeight){this.send_query();
}},show:function(m,l){this.win.open();
l=c.dfl(l,true);
if(m){this.clear_results();
if(this.last_query!==""){this.prev_queries.push(this.last_query);
this.next_queries=[];
this.back_button.set_enabled(true);
this.forward_button.set_enabled(false);
}if(l){this.input.value=m;
}else{this.input.value="";
}this.perform_search(m);
}this.query_typing=false;
Y.later(10,this,function(){this.win.set_focus();
this.input.focus();
});
},focus_win:function(){this.win.set_focus();
},on_close_request:function(l){this.win.close();
},keypress:function(m){if(this.search_event){this.search_event.cancel();
}if(!this.query_typing){this.query_typing=true;
if(this.last_query!==""){this.prev_queries.push(this.last_query);
this.next_queries=[];
this.back_button.set_enabled(true);
this.forward_button.set_enabled(false);
}this.last_query="";
}var l=IMO.REUI.APP.MeetUtils.search_delay(m);
this.search_event=Y.later(l,this,this.search);
},search:function(){if(this.last_query!=this.input.value){this.perform_search(this.input.value);
}},perform_search:function(l){Y.log(["search",l]);
this.last_query=l;
this.last_qseq_no=this.last_qseq_no+1;
this.start_spinner();
this.send_query();
},send_query:function(){var m=IMO.REUI.APP.MeetUtils.get_uid_proto();
this.has_more_results=false;
if(!m.uid){Y.log("No account","error","meet_mini.js");
return;
}var l=IMO.REUI.APP.MeetUtils.is_imo_admin();
IMO.Network.get().send(this.to_system,"search",{ssid:IMO.Network.get().ssid,uid:m.uid,proto:m.proto,qseq_no:this.last_qseq_no,query:this.last_query,only_available:false,admin:l});
},go_back:function(m){IMO.MouseManager.get().handled(m,"directory_go_back");
if(this.prev_queries.length===0){return;
}if(this.last_query!==""){this.next_queries.push(this.last_query);
this.forward_button.set_enabled(true);
}var l=this.prev_queries.pop();
if(this.prev_queries.length===0){this.back_button.set_enabled(false);
}this.input.value=l;
this.query_typing=false;
this.perform_search(l);
},go_forward:function(m){IMO.MouseManager.get().handled(m,"directory_go_forward");
if(this.next_queries.length===0){return;
}if(this.last_query!==""){this.prev_queries.push(this.last_query);
this.back_button.set_enabled(true);
}var l=this.next_queries.pop();
if(this.next_queries.length===0){this.forward_button.set_enabled(false);
}this.input.value=l;
this.query_typing=false;
this.perform_search(l);
},search_result:function(n){var m=n.edata;
Y.log(["result for search: ",n]);
if(m.qseq_no!==this.last_qseq_no){Y.log("qseq number mismatch!");
return;
}var o=false;
if(m.rtype==="initial"){this.clear_results();
this.stop_spinner();
if(m.results.length===0){Y.log("no results to display");
this.no_results();
}else{if(m.results.length===1){o=true;
}}}var l=m.results;
Y.log("Going to display "+l.length+" results");
c.foreach(l,function(q,p){this.add_result(q,o);
},this);
this.has_more_results=m.has_more_results;
},clear_results:function(){j.empty(this.results);
j.empty(this.status);
},add_result:function(l,n){var m=IMO.REUI.APP.MeetUtils.create_person_widget(l,this);
j.add_class(m.dom,"directory");
if(n){j.add_class(m.dom,"single-result");
}this.results.appendChild(m.dom);
},no_results:function(){j.replace_content(this.status,this.no_results_div);
},stop_spinner:function(){j.invisible(this.spinner);
},start_spinner:function(){j.visible(this.spinner);
j.empty(this.status);
}});
var e=null;
h.show=function(m,l){if(e===null){e=new f();
}e.show(m,l);
};
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.Utils.TranslateDom;
if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}IMO.REUI.PIN.PinPopup=function(d){this.popup=new IMO.ModalPopup();
this.title="";
this.body=null;
this.size=d;
this.button_config=null;
};
Y.mix(IMO.REUI.PIN.PinPopup.prototype,{build_dom:function(){this.header_button=this.build_header_button(this.get_positive_btn_descr());
var d=c.idiv("actions");
var f=this.get_additional_actions();
a.foreach(f,function(h){d.appendChild(c.cspan("action",h.title,h.onclick));
});
d.appendChild(c.cspan("header-button-container",this.header_button.dom));
d.appendChild(c.cspan("close",b("Close"),{onclick:this.hide,context:this}));
var g=c.idiv("pin-popup-header",d,c.cspan("title",this.title));
var e=c.idiv("pin-popup",g,this.get_body());
return e;
},build_header_button:function(d){return new IMO.UIWidgets.Button({},d.event,{cls:"header-button"},d.title);
},get_body:function(d){return c.idiv("body");
},get_positive_btn:function(){return this.header_button;
},get_positive_btn_descr:function(){return null;
},update_positive_btn:function(){if(this.update_invite_button_timer){this.update_invite_button_timer.cancel();
}this.update_invite_button_timer=Y.later(50,this,function(){var d=this.build_header_button(this.get_positive_btn_descr());
if(this.header_button){this.header_button.dom.parentNode.replaceChild(d.dom,this.header_button.dom);
}this.header_button=d;
return this.invite_button;
});
},get_additional_actions:function(){return[];
},set_title:function(d){this.title=d;
},show:function(){var d=this.build_dom();
this.popup.set_content(d,this.size);
this.popup.prepare();
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide}},bottom:true,context:this});
this.popup.show();
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.popup.hide();
document.location.hash="";
}});
}());
(function(){var a=IMO.Utils;
var d=IMO.Utils.HTML;
var c=IMO.Utils.TranslateDom;
var g=IMO.Constants;
var e={google:"Google Mail",yahoo:"Yahoo Mail",msn:"Windows Live"};
if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}var f=function(i,h,j){this.uid=i;
this.account_id=j;
this.display_name=h.display_name;
this.username=h.username;
this.icon=g.DEFAULT_BICON;
this.selected=false;
this.ev=new IMO.Event();
if(h.profile_photo_id){this.icon="/b/"+a.imo_icon(h.profile_photo_id);
}this.dom=this.build_dom();
};
Y.mix(f.prototype,{build_dom:function(){return d.cdiv("person",{onclick:this.contact_clicked,context:this},d.img({cls:"buddy-icon",src:this.icon}),d.cdiv("name-and-account",d.cdiv("buddy-name",this.display_name),d.cdiv("buddy-account",this.username)),d.sprite("icn_check_blue"));
},contact_clicked:function(h){IMO.MouseManager.get().handled(h,"pin-find-friends");
this.set_selected(!this.selected);
},set_selected:function(h){if(h===this.selected){return;
}this.selected=h;
d.toggle_class(this.dom,"selected",h);
this.ev.fire("on_selection_change",this);
}});
var b=function(h){b.superclass.constructor.call(this,h);
this.accounts={};
this.p_friends={};
this.account=IMO.Session.get().get_imo_account();
if(!this.account){return;
}this.selected_cnt=0;
IMO.EventDispatcher.get().subscribe(this,"friends_finder","pin");
};
Y.extend(b,IMO.REUI.PIN.PinPopup);
Y.mix(b.prototype,IMO.EventTarget);
Y.mix(b.prototype,{get_body:function(){this.accounts_dom=d.ul({cls:"accounts"});
var k=this;
var l=function(m){return d.li({cls:"account"},d.cdiv("account-name link",{context:k,onclick:function(){IMO.OAuth.get().oauth_connect(m,g.OAUTH_PIN_FF_CALLBACK,"contacts",k.account.uid);
}},e[m]));
};
var j=d.ul({cls:"accounts"});
a.foreach(e,function(n,m){j.appendChild(l(m));
},this);
var i=d.li({cls:"new-account"},this.select_all_checkbox=d.input({type:"checkbox",id:"select-all-acc","class":"ch",context:this,oncbchange:this.on_select_all_accounts}),d.label("Select all accounts",{"for":"select-all-acc","class":"name"}));
this.accounts_dom.appendChild(i);
a.foreach(this.accounts,function(n,m){this.accounts_dom.appendChild(this.build_account_dom(m));
},this);
this.get_accounts();
this.friends_dom=d.idiv("colums");
var h=d.idiv("ff-body",d.idiv("ff-accounts",d.idiv("oauth-accounts-title",{cls:"invite-title"},c("Use your accounts on:")),j,d.idiv("oauth-accounts-title",{cls:"invite-title"},c("Find your friends on:")),this.accounts_dom,d.idiv("description",c("Selecting an account would allow others to find you by this account"))),d.idiv("ff-friends",{cls:"ff-main"},this.friends_dom));
return h;
},get_positive_btn_descr:function(){var h=new Object();
h.title=c("Add [NUMBER] Friends",{NUMBER:this.selected_cnt});
h.event={context:this,onclick:this.add_friends};
return h;
},get_additional_actions:function(){return[{title:c("Select all"),onclick:{context:this,onclick:this.select_all}},{title:c("Unselect all"),onclick:{context:this,onclick:this.unselect_all}}];
},get_id:function(h,i){return a.sprintf("%s#%s",h,i);
},build_account_dom:function(k){var j=null;
var h=this.accounts[k].proto;
Y.log([this.accounts[k].uid,this.accounts[k].display_name]);
var i=a.dfl(this.accounts[k].display_name,this.accounts[k].uid);
if(h in g.PROTO_TO_UI){h=g.PROTO_TO_UI[h];
j=IMO.Session.get().get_account("im",this.accounts[k].uid,this.accounts[k].proto);
}else{if(this.accounts[k].service){h=e[this.accounts[k].service];
}else{if(h==="phonebook"){h="Phonebook";
i="";
}else{if(h==="phone"){h="Phone";
}else{h="Email";
}}}}i=j?j.get_display_name():i;
this.accounts[k].checkbox=d.input({type:"checkbox",id:k,"class":"ch",oncbchange:{func:this.toggle_account,args:k},context:this});
this.accounts[k].checkbox.checked=this.accounts[k].used;
this.accounts[k].div=d.li({cls:"new-account"},this.accounts[k].checkbox,d.label(h,{"for":k,"class":"name"},d.br(),d.cspan("second_line",i)));
return this.accounts[k].div;
},get_accounts:function(){IMO.Network.get().send("friendsfinder","get_friendsfinder_accounts",{uid:this.account.uid});
IMO.Network.get().send("friendsfinder","get_suggested_friends",{uid:this.account.uid});
},set_select_all_stype:function(i,h){this.select_all_checkbox.checked=i;
d.toggle_class(this.select_all_checkbox,"opacied",h);
},set_state_select_all_checkbox:function(){var i=0;
var h=0;
a.foreach(this.accounts,function(k,j){i++;
h+=(this.accounts[j].used?1:0);
},this);
if(i===0){return;
}if(h===i){this.set_select_all_stype(true,false);
return;
}if(h===0){this.set_select_all_stype(false,false);
return;
}this.set_select_all_stype(true,true);
},toggle_account:function(h,i){this.set_account_usage(i,!this.accounts[i].used,true);
this.set_state_select_all_checkbox();
},set_account_usage_at_ui:function(i,h){this.accounts[i].used=h;
this.accounts[i].checkbox.checked=h;
},set_account_usage:function(l,i,j){if(this.accounts[l].used===i){return;
}this.set_account_usage_at_ui(l,i);
var h={ssid:IMO.Network.get().ssid,uid:this.account.uid,side_uid:this.accounts[l].uid,side_proto:this.accounts[l].proto};
if(j){var k=(i)?"add_account":"remove_account";
IMO.Network.get().send("friendsfinder",k,h);
}},on_select_all_accounts:function(i){var h=this.select_all_checkbox.checked;
Y.log(this.select_all_checkbox);
a.foreach(this.accounts,function(k,j){if(k.user!==h){this.set_account_usage(j,h,true);
}},this);
d.remove_class(this.select_all_checkbox,"opacied");
},on_selection_change:function(h){this.selected_cnt+=(h.selected?1:-1);
this.update_positive_btn();
},friendsfinder_accounts:function(i){var h=i.edata;
Y.log(["FF accounts",h]);
a.foreach(h,function(j){var k=this.get_id(j.uid,j.proto);
if(k in this.accounts){this.set_account_usage_at_ui(k,j.used,false);
}else{this.accounts[k]={uid:j.uid,proto:j.proto,service:j.service,used:j.used,display_name:j.display_name};
this.accounts_dom.appendChild(this.build_account_dom(k));
}},this);
},suggested_friends:function(l){Y.log(["suggested_friends",l.edata]);
var j=l.edata;
var h=j.new_suggestions||[];
var i=j.old_suggestions||[];
var k=j.max_id;
Y.later(2000,this,this.mark_seen,[k]);
d.empty(this.friends_dom);
this.p_friends={};
this.friends_dom.appendChild(d.cdiv("pin-ff-heading",c("New suggestions")));
this._add_suggestions(h);
this.friends_dom.appendChild(d.cdiv("clear"));
this.friends_dom.appendChild(d.cdiv("pin-ff-heading",c("Old suggestions")));
this._add_suggestions(i);
this.set_state_select_all_checkbox();
},mark_seen:function(h){IMO.Network.get().send("friendsfinder","mark_seen",{uid:this.account.uid,max_id:h});
},_add_suggestions:function(h){a.foreach(h,function(k){var i=k.uid;
if(i in this.p_friends){return;
}var j=new f(i,k,null);
this.on(j);
this.friends_dom.appendChild(j.dom);
this.p_friends[i]=j;
},this);
},select_all:function(h){IMO.MouseManager.get().handled(h,"pin-ff-select-all");
this.set_all_selected(true);
},unselect_all:function(h){IMO.MouseManager.get().handled(h,"pin-ff-unselect-all");
this.set_all_selected(false);
},set_all_selected:function(h){a.foreach(this.p_friends,function(k,j){var i=this.p_friends[j];
i.set_selected(h);
},this);
},add_friends:function(){var h=a.filter(this.p_friends,function(j){return j.selected;
});
var i=a.map(h,function(j){return j.uid;
});
this.account.add_buddies(i,IMO.SharedConstants.BuddyGroups.IMO_CONTACTS);
this.hide();
}},true);
IMO.REUI.PIN.FFPopup=function(){var h=new b([900,500]);
h.set_title("Find Friends");
return h;
};
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var f=IMO.Constants;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var c=IMO.REUI.PIN.FORM;
c.make_cancellable_bubble_dom=function(i,g,h){return d.cdiv("pin_bubble",d.cspan("normal",i),d.cspan("x_button",d.sprite("icn_intrst_del_normal clickable",{context:g,onclick:h})));
};
c.make_clickable_bubble_dom=function(i,g,h){return d.cdiv("pin_bubble",d.cspan("normal",i,{context:g,onclick:h}));
};
c.FooterWidget=function(m,n,j,k,g,i){var h=d.cdiv("pin_form_footer_buttons");
var l=n?"pin_form_footer_main_button":"";
this.main_button=new IMO.UIWidgets.Button({color:"default"},{cls:"pin_form_footer_button "+l,context:k,onclick:g},{cls:"signup_button_inner"},b(m));
h.appendChild(this.main_button.dom);
if(n){this.secondary_button=(function(){var o=d.cdiv("pin_form_footer_button pin_form_text_button",{context:k,onclick:i});
if(j){o.appendChild(d.sprite(j+" vertical_middle"));
o.appendChild(d.span({style:{paddingLeft:"5px"}}));
}o.appendChild(d.span(b(n)));
return{dom:o};
}());
h.appendChild(this.secondary_button.dom);
}h.appendChild(d.cdiv("clear"));
this.dom=d.cdiv("pin_form_footer",h);
};
c.make_columns=function(i,h,k){var g=[];
if(i!==""){g.push(d.td({cls:"label_column"},d.cspan("label",e(i+":"))));
}else{g.push(d.td({cls:"label_column"}));
}var j={cls:"input_column"};
if(!k){j.colspan=2;
}g.push(d.td(j,h));
if(k){g.push(d.td({cls:"description_column"},d.cspan("pin_input_description",k)));
}return g;
};
c.make_field=function(i,h,j){var g=d.tr({cls:"pin_form_field"});
a.foreach(c.make_columns(i,h,j),function(k){g.appendChild(k);
});
return g;
};
c.change_field=function(j,h,g,i){d.empty(j);
a.foreach(c.make_columns(h,g,i),function(k){j.appendChild(k);
});
};
c.make_delimiter=function(){return d.tr(d.td({colspan:3,style:{overflow:"hidden"}},d.cdiv("pin_form_field_delimiter")));
};
c.StatusWidget=function(){this.dom=d.tr({cls:"pin_form_field"},d.td({colspan:3,cls:"label_column"},this.status=d.cspan("status_field")));
};
Y.mix(c.StatusWidget.prototype,{set_status:function(g){d.replace_content(this.status,b(g));
},set_status_dom:function(g){d.replace_content(this.status,g);
},set_error:function(g){d.replace_content(this.status,d.cspan("pin_error_color",b(g)));
}});
c.TextFieldAbstractWidget=function(h,g){this.ev=new IMO.Event();
this.dom=c.make_field(this.label=h,this.input=g,this.status_dom=d.span());
this.input_change_cb();
};
c.TextFieldAbstractWidget.make_simple_input=function(h,g){return d.input({cls:"textline_input",type:g||"text",context:h,onkeydown:h.on_key_press,onkeypress:h.on_key_press,onpaste:h.input_change_cb,onchange:h.input_change_cb});
};
Y.mix(c.TextFieldAbstractWidget.prototype,{value:function(){return this.input.value;
},focus:function(){d.focus(this.input);
},set_disabled:function(g){this.input.disabled=g;
},set_value:function(h,g){this.input.value=h;
if(g){this.input_change_cb();
}},on_key_press:function(g){this.input_change_cb();
if(g.keyCode===13){this.input.blur();
Y.later(0,this,function(){this.ev.fire("on_enter_key",this);
});
}else{if(g.keyCode===9){this.input.blur();
Y.later(0,this,function(){this.ev.fire("on_tab_key",this);
});
}}},input_change_cb:function(){Y.later(0,this,function(){this.verify_validity();
this.ev.fire("on_change",this);
});
},is_valid:function(){return true;
},verify_validity:function(){}});
c.EmailWidget=function(g){c.EmailWidget.superclass.constructor.call(this,g||"Email address",c.TextFieldAbstractWidget.make_simple_input(this));
};
Y.extend(c.EmailWidget,c.TextFieldAbstractWidget);
Y.mix(c.EmailWidget.prototype,{is_valid:function(){return this.value().indexOf("@")!==-1;
},verify_validity:function(){var g=this.is_valid();
d.empty(this.status_dom);
if(!g){this.status_dom.appendChild(d.cspan("pin_error_color","Email address must contain @"));
}this.ev.fire("on_change_validity",this,g);
}},true);
c.TextWidget=function(g){c.TextWidget.superclass.constructor.call(this,g,c.TextFieldAbstractWidget.make_simple_input(this));
};
Y.extend(c.TextWidget,c.TextFieldAbstractWidget);
c.NameWidget=function(g){c.NameWidget.superclass.constructor.call(this,g);
};
Y.extend(c.NameWidget,c.TextWidget);
Y.mix(c.NameWidget.prototype,{_find_problem:function(){return IMO.ImoProfile.name_rule_violation(this.value());
},is_valid:function(){return this._find_problem()===null;
},verify_validity:function(){var g=this._find_problem();
d.empty(this.status_dom);
if(g){this.status_dom.appendChild(d.cspan("pin_error_color",g));
}this.ev.fire("on_change_validity",this,g===null);
}},true);
c.PasswordWidget=function(g){c.PasswordWidget.superclass.constructor.call(this,g||"Password",c.TextFieldAbstractWidget.make_simple_input(this,"password"));
};
Y.extend(c.PasswordWidget,c.TextFieldAbstractWidget);
Y.mix(c.PasswordWidget.prototype,{is_valid:function(){return IMO.ImoProfile.password_valid(this.value());
},verify_validity:function(){var h=IMO.ImoProfile.password_rule_violation(this.value());
var g=(h===null);
d.empty(this.status_dom);
if(!g){this.status_dom.appendChild(d.cspan("pin_error_color",h));
}this.ev.fire("on_change_validity",this,g);
}},true);
}());
(function(){function a(b){return b.replace(/^\s+|\s+$/g,"");
}if(!IMO.ImoProfile){IMO.ImoProfile={};
}IMO.ImoProfile.canonical_typed_item=function(b,c){var d=false;
do{d=false;
c=a(c);
if(c.length>=2&&c[0]==='"'&&c[c.length-1]==='"'){var e=c.substr(1,c.length-2);
if(e.indexOf('"')===-1){c=e;
d=true;
}}}while(d);
c=c.replace(/\s+/g," ");
if(b in {lookingfor:1,interests:1,languages:1}){c=c.toLowerCase();
}return c;
};
}());
(function(){var d=IMO.Utils;
var k=d.HTML;
var a=IMO.Constants;
var l=IMO.Utils.TranslateDom;
var i=IMO.Utils.TranslateTxt;
var e=IMO.SharedConstants.ImoProfile.value_for_removal;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var j=IMO.REUI.PIN.FORM;
var m=function(o,n){this.profile=o;
this.item_type=n;
this.typed_items={};
this.newly_added={};
this.dom0=j.make_field(i(""),i(""),i(""));
this.dom=j.make_field(this.text.dom_label_loading,i("Not loaded yet"),i(""));
this.dom_suggestions=j.make_field(i(""),i(""),i(""));
this.dom2=j.make_field(i(""),i(""),i(""));
this.profile.profile_uid_call("list_typed_items",{item_type:this.item_type},this,function(q){if(q.error){j.change_field(this.dom,"Cannot load");
}this.input=new IMO.REUI.SuggestionWidget({cls:"typed_item_input textline_input",type:"text",maxlength:64},{width:"input_width"},true);
this.on(this.input);
j.change_field(this.dom0,i(""),k.cdiv("profile_field_tip",this.text.tip));
j.change_field(this.dom,this.text.dom_label,this.input.input_dom,k.cdiv("add_typed_item_button",(this.button=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.on_add_clicked},{cls:"small_button_inner"},l("Add"))).dom));
j.change_field(this.dom_suggestions,i(""),this.current_suggested_items=k.cdiv("suggested_items"));
j.change_field(this.dom2,this.text.dom2_label,this.current_typed_items=k.cdiv("current_typed_items"));
var p=this;
d.foreach(q.result,function(r){p.add_typed_item(r);
});
if(this.fetch_suggested_typed_items){this.fetch_suggested_typed_items();
}this.on_input_changed(this.input);
k.hide(this.dom_suggestions);
});
};
Y.mix(m.prototype,IMO.EventTarget);
Y.mix(m.prototype,{schedule_server_query:function(){var n=this.input.value();
if(n===this.active_query){return;
}this.cancel_server_query();
this.active_query=n;
this.server_query_timer=Y.later(0,this,function(){this.profile.profile_call("suggest_typed_items",{query:n,item_type:this.item_type},this,function(o){if(o.result&&n===this.input.value()){this.input.create_suggestion_hover(n,d.map(o.result,function(r){var q=r[0];
var p=r[1];
return[q+" ["+p+"]",q];
}));
}});
});
},cancel_server_query:function(){if(this.server_query_timer){this.server_query_timer.cancel();
delete this.server_query_timer;
delete this.active_query;
}},check_input_query:function(){var n=this.input.value();
this.query_valid=(n!==""&&!this.typed_items[n]);
},add_user_item:function(){var o=this.input.value();
this.input.set_value("");
var n=IMO.ImoProfile.parse_typed_items(this.item_type,o);
if(!n.length){return;
}this.profile.profile_uid_call("add_typed_item",{item_type:this.item_type,items:n,suggested:false},this,this.add_typed_item_cb);
this.input.set_value("");
},on_enter_key:function(){this.add_user_item();
},on_add_clicked:function(){this.add_user_item();
},on_input_changed:function(o,n){if(o!==this.input){return;
}if(n){return;
}Y.later(0,this,function(){var p=this.input.value();
this.check_input_query();
this.button.set_enabled(this.query_valid);
if(p!==""){this.schedule_server_query();
}else{this.active_query="";
}});
},make_typed_item_dom:function(o,n){return j.make_cancellable_bubble_dom(o+" ["+n+"]",this,function(){this.remove_typed_item(o);
});
},make_suggested_item_dom:function(n){return k.cspan("pin_form_text_button",{context:this,onclick:function(){var o=IMO.ImoProfile.parse_typed_items(this.item_type,n);
if(!o.length){return;
}this.profile.profile_uid_call("add_typed_item",{item_type:this.item_type,items:o,suggested:true},this,this.add_typed_item_cb);
}},k.cspan("suggested_item_span",n));
},remove_typed_item:function(n){this.profile.profile_uid_call("remove_typed_item",{item_type:this.item_type,item_name:n},this,function(o){Y.log(["Backend reply : ",o]);
if(o.error){IMO.NM.add_notification(i(this.text.cannot_remove_item));
return;
}var p=o.result;
if(this.typed_items[p]){this.current_typed_items.removeChild(this.typed_items[p].dom);
delete this.typed_items[p];
}if(this.newly_added[p]){delete this.newly_added[p];
}if(this.fetch_suggested_typed_items){this.fetch_suggested_typed_items();
}});
},add_typed_item:function(p){var o=p[0];
var n=p[1];
if(!this.typed_items[o]){this.typed_items[o]={pop:n,dom:this.make_typed_item_dom(o,n)};
this.current_typed_items.appendChild(this.typed_items[o].dom);
}},add_typed_item_cb:function(o){if(o.error){Y.log(["Error trying to add typed item: ",o]);
IMO.NM.add_notification(i(this.text.cannot_add_item));
return;
}var n=null;
d.foreach(o.result,function(p){this.add_typed_item(p);
this.newly_added[p[0]]=true;
},this);
if(this.fetch_suggested_typed_items){this.fetch_suggested_typed_items();
}},add_suggested_item:function(p,n){var q=this.make_suggested_item_dom(p);
var o=k.measure(q,this.current_suggested_items);
if(o[0]<=n||this.current_suggested_items.childNodes.length<=1){this.current_suggested_items.appendChild(q);
return o[0];
}else{return -1;
}},get_typed_suggestions_cb:function(o){if(o.error){Y.log(["Error trying to get suggestions for typed item: ",o]);
if(this.text.cannot_add_suggestion){IMO.NM.add_notification(i(this.text.cannot_add_suggestion));
}return;
}var n=[];
d.foreach(o.result,function(p){if(!this.typed_items[p]){n.push(p);
}},this);
this.all_suggested_item_strings=n;
this.populate_suggested_items();
},populate_suggested_items:function(){k.empty(this.current_suggested_items);
if(this.all_suggested_item_strings.length&&this.all_suggested_item_strings.length>0){k.show(this.dom_suggestions);
}else{k.hide(this.dom_suggestions);
return;
}this.current_suggested_items.appendChild(k.cspan("suggested_items_intro",i("Some suggestions:")));
var n=0;
var p=0;
d.foreach(this.all_suggested_item_strings,function(q){var r=this.add_suggested_item(q,300-p);
if(r>=0){p+=r;
n++;
}else{return false;
}},this);
if(n<this.all_suggested_item_strings.length){var o=k.cspan("pin_form_text_button",{context:this,onclick:function(){for(var q=0;
q<n;
++q){var r=this.all_suggested_item_strings.shift();
if(r){this.all_suggested_item_strings.push(r);
}}this.populate_suggested_items();
}},k.cspan("suggested_item_span",i("more...")));
this.current_suggested_items.appendChild(o);
}},close:function(){if(this.input){this.unsubscribe(this.input);
this.input.close();
}}});
IMO.REUI.PIN.ImoProfileWidgetPopup=function(){this.popup=new IMO.ModalPopup(this);
};
Y.mix(IMO.REUI.PIN.ImoProfileWidgetPopup.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoProfileWidgetPopup.prototype,{show:function(o){this.first_time=o||false;
this.build_dom();
this.popup.set_content(this.dom,[a.pin_form_width+2*a.pin_form_border,a.profile_edit_height+2*a.pin_form_border]);
this.popup.prepare();
this.popup.show();
IMO.ResizeManager.register(this.on_resize,this);
var n=this;
this.shortcuts=IMO.KeyboardManager.get().push({bindings:{esc:{cb:(o?function(){}:function(){n.close();
})}},bottom:true,context:this});
},hide:function(){this.close_webcam_widget();
delete this.profile_footer_widget;
delete this.take_snapshot_footer_widget;
delete this.use_snapshot_footer_widget;
delete this.footer_dom;
delete this.header_dom;
delete this.dom;
this.profile_widget.close();
delete this.profile_widget;
delete this.profile_core;
delete this.account;
this.popup.hide();
IMO.KeyboardManager.get().pop(this.shortcuts);
IMO.ResizeManager.unregister(this.on_resize,this);
document.location.hash="";
},close:function(){this.hide();
},close_webcam_widget:function(){if(this.webcam_widget){delete this.webcam_text;
delete this.webcam_dom;
this.webcam_widget.close();
this.unsubscribe(this.webcam_widget);
delete this.webcam_widget;
}},open_webcam_widget:function(){this.close_webcam_widget();
this.webcam_widget=new IMO.REUI.WebcamCaptureWidget();
this.on(this.webcam_widget);
this.webcam_dom=k.cdiv("webcam_capture_widget",this.webcam_text=k.cspan("profile_capture_widget_text",i("Take a snapshot to use as a picture")),this.webcam_widget.dom);
this.take_snapshot_footer_widget.main_button.set_enabled(false);
k.replace_content(this.body_dom,k.cdiv("profile_webcam_picture",this.webcam_dom));
k.replace_content(this.footer_dom,this.webcam_footer_dom);
this.webcam_widget.open();
},open_main_profile:function(){this.close_webcam_widget();
k.replace_content(this.body_dom,this.profile_widget.dom);
k.replace_content(this.footer_dom,this.profile_footer_widget.dom);
},on_take_snap:function(n){if(!this.webcam_widget){return;
}if(!this.take_snapshot_footer_widget.main_button.enabled){return;
}this.webcam_widget.freeze();
},on_cancel_webcam:function(n){this.close_webcam_widget();
this.open_main_profile();
},on_discard_snap:function(n){if(!this.webcam_widget){return;
}this.webcam_widget.live();
},on_use_snap:function(n){if(!this.webcam_widget){return;
}this.profile_core.profile_uid_call("set_profile_picture",{filename:"webcam.jpg",fileBase64:this.webcam_widget.snapshot(),uploader:"web_webcam"},this,function(p){Y.log(["Picture upload attempt returned ",p]);
if(p.error){return;
}var o=p.result;
this.open_main_profile();
this.profile_widget.picture_widget.set_picture_id(o);
});
},on_save_profile_changes:function(n){IMO.MouseManager.get().handled(n,"save-profile-changes");
if(!this.profile_footer_widget.main_button.enabled){return;
}this.profile_widget.submit();
},on_delete_account:function(o){var n=new IMO.REUI.ConfirmModalPopup(i("Delete account?"),i("Are you sure you want to delete your imo account?"),[[l("Yes"),"blue"],[l("No"),"grey"]],function(p){if(p===0){this.account.delete_account();
this.hide();
}},this);
},on_cancel:function(n){this.hide();
},on_can_capture_change:function(o,n){if(!this.webcam_widget){return;
}if(o!==this.webcam_widget){return;
}k.replace_content(this.webcam_footer_dom,n?this.use_snapshot_footer_widget.dom:this.take_snapshot_footer_widget.dom);
},on_swf_init:function(n){if(!n||n!==this.webcam_widget){return;
}this.take_snapshot_footer_widget.main_button.set_enabled(true);
},on_swf_embed_fail:function(n){if(!n||n!==this.webcam_widget){return;
}k.replace_content(this.webcam_text,k.cspan("webcam_capture_error",l("You need to install Adobe Flash")));
},build_dom:function(){this.account=IMO.Session.get().get_imo_account();
this.profile_core=this.account.profile;
this.profile_widget=new IMO.REUI.PIN.ImoProfileWidget(this.profile_core);
this.on(this.profile_widget);
this.header_dom=k.cdiv("pin_form_header",k.cspan("text","Loading public profile"));
this.profile_footer_widget=new j.FooterWidget("Save changes","Cancel",null,this,this.on_save_profile_changes,this.on_cancel);
this.take_snapshot_footer_widget=new j.FooterWidget("Take snapshot","Cancel webcam",null,this,this.on_take_snap,this.on_cancel_webcam);
this.use_snapshot_footer_widget=new j.FooterWidget("Use snapshort","Discard snapshot",null,this,this.on_use_snap,this.on_discard_snap);
this.webcam_footer_dom=k.div(this.take_snapshot_footer_widget.dom);
this.footer_dom=k.div(this.profile_footer_widget.dom);
this.body_dom=k.cdiv("stretch");
var n=IMO.REUI.header_body_footer_widget(this.header_dom,this.body_dom,this.footer_dom,"abs");
this.dom=k.cdiv("imo_profile_edit_border",k.cdiv("pin_form_border_inner",n));
this.profile_widget.open();
this.open_main_profile();
},on_resize:function(n){this.popup.adjust_size();
if(this.webcam_widget){this.webcam_widget.center_in_parent();
}},on_profile_loaded:function(n){if(n!==this.profile_widget){return;
}k.replace_content(this.header_dom,k.cspan("profile_user_name",this.profile_widget.profile_data.display_name),k.cspan("text","public profile"));
},on_change_validity:function(o,n){if(o!==this.profile_widget){return;
}if(this.profile_footer_widget){this.profile_footer_widget.main_button.set_enabled(n);
}},on_submit_done:function(n,o){if(n!==this.profile_widget){return;
}if(!o){return;
}if(this.first_time){this.profile_core.profile_uid_call("mark_profile_as_created",{},null,function(){});
Y.later(3000,this,this.suggest_link);
}this.close();
},suggest_link:function(){var n=IMO.Session.get().get_accounts_by_link_group_imo_first();
if(n.length>1){var p=0;
var q=false;
for(var o in n[0].accounts){if(!n[0].accounts.hasOwnProperty(o)){continue;
}p++;
if(n[0].accounts[o].proto===a.PROTO_IMO){q=true;
}}if(q&&p===1){IMO.REUI.PIN.Notification.show_suggest_link();
}}},on_select_webcam:function(n){if(n!==this.profile_widget){return;
}this.open_webcam_widget();
},IMOIMOIMOIMO:1});
IMO.REUI.PIN.ProfileEdit=new IMO.REUI.PIN.ImoProfileWidgetPopup();
var f={valid:"Checking availability",invalid:"Username invalid",taken:"Username not available",available:"Username available",same:"",empty:"No username specified"};
var h=function(){if(this.input.value.length>this.maxlen){this.input.value=this.input.value.substr(0,this.maxlen);
}};
var g=function(n){return{context:n,onkeydown:h,onkeypress:h,onkeyup:h,onpaste:h,onchange:h};
};
var c=function(n,o){this.label=n;
this.input=new IMO.REUI.PopDownWidget({cls:"popdown_select"},o,o[0]);
this.dom=j.make_field(n,this.input.dom);
};
Y.mix(c.prototype,{value:function(){return this.input.value();
},set_value:function(n){return this.input.set_value(n);
}});
var b=function(n){this.label=n;
this.maxlen=IMO.SharedConstants.ImoProfile.max_value_length;
var o={cls:"textarea_input",rows:10};
Y.mix(o,g(this));
this.dom=j.make_field(n,this.input=k.textarea(o));
};
Y.mix(b.prototype,{value:function(){return this.input.value;
},set_value:function(n){this.input.value=n;
}});
IMO.REUI.PIN.ImoProfilePictureWidget=function(n){this.ev=new IMO.Event();
this.profile_core=n;
this.picture_id=null;
this.on(this.profile_core);
this.dom=j.make_field("Picture",k.cdiv("profile_picture_field",k.cdiv("profile_picture_div",this.img=k.img({cls:"profile_picture_img"})),k.cdiv("profile_picture_actions",k.cdiv("upload_picture",this.form=k.form({enctype:"multipart/form-data"},this.input=k.input({cls:"upload_picture_input",type:"file",name:"file",context:this,onchange:function(){Y.log("File selected ....");
Y.later(0,this,this.upload_picture);
}}))),k.cdiv("use_webcam profile_picture_action pin_form_text_button",{context:this,onclick:this.on_select_webcam},l("Take a picture from your webcam")),this.delete_pic_div=k.cdiv("delete_profile_picture profile_picture_action pin_form_text_button",{context:this,onclick:this.on_delete_profile_picture},l("Delete profile picture"))),k.cdiv("clear"),this.error_div=k.cdiv("profile_picture_error")));
};
Y.mix(IMO.REUI.PIN.ImoProfilePictureWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoProfilePictureWidget.prototype,{close:function(){this.cancel_picture_loader();
},set_picture_id:function(n){Y.log(["Picture ID is ",n]);
if(n){k.cshow(this.delete_pic_div);
}else{k.chide(this.delete_pic_div);
}this.picture_id=n;
this.reload_picture();
},cancel_picture_loader:function(){if(this.picture_loader){this.picture_loader.cancel();
delete this.picture_loader;
}},reload_picture:function(){var o=a.imo_profile_picture_width;
var n=a.imo_profile_picture_height;
var p=this.picture_id?("/o/"+this.picture_id+""+o+"x"+n):a.DEFAULT_BICON;
this.cancel_picture_loader();
this.picture_loader=new IMO.REUI.ImageLoader(this.img,p,20,false);
},on_select_webcam:function(){this.ev.fire("on_select_webcam",this);
},on_delete_profile_picture:function(){this.profile_core.update_profile({profile_photo_id:e},this,function(n){Y.log("delete profile picture reply");
if(!n.error){this.set_picture_id(null);
}});
},upload_picture:function(){this.profile_core.upload_picture(this.form);
},on_picture_upload_fail:function(){k.replace_content(this.error_div,l("Invalid file"));
},on_picture_upload_success:function(n){this.set_picture_id(n);
k.empty(this.error_div);
},IMOIMOIMOIMO:1});
IMO.REUI.PIN.ImoUniversityWidget=function(n){this.text={dom_label_loading:"Universities",dom_label:"Universities",dom2_label:"",cannot_remove_item:"Cannot remove university. Server error",cannot_add_item:"Cannot add university. Server error",tip:"Please add universities one by one. Do not separate them by commas or spaces."};
IMO.REUI.PIN.ImoUniversityWidget.superclass.constructor.call(this,n,"university");
};
Y.extend(IMO.REUI.PIN.ImoUniversityWidget,m);
IMO.REUI.PIN.ImoHighSchoolWidget=function(n){this.text={dom_label_loading:"High schools",dom_label:"High schools",dom2_label:"",cannot_remove_item:"Cannot remove high school. Server error",cannot_add_item:"Cannot add high school. Server error",tip:"Please add high schools one by one. Do not separate them by commas or spaces."};
IMO.REUI.PIN.ImoHighSchoolWidget.superclass.constructor.call(this,n,"highschool");
};
Y.extend(IMO.REUI.PIN.ImoHighSchoolWidget,m);
IMO.REUI.PIN.ImoEmployerWidget=function(n){this.text={dom_label_loading:"Employers",dom_label:"Employers",dom2_label:"",cannot_remove_item:"Cannot remove employer. Server error",cannot_add_item:"Cannot add employer. Server error",tip:"Please add employers one by one. Do not separate them by commas or spaces."};
IMO.REUI.PIN.ImoEmployerWidget.superclass.constructor.call(this,n,"employer");
};
Y.extend(IMO.REUI.PIN.ImoEmployerWidget,m);
IMO.REUI.PIN.ImoLanguagesWidget=function(n){this.text={dom_label_loading:"Languages",dom_label:"Languages",dom2_label:"",cannot_remove_item:"Cannot remove language. Server error",cannot_add_item:"Cannot add language. Server error",tip:"Please add languages one by one. Do not separate them by commas or spaces."};
IMO.REUI.PIN.ImoLanguagesWidget.superclass.constructor.call(this,n,"languages");
};
Y.extend(IMO.REUI.PIN.ImoLanguagesWidget,m);
IMO.REUI.PIN.ImoInterestsWidget=function(n){this.text={dom_label_loading:"Interests",dom_label:"Interests",dom2_label:"",dom_suggestions_label:"Suggested interests",cannot_remove_item:"Cannot remove interest. Server error",cannot_add_item:"Cannot add interest. Server error",cannot_add_suggestion:"Cannot retrieve suggestions. Server error",tip:"Please add your interests. Use commas to separate multiple items."};
this.fetch_suggested_typed_items=function(){var p=null;
var o=true;
d.foreach(this.newly_added,function(q){o=false;
return false;
},this);
if(o){p=Object.keys(this.typed_items);
}else{p=Object.keys(this.newly_added);
}if(p.length>0){this.profile.profile_uid_call("get_typed_suggestions",{item_type:"interest",items:p},this,this.get_typed_suggestions_cb);
}};
IMO.REUI.PIN.ImoInterestsWidget.superclass.constructor.call(this,n,"interests");
};
Y.extend(IMO.REUI.PIN.ImoInterestsWidget,m);
IMO.REUI.PIN.ImoLookingForWidget=function(n){this.text={dom_label_loading:"Looking for",dom_label:"Looking for",dom2_label:"",cannot_remove_item:"Cannot remove item. Server error",cannot_add_item:"Cannot add item. Server error",tip:"Please add your items one by one. Do not separate them by commas or spaces."};
IMO.REUI.PIN.ImoLookingForWidget.superclass.constructor.call(this,n,"lookingfor");
};
Y.extend(IMO.REUI.PIN.ImoLookingForWidget,m);
IMO.REUI.PIN.ImoLinkedAccountsWidget=function(n){this.profile=n;
this.linked_profiles_urls={};
this.linked_names={};
this.dom=j.make_field("Link account",i(""),this.status=k.span());
this.dom2=j.make_field("Currently linked",i(""));
this.pictures={};
this.pictures[IMO.OAuth.GOOGLE2]="google2_big";
this.pictures[IMO.OAuth.FACEBOOK]="facebook_big";
this.pictures[IMO.OAuth.TWITTER]="twitter_big";
this.pictures[IMO.OAuth.LINKEDIN]="linkedin_big";
this.all_websites=[IMO.OAuth.GOOGLE2,IMO.OAuth.FACEBOOK,IMO.OAuth.TWITTER,IMO.OAuth.LINKEDIN];
};
Y.mix(IMO.REUI.PIN.ImoLinkedAccountsWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoLinkedAccountsWidget.prototype,{open:function(){IMO.OAuth.get().init();
this.on(IMO.OAuth.get());
this.is_opened=true;
},close:function(){if(this.is_opened){this.unsubscribe(IMO.OAuth.get());
delete this.is_opened;
}},set_value:function(n){this.linked_profiles_urls={};
this.linked_names={};
d.foreach(this.all_websites,function(o){if(n[o+"_profile_url"]){this.linked_profiles_urls[o]=n[o+"_profile_url"];
this.linked_names[o]=n[o+"_full_name"];
}},this);
this.build_dom();
},build_dom:function(){var p=this;
var r=function(u){return k.span(k.sprite(p.pictures[u],{cls:"button"}),{context:p,title:u,onclick:function(v){p.link_clicked(u);
}});
};
var t=function(u){return k.cdiv("external_profile",k.cdiv("network_picture_and_x",k.cspan("network_picture",k.sprite(p.pictures[u])),k.sprite("btn_close_small remove_account_x",{context:p,onclick:function(v){p.on_click_x(u);
}})),k.cspan("foreign_profile_name",k.a({href:p.linked_profiles_urls[u],target:"_blank"},k(p.linked_names[u]))),k.cdiv("clear"));
};
var n=k.cdiv("linked_accounts_widget");
var s=k.cdiv("linked_accounts_widget");
var q=false;
var o=false;
d.foreach(this.all_websites,function(u){if(!this.linked_profiles_urls[u]){n.appendChild(r(u));
q=true;
}else{s.appendChild(t(u));
o=true;
}},this);
j.change_field(this.dom,"Link account",n,this.status);
j.change_field(this.dom2,"Currently linked",s);
if(!q){k.empty(this.dom);
}if(!o){k.empty(this.dom2);
}},link_clicked:function(n){k.replace_content(this.status,k.cspan("",""));
IMO.OAuth.get().profile_connect(n,this.profile.uid);
},send_profile_update:function(n){this.profile.update_profile(n,this,function(o){Y.log(["updating profile : ",n]);
if(o.error&&o.error.account_link){this.server_error(o.error.account_link);
}else{this.get_profile();
}});
},get_profile:function(){this.profile.profile_uid_call("get_profile",{},this,function(n){Y.log(["read profile: ",n]);
if(!n.error){this.set_value(n.result);
}});
},server_error:function(n){var o=k.cspan("pin_error_color",i(n.error));
k.replace_content(this.status,o);
},on_click_x:function(n){var o={};
o[n+"_token"]=IMO.SharedConstants.ImoProfile.value_for_removal;
this.send_profile_update(o);
},oauth:function(p,n,o){if(p!==IMO.OAuth.get()){return;
}if(n===IMO.OAuth.FACEBOOK){var q={};
q[n+"_token"]=o;
this.send_profile_update(q);
}this.get_profile();
}});
IMO.REUI.PIN.ImoLinkedDomainsWidget=function(n){this.profile=n;
this.linked_domains={};
this.dom2=j.make_field("",i("Email domains not loaded yet"),i(""));
this.dom=j.make_field("EmailDomains",i("Email domains not loaded yet"),i(""));
};
Y.mix(IMO.REUI.PIN.ImoLinkedDomainsWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoLinkedDomainsWidget.prototype,{build_dom:function(){var o=this;
this.input=k.input({cls:"textline_input",type:"text",context:this,onkeyup:function(q){if(q.keyCode===13){o.on_enter_key();
}else{o.on_input_changed(o.input);
}}});
j.change_field(this.dom,"Email domains",this.input,k.cdiv("add_email_domain",k.cdiv("domain_button",(this.button=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.on_add_clicked},{cls:"small_button_inner"},l("Add"))).dom),k.cdiv("domain_tooltip",(this.domain_question_dom=k.sprite("icn_question")),{context:this}),k.cdiv("clear")));
var n=new IMO.REUI.LinkTooltipManager(this.domain_question_dom,IMO.Texts.DOMAINS_HELP,"sprite_icn_question");
j.change_field(this.dom2,"",this.current_domain_emails=k.cdiv("current_email_domains"));
for(var p in this.linked_domains){if(this.linked_domains.hasOwnProperty(p)){this.add_domain(p,this.linked_domains[p]);
}}this.on_input_changed(this.input);
},set_value:function(n){this.linked_domains={};
for(var o in n){if(o.indexOf("domain_email_")===0){var p=o.substr(13);
this.linked_domains[p]=n["domain_date_"+p];
}}this.build_dom();
},check_input_query:function(){var n=this.input.value;
this.query_valid=(n!==""&&d.verify_email(n));
},add_typed_domain_email:function(){if(!this.button.enabled){return;
}var n=this.input.value;
this.input.value="";
var o="domain_email_"+n.substr(n.indexOf("@"));
var p={};
p[o]=n;
this.profile.update_profile(p,this,function(){Y.log(["updating profile : ",p]);
this.profile.profile_uid_call("get_profile",{},this,function(q){Y.log(["read profile: ",q]);
if(!q.error){this.set_value(q.result);
}});
});
this.on_input_changed(this.input);
},on_enter_key:function(){this.add_typed_domain_email();
},on_add_clicked:function(){this.add_typed_domain_email();
},on_input_changed:function(n){if(n!==this.input){return;
}this.check_input_query();
this.button.set_enabled(this.query_valid);
},make_domain_email_dom:function(o,n){var p=o;
if(!n){p+=" (not verified)";
}return j.make_cancellable_bubble_dom(p,this,function(q){this.remove_domain_email(o);
});
},remove_domain_email:function(n){n="domain_email_"+n;
var o={};
o[n]=null;
this.profile.update_profile(o,this,function(){Y.log(["updating profile : ",o]);
this.profile.profile_uid_call("get_profile",{},this,function(p){Y.log(["read profile: ",p]);
if(!p.error){this.set_value(p.result);
}});
});
},add_domain:function(p,o){var n=this.make_domain_email_dom(p,o);
this.current_domain_emails.appendChild(n);
}});
IMO.REUI.PIN.ImoProfileFullNameWidget=function(){this.name="(Not loaded yet)";
this.dom=j.make_field(i("Name"),i(this.name));
};
Y.mix(IMO.REUI.PIN.ImoProfileFullNameWidget.prototype,{set_value:function(n){this.name=n;
j.change_field(this.dom,i("Name"),k.cdiv("text_field",this.name),(this.button=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:function(){IMO.REUI.PIN.NameChangePopup.show();
}},{cls:"small_button_inner"},l("Request name change"))).dom);
}});
IMO.REUI.PIN.ImoProfileChangePasswordWidget=function(){this.dom=j.make_field(i("Password"),new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.change_password},{cls:"small_button_inner"},l("Change Password")).dom);
};
Y.mix(IMO.REUI.PIN.ImoProfileChangePasswordWidget.prototype,{change_password:function(){IMO.REUI.PIN.ChangePasswordPopup.show();
}});
IMO.REUI.PIN.ImoProfileVerifyPhoneWidget=function(){this.dom=j.make_field(i("Phone"),new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.verify_phone},{cls:"small_button_inner"},l("Verify Phone Number")).dom);
};
Y.mix(IMO.REUI.PIN.ImoProfileVerifyPhoneWidget.prototype,{verify_phone:function(){IMO.REUI.PIN.PhoneVerify.show();
}});
IMO.REUI.PIN.ImoProfileDeleteWidget=function(n){this.profile=n;
this.dom=j.make_field(i("Account"),new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.delete_clicked},{cls:"small_button_inner"},l("Delete Account")).dom);
};
Y.mix(IMO.REUI.PIN.ImoProfileDeleteWidget.prototype,{delete_clicked:function(){Y.log("delete_account");
var n=this;
this.popup=new IMO.REUI.ConfirmModalPopup("Delete your imo account?",i("Deleting your imo account. Are you sure?"),[[l("Yes"),"blue"],[l("No"),"grey"]],function(o){if(o===0){var p=IMO.Session.get().get_account("im",n.profile.uid,a.PROTO_IMO);
if(p){p.delete_account();
IMO.REUI.PIN.ProfileEdit.close();
}}n.popup.destroy();
delete n.popup;
},this);
}});
IMO.REUI.PIN.PremiumAccountWidget=function(n){if(n){this.dom=j.make_field(i("Premium Account"),k.sprite("premium_account",{style:{cursor:"pointer"},context:this,onclick:function(o){IMO.REUI.PremiumAccount.show();
}}));
}else{this.dom=j.make_field(i("Premium Account"),new IMO.UIWidgets.Button({button_size:"small"},{onclick:function(o){IMO.REUI.PremiumAccount.show();
}},{cls:"small_button_inner"},l("Upgrade to a Premium Account!")).dom);
}};
IMO.REUI.PIN.ImoProfileUsernameWidget=function(n){this.ev=new IMO.Event();
this.profile=n;
this.dom=j.make_field("Username",k.cdiv("username_hint_and_input",this.input=k.input({cls:"username_input textline_input",type:"text",context:this,onkeydown:this.username_change_cb,onkeypress:this.username_change_cb,onkeyup:this.username_change_cb,onpaste:this.username_change_cb,onchange:this.username_change_cb})),this.status=k.span());
this.username_change_cb();
};
Y.mix(IMO.REUI.PIN.ImoProfileUsernameWidget.prototype,{cancel_availability_check:function(){delete this.username_to_be_checked;
if(this.username_check_timer){this.username_check_timer.cancel();
delete this.username_check_timer;
}},schedule_availability_check:function(){var n=this.input.value;
if(this.username_to_be_checked===n){return;
}this.cancel_availability_check();
this.username_to_be_checked=n;
this.username_check_timer=Y.later(0,this,function(){this.profile.username_available(n,this,function(o){if(o.result!==undefined){this.set_username_availability(n,o.result);
}});
});
},is_valid:function(){return this.username_status===f.available||this.username_status===f.same||this.username_status===f.empty;
},signal_validity:function(){this.ev.fire("on_change_validity",this,this.is_valid());
},set_username_status:function(o){this.username_status=o;
var n=this.is_valid();
var p=k.cspan(n?"":"pin_error_color",i(o));
k.replace_content(this.status,p);
this.signal_validity();
},server_error:function(n){var o=this.input.value;
if(o!==n.username){return;
}this.set_username_status(n.error);
},set_username_validity:function(){var o=this.input.value;
if(o===this.last_valid_checked){return;
}this.last_valid_checked=o;
if(o===this.current_value){this.set_username_status(f.same);
return;
}if(o===""){this.set_username_status(f.empty);
return;
}var n=IMO.ImoProfile.username_rule_violation(o);
this.set_username_status(n?n:f.valid);
},set_username_availability:function(n,o){var p=this.input.value;
if(p!==n){return;
}this.set_username_status(o?f.available:f.taken);
},username_change_cb:function(){Y.later(0,this,function(){this.set_username_validity();
if(this.username_status===f.valid){this.schedule_availability_check();
}else{this.cancel_availability_check();
}});
},value:function(){return this.input.value;
},set_value:function(n){this.input.value=n;
this.last_valid_checked=null;
this.username_change_cb();
},set_current_value:function(n){this.current_value=n;
}});
IMO.REUI.PIN.ImoProfileLocationWidget=function(){var n={cls:"textline_input",type:"text",context:this,onblur:this.onblur};
this.input=new IMO.REUI.SuggestionWidget(n,{},true);
this.dom=j.make_field("Location",this.input.input_dom,l("Start typing to choose location"));
};
Y.mix(IMO.REUI.PIN.ImoProfileLocationWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoProfileLocationWidget.prototype,{open:function(){this.on(this.input);
this.input.open();
this.is_opened=true;
},onblur:function(n){Y.later(0,this,this.check_location);
},close:function(){if(this.in_opened){this.input.close();
this.unsubscribe(this.input);
delete this.is_opened;
}},on_input_changed:function(p,n){if(p!==this.input){return;
}if(n){return;
}var o=this.input.value();
IMO.EventDispatcher.get().subscribe(this,"geoip","geoip_city_suggestion",o);
IMO.Network.get().send("geoip","web_suggest_cities",{query:o});
},on_enter_key:function(n){if(n!==this.input){return;
}this.input.close_suggestion_hover();
this.check_location();
},check_location:function(){IMO.Network.get().send("geoip","check_location",{loc:this.input.value()},true,function(n){if(n!==true){this.input.set_value("");
}},this);
},city_suggestion:function(o){IMO.EventDispatcher.get().unsubscribe(this,"geoip","geoip_city_suggestion",o.query);
var n=d.map(o.result,function(p){return[p,p];
});
this.input.create_suggestion_hover(o.query,n);
},value:function(){return this.input.value();
},set_value:function(n){this.input.set_value(n);
}});
IMO.REUI.PIN.ImoProfileGenderWidget=function(){IMO.REUI.PIN.ImoProfileGenderWidget.superclass.constructor.call(this,"Gender",IMO.SharedConstants.ImoProfile.genders);
};
Y.extend(IMO.REUI.PIN.ImoProfileGenderWidget,c);
IMO.REUI.PIN.ImoProfileBioWidget=function(){IMO.REUI.PIN.ImoProfileBioWidget.superclass.constructor.call(this,"Short biography");
};
Y.extend(IMO.REUI.PIN.ImoProfileBioWidget,b);
IMO.REUI.PIN.ImoProfileWidget=function(n){this.ev=new IMO.Event();
this.profile=n;
this.default_dom=k.table({cls:"pin_form_field_list"},k.tbody(k.tr(k.td(k.cdiv("loading_profile_gif",k.img({src:"assets/loading_54.gif"}))))));
this.inited=false;
this.on_change_validity(this);
this.dom=this.default_dom;
this.account=IMO.Session.get().get_imo_account();
this.on(this.account);
};
Y.mix(IMO.REUI.PIN.ImoProfileWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoProfileWidget.prototype,{on_change_validity:function(n){this.ev.fire("on_change_validity",this,this.is_valid());
},on_select_webcam:function(n){if(n!==this.picture_widget){return;
}this.ev.fire("on_select_webcam",this);
},close:function(){this.picture_widget.close();
this.interest_widget.close();
this.university_widget.close();
this.high_school_widget.close();
this.employer_widget.close();
this.languages_widget.close();
this.location_widget.close();
this.linked_accounts_widget.close();
this.unsubscribe(this.username_widget);
this.unsubscribe(this.picture_widget);
this.dom=this.default_dom;
delete this.delete_widget;
delete this.bio_widget;
delete this.interest_widget;
delete this.looking_for_widget;
delete this.linked_accounts_widget;
delete this.linked_domains_widget;
delete this.location_widget;
delete this.university_widget;
delete this.high_school_widget;
delete this.employer_widget;
delete this.languages_widget;
delete this.username_widget;
delete this.picture_widget;
delete this.fullname_widget;
this.inited=false;
this.on_change_validity(this);
if(this.request_id){this.profile.cancel_callback(this.request_id);
}},on_premium:function(n){k.replace_content(this.premium_account_widget.dom,(new IMO.REUI.PIN.PremiumAccountWidget(n)).dom);
},open:function(){var n=function(p,o){if(!o){o="";
}p.set_value(o);
};
this.fullname_widget=new IMO.REUI.PIN.ImoProfileFullNameWidget(this.profile);
this.picture_widget=new IMO.REUI.PIN.ImoProfilePictureWidget(this.profile);
this.username_widget=new IMO.REUI.PIN.ImoProfileUsernameWidget(this.profile);
this.premium_account_widget=new IMO.REUI.PIN.PremiumAccountWidget(this.account.premium);
this.location_widget=new IMO.REUI.PIN.ImoProfileLocationWidget();
this.languages_widget=new IMO.REUI.PIN.ImoLanguagesWidget(this.profile);
this.interest_widget=new IMO.REUI.PIN.ImoInterestsWidget(this.profile);
this.university_widget=new IMO.REUI.PIN.ImoUniversityWidget(this.profile);
this.high_school_widget=new IMO.REUI.PIN.ImoHighSchoolWidget(this.profile);
this.employer_widget=new IMO.REUI.PIN.ImoEmployerWidget(this.profile);
this.looking_for_widget=new IMO.REUI.PIN.ImoLookingForWidget(this.profile);
this.linked_accounts_widget=new IMO.REUI.PIN.ImoLinkedAccountsWidget(this.profile);
this.linked_domains_widget=new IMO.REUI.PIN.ImoLinkedDomainsWidget(this.profile);
this.bio_widget=new IMO.REUI.PIN.ImoProfileBioWidget();
this.change_password_widget=new IMO.REUI.PIN.ImoProfileChangePasswordWidget();
this.verify_phone_widget=new IMO.REUI.PIN.ImoProfileVerifyPhoneWidget();
this.delete_widget=new IMO.REUI.PIN.ImoProfileDeleteWidget(this.profile);
this.gender_widget=new IMO.REUI.PIN.ImoProfileGenderWidget();
this.request_id=this.profile.profile_uid_call("get_profile",{},this,function(p){Y.log(p);
if(p.request_id!==this.request_id){return;
}delete this.request_id;
if(p.error){k.replace_content(this.dom,l("Cannot load profile"));
return;
}var o=p.result;
this.profile_data=o;
if(!o.username){o.username="";
}this.username_widget.set_current_value(o.username);
n(this.gender_widget,o.gender);
n(this.username_widget,o.username);
n(this.location_widget,o.location);
n(this.bio_widget,o.bio);
n(this.linked_accounts_widget,o);
n(this.linked_domains_widget,o);
n(this.fullname_widget,o.display_name);
this.location_widget.open();
this.linked_accounts_widget.open();
k.replace_content(this.dom,k.tbody(this.picture_widget.dom,j.make_delimiter(),this.username_widget.dom,j.make_delimiter(),this.premium_account_widget.dom,j.make_delimiter(),this.location_widget.dom,j.make_delimiter(),this.interest_widget.dom0,this.interest_widget.dom,this.interest_widget.dom_suggestions,this.interest_widget.dom2,j.make_delimiter(),this.linked_accounts_widget.dom,this.linked_accounts_widget.dom2,j.make_delimiter(),this.employer_widget.dom0,this.employer_widget.dom,this.employer_widget.dom2,j.make_delimiter(),this.university_widget.dom0,this.university_widget.dom,this.university_widget.dom2,j.make_delimiter(),this.high_school_widget.dom0,this.high_school_widget.dom,this.high_school_widget.dom2,j.make_delimiter(),this.linked_domains_widget.dom,this.linked_domains_widget.dom2,j.make_delimiter(),this.gender_widget.dom,j.make_delimiter(),this.bio_widget.dom,j.make_delimiter(),this.looking_for_widget.dom0,this.looking_for_widget.dom,this.looking_for_widget.dom2,j.make_delimiter(),this.languages_widget.dom0,this.languages_widget.dom,this.languages_widget.dom2,j.make_delimiter(),this.fullname_widget.dom,this.fullname_widget.dom1,this.fullname_widget.dom2,j.make_delimiter(),this.verify_phone_widget.dom,j.make_delimiter(),this.change_password_widget.dom,j.make_delimiter(),this.delete_widget.dom));
this.picture_widget.set_picture_id(o.profile_photo_id);
this.ev.fire("on_resize",this);
this.ev.fire("on_profile_loaded",this);
this.inited=true;
this.on_change_validity(this);
});
this.on(this.picture_widget);
this.on(this.username_widget);
this.on_change_validity(this);
},submit:function(){var n={username:(this.username_widget.value()===""?IMO.SharedConstants.ImoProfile.value_for_removal:this.username_widget.value()),location:this.location_widget.value(),bio:this.bio_widget.value(),gender:this.gender_widget.value()};
this.profile.update_profile(n,this,function(o){Y.log(o);
if(o.error&&o.error.username){this.username_widget.server_error(o.error.username);
}this.ev.fire("on_submit_done",this,!o.error);
});
},is_valid:function(){return this.inited&&this.username_widget.is_valid();
}},true);
}());
(function(){IMO.REUI.PIN.CPHelpPopup=new IMO.REUI.IFramePopup("cp.html","Communication Points");
IMO.REUI.PIN.NameChangePolicyPopup=new IMO.REUI.IFramePopup("/policies/profile_name_policy.html","Profile Name Policy");
}());
(function(){var e=IMO.Utils;
var k=IMO.Utils.HTML;
var l=IMO.Utils.TranslateDom;
var i=IMO.Utils.TranslateTxt;
var a=IMO.Constants;
var b=[a.PROTO_GTALK,a.PROTO_MSN,a.PROTO_MYSPACE,a.PROTO_XMPP];
var g={google:"Google Mail",yahoo:"Yahoo Mail",msn:"Windows Live"};
var m={facebook:"Facebook",twitter:"Twitter",googleplus:"Google+"};
var c="I'm using the imo network to talk to my friends and make new friends. Join me on imo";
if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}var h=0;
var f=function(o,r,q,n,p){this.id=++h;
this.ev=new IMO.Event();
this.email=o;
this.account=r;
this.account_id=q;
this.display_name=n;
this.icon=p||IMO.Constants.DEFAULT_BICON;
this.selected=false;
this.dom=this.build_dom();
if(p){IMO.PriorityIconDownloader.get().request_image_download(this,5);
}};
Y.mix(f.prototype,IMO.IconHolder);
Y.mix(f.prototype,{get_id:function(){return"invitee_"+this.id;
},get_icon_url:function(){return this.icon;
},img_downloaded:function(n){Y.log(["Image downloaded:",n]);
this.img.src=n;
},img_failed:function(){Y.log(["Failed to load image",this,this.icon]);
}},true);
Y.mix(f.prototype,{build_dom:function(){return k.cdiv("person",{onclick:this.invitee_clicked,context:this},this.img=k.img({cls:"buddy-icon",src:IMO.Constants.DEFAULT_BICON}),k.cdiv("name-and-account",k.cdiv("buddy-name",this.display_name),k.cdiv("buddy-account",this.account)),k.sprite("icn_check_blue"));
},get_search_tokens:function(){var n=[];
n=n.concat(this.email);
n=n.concat(this.account);
n=n.concat(e.split_for_search(this.display_name));
n=e.map(n,function(o){return o.toLowerCase();
});
return n;
},invitee_clicked:function(n){IMO.MouseManager.get().handled(n,"pin-invitee-selected");
this.set_selected(!this.selected);
},set_selected:function(n){var o=(this.selected!==n);
this.selected=n;
k.toggle_class(this.dom,"selected",n);
if(o){this.ev.fire("on_selection_change",this);
}}});
var d=function(){this.trie=new e.Trie();
this.invitees={};
this.invitees_shown={};
this.currently_showing=0;
this.selected_cnt=0;
this.accounts={};
this.social_dom={};
this.social_inactive={};
this.accounts_selected_dom=null;
this.popup=new IMO.ModalPopup(this);
this.popup.set_close_on_outside_click(false);
this.dom=this.build_dom();
IMO.EventDispatcher.get().subscribe(this,"oauthmanager","invite");
IMO.EventDispatcher.get().subscribe(this,"imo_account","invite");
};
Y.mix(d.prototype,IMO.EventTarget);
Y.mix(d.prototype,{build_dom:function(){this.invite_button=this.build_invite_button();
this.filter_input=k.input({cls:"filter",onkeydown:this.filter,onkeypress:this.filter,onchange:this.filter,context:this});
this.results=k.idiv("colums");
this.accounts_dom=k.ul({cls:"accounts"});
this.oauth_accounts_dom=k.ul({cls:"accounts"});
var p=this;
var r=function(t){return k.li({cls:"account"},k.cdiv("account-name link",{context:p,onclick:function(){p.show_buddies();
IMO.OAuth.get().oauth_connect(t,a.OAUTH_PIN_INVITE_CALLBACK,"contacts");
}},g[t]));
};
for(var q in g){this.oauth_accounts_dom.appendChild(r(q));
}this.oauth_accounts_dom.appendChild(k.li({cls:"account"},this.manual_link=k.cdiv("account-name link",{context:this,onclick:this.show_addresses},i("Manually enter addresses"))));
var n=function(t){p.social_inactive[t]=false;
return k.li({cls:"account"},p.social_dom[t]=k.cdiv("account-name link",{context:p,onclick:function(){p.share_social(t);
}},m[t]));
};
this.social_links_dom=k.ul({cls:"accounts"});
for(var o in m){this.social_links_dom.appendChild(n(o));
}this.parse_button=new IMO.UIWidgets.Button({},{context:this,onclick:this.parse_addresses},{cls:"parse-button"},l("OK"));
this.share_button=this.build_share_button("N/A");
var s=k.idiv("invite-popup",k.idiv("invite-header",k.idiv("actions",k.cspan("select-all",l("Select all"),{onclick:this.select_all,context:this}),k.cspan("unselect-all",l("Unselect all"),{onclick:this.unselect_all,context:this}),k.cspan("invite-button-container",this.invite_button.dom),k.cspan("close",l("Close"),{onclick:this.hide,context:this})),k.cspan("title",l("Invite your friends to meet their friends")),k.cdiv("clear"),k.cspan("description",l("Earn 2 CP (daily) for each new friend you invite when they join the imo network!"))),k.idiv("invite-body",k.idiv("invite-accounts",k.idiv("oauth-accounts-title",{cls:"invite-title"},l("Find your friends on:")),this.oauth_accounts_dom,k.idiv("social-links-title",{cls:"invite-title"},l("Send invite to friends on:")),this.social_links_dom,k.idiv("accounts-title",{cls:"invite-title"},l("We found your contacts on:")),this.accounts_dom),this.invite_buddies_div=k.idiv("invite-buddies",{cls:"invite-main"},this.filter_input,this.results),this.enter_addresses_div=k.idiv("invite-addresses",{cls:"invite-main"},k.cdiv("address-description",l("Add friends' email addresses separated by commas.")),this.addresses_area=k.textarea(),k.cdiv("main-buttons",this.parse_button.dom,k.cdiv("main-cancel",{context:this,onclick:function(){this.addresses_area.value="";
this.show_buddies();
}},l("Cancel")))),this.share_social_div=k.idiv("invite-social",{cls:"invite-main"},this.social_wait_text=k.cdiv("social-loading",l("Creating an invite link, please wait...")),this.social_description=k.cdiv("social-description",l("Click on the Share button to invite your friends. You can also add the URL below to any email, blog post or update.")),this.social_warning=k.cdiv("social-warning",""),this.social_invite_link=k.input({cls:"invite-link",context:this,onclick:this.select_invite_link,readonly:"readonly"}),this.social_buttons_dom=k.cdiv("main-buttons",this.share_button.dom,k.cdiv("main-cancel",{context:this,onclick:function(){this.show_buddies();
}},l("Cancel"))))));
this.show_buddies();
return s;
},show_buddies:function(){k.show(this.invite_buddies_div,"block");
k.hide(this.enter_addresses_div);
k.hide(this.share_social_div);
if(this.accounts_selected_dom){k.remove_class(this.accounts_selected_dom,"selected");
}},show_addresses:function(){k.hide(this.invite_buddies_div);
k.show(this.enter_addresses_div,"block");
k.hide(this.share_social_div);
if(this.accounts_selected_dom){k.remove_class(this.accounts_selected_dom,"selected");
}k.add_class(this.manual_link,"selected");
this.accounts_selected_dom=this.manual_link;
},show_social:function(){k.hide(this.invite_buddies_div);
k.hide(this.enter_addresses_div);
k.show(this.share_social_div,"block");
if(this.accounts_selected_dom){k.remove_class(this.accounts_selected_dom,"selected");
}},select_invite_link:function(){this.social_invite_link.select();
},parse_addresses:function(){Y.log(this.addresses_area.value);
var n=this.addresses_area.value.match(/[^\s,<>]+/g);
var o=[];
e.foreach(n,function(r){var s=r.indexOf("@");
if(s!=-1){var q=r.lastIndexOf("@");
if(s===q){o.push(r);
}}});
Y.log(o);
this.manual_add(o);
this.show_buddies();
},build_account_dom:function(p,n,o){return k.li({cls:"account"},this.accounts[p].div=k.cdiv("account-name toggle",{context:this,onclick:function(){this.toggle_account(p);
}},e.HTML(n+" ("+o+")")));
},share_social:function(n){if(this.generating_invite_proto===n){return;
}this.show_social();
this.social_invite_link_text=null;
this.generating_invite_proto=n;
k.show(this.social_wait_text,"block");
k.hide(this.social_description);
k.hide(this.social_warning);
k.hide(this.social_invite_link);
k.hide(this.social_buttons_dom);
this.update_share_button(n);
if(this.social_inactive[n]){this.show_buddies();
return;
}var o=IMO.Session.get().get_imo_account();
if(!o){this.show_buddies();
return;
}IMO.Network.get().send("inviter","generate_invite",{ssid:IMO.Session.get().ssid,uid:o.uid,invite_proto:n},true,this.invite_created,this);
k.add_class(this.social_dom[n],"selected");
this.accounts_selected_dom=this.social_dom[n];
},share_social_clicked:function(){var n=this.selected_invite_link;
IMO.Stats.log_event("pin_social_invite",{proto:this.selected_social_proto});
if(this.selected_social_proto==="facebook"){this.share_with_facebook(n);
}else{if(this.selected_social_proto==="twitter"){this.share_with_twitter(n);
}else{if(this.selected_social_proto==="googleplus"){this.share_with_googleplus(n);
}else{this.show_buddies();
return;
}}}},invite_created:function(p){var o=p.invite_link;
var n=p.social_proto;
if(this.generating_invite_proto!==n){return;
}this.generating_invite_proto=null;
k.hide(this.social_wait_text);
k.show(this.social_description,"block");
if(n==="googleplus"){k.replace_content(this.social_warning,l("You need to be logged in on Google+ for this to work!"));
k.show(this.social_warning,"block");
}else{k.hide(this.social_warning);
}k.show(this.social_invite_link,"block");
k.show(this.social_buttons_dom,"block");
this.update_share_button(n);
this.social_invite_link.value=o;
if(!(n in m)){this.show_buddies();
return;
}this.selected_social_proto=n;
this.selected_invite_link=o;
},share_with_facebook:function(n){var q=i(c);
var r=e.sprintf("https://%s/s/oauth/fb_feed_callback",location.host);
var p={app_id:IMO.Constants.FACEBOOK_APP_ID,name:"Join me on the imo Network",link:n,caption:n,description:q,display:"popup",redirect_uri:r};
var o="https://www.facebook.com/dialog/feed?"+e.encodeURL(p);
window.open(o,"_blank","width=400, height=400");
},share_with_twitter:function(n){var p=i(c);
var o=e.sprintf("https://twitter.com/intent/tweet?url=%s&text=%s",encodeURIComponent(n),encodeURIComponent(p));
window.open(o,"_blank","width=400, height=400");
},share_with_googleplus:function(n){var p=i(c+" [LINK]",{LINK:n});
var o=e.sprintf("https://m.google.com/app/plus/x/?v=compose&content=%s",encodeURIComponent(p));
window.open(o,"_blank","width=450, height=400");
},toggle_account:function(o){var n=this.accounts[o].hidden;
k.set_class(this.accounts[o].div,"grey",!n);
this.accounts[o].hidden=!n;
this.filter(null,true);
},initial_populate:function(){k.empty(this.accounts_dom);
var n=[];
var p=IMO.BuddyList.get().get_buddies();
e.foreach(p,function(r){var q=this.get_email(r);
if(q){var s=new f(q,r.account.pretty_proto(),e.sprintf("%s#%s",r.account.uid,r.account.proto),r.get_display_text(),r.get_buddy_icon());
this.on(s);
s.set_selected(true);
this.invitees[s.id]=s;
this.trie.insert_set(s.get_search_tokens(),s.id);
n.push(s);
if(!(s.account_id in this.accounts)){this.accounts[s.account_id]={name:s.account,count:0,hidden:false};
}this.accounts[s.account_id].count++;
}},this);
this.display_results(n);
for(var o in this.accounts){this.accounts_dom.appendChild(this.build_account_dom(o,this.accounts[o].name,this.accounts[o].count));
}},manual_add:function(p){IMO.Stats.log_event("pin_invite",{manual:p.length});
var o="manual-"+e.random_string(8);
var n=i("Manually added");
this.accounts[o]={name:n,count:0,hidden:false};
e.foreach(p,function(q){var r=new f(q,n,o,q,null);
this.on(r);
r.set_selected(true);
this.invitees[r.id]=r;
this.trie.insert_set(r.get_search_tokens(),r.id);
this.accounts[o].count++;
},this);
this.accounts_dom.appendChild(this.build_account_dom(o,n,this.accounts[o].count));
this.filter(null,true);
},contacts_added:function(r){var p=r.edata.contacts;
var n=r.edata.service;
if(!(n in g)){Y.log(["Unknown service",n]);
return;
}var o=r.edata.id+e.random_string(8);
var q=g[n];
this.accounts[o]={name:q,count:0,hidden:false};
e.foreach(p,function(t){var s=new f(t.email,q,o,t.name?t.name:t.email,t.photo?e.sprintf(a.OAUTH_GET_PHOTO_URL,location.host,n,IMO.Network.get().ssid,t.photo):null);
this.on(s);
s.set_selected(true);
this.invitees[s.id]=s;
this.trie.insert_set(s.get_search_tokens(),s.id);
this.accounts[o].count++;
},this);
this.accounts_dom.appendChild(this.build_account_dom(o,q,this.accounts[o].count));
this.filter(null,true);
},on_selection_change:function(n){this.selected_cnt+=(n.selected?1:-1);
this.update_invite_button();
},build_invite_button:function(){return new IMO.UIWidgets.Button({},{context:this,onclick:this.invite_contacts},{cls:"invite-button"},l("Invite [NUMBER] Contacts",{NUMBER:this.selected_cnt}));
},update_invite_button:function(){if(this.update_invite_button_timer){this.update_invite_button_timer.cancel();
}this.update_invite_button_timer=Y.later(50,this,function(){var n=this.build_invite_button();
if(this.invite_button){this.invite_button.dom.parentNode.replaceChild(n.dom,this.invite_button.dom);
}this.invite_button=n;
return this.invite_button;
});
},build_share_button:function(n){return new IMO.UIWidgets.Button({},{context:this,onclick:this.share_social_clicked},{cls:"share-social-button"},l("Share with [PROTO]",{PROTO:m[n]}));
},update_share_button:function(o){var n=this.build_share_button(o);
if(this.share_button){this.share_button.dom.parentNode.replaceChild(n.dom,this.share_button.dom);
}this.share_button=n;
return this.share_button;
},get_email:function(q){if(e.is_group_target(q.buid)||b.indexOf(q.account.proto)===-1){return null;
}var p=q.buid;
var o=p.indexOf("@");
var r=o===-1?"":p.substring(o);
var n=p.indexOf("/");
if(n!==-1){if(r===""){return null;
}p=p.substring(n+1);
}if(r===""){return null;
}return p;
},unselect_all:function(n){IMO.MouseManager.get().handled(n,"pin-invitee-select-all");
this.set_all_selected(false);
},select_all:function(n){IMO.MouseManager.get().handled(n,"pin-invitee-select-all");
this.set_all_selected(true);
},set_all_selected:function(o){for(var n in this.invitees_shown){var p=this.invitees_shown[n];
p.set_selected(o);
}},filter:function(o,n){Y.later(0,this,function(){var p=this.filter_input.value;
if(n||p!==this.last_query){this.last_query=p;
k.empty(this.results);
this.invitees_shown={};
this.process(p);
}});
},process:function(q){q=q.toLowerCase();
var o=[];
if(q){var n=q.split(" ");
var p=this.trie.and_search(n);
o=e.map(p,function(r){return this.invitees[r];
},this);
}else{o=Y.Object.values(this.invitees);
}o=e.filter(o,function(r){return !this.accounts[r.account_id].hidden;
},this);
this.display_results(o,q);
},display_results:function(n,o){n=n.slice();
k.empty(this.results);
this.invitees_shown={};
n.sort(function(q,p){return e.string_compare(q.display_name,p.display_name);
});
e.map(n,function(p){this.results.appendChild(p.dom);
this.invitees_shown[p.id]=p;
},this);
if(this.single_res){this.single_res.set_selected(false);
this.unsubscribe(this.single_res);
delete this.single_res;
}if(n.length===0&&o){this.single_res=new f(o,"Email","Email",o);
this.single_res.single=true;
this.on(this.single_res);
this.single_res.set_selected(true);
this.invitees_shown[this.single_res.id]=this.single_res;
this.results.appendChild(this.single_res.dom);
}this.results.appendChild(k.cdiv("clear"));
},invite_contacts:function(q){IMO.MouseManager.get().handled(q,"pin-invitee-invite-contacts");
var n=[];
e.foreach(this.invitees,function(r){if(r.selected){n.push({type:"mail",buid:r.email,invitee_name:r.display_name});
}},this);
if(this.single_res&&this.single_res.selected){n.push({type:"mail",buid:this.single_res.email});
}var p=IMO.Session.get().get_imo_account();
var o={uid:p.uid,ssid:IMO.Network.get().ssid,invites:n};
IMO.Network.get().send("inviter","invite",o);
this.hide();
},show:function(){this.popup.set_content(this.dom,[900,500]);
this.popup.prepare();
this.popup.show();
IMO.ResizeManager.register(this.on_resize,this);
this.initial_populate();
},hide:function(){if(this.single_res){this.unsubscribe(this.single_res);
}e.foreach(this.invitees,function(n){this.unsubscribe(n);
},this);
this.show_buddies();
this.invitees={};
this.accounts={};
this.trie=new e.Trie();
this.filter_input.value="";
this.single_res=null;
this.selected_cnt=0;
this.update_invite_button();
this.generating_invite_proto=null;
this.popup.hide();
IMO.ResizeManager.unregister(this.on_resize,this);
document.location.hash="";
},on_resize:function(n){this.popup.adjust_size();
}});
var j=null;
IMO.REUI.PIN.InvitePopup=function(){if(!j){j=new d();
}return j;
};
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var f=IMO.Constants;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var c=IMO.REUI.PIN.FORM;
IMO.REUI.PIN.NewsSourceUploadPopup=function(){this.popup=new IMO.ModalPopup(this);
this.popup.set_close_on_outside_click(false);
};
Y.mix(IMO.REUI.PIN.NewsSourceUploadPopup.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.NewsSourceUploadPopup.prototype,{show:function(){this.build_dom();
this.popup.set_content(this.dom,[f.news_upload_width+2*f.pin_form_border,f.news_upload_height+2*f.pin_form_border]);
this.popup.prepare();
this.popup.show();
IMO.ResizeManager.register(this.on_resize,this);
var g=this;
this.shortcuts=IMO.K.push({bindings:{esc:{cb:function(){g.close();
}}},bottom:true,context:this});
},hide:function(){delete this.footer_dom;
delete this.header_dom;
delete this.dom;
this.news_upload_widget.close();
this.popup.hide();
IMO.K.pop(this.shortcuts);
IMO.ResizeManager.unregister(this.on_resize,this);
document.location.hash="";
},close:function(){this.hide();
},build_dom:function(){this.account=IMO.S.get_imo_account();
this.news_upload_widget=new IMO.REUI.PIN.ImoNewsUploadWidget();
this.on(this.news_upload_widget);
this.header_dom=d.cdiv("pin_form_header",d.cspan("title","Improve imo news"));
this.footer_widget=new c.FooterWidget("Done",null,null,this,this.close,null);
this.body_dom=d.cdiv("stretch");
var g=IMO.REUI.header_body_footer_widget(this.header_dom,this.body_dom,this.footer_widget.dom);
this.dom=d.cdiv("imo_news_upload_border",d.cdiv("pin_form_border_inner",g));
this.news_upload_widget.open();
d.replace_content(this.body_dom,this.news_upload_widget.dom);
},on_resize:function(g){this.popup.adjust_size();
}});
IMO.REUI.PIN.NewsUpload=new IMO.REUI.PIN.NewsSourceUploadPopup();
IMO.REUI.PIN.ImoNewsUploadWidget=function(){this.ev=new IMO.Event();
this.default_dom=d.table({cls:"pin_form_field_list"},d.tbody(d.tr(d.td(d.cdiv("loading_profile_gif",d.img({src:"assets/loading_54.gif"}))))));
this.dom=this.default_dom;
this.account=IMO.S.get_imo_account();
this.on(this.account);
};
Y.mix(IMO.REUI.PIN.ImoNewsUploadWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoNewsUploadWidget.prototype,{close:function(){this.dom=this.default_dom;
this.inited=false;
},open:function(){this.info_widget=new IMO.REUI.PIN.ImoNewsInfoWidget();
this.add_source_widget=new IMO.REUI.PIN.ImoAddNewsSourceWidget();
this.add_sublist_widget=new IMO.REUI.PIN.ImoAddSubscriptionWidget();
d.replace_content(this.dom,this.info_widget.dom,d.tbody(c.make_delimiter(),this.add_source_widget.dom,this.add_source_widget.dom1,c.make_delimiter(),this.add_sublist_widget.dom0,this.add_sublist_widget.dom,this.add_sublist_widget.dom1));
},submit:function(){alert("Submit!");
}},true);
IMO.REUI.PIN.ImoNewsInfoWidget=function(){var h=d.tr({cls:"pin_form_field"});
var g=d.td({cls:"single_column",colspan:3},d.cspan("info","Help us improve imo news! Suggest rss-feeds that we should add."));
h.appendChild(g);
this.dom=h;
};
IMO.REUI.PIN.ImoAddNewsSourceWidget=function(){var g=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.add_source,onchange:function(){this.source_status.style.visibility="hidden";
}},{cls:"small_button_inner"},b("Add")).dom;
var h=d.div(this.input=d.input({type:"text",name:"source_url",size:"50",placeholder:"e.g. http://feeds.guardian.co.uk/theguardian/world/rss",context:this}));
this.dom=c.make_field("Suggest a feed url",h,d.div({width:"100"},g));
this.dom1=c.make_field(e(""),this.status=d.div("Thank you! Your suggestion will be reviewed, and added if appropriate."),e(""));
this.status.style.visibility="hidden";
};
Y.mix(IMO.REUI.PIN.ImoAddNewsSourceWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoAddNewsSourceWidget.prototype,{add_source:function(){var g=IMO.S.get_imo_account();
g.send("add_user_news_feed",{uid:g.uid,url:this.input.value},"imo_broadcasts",this.complete,this);
},complete:function(){this.status.style.visibility="visible";
}});
IMO.REUI.PIN.ImoAddSubscriptionWidget=function(){this.button=new IMO.UIWidgets.Button({button_size:"small"},{context:this,onclick:this.add_sublist},{cls:"small_button_inner"},b("Upload"));
this.button.set_enabled(false);
var g=d.cdiv("",this.form=d.form({id:"subscription_form",action:"/s/upload_news_subscription",method:"post",enctype:"multipart/form-data"},this.input=d.input({type:"file",name:"feeds_file",context:this,onchange:function(){this.status.style.visibility="hidden";
this.button.set_enabled(true);
}})));
this.dom0=c.make_field(e(""),e(""),e(""));
c.change_field(this.dom0,e(""),d.cdiv("profile_field_tip","Supported file formats: .opml/.xml (e.g. Google Reader lists)"));
this.dom=c.make_field("Upload a subscription list",g,d.div({width:"100"},this.button.dom));
this.dom1=c.make_field(e(""),this.status=d.div("Thank you! Feeds from your subscription list will be added after review."),e(""));
this.status.style.visibility="hidden";
};
Y.mix(IMO.REUI.PIN.ImoAddSubscriptionWidget.prototype,IMO.EventTarget);
Y.mix(IMO.REUI.PIN.ImoAddSubscriptionWidget.prototype,{add_sublist:function(){if(!this.button.enabled){return;
}var g=IMO.S.get_imo_account();
IMO.HTTPRPC.upload("imo_broadcasts","import_user_feeds_file",{uid:g.uid},this.form);
this.complete();
},complete:function(){this.status.style.visibility="visible";
}});
}());
(function(){var b=IMO.Utils;
var k=b.HTML;
var l=IMO.Utils.TranslateDom;
if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var j=IMO.REUI.PIN.FORM;
var h="Verify your phone number. This will help us keep your account secure.";
var f="Phone number verified.";
var i="Phone number deleted.";
var d="This phone number doesn't seem to be properly formated";
var g="This phone number was already used by for verification purposes by another user. If you believe this is an error please send us feedback.";
var e="Unknown error has occured.";
var a="The code you have entered is not correct. Please try again.";
var c="An SMS message with verification code was sent to your phone. Please enter this verification code below to complete the process.";
IMO.REUI.PIN.PhoneVerifyWidget=function(){IMO.REUI.PIN.PhoneVerifyWidget.superclass.constructor.call(this);
};
Y.extend(IMO.REUI.PIN.PhoneVerifyWidget,IMO.REUI.PIN.GenericFormPopup);
Y.mix(IMO.REUI.PIN.PhoneVerifyWidget.prototype,{is_valid:function(){return true;
},on_verify_phone:function(m){IMO.MouseManager.get().handled(m,"pin-verify-phone");
if(!this.footer_widget.main_button.enabled){return;
}this.do_verify_phone();
},on_verify_code:function(m){IMO.MouseManager.get().handled(m,"pin-verify-code");
this.do_verify_code();
},do_verify_phone:function(){if(this.pending_request){return;
}this.set_pending_request(true);
var m=IMO.Session.get().get_imo_account();
IMO.Network.get().send("imo_account","verify_phone",{uid:m.uid,phone:this.phone_number.value()},true,this.verify_phone_reply,this);
},verify_phone_reply:function(m){this.set_pending_request(false);
if(m.status==="error"){if(m.error==="wrong_format"){this.stat_widget.set_error(d);
}else{if(m.error=="already_used"){this.stat_widget.set_error(g);
}else{this.stat_widget.set_error(e);
}}return;
}if(m.status==="ok"){this.stat_widget.set_status(c);
this._show_verify_code_field();
}},_show_verify_code_field:function(){this.phone_number.set_disabled(true);
k.visible(this.verification_code.dom);
this.footer_widget=this.button_set2;
k.replace_content(this.footer_dom,this.footer_widget.dom);
k.replace_content(this.phone_number.status_dom,this.edit_button.dom,this.delete_button.dom);
this.set_border_size();
},_reset_form:function(){k.invisible(this.verification_code.dom);
this.phone_number.set_disabled(false);
this.phone_number.focus();
this.stat_widget.set_status("");
this.footer_widget=this.button_set1;
k.replace_content(this.footer_dom,this.footer_widget.dom);
k.replace_content(this.phone_number.status_dom,k.cspan("pin_tip_color","(eg. +1 (555) 555 5555)"));
this.footer_widget.main_button.set_enabled(true);
this.set_border_size();
},edit_phone:function(m){IMO.MouseManager.get().handled(m,"pin-edit-phone");
this._reset_form();
},delete_phone:function(n){IMO.MouseManager.get().handled(n,"pin-delete-phone");
var m=IMO.Session.get().get_imo_account();
IMO.Network.get().send("imo_account","unverify_phone",{uid:m.uid},true,function(){this.stat_widget.set_status(i);
},this);
this._reset_form();
this.phone_number.set_value("");
},do_verify_code:function(){if(this.pending_request){return;
}this.set_pending_request(true);
var m=IMO.Session.get().get_imo_account();
IMO.Network.get().send("imo_account","verify_phone_code",{uid:m.uid,phone:this.phone_number.value(),verification_code:this.verification_code.value()},true,this.verify_phone_code_reply,this);
},verify_phone_code_reply:function(m){this.set_pending_request(false);
if(m!==true){this.stat_widget.set_error(a);
this.set_border_size();
return;
}this.close();
},on_cancel:function(m){this.hide();
},build_widgets:function(){var m=IMO.Session.get().get_imo_account();
IMO.Network.get().send("imo_account","get_verified_phone",{uid:m.uid},true,this.get_verified_phone_reply,this);
this.header_dom=k.cdiv("pin_form_header",k.cspan("text",l("Verify Phone Number")));
this.button_set1=new j.FooterWidget("Verify Phone","Cancel",null,this,this.on_verify_phone,this.on_cancel);
this.button_set2=new j.FooterWidget("Check Code","Cancel",null,this,this.on_verify_code,this.on_cancel);
this.edit_button=new IMO.UIWidgets.Button2({button_size:"small"},{context:this,onclick:this.edit_phone},{cls:"small_button_inner"},l("Edit"));
this.delete_button=new IMO.UIWidgets.Button2({button_size:"small"},{context:this,onclick:this.delete_phone},{cls:"small_button_inner"},l("Delete"));
this.footer_widget=this.button_set1;
this.add_event_dispatcher_field("account",IMO.Session.get().get_imo_account());
this.add_normal_field("stat_widget",new j.StatusWidget());
this.add_event_dispatcher_field("phone_number",new j.TextWidget("Phone Number"));
this.phone_number.status_dom.appendChild(k.cspan("pin_tip_color","(eg. +1 (555) 555 5555)"));
this.add_event_dispatcher_field("verification_code",new j.TextWidget("Verification Code"));
k.invisible(this.verification_code.dom);
this.stat_widget.set_status(h);
this.tbody_dom=k.tbody(this.stat_widget.dom,j.make_delimiter(),this.phone_number.dom,this.verification_code.dom);
},get_verified_phone_reply:function(m){if(m&&m.phone){this.phone_number.set_value(m.phone);
this.phone_number.set_disabled(true);
k.replace_content(this.phone_number.status_dom,this.edit_button.dom,this.delete_button.dom);
if(m.verified){this.stat_widget.set_status(f);
this.footer_widget.main_button.set_enabled(false);
}else{this._show_verify_code_field();
}}},widget_init:function(){Y.later(0,this,function(){this.verification_code.focus();
this.phone_number.focus();
});
}},true);
IMO.REUI.PIN.PhoneVerify=new IMO.REUI.PIN.PhoneVerifyWidget();
}());
(function(){var a=IMO.Utils;
var d=IMO.Utils.sprintf;
var c=IMO.Utils.HTML;
var b=IMO.Utils.TranslateDom;
var f=IMO.Constants;
f.TEXT.VERIFY_EMAIL_NOTIFICATION="Please verify your email address. Verification message was sent to [EMAIL]. ";
f.TEXT.VERIFY_EMAIL_SEND_NOTIFICATION="An email with your verification code was sent.";
if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}var e=function(){this.account=null;
this.contact_notif={};
this.on(IMO.Session.get());
var g=IMO.Session.get().get_imo_account();
if(g){this.on_create_account(g);
}IMO.EventDispatcher.get().subscribe(this,"friends_finder","pin");
return this;
};
Y.mix(e.prototype,IMO.EventTarget);
Y.mix(e.prototype,{on_create_account:function(g){Y.log(["on_create_account",g]);
if(g.account_type==="im"&&g.proto==="imo"){this.account=g;
this.on(g);
}},on_added_as_contact:function(j,i){var g=c.span(i.alias,{cls:"action",onclick:function(){Y.log(["contactof",i]);
var l=d('user:"%s (%s)"',i.username||i.buid,i.alias);
IMO.REUI.PIN.Directory.show(l);
},context:this});
var k=c.div(c.div(g,c(" "),c.span("added you as a contact.")),c.br());
var h=j.get_buddy(i.buid,false);
Y.log(["buddy",h]);
if(!h||h.nonbuddy){k.appendChild(c.span(b("Add to Contacts"),{cls:"action",onclick:function(){this.add_contact(j,i);
},context:this}));
}this.contact_notif[i.buid]=IMO.NM.add_notification(k,IMO.REUI.Notification.types.info,{momentary:true,on_time:10000});
},add_contact:function(h,g){h.add_buddy(g.buid,IMO.SharedConstants.BuddyGroups.IMO_CONTACTS);
IMO.NM.remove_notification(this.contact_notif[g.buid]);
},on_imo_account_not_verified:function(g){IMO.REUI.APP.MeetUtils.show_activation_required(g.uid);
},on_name_change_required:function(){IMO.REUI.APP.MeetUtils.show_name_change_required();
},on_adding_first_buddy:function(h,g,i){IMO.REUI.APP.MeetUtils.show_adding_first_buddy(h,g,i);
},on_unverified_email:function(h){if(this.unverified_email_notification){return;
}var g=c.div(b(f.TEXT.VERIFY_EMAIL_NOTIFICATION,{EMAIL:h.email}),c.cspan("text_button",b("Resend verification."),{context:this,onclick:function(){h.resend_verification_code();
IMO.NM.add_notification(b(f.TEXT.VERIFY_EMAIL_SEND_NOTIFICATION),IMO.REUI.Notification.types.info);
}}));
this.unverified_email_notification=IMO.NM.add_notification(g,IMO.REUI.Notification.types.info,{momentary:true,on_time:10*f.TIME.SECONDS});
},on_verified_email:function(g){if(this.unverified_email_notification){IMO.NM.remove_notification(this.unverified_email_notification);
delete this.unverified_email_notification;
}},show_suggest_link:function(){var h=c.span(b("Link your accounts now!"),{cls:"action",context:this,onclick:function(){IMO.Session.get().link_accounts();
}});
var g=c.div(h,c.br(),b("Linking accounts saves you time. It allows you to automatically sign into all of your accounts when you sign into any one of them."));
IMO.NM.add_notification(g,IMO.REUI.Notification.types.info,{momentary:true,on_time:30000});
},notification:function(h){var g=h.edata;
Y.log(["pin notification",g]);
if(g.notification_type==="friend_suggestion"){this.friend_suggestion_notification(g);
}},friend_suggestion_notification:function(m){var l=m.buid;
var k={};
var g=function(p){p.preventDefault();
IMO.NM.remove_notification(k.id);
var o=d('user:"%s (%s)"',m.username||m.buid,m.display_name);
IMO.REUI.PIN.Directory.show(o);
};
var h=new IMO.UIWidgets.Button2("Add contact",{onclick:function(p){IMO.NM.remove_notification(k.id);
var o=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!o){return;
}o.add_buddy(m.buid,IMO.SharedConstants.BuddyGroups.IMO_CONTACTS);
},context:this,style:"small"});
var i=new IMO.UIWidgets.Button2("Chat",{onclick:function(o){IMO.NM.remove_notification(k.id);
IMO.REUI.APP.MeetUtils.start_chat(l);
},context:this,style:"small"});
var j=f.DEFAULT_BICON;
if(m.profile_photo_id){j="/b/"+a.imo_icon(m.profile_photo_id);
}var n=c.cdiv("pin-notif-friend-suggest",c.cdiv("top",c.img({src:j,align:"left"}),c.a(m.display_name,{href:"#",onclick:g}),c.br(),c.span(b("just joined imo!"))),i.dom,h.dom);
k.id=IMO.NM.add_notification(n,IMO.REUI.Notification.types.info,{momentary:false});
}});
IMO.REUI.PIN.NotificationInit=function(){IMO.REUI.PIN.Notification=new e();
};
}());
(function(){var b=IMO.Utils;
var e=b.HTML;
var g=IMO.Constants;
var c=IMO.Utils.TranslateDom;
var f=IMO.Utils.TranslateTxt;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var d=IMO.REUI.PIN.FORM;
var a="We require everyone to use their real name so you know whom you are chatting with. You can request two name changes every two years. You will receive an email once your name change has been approved, or if further action is required. ";
IMO.REUI.PIN.RequestNameChangePopup=function(){IMO.REUI.PIN.RequestNameChangePopup.superclass.constructor.call(this);
};
Y.extend(IMO.REUI.PIN.RequestNameChangePopup,IMO.REUI.PIN.GenericFormPopup);
Y.mix(IMO.REUI.PIN.RequestNameChangePopup.prototype,{init_and_show:function(j,i,h){this.add_normal_field("profile",j);
this.add_normal_field("first_name",i);
this.add_normal_field("last_name",h);
this.show();
},update_status:function(){var h=this.is_valid();
if(h){this.stat_widget.set_status(f("You can now request a name change"));
}else{var i;
if(!this.first_name_widget.is_valid()){this.stat_widget.set_error(f("First name is not valid"));
}else{if(!this.last_name_widget.is_valid()){this.stat_widget.set_error(f("Last name is not valid"));
}else{this.stat_widget.set_status(f("You can now change your name and request a name change"));
}}}this.footer_widget.main_button.set_enabled(h);
},is_valid:function(){return !this.pending_request&&this.first_name_widget.is_valid()&&this.last_name_widget.is_valid()&&(this.first_name_widget.value().trim()!==this.first_name.trim()||this.last_name_widget.value().trim()!==this.last_name.trim());
},on_change:function(h){if(h===this.first_name_widget||h===this.last_name_widget){this.update_status();
}},on_enter_key:function(h){this.do_request_name_change();
},on_tab_key:function(h){if(h===this.first_name_widget){this.last_name_widget.focus();
}else{if(h===this.last_name_widget){this.first_name_widget.focus();
}}},on_request_name_change:function(h){IMO.MouseManager.get().handled(h,"pin-request-name-change");
this.do_request_name_change();
},do_request_name_change:function(){if(!this.try_to_start_request()){return;
}this.stat_widget.set_status("Request pending ...");
var i=this.first_name_widget.value();
var h=this.last_name_widget.value();
this.profile.profile_uid_call("name_change_request",{new_first_name:i,new_last_name:h},this,this.request_name_change_reply);
},request_name_change_reply:function(i){if(!this.try_to_handle_reply()){return;
}if(i.result==="first_name"){this.stat_widget.set_error(f("First name is not valid"));
return;
}else{if(i.result==="last_name"){this.stat_widget.set_error(f("Last name is not valid"));
return;
}else{if(i.result==="too_many_requests"){this.stat_widget.set_error(f("You have exceeded the maximum number of Name Changes."));
return;
}}}var h=(i.result==="ok");
if(h){this.stat_widget.set_status("Request sent");
this.close();
IMO.NM.add_notifiction("A name change request has been sent. You will receive an email when it is approved or rejected");
return;
}this.stat_widget.set_error("Server error. Please try again later");
this.footer_widget.main_button.set_enabled(this.is_valid());
},on_cancel:function(h){this.hide();
},build_widgets:function(){this.add_normal_field("account",IMO.Session.get().get_imo_account());
this.add_normal_field("profile",this.account.profile);
this.add_normal_field("first_name","");
this.add_normal_field("last_name","");
this.profile.profile_uid_call("get_profile",{},this,function(i){if(!i.error){var h=i.result;
this.first_name=h.first_name;
this.last_name=h.last_name;
if(this.first_name_widget.value()===""){this.first_name_widget.set_value(this.first_name,true);
}if(this.last_name_widget.value()===""){this.last_name_widget.set_value(this.last_name,true);
}}});
Y.log("running init");
this.add_normal_field("header_dom",e.cdiv("pin_form_header",e.cspan("text",c("Request name change"))));
this.add_normal_field("footer_widget",new d.FooterWidget("Request name change","Cancel",null,this,this.on_request_name_change,this.on_cancel));
this.add_normal_field("account",IMO.Session.get().get_imo_account());
this.add_normal_field("profile",this.account.profile);
this.add_normal_field("legal_widget",new d.StatusWidget());
this.add_normal_field("stat_widget",new d.StatusWidget());
this.add_event_dispatcher_field("first_name_widget",new d.NameWidget("First name"));
this.add_event_dispatcher_field("last_name_widget",new d.NameWidget("Last name"));
this.legal_widget.set_status_dom(e.div(c(a),e.a(c("Learn More"),{context:this,onclick:function(h){IMO.MouseManager.get().handled("mnp-name-change-policy");
IMO.REUI.PIN.NameChangePolicyPopup.show();
}})));
this.first_name_widget.set_value(this.first_name);
this.last_name_widget.set_value(this.last_name);
this.update_status();
this.tbody_dom=e.tbody(this.legal_widget.dom,d.make_delimiter(),this.stat_widget.dom,d.make_delimiter(),this.first_name_widget.dom,this.last_name_widget.dom);
this.widget_init();
},widget_init:function(){Y.later(0,this,function(){if(this.first_name_widget){this.first_name_widget.focus();
}});
}},true);
IMO.REUI.PIN.NameChangePopup=new IMO.REUI.PIN.RequestNameChangePopup();
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var g=IMO.Constants;
var b=IMO.Utils.TranslateDom;
var e=IMO.Utils.TranslateTxt;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var c=IMO.REUI.PIN.FORM;
var f="Enter the email address for your imo account";
IMO.REUI.PIN.RequestPasswordResetWidgetPopup=function(){IMO.REUI.PIN.RequestPasswordResetWidgetPopup.superclass.constructor.call(this);
};
Y.extend(IMO.REUI.PIN.RequestPasswordResetWidgetPopup,IMO.REUI.PIN.GenericFormPopup);
Y.mix(IMO.REUI.PIN.RequestPasswordResetWidgetPopup.prototype,{is_valid:function(){return !this.pending_request&&this.email_widget.is_valid();
},on_change:function(h){if(h!==this.email_widget){return;
}this.stat_widget.set_status(f);
},on_enter_key:function(h){if(h!==this.email_widget){return;
}this.do_request_password_reset();
},on_request_password_reset:function(h){IMO.MouseManager.get().handled(h,"pin-request-password-reset");
this.do_request_password_reset();
},do_request_password_reset:function(){if(!this.try_to_start_request()){return;
}this.stat_widget.set_status("Request pending ...");
var h=this.email_widget.value();
IMO.EventDispatcher.get().subscribe(this,"imo_account","imo_account_request_password_reset_reply",h);
IMO.Network.get().send("imo_account","request_password_reset",{email:h});
},request_password_reset_reply:function(i){if(!this.try_to_handle_reply()){return;
}var h=i.email;
IMO.EventDispatcher.get().unsubscribe(this,"imo_account","imo_account_request_password_reset_reply",h);
var j=i.edata;
if(j.status==="error"){var k;
if(j.reason=="internal_error"){k="An internal server error occured. Please try again later.";
}else{k="Unknown error";
}this.stat_widget.set_status("Server error");
this.close();
IMO.NM.add_notification(k,IMO.REUI.Notification.types.error,{momentary:false});
}else{if(j.status==="ok"){this.stat_widget.set_status("Request sent");
this.close();
IMO.NM.add_notification("If an account was registered using "+h+", an e-mail with password reset instructions will be sent out shortly",IMO.REUI.Notification.types.info,{momentary:false});
}else{this.stat_widget.set_error("Unknown server response");
}}},on_cancel:function(h){this.hide();
},build_widgets:function(){this.header_dom=d.cdiv("pin_form_header",d.cspan("text",b("Request password reset")));
this.footer_widget=new c.FooterWidget("Request password reset","Cancel",null,this,this.on_request_password_reset,this.on_cancel);
this.add_normal_field("stat_widget",new c.StatusWidget());
this.add_event_dispatcher_field("email_widget",new c.EmailWidget());
this.stat_widget.set_status(f);
this.tbody_dom=d.tbody(this.stat_widget.dom,c.make_delimiter(),this.email_widget.dom);
},widget_init:function(){Y.later(0,this,function(){this.email_widget.focus();
});
}},true);
IMO.REUI.PIN.ForgotPasswordPopup=new IMO.REUI.PIN.RequestPasswordResetWidgetPopup();
}());
(function(){var a=IMO.Utils;
var d=a.HTML;
var b=IMO.Utils.TranslateDom;
if(!IMO.REUI){IMO.REUI={};
}if(!IMO.REUI.PIN){IMO.REUI.PIN={};
}if(!IMO.REUI.PIN.FORM){IMO.REUI.PIN.FORM={};
}var c=IMO.REUI.PIN.FORM;
var e={DEFAULT:"Enter the new password",INVALID_TOKEN:"The token was invalid, expired or had already been used",INTERNAL_ERROR:"An internal server error occured. Please try again later",INVALID_NEW_PASSWORD:"The new password is invalid",OK:"Password changed"};
IMO.REUI.PIN.ResetPasswordWidgetPopup=function(){IMO.REUI.PIN.ResetPasswordWidgetPopup.superclass.constructor.call(this);
};
Y.extend(IMO.REUI.PIN.ResetPasswordWidgetPopup,IMO.REUI.PIN.GenericFormPopup);
Y.mix(IMO.REUI.PIN.ResetPasswordWidgetPopup.prototype,{init_and_show:function(f){this.add_normal_field("reset_token",f);
this.show();
},is_valid:function(){return !this.pending_request&&this.password_widget.is_valid();
},on_change:function(f){if(f!==this.password_widget){return;
}this.stat_widget.set_status(e.DEFAULT);
},on_enter_key:function(f){if(f!==this.password_widget){return;
}this.do_reset_password();
},on_reset_password:function(f){IMO.MouseManager.get().handled(f,"pin-reset-password");
this.do_reset_password();
},on_goto_imo:function(){a.goto_main_imo_page();
},do_reset_password:function(){if(!this.try_to_start_request()){return;
}this.stat_widget.set_status("Request pending ...");
this.password_widget.input.disabled=true;
IMO.EventDispatcher.get().subscribe(this,"imo_account","imo_account_reset_password_reply");
IMO.Network.get().send("imo_account","reset_password",{token:this.reset_token,new_passwd:this.password_widget.value()});
},reset_password_reply:function(g){Y.log(g);
if(!this.try_to_handle_reply()){return;
}IMO.EventDispatcher.get().unsubscribe(this,"imo_account","imo_account_reset_password_reply");
var h=g.edata;
var j="Unknown server response";
var i=false;
var f=false;
if(h.status==="error"){i=false;
f=h.retry_now;
if(h.reason==="invalid_token"){j=e.INVALID_TOKEN;
}else{if(h.reason==="invalid_new_password"){j=e.INVALID_NEW_PASSWORD;
}else{j=e.INTERNAL_ERROR;
Y.log(["Failed to reset password",h.reason,h],"error");
}}}else{if(h.status==="ok"){i=true;
f=false;
j=e.OK;
}}if(i){this.stat_widget.set_status(j);
}else{this.stat_widget.set_error(j);
}if(!f){this.footer_widget=new c.FooterWidget("Go to the main IMO page",null,null,this,this.on_goto_imo);
}else{this.password_widget.input.disabled=false;
}d.replace_content(this.footer_dom,this.footer_widget.dom);
},build_widgets:function(){this.header_dom=d.cdiv("pin_form_header",d.cspan("text",b("Reset password")));
this.footer_widget=new c.FooterWidget("Reset password","Go to the main IMO page",null,this,this.on_reset_password,this.on_goto_imo);
this.add_normal_field("stat_widget",new c.StatusWidget());
this.add_event_dispatcher_field("password_widget",new c.PasswordWidget("New password"));
this.stat_widget.set_status(e.DEFAULT);
this.tbody_dom=d.tbody(this.stat_widget.dom,c.make_delimiter(),this.password_widget.dom);
},widget_init:function(){Y.later(0,this,function(){this.password_widget.focus();
});
}},true);
IMO.REUI.PIN.ResetPasswordPopup=new IMO.REUI.PIN.ResetPasswordWidgetPopup();
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.Utils.TranslateDom;
if(!IMO.REUI.Signup){IMO.REUI.Signup={};
}var e=IMO.REUI.Signup;
e.WIDGETS={FORM:"form",LINK:"link",CAPTCHA:"captcha",SMS:"sms",UNDER13:"under13"};
e.TABINDEX={FIRST_FIELD:1,BD_MONTH:10,BD_YEAR:11,SIGN_UP:15,HUMAN:15,CLOSE:20,TOS:30,PRIVACY1:31,PRIVACY2:40,BD_DESC:41,ABOUT_US:90,HELP:91};
e.BaseWidget=function(){};
Y.mix(e.BaseWidget.prototype,{get_signup_data:function(){return{};
},show:function(g){Y.log(["show",this]);
},hide:function(){Y.log(["hide",this]);
},_build_form_row:function(h,g){return c.tr(c.td({cls:"label"},b(h.label)),c.td({cls:"input"},this.input_fields[g]=c.input({id:h.input,type:(h.type==="password")?"password":"text",onkeydown:function(i){var j=i.target.getAttribute("id");
this._clean_error(j);
},context:this,tabindex:e.TABINDEX.FIRST_FIELD+parseInt(g,10)})),c.td({cls:"more"},c.div({cls:"desc",id:h.input+"_desc"},h.desc),c.div({cls:"error",id:h.input+"_error"})));
},_clean_error:function(g){c.remove_class(c.dom(g),"wrong");
c.hide(c.dom(g+"_error"));
c.show(c.dom(g+"_desc"));
},_show_error:function(i,g){if(i){c.add_class(c.dom(i),"wrong");
c.hide(c.dom(i+"_desc"));
var h=c.dom(i+"_error");
c.replace_content(h,g);
c.show(h,"block");
}else{c.show(this.general_error);
c.replace_content(this.general_error,g);
}}});
e.Under13Widget=function(g){this.controller=g;
this.dom=this.build_dom();
};
Y.extend(e.Under13Widget,e.BaseWidget);
Y.mix(e.Under13Widget.prototype,IMO.EventTarget);
Y.mix(e.Under13Widget.prototype,{build_dom:function(){return c.idiv("signup-birthday-error",b("Sorry, we are not able to process your registration."));
}},true);
var f=function(){this.current_widget=null;
this.widgets={};
this.widgets[e.WIDGETS.LINK]=new e.LinkWidget(this);
this.widgets[e.WIDGETS.FORM]=new e.FormWidget(this);
this.widgets[e.WIDGETS.CAPTCHA]=new e.CaptchaWidget(this);
this.widgets[e.WIDGETS.SMS]=new e.SMSWidget(this);
this.widgets[e.WIDGETS.UNDER13]=new e.Under13Widget(this);
this.build_dom();
IMO.EventDispatcher.get().subscribe(this,"imo_account","imo_account");
};
Y.mix(f.prototype,IMO.EventTarget);
Y.mix(f.prototype,{on_create_account:function(g){if(g.account_type==="im"&&g.proto==="imo"){if(g.uid===this.uid){if(IMO.U.query.hasOwnProperty("signup")){a.refresh_page(true);
}else{IMO.REUI.PIN.show_wizard=true;
this.hide();
}}else{IMO.NM.add_notification(b("You are already signed in with an imo account. Please Sign Out All first."),IMO.REUI.Notification.types.error,{momentary:false});
this.hide();
}}},show:function(g,h){this.can_close=g;
this.widgets[e.WIDGETS.FORM].prefil_email(h);
if(g){c.show(this.cancel_dom);
}else{c.hide(this.cancel_dom);
}this.shortcuts=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.cancel}},bottom:true,context:this});
this.begin_signup();
this.on(IMO.Session.get());
},hide:function(){this.unsubscribe(IMO.Session.get());
if(this.current_widget){this.current_widget.hide();
}this.widgets[e.WIDGETS.FORM].clear_form();
IMO.KeyboardManager.get().pop(this.shortcuts);
delete this.shortcuts;
document.location.hash="";
c.remove(this.dom);
IMO.U.show_main_ui();
},sign_up:function(){Y.log("sending signup message");
var g={};
a.foreach(this.widgets,function(h){Y.mix(g,h.get_signup_data());
});
g.invite_id=this.invite_id;
Y.log(["signup_data",g]);
IMO.Network.get().send("imo_account","sign_up",g);
},set_invite_id:function(g){if(!g){g=IMO.pin_invite_id;
}this.invite_id=g;
},sign_up_result:function(h){var g=h.edata;
Y.log(["result for signup: ",h]);
this.do_sign_up_result(h.edata.result,h.edata.reason,g.uid);
},do_sign_up_result:function(g,i,h){if(g==="error"){if(a.array_find(["email","invite_id","birthday","tooyoung","passwd","first_name","last_name"],i)!==-1){this.show_widget(e.WIDGETS.FORM);
this.current_widget.signup_result(g,i);
}else{if(i==="social_links"){this.show_widget(e.WIDGETS.LINK);
this.current_widget.signup_result(g,i);
}else{if(i==="unverified_phone"){this.show_widget(e.WIDGETS.SMS);
this.current_widget.signup_result(g,i);
}}}this.widgets[e.WIDGETS.CAPTCHA].clear();
}else{if(g==="show_captcha"){this.show_widget(e.WIDGETS.CAPTCHA);
this.current_widget.signup_result(g,i);
}else{if(g==="ok"){this.widgets[e.WIDGETS.CAPTCHA].clear();
this.uid=h;
this.show_spinner();
IMO.Stats.report_user_flow("page_register_ok");
}else{throw"unsupported signup result"+g;
}}}},show_spinner:function(){c.hide(this.signup_main);
c.show(this.spinner);
},show_widget:function(i,h){Y.log(["showing widget",i,h]);
var g=this.widgets[i];
if(this.current_widget===g){Y.log("already shown");
return;
}if(this.current_widget){this.current_widget.hide();
}c.replace_content(this.widget_container,g.dom);
this.current_widget=g;
g.show(h);
},begin_signup:function(){c.show(this.signup_main);
this.show_widget(e.WIDGETS.LINK);
c.hide(this.spinner);
},cancel:function(){if(!this.can_close){return;
}if(IMO.Session.get().get_accounts().length===0){a.refresh_page(true);
}else{this.hide();
}},build_dom:function(){var g=c.cdiv("signup_text_left",c.div("Chat easily with family, friends, acquaintances and colleagues by finding them in the imo network directory"),c.div("Make new friends and grow your professional network using the imo network's Broadcasts feature"));
this.cancel_dom=c.a("Go Back",{cls:"signup-cancel old-style-link",onclick:this.cancel,context:this,tabindex:e.TABINDEX.CLOSE});
var h=c.cdiv("signup-footer",this.cancel_dom);
this.signup_main=c.cdiv("signup_main",c.cdiv("signup_top",c.cdiv("signup_bgr sprite_bgr_signup",g,this.widget_container=c.idiv("signup-container"),h)),c.cdiv("signup_footer",c.cdiv("signup_copy_right","\u00A9 2013 imo.im",c.cspan("signup_all_rights","All rights reserved")),c.cdiv("signup_links",c.a({cls:"signup_link old-style-link",href:"/about",target:"_blank",tabindex:e.TABINDEX.ABOUT_US},b("About us")),c.a({cls:"signup_link old-style-link",href:"/imo_network",target:"_blank",tabindex:e.TABINDEX.HELP},b("Help")))));
this.spinner=c.cdiv("signup_spinner",c.img({src:"assets/loading_54.gif"}));
this.dom=c.cdiv("signup",this.signup_main,this.spinner);
}});
var d=null;
e.show=function(g,h){if(d===null){d=new f();
}d.show(g,h);
return d;
};
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
var e=IMO.REUI.Signup;
e.CaptchaWidget=function(f){this.controller=f;
this.signup_data={};
this.dom=this.build_dom();
IMO.Captcha.load();
};
Y.extend(e.CaptchaWidget,e.BaseWidget);
Y.mix(e.CaptchaWidget.prototype,IMO.EventTarget);
Y.mix(e.CaptchaWidget.prototype,{get_signup_data:function(){return this.signup_data;
},clear:function(){IMO.Captcha.hide_captcha("signup_captcha");
this.signup_data.challenge=null;
this.signup_data.response=null;
},send_captcha:function(g){IMO.MouseManager.get().handled(g,"signup-captcha");
var f=IMO.Captcha.get_data();
if(!f.response){this.do_sign_up_result("show_captcha","empty");
return;
}this.signup_data.challenge=f.challenge;
this.signup_data.response=f.response;
this.controller.sign_up();
},signup_result:function(f,g){Y.log(["recaptcha result: ",g]);
switch(g){case"missing":IMO.Captcha.show_captcha("signup_captcha");
break;
case"empty":c.replace_content(this.status_dom,b("Please enter the words shown above first!"));
break;
case"no":IMO.Captcha.show_captcha("signup_captcha");
c.replace_content(this.status_dom,b("Wrong answer, please try again"));
break;
case"error":Y.log("Captcha ERROR");
IMO.Captcha.show_captcha("signup_captcha");
c.replace_content(this.status_dom,b("We were unable to verify your answer. Please try again."));
break;
default:Y.log("Unhandled captcha result case");
break;
}},build_dom:function(){var g=new IMO.UIWidgets.Button2(b("I'm human"),{onclick:this.send_captcha,context:this});
var f=c.cdiv("imo_captcha signup_white_box",c.form({onsubmit:function(h){h.preventDefault();
this.send_captcha(h);
return false;
},context:this},c.div({cls:"captcha",id:"signup_captcha"}),this.status_dom=c.div({id:"signup_captcha_status"}),c.cdiv("captcha-text",b("Please enter the words shown above and click I'm human to complete the sign up process.")),g.dom,c.cdiv("fake_submit_button",c.input({cls:"fake_submit_input",value:d("Login"),type:"submit",tabindex:-1}))));
return f;
}},true);
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.Utils.TranslateDom;
var d=IMO.Utils.TranslateTxt;
if(!IMO.REUI.Signup){IMO.REUI.Signup={};
}var f=IMO.REUI.Signup;
var e=[{label:"First name:",input:"signup_first_name",desc:c.span(b("Your name will appear in your profile. Use your real name, so people you know can recognize you."))},{label:"Last name:",input:"signup_last_name"},{label:"Email:",input:"signup_email",desc:c.span("We value your",c(" "),c.a("privacy",{href:"/policies/privacy_policy.html",target:"_blank",tabindex:f.TABINDEX.PRIVACY2,cls:"old-style-link"}))},{label:"New Password:",input:"signup_password",type:"password",desc:"At least 6 characters"}];
f.FormWidget=function(g){this.controller=g;
this.signup_data={};
this.dom=this.build_dom();
};
Y.extend(f.FormWidget,f.BaseWidget);
Y.mix(f.FormWidget.prototype,IMO.EventTarget);
Y.mix(f.FormWidget.prototype,{show:function(h){if(h){var g=0;
if(h.first_name!="_"&&c.dom("signup_first_name").value.length===0){c.dom("signup_first_name").value=h.first_name;
g=1;
}if(h.last_name!="_"&&c.dom("signup_last_name").value.length===0){c.dom("signup_last_name").value=h.last_name;
if(g===1){g=2;
}}if(h.email){c.dom("signup_email").value=h.email;
}else{if(this.email_prefil){c.dom("signup_email").value=this.email_prefil;
}}Y.later(0,this,function(){this.input_fields[g].focus();
});
}},sign_up:function(l){IMO.MouseManager.get().handled(l,"signup-sign_up");
var j=c.dom("signup_first_name").value;
var g=c.dom("signup_last_name").value;
var i=c.dom("signup_email").value;
var h=c.dom("signup_password").value;
var k=this.get_birthday();
IMO.Stats.report_user_flow("page_register_signup");
if(this.validate(j,g,i,h)){this.signup_data={email:i,passwd:h,first_name:j,last_name:g,birthday:k};
this.controller.sign_up();
}},get_signup_data:function(){return this.signup_data;
},signup_result:function(g,h){Y.log(["Form error",h,g]);
if(h==="email"){Y.log("Email taken");
this._show_error("signup_email",b("This email is already taken"));
}else{if(h==="invite_id"){this.display_invalid_invite();
}else{if(h==="birthday"){this._show_error("signup_birthday",b("Please enter a valid date"));
}else{if(h==="tooyoung"){IMO.Stats.report_user_flow("page_register_u13");
this.controller.show_widget(f.WIDGETS.UNDER13);
}else{if(h==="passwd"){this._show_error("signup_password",b("This password is too short"));
}else{if(h==="first_name"){this._show_error("signup_first_name",b("Please use a real First Name"));
}else{if(h==="last_name"){this._show_error("signup_last_name",b("Please use a real Last Name"));
}}}}}}}},validate:function(k,h,j,i){Y.log("validate");
var l=true;
if(i.length<6){this._show_error("signup_password",b("This password is too short"));
l=false;
}var g=IMO.ImoProfile.name_rule_violation(k);
if(g){this._show_error("signup_first_name",b(g));
l=false;
}var m=IMO.ImoProfile.name_rule_violation(h);
if(m){this._show_error("signup_last_name",b(m));
l=false;
}if(!a.verify_email(j)){this._show_error("signup_email",b("Please provide your Email"));
l=false;
}if(!this.verify_birthday()){this._show_error("signup_birthday",b("Please enter a valid date"));
l=false;
}Y.log(["valid:",l]);
return l;
},build_selects:function(){var g=[d("January"),d("February"),d("March"),d("April"),d("May"),d("June"),d("July"),d("August"),d("September"),d("October"),d("November"),d("December")];
var j;
this.month_select.appendChild(c.option(b("Month:")));
for(j=1;
j<=12;
j++){var h=d(g[j-1]);
this.month_select.appendChild(c.option({value:j},h));
}this.year_select.appendChild(c.option(b("Year:")));
var k=new Date();
this.full_year=k.getFullYear();
for(j=this.full_year;
j>=this.full_year-120;
j--){this.year_select.appendChild(c.option({value:j},j+""));
}},get_birthday:function(){var i=this.month_select.options[this.month_select.selectedIndex].value;
var h=this.year_select.options[this.year_select.selectedIndex].value;
var g=h+"-"+i;
return g;
},verify_birthday:function(){var j=this.month_select.options[this.month_select.selectedIndex].value-1;
var i=this.year_select.options[this.year_select.selectedIndex].value;
if(!(j>=0&&j<=11&&i>=this.full_year-120&&i<=this.full_year)){return false;
}var h=new Date();
var g=new Date(i,j,1);
if(h<g){return false;
}return true;
},prefil_email:function(g){if(g){this.email_prefil=g;
}},clear_form:function(){this.signup_data=null;
for(var g in e){this.input_fields[g].value="";
}c.hide(this.general_error);
},build_dom:function(){var k=c.form({cls:"signup_imo_form signup_white_box",onsubmit:function(i){i.preventDefault();
this.sign_up(i);
return false;
},context:this},c.cdiv("signup-widget-header",b("All fields are required")));
this.input_fields=[];
var j=c.table();
for(var h in e){j.appendChild(this._build_form_row(e[h],h));
}var g=function(){this._clean_error("signup_birthday");
};
j.appendChild(c.tr(c.td({cls:"label"},d("Birthdate")),c.td({cls:"input birthdate"},this.month_select=c.select({id:"birthday_select_month",context:this,onchange:g,tabindex:f.TABINDEX.BD_MONTH}),this.year_select=c.select({id:"birthday_select_year",context:this,onchange:g,tabindex:f.TABINDEX.BD_YEAR})),c.td({cls:"more"},c.div({cls:"desc",id:"signup_birthday_desc"},c.span(c.a("why do I need to provide my birthday?",{href:"/policies/privacy_policy.html",target:"_blank",tabindex:f.TABINDEX.BD_DESC,cls:"old-style-link"}))),c.div({cls:"error",id:"signup_birthday_error"}))));
k.appendChild(j);
this.build_selects();
this.general_error=c.cdiv("general_error");
k.appendChild(this.general_error);
k.appendChild(c.cdiv("terms",b("By clicking Sign Up, you agree to the")," ",c.a(b("Terms of Service"),{href:"/policies/terms_of_service.html",target:"_blank",cls:"old-style-link",tabindex:f.TABINDEX.TOS})," ",c.span(b("and"))," ",c.a(b("Privacy Policy"),{href:"/policies/privacy_policy.html",target:"_blank",cls:"old-style-link",tabindex:f.TABINDEX.PRIVACY1}),"."));
k.appendChild(c.cdiv("fake_submit_button",c.input({cls:"fake_submit_input",value:d("Login"),type:"submit",tabindex:-1})));
this.sign_up_btn=new IMO.UIWidgets.Button2(b("Sign up"),{onclick:this.sign_up,context:this},{tabindex:f.TABINDEX.SIGN_UP});
var l=c.cdiv("signup-form-footer",c.cdiv("signup-form-button",this.sign_up_btn.dom));
k.appendChild(l);
return k;
}},true);
}());
(function(){var c=IMO.Utils;
var e=c.HTML;
var d=IMO.Utils.TranslateDom;
var f=IMO.REUI.Signup;
var b="sms";
var a="We require you to provide your Google, Facebook, Twitter or LinkedIn account or verify your phone number to help reduce spam. A link to your social profile, or your country of origin (if you use a phone number) will be viewable in your public profile. You can unlink this information from your profile any time after registration.";
f.LinkWidget=function(g){this.controller=g;
this.pictures={};
this.pictures[IMO.OAuth.GOOGLE2]="google2_use";
this.pictures[IMO.OAuth.FACEBOOK]="facebook_use";
this.pictures[IMO.OAuth.TWITTER]="twitter_use";
this.pictures[IMO.OAuth.LINKEDIN]="linkedin_use";
this.pictures[b]="sms_use";
this.social_names={};
this.social_names[IMO.OAuth.GOOGLE2]="google2";
this.social_names[IMO.OAuth.FACEBOOK]="facebook";
this.social_names[IMO.OAuth.TWITTER]="twitter";
this.social_names[IMO.OAuth.LINKEDIN]="LinkedIn";
this.social_names[b]="SMS";
this.all_websites=[IMO.OAuth.GOOGLE2,IMO.OAuth.FACEBOOK,IMO.OAuth.TWITTER,IMO.OAuth.LINKEDIN,b];
Y.log(["all_websites",this.all_websites]);
this.social_profile_data={};
this.build_dom();
IMO.EventDispatcher.get().subscribe(this,"imo_account","imo_account");
};
Y.extend(f.LinkWidget,f.BaseWidget);
Y.mix(f.LinkWidget.prototype,IMO.EventTarget);
Y.mix(f.LinkWidget.prototype,{get_signup_data:function(){return{social_profile_data:this.social_profile_data};
},link_clicked:function(g){e.empty(this.linked_accounts_error);
IMO.Stats.report_user_flow("page_register_social",{website:g});
if(g===b){this.controller.show_widget(f.WIDGETS.SMS);
return;
}IMO.OAuth.get().pin_signup(g);
},signup_result:function(g,h){if(g==="error"&&h==="social_links"){this.oauth_failed();
}else{Y.log(["uknow reason",g,h],"error");
}},oauth_data_fetched:function(h){var g=h.edata;
this.social_profile_data[g.website]=g.profile_data;
this.controller.show_widget(f.WIDGETS.FORM,g);
},oauth_failed:function(g){if(g&&g.edata&&g.edata.signing_in){Y.log([g]);
this.controller.hide();
return;
}e.replace_content(this.linked_accounts_error,d("We could not link your account. Your account may already be associated with another imo network account."));
},show:function(){IMO.OAuth.get().init();
this.on(IMO.OAuth.get());
},hide:function(){this.unsubscribe(IMO.OAuth.get());
},build_dom:function(){var g=e.cdiv("linked-buttons");
c.foreach(this.all_websites,function(i){g.appendChild(this._make_button(i));
},this);
var h=e.cdiv("social-linked-accounts signup_white_box",e.cdiv("linked-accounts-text",d(a)),g,this.linked_accounts_error=e.cdiv("linked-accounts-error"));
this.dom=h;
return h;
},_make_button:function(g){return e.cdiv("social_link",e.sprite(this.pictures[g],{cls:"button"}),{context:this,title:g,onclick:function(h){IMO.MouseManager.get().handled("signup_link_clicked");
this.link_clicked(g);
}});
}},true);
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.Utils.TranslateDom;
var e=IMO.REUI.Signup;
var d=[{label:"Phone Number:",input:"signup_phone_number",desc:c.span(b("We will send verification code via SMS."))},{label:"Verification Code:",input:"signup_phone_code",desc:c.span(b("The 6 digit code you received."))}];
e.SMSWidget=function(f){this.controller=f;
this.signup_data={};
this.dom=this.build_dom();
};
Y.extend(e.SMSWidget,e.BaseWidget);
Y.mix(e.SMSWidget.prototype,IMO.EventTarget);
Y.mix(e.SMSWidget.prototype,{show:function(){c.focus(c.dom("signup_phone_number"));
},get_signup_data:function(){return this.signup_data;
},verify_phone:function(g){IMO.MouseManager.get().handled(g,"signup-verify-phone");
var f=c.dom("signup_phone_number").value;
Y.log(["verify_phone",f]);
IMO.Network.get().send("imo_account","verify_phone",{phone:f},true,this.verify_phone_result,this);
},verify_phone_result:function(f){Y.log(["verify_phone_result",f]);
if(f.status==="error"){this._handle_error(f.error);
return;
}if(f.status==="ok"){c.show(this.row_doms[1]);
c.show(this.button2.dom);
c.hide(this.button1.dom);
c.dom("signup_phone_number").disabled=true;
c.focus(c.dom("signup_phone_code"));
}},check_phone_code:function(h){IMO.MouseManager.get().handled(h,"signup-check-verify-phone");
var f=c.dom("signup_phone_number").value;
var g=c.dom("signup_phone_code").value;
Y.log(["check_phone_code",f,g]);
this.signup_data={phone:f,verification_code:g};
IMO.Network.get().send("imo_account","check_phone_code",this.signup_data,true,this.check_phone_code_result,this);
},check_phone_code_result:function(f){Y.log(["check_phone_code_result",f]);
if(!f){this._show_error("signup_phone_code",b("Wrong verification code. Please try again."));
}else{this.controller.show_widget(e.WIDGETS.FORM);
}},signup_result:function(f,g){if(g==="unverified_phone"){c.hide(this.row_doms[1]);
c.hide(this.button2.dom);
c.show(this.button1.dom);
c.dom("signup_phone_number").disabled=false;
c.dom("signup_phone_number").value="";
c.dom("signup_phone_code").value="";
}else{Y.log(["unknown error reason",f,g],"error");
}},build_dom:function(){this.input_fields=[];
var h=c.form({cls:"signup_imo_form signup_white_box signup-widget-sms",onsubmit:function(i){i.preventDefault();
this.verify_phone(i);
return false;
},context:this},c.cdiv("signup-widget-header",b("We require a phone number to reduce the amount of spam in the system and protect your account. We will not share your phone number with other users.")));
var g=c.table();
this.row_doms=[];
for(var f in d){var j=this._build_form_row(d[f],f);
g.appendChild(j);
this.row_doms.push(j);
}h.appendChild(g);
this.button1=new IMO.UIWidgets.Button2(b("Send Verification SMS"),{onclick:this.verify_phone,context:this},{tabindex:e.TABINDEX.SIGN_UP,cls:"signup-form-button"});
this.button2=new IMO.UIWidgets.Button2(b("Verify Code"),{onclick:this.check_phone_code,context:this},{tabindex:e.TABINDEX.SIGN_UP,cls:"signup-form-button signup-sms-button"});
c.hide(this.button2.dom);
c.hide(this.row_doms[1]);
h.appendChild(c.cdiv("signup-form-footer",this.button1.dom));
h.appendChild(c.cdiv("signup-form-footer",this.button2.dom));
return h;
},_handle_error:function(f){if(f==="wrong_format"){this._show_error("signup_phone_number",b("Wrong phone format."));
}else{if(f==="already_used"){this._show_error("signup_phone_number",b("Number already used."));
}else{if(f==="sms_send_failed"){this._show_error("signup_phone_number",b("We are unable to send SMS to this number."));
}}}}},true);
}());
(function(){if(!IMO.REUI.APP){IMO.REUI.APP={};
}}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.AggregateLogger;
if(!IMO.REUI.APP){IMO.REUI.APP={};
}IMO.REUI.APP.MNPTooltip=function(){IMO.REUI.APP.MNPTooltip.superclass.constructor.call(this,{direction:IMO.REUI.ReTooltip.RIGHT,max_overflow:30,sprite:"profile_popover_arrow_left",sprite_overlap:15});
this.tooltip_open_time=0;
this.current_result=null;
};
Y.extend(IMO.REUI.APP.MNPTooltip,IMO.REUI.ReTooltip);
Y.mix(IMO.REUI.APP.MNPTooltip.prototype,{update:function(e){this.current_result=e;
if(this._person_widget){this._person_widget.destroy();
}this._person_widget=IMO.REUI.APP.MeetUtils.create_person_widget(e.user,this,e.broadcast);
c.add_class(this._person_widget.dom,"meet-app");
this.content=c.cdiv("app_meet_person_hover",this._person_widget.dom);
},show:function(f,e){IMO.REUI.APP.MNPTooltip.superclass.show.call(this,f,e);
this.tooltip_open_time=new Date().getTime()/1000;
},hide:function(){IMO.REUI.APP.MNPTooltip.superclass.hide.call(this);
var e=new Date().getTime()/1000-this.tooltip_open_time;
if(e>0.7){IMO.REUI.MNP_PANEL.result_hovered(this.current_result.id,e);
if(this.current_result.is_broadcast()){b.log_event("broadcast.hover",{time:e,id:this.current_result.data.broadcast.id,uid:this.current_result.user.uid});
}else{b.log_event("user.hover",{time:e,uid:this.current_result.user.uid});
}}}},true);
var d=new IMO.REUI.APP.MNPTooltip();
IMO.REUI.APP.MNPResults=function(e){IMO.REUI.APP.MNPResults.superclass.constructor.call(this,e,d);
};
Y.extend(IMO.REUI.APP.MNPResults,IMO.REUI.HoverableContainer);
Y.mix(IMO.REUI.APP.MNPResults.prototype,{is_an_item:function(e){return Y.DOM.hasClass(e,"mnp-result-header");
},get_data_for_node:function(e){return IMO.REUI.MNP_PANEL.results[e.id.split("#")[1]];
},handle_tooltip_mousedown:function(){return false;
}},true);
}());
(function(){var c=IMO.Utils;
var k=c.HTML;
var e=c.sprintf;
var l=c.TranslateDom;
var j=c.TranslateTxt;
var a=IMO.Constants;
a.TEXT.VERIFY_EMAIL_REMINDER="Please verify your email address to access all of the imo Network features. A verification message was sent to [EMAIL]. If you did not receive a verification message, please check your email accounts spam folder.";
a.TEXT.LIMITED_REMINDER="We detected that you are using a fake name. We require everyone to use their real names. Please review our [NAME_POLICY] and submit a Name Change Request.";
if(!IMO.REUI.APP){IMO.REUI.APP={};
}var i=100;
var d={interests:"Interests",contacts:"Contacts",contactof:"Contact of",domains:"Domains",lookingfor:"Looking for",highschool:"High Schools",university:"Universities",employer:"Employers",languages:"Languages"};
var h={ad:"Andorra",ae:"United Arab Emirates",af:"Afghanistan",ag:"Antigua and Barbuda",ai:"Anguilla",al:"Albania",am:"Armenia",an:"Netherlands Antilles",ao:"Angola",aq:"Antarctica",ar:"Argentina",as:"American Samoa",at:"Austria",au:"Australia",aw:"Aruba",ax:"land Islands",az:"Azerbaijan",ba:"Bosnia and Herzegovina",bb:"Barbados",bd:"Bangladesh",be:"Belgium",bf:"Burkina Faso",bg:"Bulgaria",bh:"Bahrain",bi:"Burundi",bj:"Benin",bl:"Saint Barthlemy",bm:"Bermuda",bn:"Brunei",bo:"Bolivia",bq:"Bonaire, Sint Eustatius and Saba",br:"Brazil",bs:"Bahamas",bt:"Bhutan",bv:"Bouvet Island",bw:"Botswana",by:"Belarus",bz:"Belize",ca:"Canada",catalonia:"Catalonia",cc:"Cocos (Keeling) Islands",cd:"Democratic Republic of the Congo",cf:"Central African Republic",cg:"Congo",ch:"Switzerland",ci:"Cote D'Ivoire",ck:"Cook Islands",cl:"Chile",cm:"Cameroon",cn:"China",co:"Colombia",cr:"Costa Rica",cs:"Serbia and Montenegro",cu:"Cuba",cv:"Cape Verde",cw:"Curaao",cx:"Christmas Island",cy:"Cyprus",cz:"Czech Republic",de:"Germany",dj:"Djibouti",dk:"Denmark",dm:"Dominica","do":"Dominican Republic",dz:"Algeria",ec:"Ecuador",ee:"Estonia",eg:"Egypt",eh:"Western Sahara",england:"England",er:"Eritrea",es:"Spain",et:"Ethiopia",eu:"European Union",fi:"Finland",fj:"Fiji",fk:"Falkland Islands (Malvinas)",fm:"Federated States of Micronesia",fo:"Faroe Islands",fr:"France",ga:"Gabon",galicia:"Galicia",gb:"United Kingdom",gd:"Grenada",ge:"Georgia",gf:"French Guiana",gg:"Guernsey",gh:"Ghana",gi:"Gibraltar",gl:"Greenland",gm:"Gambia",gn:"Guinea",gp:"Guadeloupe",gq:"Equatorial Guinea",gr:"Greece",gs:"South Georgia and the South Sandwich Islands",gt:"Guatemala",gu:"Guam",gw:"Guinea-Bissau",gy:"Guyana",hk:"Hong Kong",hm:"Heard Island and McDonald Islands",hn:"Honduras",hr:"Croatia",ht:"Haiti",hu:"Hungary",id:"Indonesia",ie:"Ireland",il:"Israel",im:"Isle of Man","in":"India",io:"British Indian Ocean Territory",iq:"Iraq",ir:"Iran",is:"Iceland",it:"Italy",je:"Jersey",jm:"Jamaica",jo:"Jordan",jp:"Japan",ke:"Kenya",kg:"Kyrgyzstan",kh:"Cambodia",ki:"Kiribati",km:"Comoros",kn:"Saint Kitts and Nevis",kp:"North Korea",kr:"South Korea",kw:"Kuwait",ky:"Cayman Islands",kz:"Kazakhstan",la:"Laos",lb:"Lebanon",lc:"Saint Lucia",li:"Liechtenstein",lk:"Sri Lanka",lr:"Liberia",ls:"Lesotho",lt:"Lithuania",lu:"Luxembourg",lv:"Latvia",ly:"Libya",ma:"Morocco",mc:"Monaco",md:"Moldova",me:"Montenegro",mf:"Saint Martin (French part)",mg:"Madagascar",mh:"Marshall Islands",mk:"Macedonia",ml:"Mali",mm:"Myanmar (Burma)",mn:"Mongolia",mo:"Macau",mp:"Northern Mariana Islands",mq:"Martinique",mr:"Mauritania",ms:"Montserrat",mt:"Malta",mu:"Mauritius",mv:"Maldives",mw:"Malawi",mx:"Mexico",my:"Malaysia",mz:"Mozambique",na:"Namibia",nc:"New Caledonia",nc2:"New Caledonia",ne:"Niger",nf:"Norfolk Island",ng:"Nigeria",ni:"Nicaragua",nl:"Netherlands",no:"Norway",np:"Nepal",nr:"Nauru",nu:"Niue",nz:"New Zealand",om:"Oman",pa:"Panama",pe:"Peru",pf:"French Polynesia",pg:"Papua New Guinea",ph:"Philippines",pk:"Pakistan",pl:"Poland",pm:"St. Pierre and Miquelon",pn:"Pitcairn",pr:"Puerto Rico",ps:"Palestinian Territories",pt:"Portugal",pw:"Palau",py:"Paraguay",qa:"Qatar",re:"Runion",ro:"Romania",rs:"Serbia",ru:"Russian Federation",rw:"Rwanda",sa:"Saudi Arabia",sb:"Solomon Islands",sc:"Seychelles",scotland:"Scotland",sd:"Sudan",se:"Sweden",sg:"Singapore",sh:"Saint Helena, Ascension and Tristan da Cunha",si:"Slovenia",sj:"Svalbard and Jan Mayen",sk:"Slovakia",sl:"Sierra Leone",sm:"San Marino",sn:"Senegal",so:"Somalia",sr:"Suriname",st:"Sao Tome and Principe",sv:"El Salvador",sx:"Sint Maarten (Dutch part)",sy:"Syria",sz:"Swaziland",tc:"Turks and Caicos Islands",td:"Chad",tf:"French Southern Territories",tg:"Togo",th:"Thailand",tj:"Tajikistan",tk:"Tokelau",tl:"Timor-Leste",tm:"Turkmenistan",tn:"Tunisia",to:"Tonga",tr:"Turkey",tt:"Trinidad and Tobago",tv:"Tuvalu",tw:"Taiwan, Province of China",tz:"Tanzania",ua:"Ukraine",ug:"Uganda",um:"U.S. Minor Outlying Islands",us:"United States",uy:"Uruguay",uz:"Uzbekistan",va:"Holy See (Vatican City State)",vc:"Saint Vincent and the Grenadines",ve:"Venezuela",vg:"Virgin Islands (British)",vi:"Virgin Islands (U.S.)",vn:"Viet Nam",vu:"Vanuatu",wales:"Wales",wf:"Wallis and Futuna Islands",ws:"Samoa",ye:"Yemen",yt:"Mayotte",za:"South Africa",zm:"Zambia",zw:"Zimbabwe "};
var m={contacts:true,contactof:true};
var g={contacts:true,contactof:true};
var b={interests:true,contacts:true,contactof:true,domains:true,lookingfor:true,highschool:true,university:true,employer:true,languages:true};
var f=function(o,n,p){this.person=o;
this.container=n;
this.broadcast=p;
var q=IMO.Session.get().get_imo_account();
if(q&&this.person.uid){this.buddy=q.get_buddy(this.person.uid);
if(this.buddy){this.on(this.buddy);
}}this.dom=this.build_dom();
};
Y.mix(f.prototype,IMO.EventTarget);
Y.mix(f.prototype,{data_label_clicked:function(n){var o="";
if(n==="contacts"){o='contacts:"'+this.query_uid+'"';
}else{if(n==="contactof"){o='contactof:"'+this.query_uid+'"';
}else{return;
}}Y.log(["QUERY:",o]);
IMO.REUI.PIN.Directory.show(o);
},data_entry_clicked:function(n,p){var o="";
if(n==="interests"){o='interests:"'+p.value+'"';
}else{if(n==="lookingfor"){o='lookingfor:"'+p.value+'"';
}else{if(n==="university"||n==="highschool"||n==="employer"||n==="languages"){o=n+':"'+p.value+'"';
}else{if(n==="contacts"||n==="contactof"||n==="name"){Y.log(["value",p]);
o=e('user:"%s (%s)"',p.username||p.uid,p.display_name||p.alias);
}else{if(n==="domains"){o='domain:"'+p.value+'"';
}}}}}Y.log(["QUERY:",o]);
IMO.REUI.PIN.Directory.show(o);
},make_typed_item_lable_dom:function(n,p){var o=null;
if(n in g){o=l(d[n]+" ([NUMBER]):",{NUMBER:p});
}else{o=l(d[n]+":");
}return k.cspan("meet-card-data-label",o,{context:this,onclick:function(q){IMO.MouseManager.get().handled(q,"meet-card-label");
if(n in m){this.data_label_clicked(n);
}}});
},make_data_list_dom:function(q,n,p){var r=k.cdiv("meet-card-dataline");
k.add_class(r,"meet-card-"+q);
var o=this.make_typed_item_lable_dom(q,p||n.length);
if(q in m){k.add_class(o,"clickable");
}r.appendChild(o);
c.foreach(n,function(u){var v="";
var s=null;
switch(q){case"interests":case"lookingfor":case"domains":case"university":case"highschool":case"employer":case"languages":v=u.value;
break;
case"contacts":case"contactof":v=(u.display_name||u.alias)+(u.username&&(" ("+u.username+")")||"");
v=(u.display_name||u.alias)+(u.username&&(" ("+u.username+")")||"");
break;
default:break;
}var t=k.cspan("meet-card-data-entry",{context:this,onclick:function(w){IMO.MouseManager.get().handled(w,"meet-card-entry");
if(q in b){this.data_entry_clicked(q,u);
}}},k.cspan("meet-card-data-display",v));
if(u.is_common){k.add_class(t,"common");
}else{k.add_class(t,"not-common");
}if(q in b){k.add_class(t,"clickable");
}r.appendChild(t);
},this);
return r;
},create_social_button:function(n,o,p){return k.cspan("meet-card-social",k.a({href:o,target:"_blank",title:p},k.sprite(n+"_small")));
},make_main_action_button:function(n,o){return new IMO.UIWidgets.Button({color:"small"},{cls:"meet-card-chat-button",onclick:n,context:this},{cls:"meet-card-chat-button-inner"},o);
},readable_date:function(n){var o=["","January","February","March","April","May","June","July","August","September","October","November","December"];
return o[parseInt(n.substring(5,7),10)]+" "+n.substring(8)+", "+n.substring(0,4);
},build_dom:function(){var r=a.DEFAULT_BICON;
if(this.person.profile_photo_id){r="/b/"+c.imo_icon(this.person.profile_photo_id);
}var p=this.person.first_name+" "+this.person.last_name;
if(this.person.username){p+=" ("+this.person.username+")";
}this.details_div=k.cdiv("meet-card-details");
this.details_div.appendChild(k.cdiv("meet-card-location",k.cspan("location-name",l("Location: ")),k.cspan("location-value",this.person.location||"-")));
this.premium_badge=null;
if(this.person.premium){this.premium_badge=k.sprite("premium_account",{cls:"directory-result-premium-badge",title:"Premium Account",context:this,onclick:function(v){IMO.REUI.PremiumAccount.show();
}});
}var s=k.cdiv("meet-card-social-container");
this.details_div.appendChild(s);
c.foreach([IMO.OAuth.GOOGLE2,IMO.OAuth.FACEBOOK,IMO.OAuth.LINKEDIN,IMO.OAuth.TWITTER],function(w){var v=this.person[w+"_profile_url"];
if(!v){return;
}var x=this.person[w+"_full_name"]||"";
s.appendChild(this.create_social_button(w,v,x));
},this);
s.appendChild(k.cspan("meet-card-member-since",l("Member since [DATE]",{DATE:this.readable_date(this.person.signup_date)})));
if(this.person.phone_cc){var u=h[this.person.phone_cc]||"Country code: "+this.person.phone_cc;
s.appendChild(k.cdiv("meet-card-phone-cc",k.sprite(this.person.phone_cc,{title:u,alt:u}),k.sprite("icn_phonebadge",{cls:"meet-card-phone-icn",title:u,alt:""})));
}if(this.broadcast){this.main_action_button=this.make_main_action_button(this.join_discussion,l("Discuss"));
}else{this.main_action_button=this.make_main_action_button(this.start_chat,l("Chat"));
}this.add_button_enabled=k.cdiv("meet-card-add-button enabled",{context:this,onclick:this.add_contact},k.sprite("icn_buddies"),l("Add to contacts"));
this.add_button_disabled=k.cdiv("meet-card-add-button disabled",k.sprite("icn_buddies"),l("In Contacts"));
this.add_button=IMO.REUI.make_EDButton(this.add_button_enabled,this.add_button_disabled,true,true);
var n=c.dfl(this.person.primitive,a.PRIM_UNKNOWN);
this.main_div=k.cdiv("meet-card-main",k.div({style:{width:"300px","white-space":"nowrap"}},this.prim_img=k.img({cls:"meet-card-prim-img sprite_imo_"+n,src:"/images/blank.gif"}),k.cdiv("meet-card-name",p,{onclick:function(v){IMO.MouseManager.get().handled(v,"meet-card-name");
this.data_entry_clicked("name",this.person);
},context:this}),k.cspan("directory-result-premium-badge",this.premium_badge)),this.details_div,this.main_action_button.dom,this.add_button.dom);
this.bio_div=k.cdiv("meet-card-bio",k.cdiv("bio-header",l("Bio:")),k.cdiv("bio-body",c.linkify_string(this.person.bio)));
this.top_div=k.cdiv("meet-card-top",k.cdiv("meet-card-image",k.img({src:r,onclick:function(v){IMO.MouseManager.get().handled(v,"meet-card-image");
this.data_entry_clicked("name",this.person);
},context:this})),this.main_div,this.bio_div,k.cdiv("meet-card-block-container",IMO.REUI.APP.MeetUtils.question_mark(document.querySelector("input.dir-input"),this.person.uid,"user","dir"),k.cspan("meet-card-block",this.block_bt_txt_div=(this.buddy&&this.buddy.blocked)?l("Unblock"):l("Block"),{onclick:function(v){IMO.MouseManager.get().handled(v,"meet-card-block");
if(!this.buddy||!this.buddy.blocked){IMO.REUI.APP.MeetUtils.block_person(this.person);
}else{IMO.REUI.APP.MeetUtils.unblock_person(this.person);
}},context:this}),k.cspan("meet-card-report",l("Report"),{onclick:function(v){IMO.MouseManager.get().handled(v,"meet-card-report");
IMO.REUI.APP.MeetUtils.report_person(this.person,this.broadcast);
},context:this})));
this.bottom_div=k.cdiv("meet-card-bottom");
c.foreach(["interests","lookingfor","highschool","university","employer","contacts","contactof","domains","languages"],function(v){if(this.person[v]&&this.person[v].length){var w=this.make_data_list_dom(v,this.person[v],this.person["num_"+v]);
this.bottom_div.appendChild(w);
}},this);
var q=true;
var t=IMO.Session.get().get_signed_on_imo_account();
if(t){var o=t.get_buddy(this.person.uid);
if(o&&!o.nonbuddy){q=false;
}}this.add_button.set_enabled(q);
this.query_uid="";
if(this.person.username){this.query_uid+=this.person.username;
}else{this.query_uid+=this.person.uid;
}if(IMO.REUI.APP.MeetUtils.is_imo_admin()){this.admin_div=this._build_admin_dom(this.person);
return k.cdiv("meet-card",this.top_div,this.admin_div,this.bottom_div);
}return k.cdiv("meet-card",this.top_div,this.bottom_div);
},_build_admin_dom:function(n){var o=k.cdiv("meet-card-admin",k.cdiv("meet-card-admin-buttons",k.cspan("meet-card-admin-button link",k("Suspend"),{onclick:function(p){IMO.MouseManager.get().handled(p,"meet-card-admin");
IMO.REUI.APP.MeetUtils.admin_call("suspend",n.uid,{});
},context:this}),k.cspan("meet-card-admin-button link",k("Limit"),{onclick:function(p){IMO.MouseManager.get().handled(p,"meet-card-admin");
IMO.REUI.APP.MeetUtils.admin_call("limit",n.uid,{});
},context:this}),k.cspan("meet-card-admin-button link",k("Delete Photo"),{onclick:function(p){IMO.MouseManager.get().handled(p,"meet-card-admin");
IMO.REUI.APP.MeetUtils.admin_call("delete_photo",n.uid,{});
},context:this}),k.cspan("meet-card-admin-button link",k("Delete Account"),{onclick:function(p){IMO.MouseManager.get().handled(p,"meet-card-admin");
IMO.REUI.APP.MeetUtils.admin_call("delete_account",n.uid,{});
},context:this}),k.a({href:"mailto:"+n.email,target:"_blank"},n.email)));
if(n.name_change_request){o.appendChild(k.cdiv("meet-card-admin-name-change",k.cspan("name-change-label",k("Request Name Change To:")),k.cspan("name",k(n.name_change_request.first)),k.cspan("name",k(n.name_change_request.last)),k.cspan("meet-card-admin-button link",k("Accept"),{onclick:function(p){IMO.MouseManager.get().handled(p,"meet-card-admin");
IMO.REUI.APP.MeetUtils.admin_call("accept_name_change",n.uid,{request_id:n.name_change_request.request_id});
},context:this}),k.cspan("meet-card-admin-button link",k("Reject"),{onclick:function(p){IMO.MouseManager.get().handled(p,"meet-card-admin");
IMO.REUI.APP.MeetUtils.reject_name_change(n);
},context:this})));
}if(n.spam_reports){this.history_divs={};
c.foreach(n.spam_reports,function(p){o.appendChild(k.cdiv("meet-card-admin-spam",k.cspan("spam-label",k("Spam Report:")),k.cspan("spam-time",k(p.time)),k.cspan("spam-user link",k(p.name),{onclick:function(q){IMO.MouseManager.get().handled(q,"meet-card-admin");
IMO.REUI.PIN.Directory.show("user:"+p.uid);
},context:this}),k.cspan("spam-type",k(p.ctype)),k.cspan("spam-state",k(p.cstate)),p.chistory.length>0?k.cspan("spam-history-label link",k("Chat History"),{onclick:function(q){IMO.MouseManager.get().handled(q,"meet-card-admin");
k.toggle_class(this.history_divs[p.id],"invisible");
},context:this}):null));
if(p.chistory.length>0){o.appendChild(this.history_divs[p.id]=k.cdiv("chat-history invisible"));
c.foreach(p.chistory,function(q){this.history_divs[p.id].appendChild(k.cdiv("chat-line",k.cspan("chat-who",k(q.who)),k.cspan("chat-ts",k(q.timestamp)),k.cspan("chat-msg",k(q.msg))));
},this);
}},this);
}if(n.profile_history){c.foreach(n.profile_history,function(p){o.appendChild(k.cdiv("meet-card-admin-history",k.cspan("history-time",p.time),k.cspan("history-var",p.hvar),k.cspan("history-old-val",p.old_val),k.cspan("history-new-val",p.new_val)));
},this);
}return o;
},destroy:function(){k.destroy(this.dom);
this.main_action_button.destroy();
this.add_button.destroy();
delete this.dom;
},add_contact:function(o){IMO.MouseManager.get().handled(o,"app-meet-new-people-add");
var n=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!n){return;
}n.add_buddy(this.person.uid,IMO.SharedConstants.BuddyGroups.IMO_CONTACTS);
this.add_button.set_enabled(false);
},start_chat:function(n){IMO.MouseManager.get().handled(n,"app-meet-new-people-chat");
Y.log(["Person: ",this.person]);
IMO.REUI.APP.MeetUtils.start_chat(this.person.uid,this.person.display_name,this.person.profile_photo_id);
},join_discussion:function(n){IMO.MouseManager.get().handled(n,"app-meet-new-people-discuss");
IMO.REUI.APP.MeetUtils.join_discussion(this.broadcast.id,this.broadcast.text);
},on_buddy_update:function(){var n=this.buddy.blocked?l("Unblock"):l("Block");
k.replace_content(this.block_bt_txt_div,n);
}});
IMO.REUI.APP.MeetUtils={show_pin_tutorial:function(){if(!this.show_tutorial_conf){IMO.REUI.APP.MeetUtils._handle_show_tutorial_conf(1);
}},_handle_show_tutorial_conf:function(n){if(n===1){this._start_pin_tutorial();
}var o=IMO.REUI.APP.MeetUtils.get_uid_proto(true);
if(!o.uid){Y.log("No account","error","meet_mini.js");
return;
}IMO.Network.get().send("pin","tutorial_shown",{ssid:IMO.Session.get().ssid,uid:o.uid,proto:o.proto});
},_start_pin_tutorial:function(){if(!this.tutorial){this.tutorial=new IMO.REUI.Tutorial([IMO.Texts.PIN_TUTORIAL_1,IMO.Texts.PIN_TUTORIAL_2,IMO.Texts.PIN_TUTORIAL_3],["directory_button","header-mnp-btn","mnp-panel-footer"]);
}this.tutorial.set_action(1,IMO.U.toggle_mnp(true,false),null);
this.tutorial.start();
},get_uid_proto:function(p){var q=IMO.Session.get().get_imo_account();
if(!q&&!p){q=IMO.Session.get().get_account_filter(null,null);
}var n=null;
var o=null;
if(q){n=q.uid;
o=q.proto;
}return{uid:n,proto:o};
},is_imo_admin:function(){return(IMO.U.query.hasOwnProperty("imo_admin")&&IMO.Alpha.get().has_feature("imo_admin"));
},admin_call:function(q,p,n){var o=IMO.REUI.APP.MeetUtils.get_uid_proto(true);
if(!o.uid){return;
}IMO.Network.get().send("imo_directory","admin_call",{ssid:IMO.Session.get().ssid,uid:o.uid,method:q,target_uid:p,params:n});
},get_buddy_for_buid:function(s,r,p,o){var n=s.get_buddy(r,false);
if(!n){n=s.get_buddy(r,true);
var q={display:p,group:a.GROUPNAME_MEET,icon:c.imo_icon(o),primitive:a.PRIM_UNKNOWN};
n.update(q);
n.nonbuddy=true;
}return n;
},start_chat:function(r,p,o){var q=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!q){return false;
}Y.log(["start chat with buddy",this.person]);
var n=this.get_buddy_for_buid(q,r,p,o);
var s=n.get_im_conversation();
if(s.ui){Y.later(50,this,function(){s.ui.focus();
});
return true;
}return false;
},join_discussion:function(o,n){var q=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!q){return false;
}var p=(IMO.U.query.hasOwnProperty("imodirectory2")||document.location.hostname==="test.imo.im")?"imo_broadcasts":"imo_directory";
IMO.Network.get().send(p,"join_discussion2",{bid:o,uid:q.uid},true,function(r){Y.log(["join_discussion cb",r]);
if(r.status!==true){return;
}var s=r.gid;
var t=q.groups.get_group(s,true);
Y.log(["discussion group",t]);
t.update({bid:o,type:a.GROUP_TYPE.DISCUSSION,alias:n});
var u=t.get_im_conversation();
if(u.ui){u.ui.focus();
}},this);
},block_person:function(o){var p=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!p){return;
}var n=this.get_buddy_for_buid(p,o.uid,o.display_name,o.profile_photo_id);
n.set_blocked(true);
},unblock_person:function(o){var p=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!p){return;
}var n=this.get_buddy_for_buid(p,o.uid,o.display_name,o.profile_photo_id);
n.set_blocked(false);
},report_person:function(n,o){var p=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!p){return;
}this.spam_widget=new IMO.REUI.SpamReportWidget(n.uid,n.display_name||n.alias,null,(o?o.id:null));
},reject_name_change:function(n){var o=IMO.REUI.APP.MeetUtils.verify_imo_account_online();
if(!o){return;
}this.reject_name_change_widget=new IMO.REUI.RejectNameChangeWidget(n.uid,n.name_change_request.request_id);
},verify_imo_account_online:function(n){var o=IMO.Session.get().get_imo_account();
if(!o){if(!n){this.show_imo_required();
}return null;
}if(o.state!==a.IM_STATE_ONLINE){if(!n){this.show_imo_login_required();
}return null;
}if(o.account_limited){if(!n){this.show_name_change_required();
}return null;
}if(!o.account_activated){if(!n){this.show_activation_required(o.uid);
}return null;
}return o;
},show_imo_login_required:function(){this.imo_account_required=new IMO.REUI.ConfirmModalPopup("Your imo account is offline",j("An Imo account is required to broadcast."),[[l("Cancel"),"grey"],[l("Login"),"blue"]],this.handle_imo_account_login_required,this);
},show_imo_required:function(){this.imo_account_required=new IMO.REUI.ConfirmModalPopup("Do you have an Imo Account?",j("An Imo account is required to broadcast."),[[l("Cancel"),"grey"],[l("Create Account"),"blue"],[l("Login"),"blue"]],this.handle_imo_account_required,this);
},show_name_change_required:function(){if(this.name_change_required){return;
}this.name_change_required=new IMO.REUI.ConfirmModalPopup("Your imo account has been Limited",l(a.TEXT.LIMITED_REMINDER,{NAME_POLICY:k.a("Name Policy",{href:"/policies/profile_name_policy.html",target:"_blank"})}),[[l("Cancel"),"grey"],[l("Request Name Change"),"blue"]],function(n){this.handle_name_change_required(n);
},this);
},show_activation_required:function(o){var p=IMO.Session.get().get_imo_account();
var n=p.email||"email";
this.imo_activation_required=new IMO.REUI.ConfirmModalPopup("Did you verify your Imo Account?",j(a.TEXT.VERIFY_EMAIL_REMINDER,{EMAIL:n}),[[l("OK"),"blue"],[l("Resend verification"),"blue"]],function(q){this.handle_imo_activation_required(q,o);
},this);
},show_adding_first_buddy:function(o,n,p){this.adding_first_buddy=new IMO.REUI.ConfirmModalPopup("Add public contact?",j("Please note that all contacts on the Imo Network are public. Do you want to add this contact?"),[[l("No"),"grey"],[l("Yes"),"blue"]],function(q){this.handle_adding_first_buddy(q,o,n,p);
},this);
},handle_imo_account_login_required:function(n){this.imo_account_required.destroy();
delete this.imo_account_required;
if(n===1){var o=IMO.Session.get().get_imo_account();
if(o){o.relogin();
}else{IMO.REUI.Accounts.show_account_login(false,null,a.PROTO_IMO);
}}},handle_imo_account_required:function(n){this.imo_account_required.destroy();
delete this.imo_account_required;
if(n===1){IMO.U.request_imo_signup_window(IMO.pin_invite_id);
}else{if(n===2){IMO.REUI.Accounts.show_account_login(false,null,a.PROTO_IMO);
}}},handle_name_change_required:function(n){this.name_change_required.destroy();
delete this.name_change_required;
if(n===1){IMO.REUI.PIN.NameChangePopup.show();
}},handle_imo_activation_required:function(o,n){this.imo_activation_required.destroy();
delete this.imo_activation_required;
if(o===0){IMO.Network.get().send("pin","get_account_data",{uid:n,proto:a.PROTO_IMO});
}else{IMO.Network.get().send("imo_account","resend_verification_code",{uid:n});
}},handle_adding_first_buddy:function(n,p,o,q){this.adding_first_buddy.destroy();
delete this.adding_first_buddy;
if(n===1){p.add_buddies(o,q,true);
}},create_person_widget:function(o,n,p){return new f(o,n,p);
},search_delay:function(o){var n=null;
switch(o.keyCode){case IMO.KeyboardManager.name2code.enter:case IMO.KeyboardManager.name2code.space:n=0;
break;
default:n=i;
break;
}return n;
},shorten_location:function(n){if(!n){return n;
}var o=n.split(",");
if(o.length==3&&o[o.length-1].toLowerCase().indexOf("united states")===-1){return o[0]+","+o[o.length-1];
}else{return n;
}},question_mark:function(p,w,v,o){var r=IMO.REUI.APP.MeetUtils.verify_imo_account_online(true);
var q=null;
var n=window.location.href;
var u=false;
var t="https://imoaccountadmin.office.imo.im";
if(n.indexOf("localhost")!=-1||n.indexOf("facebooktest")!=-1){t="localhost:16030";
u=true;
}var s="";
if(p){s=p.value;
if(s=="people and broadcasts"){s="";
}}if(r&&(u||IMO.Alpha.get().has_feature("score_details"))){q=k.cspan("mnp-result-question-mark",k.a(k.sprite("question_mark"),{href:t+"/"+o+"score?uid="+r.uid+"&reset=1&item_class="+v+"&item_id="+w+"&query="+encodeURIComponent(s),onclick:function(x){x.stopPropagation();
}}));
}return q;
}};
}());
(function(){var a=IMO.Utils;
var c=a.HTML;
var b=IMO.Utils.TranslateDom;
IMO.REUI.RejectNameChangeWidget=function(d,e){Y.log("HERE");
this.reasons=[{value:"",label:"(no reason)"},{label:"because you have not entered a real name. We require everyone to use their real first and last names so you know who you are chatting with."}];
this.xuid=d;
this.request_id=e;
this.build_dom();
this.popup=new IMO.ModalPopup(this);
this.popup.set_title("Reject Name Change");
this.popup.set_content(this.dom,[500,350]);
this.popup.prepare();
this.sc_uid=IMO.KeyboardManager.get().push({bindings:{esc:{cb:this.hide},enter:{cb:this.save}},bottom:true,context:this});
this.popup.show();
};
Y.mix(IMO.REUI.RejectNameChangeWidget.prototype,{build_dom:function(){this.reject_buttons=[];
this.dom=c.cdiv("reject-name-change-widget");
a.foreach(this.reasons,function(i){var f=c.cdiv("reject-type");
var j=c.get_unique_id();
var h=i.value;
if(h===undefined){h=i.label;
}var g=c.input({type:"radio",id:j,name:"reject-reasons",context:this,value:h});
f.appendChild(g);
f.appendChild(c.span(i.label));
this.dom.appendChild(f);
this.reject_buttons.push(g);
},this);
this.reject_buttons[1].checked=true;
var d=c.cdiv("reject-type");
var e=c.get_unique_id();
this.reject_other_button=c.input({type:"radio",id:e,name:"reject-reasons",context:this,value:"user_defined"});
this.user_defined_text=c.input({type:"text",id:e});
d.appendChild(this.reject_other_button);
d.appendChild(this.user_defined_text);
this.dom.appendChild(d);
this.dom.appendChild(c.cdiv("reject-controls",IMO.REUI.Button("grey",b("Cancel"),{cls:"cancel-button",onclick:function(f){IMO.MouseManager.get().handled(f,"reject-cancel-button");
this.hide();
},context:this}),IMO.REUI.Button("blue",b("Submit"),{cls:"submit-button",onclick:function(f){IMO.MouseManager.get().handled(f,"reject-submit-button");
this.save();
},context:this}),c.cdiv("clear")));
},save:function(){var d=null;
a.foreach(this.reject_buttons,function(e){if(e.checked){d=e.value;
return e.value;
}},this);
if(this.reject_other_button.checked){d=this.user_defined_text.value;
}this.hide();
IMO.REUI.APP.MeetUtils.admin_call("reject_name_change",this.xuid,{request_id:this.request_id,reason:d});
},hide:function(){IMO.KeyboardManager.get().pop(this.sc_uid);
delete this.sc_uid;
this.popup.hide();
},destroy:function(){this.popup.destroy();
delete this.popup;
}});
}());
IMO.Splash.loaded();
